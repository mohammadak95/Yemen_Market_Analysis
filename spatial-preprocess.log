{"level":"info","message":"Starting enhanced spatial preprocessing...","timestamp":"2024-11-10T16:22:57.702Z"}
{"level":"info","message":"Processing base data...","timestamp":"2024-11-10T16:22:57.712Z"}
{"level":"error","message":"Preprocessing failed: this.loadGeoData is not a function","stack":"TypeError: this.loadGeoData is not a function\n    at EnhancedSpatialPreprocessor.processBaseData (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/preprocessing/enhancedSpatialPreprocessor.js:83:12)\n    at EnhancedSpatialPreprocessor.processAll (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/preprocessing/enhancedSpatialPreprocessor.js:57:18)\n    at buildSpatialData (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/build.js:152:46)","timestamp":"2024-11-10T16:22:57.713Z"}
{"level":"info","message":"Starting enhanced spatial preprocessing...","timestamp":"2024-11-10T16:41:02.820Z"}
{"level":"info","message":"Starting enhanced spatial preprocessing...","timestamp":"2024-11-10T16:43:56.577Z"}
{"level":"info","message":"Processing base data...","timestamp":"2024-11-10T16:43:56.645Z"}
{"level":"error","message":"File operation failed: this.normalizeWeightsData is not a function","timestamp":"2024-11-10T16:43:56.670Z"}
{"level":"error","message":"Preprocessing failed: this.normalizeWeightsData is not a function","stack":"TypeError: this.normalizeWeightsData is not a function\n    at /Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/preprocessing/enhancedSpatialPreprocessor.js:349:19\n    at async EnhancedSpatialPreprocessor.safeFileOperation (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/preprocessing/enhancedSpatialPreprocessor.js:311:14)\n    at async EnhancedSpatialPreprocessor.loadWeightsData (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/preprocessing/enhancedSpatialPreprocessor.js:347:12)\n    at async Promise.all (index 3)\n    at async EnhancedSpatialPreprocessor.processBaseData (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/preprocessing/enhancedSpatialPreprocessor.js:82:62)\n    at async EnhancedSpatialPreprocessor.processAll (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/preprocessing/enhancedSpatialPreprocessor.js:57:7)\n    at async buildSpatialData (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/build.js:184:27)\n    at async runBuild (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/runBuild.js:171:20)","timestamp":"2024-11-10T16:43:56.691Z"}
{"level":"error","message":"File operation failed: /Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/results/network_data/time_varying_flows.csv: Unexpected token 'd', \"date,sourc\"... is not valid JSON","timestamp":"2024-11-10T16:43:56.715Z"}
{"level":"info","message":"Starting enhanced spatial preprocessing...","timestamp":"2024-11-10T16:47:18.186Z"}
{"level":"info","message":"Processing base data...","timestamp":"2024-11-10T16:47:18.195Z"}
{"level":"error","message":"File operation failed: this.normalizeRegionName is not a function","timestamp":"2024-11-10T16:47:18.233Z"}
{"level":"error","message":"Preprocessing failed: this.normalizeRegionName is not a function","stack":"TypeError: this.normalizeRegionName is not a function\n    at /Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/preprocessing/enhancedSpatialPreprocessor.js:458:20\n    at Array.map (<anonymous>)\n    at EnhancedSpatialPreprocessor.normalizeFlowsData (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/preprocessing/enhancedSpatialPreprocessor.js:456:22)\n    at /Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/preprocessing/enhancedSpatialPreprocessor.js:340:19\n    at async /Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/preprocessing/enhancedSpatialPreprocessor.js:530:16\n    at async EnhancedSpatialPreprocessor.loadFlowData (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/preprocessing/enhancedSpatialPreprocessor.js:334:12)\n    at async Promise.all (index 1)\n    at async EnhancedSpatialPreprocessor.processBaseData (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/preprocessing/enhancedSpatialPreprocessor.js:83:62)\n    at async EnhancedSpatialPreprocessor.processAll (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/preprocessing/enhancedSpatialPreprocessor.js:58:7)\n    at async buildSpatialData (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/build.js:184:27)","timestamp":"2024-11-10T16:47:18.234Z"}
{"level":"info","message":"Starting enhanced spatial preprocessing...","timestamp":"2024-11-10T16:49:43.075Z"}
{"level":"info","message":"Processing base data...","timestamp":"2024-11-10T16:49:43.084Z"}
{"level":"info","message":"Processing derived data...","timestamp":"2024-11-10T16:49:43.132Z"}
{"level":"error","message":"Preprocessing failed: this.calculateSpatialWeights is not a function","stack":"TypeError: this.calculateSpatialWeights is not a function\n    at EnhancedSpatialPreprocessor.processDerivedData (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/preprocessing/enhancedSpatialPreprocessor.js:108:12)\n    at EnhancedSpatialPreprocessor.processAll (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/preprocessing/enhancedSpatialPreprocessor.js:61:18)\n    at async buildSpatialData (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/build.js:184:27)\n    at async runBuild (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/runBuild.js:171:20)","timestamp":"2024-11-10T16:49:43.132Z"}
{"level":"info","message":"Starting enhanced spatial preprocessing...","timestamp":"2024-11-10T16:51:33.058Z"}
{"level":"info","message":"Processing base data...","timestamp":"2024-11-10T16:51:33.068Z"}
{"level":"info","message":"Processing derived data...","timestamp":"2024-11-10T16:51:33.118Z"}
{"level":"error","message":"Preprocessing failed: this.identifyMarketClusters is not a function","stack":"TypeError: this.identifyMarketClusters is not a function\n    at EnhancedSpatialPreprocessor.processDerivedData (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/preprocessing/enhancedSpatialPreprocessor.js:109:12)\n    at EnhancedSpatialPreprocessor.processAll (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/preprocessing/enhancedSpatialPreprocessor.js:61:18)\n    at async buildSpatialData (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/build.js:184:27)\n    at async runBuild (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/runBuild.js:171:20)","timestamp":"2024-11-10T16:51:33.119Z"}
{"level":"info","message":"Starting enhanced spatial preprocessing...","timestamp":"2024-11-10T16:54:49.100Z"}
{"level":"info","message":"Processing base data...","timestamp":"2024-11-10T16:54:49.118Z"}
{"level":"info","message":"Processing derived data...","timestamp":"2024-11-10T16:54:49.204Z"}
{"level":"error","message":"Error identifying market clusters: Cannot convert undefined or null to object","stack":"TypeError: Cannot convert undefined or null to object\n    at Function.keys (<anonymous>)\n    at EnhancedSpatialPreprocessor.findInitialClusters (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/preprocessing/enhancedSpatialPreprocessor.js:860:12)\n    at EnhancedSpatialPreprocessor.identifyMarketClusters (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/preprocessing/enhancedSpatialPreprocessor.js:825:36)\n    at EnhancedSpatialPreprocessor.processDerivedData (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/preprocessing/enhancedSpatialPreprocessor.js:109:12)\n    at EnhancedSpatialPreprocessor.processAll (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/preprocessing/enhancedSpatialPreprocessor.js:61:18)\n    at async buildSpatialData (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/build.js:184:27)\n    at async runBuild (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/runBuild.js:171:20)","timestamp":"2024-11-10T16:54:49.206Z"}
{"level":"info","message":"Processing analysis data...","timestamp":"2024-11-10T16:54:49.207Z"}
{"level":"error","message":"Preprocessing failed: this.analyzeVolatility is not a function","stack":"TypeError: this.analyzeVolatility is not a function\n    at EnhancedSpatialPreprocessor.processAnalysis (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/preprocessing/enhancedSpatialPreprocessor.js:134:12)\n    at EnhancedSpatialPreprocessor.processAll (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/preprocessing/enhancedSpatialPreprocessor.js:64:18)\n    at async buildSpatialData (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/build.js:184:27)\n    at async runBuild (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/runBuild.js:171:20)","timestamp":"2024-11-10T16:54:49.207Z"}
{"level":"info","message":"Starting enhanced spatial preprocessing...","timestamp":"2024-11-10T16:59:39.038Z"}
{"level":"info","message":"Processing base data...","timestamp":"2024-11-10T16:59:39.048Z"}
{"level":"info","message":"Processing derived data...","timestamp":"2024-11-10T16:59:39.100Z"}
{"level":"error","message":"Error identifying market clusters: Cannot convert undefined or null to object","stack":"TypeError: Cannot convert undefined or null to object\n    at Function.keys (<anonymous>)\n    at EnhancedSpatialPreprocessor.findInitialClusters (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/preprocessing/enhancedSpatialPreprocessor.js:860:12)\n    at EnhancedSpatialPreprocessor.identifyMarketClusters (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/preprocessing/enhancedSpatialPreprocessor.js:825:36)\n    at EnhancedSpatialPreprocessor.processDerivedData (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/preprocessing/enhancedSpatialPreprocessor.js:109:12)\n    at EnhancedSpatialPreprocessor.processAll (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/preprocessing/enhancedSpatialPreprocessor.js:61:18)\n    at async buildSpatialData (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/build.js:184:27)\n    at async runBuild (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/runBuild.js:171:20)","timestamp":"2024-11-10T16:59:39.100Z"}
{"level":"info","message":"Processing analysis data...","timestamp":"2024-11-10T16:59:39.100Z"}
{"level":"error","message":"Preprocessing failed: this.analyzeVolatility is not a function","stack":"TypeError: this.analyzeVolatility is not a function\n    at EnhancedSpatialPreprocessor.processAnalysis (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/preprocessing/enhancedSpatialPreprocessor.js:134:12)\n    at EnhancedSpatialPreprocessor.processAll (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/preprocessing/enhancedSpatialPreprocessor.js:64:18)\n    at async buildSpatialData (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/build.js:184:27)\n    at async runBuild (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/runBuild.js:171:20)","timestamp":"2024-11-10T16:59:39.101Z"}
{"level":"info","message":"Starting enhanced spatial preprocessing...","timestamp":"2024-11-10T17:06:21.146Z"}
{"level":"info","message":"Processing base data...","timestamp":"2024-11-10T17:06:21.155Z"}
{"level":"info","message":"Processing derived data...","timestamp":"2024-11-10T17:06:21.204Z"}
{"level":"info","message":"Calculating spatial weights","timestamp":"2024-11-10T17:06:21.204Z"}
{"level":"error","message":"No features found for spatial weights calculation","timestamp":"2024-11-10T17:06:21.205Z"}
{"level":"error","message":"Error identifying market clusters: Cannot convert undefined or null to object","stack":"TypeError: Cannot convert undefined or null to object\n    at Function.keys (<anonymous>)\n    at EnhancedSpatialPreprocessor.findInitialClusters (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/preprocessing/enhancedSpatialPreprocessor.js:871:12)\n    at EnhancedSpatialPreprocessor.identifyMarketClusters (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/preprocessing/enhancedSpatialPreprocessor.js:836:36)\n    at EnhancedSpatialPreprocessor.processDerivedData (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/preprocessing/enhancedSpatialPreprocessor.js:120:12)\n    at EnhancedSpatialPreprocessor.processAll (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/preprocessing/enhancedSpatialPreprocessor.js:1550:18)\n    at async buildSpatialData (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/build.js:184:27)\n    at async runBuild (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/runBuild.js:171:20)","timestamp":"2024-11-10T17:06:21.205Z"}
{"level":"info","message":"Processing analysis data...","timestamp":"2024-11-10T17:06:21.206Z"}
{"level":"info","message":"Analyzing volatility","timestamp":"2024-11-10T17:06:21.206Z"}
{"level":"info","message":"Volatility analysis completed","timestamp":"2024-11-10T17:06:21.206Z"}
{"error":"Cannot convert undefined or null to object","lastState":"{\n  base: {\n    geo: async () => {\n      try {\n        return await operation();\n      } catch (error) {\n        this.logger.error(`File operation failed: ${error.message}`);\n        if (error.code === 'ENOENT') {\n          this.logger.warn('File not found, using fallback data');\n          return fallback;\n        }\n        throw error;\n      }\n    }\n    flows: Array(4689): {\n        date: MAX_DEPTH\n        source: MAX_DEPTH\n        source_lat: MAX_DEPTH\n        ...(8 more)\n      }...\n    timeSeries: async () => {\n      try {\n        return await operation();\n      } catch (error) {\n        this.logger.error(`File operation failed: ${error.message}`);\n        if (error.code === 'ENOENT') {\n          this.logger.warn('File not found, using fallback data');\n          return fallback;\n        }\n        throw error;\n      }\n    }\n    ...(1 more)\n  }\n  derived: {\n    spatialWeights: {\n    }\n    marketClusters: Array(0)\n    timeSeriesStats: {\n    }\n    ...(1 more)\n  }\n  analysis: {\n  }\n  ...(1 more)\n}","level":"error","message":"Preprocessing failed:","stack":"TypeError: Cannot convert undefined or null to object\n    at Function.keys (<anonymous>)\n    at EnhancedSpatialPreprocessor.calculateResilienceScores (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/preprocessing/enhancedSpatialPreprocessor.js:255:33)\n    at EnhancedSpatialPreprocessor.processAnalysis (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/preprocessing/enhancedSpatialPreprocessor.js:150:41)\n    at async EnhancedSpatialPreprocessor.processAll (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/preprocessing/enhancedSpatialPreprocessor.js:1555:7)\n    at async buildSpatialData (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/build.js:184:27)\n    at async runBuild (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/runBuild.js:171:20)","timestamp":"2024-11-10T17:06:21.206Z"}
{"level":"info","message":"Starting enhanced spatial preprocessing...","timestamp":"2024-11-10T17:15:55.557Z"}
{"level":"info","message":"Starting enhanced spatial preprocessing...","timestamp":"2024-11-10T18:12:53.643Z"}
{"level":"info","message":"Processing base data...","timestamp":"2024-11-10T18:12:53.652Z"}
{"level":"error","message":"File operation failed: this.normalizeDate is not a function","timestamp":"2024-11-10T18:12:53.695Z"}
{"level":"error","message":"Error processing base data: this.normalizeDate is not a function","stack":"TypeError: this.normalizeDate is not a function\n    at /Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/preprocessing/enhancedSpatialPreprocessor.js:1644:20\n    at Array.map (<anonymous>)\n    at EnhancedSpatialPreprocessor.normalizeFlowsData (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/preprocessing/enhancedSpatialPreprocessor.js:1627:22)\n    at /Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/preprocessing/enhancedSpatialPreprocessor.js:1753:19\n    at async EnhancedSpatialPreprocessor.safeFileOperation (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/preprocessing/enhancedSpatialPreprocessor.js:1789:14)\n    at async FileOperationQueue.processQueue (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/preprocessing/enhancedSpatialPreprocessor.js:2426:22)","timestamp":"2024-11-10T18:12:53.695Z"}
{"error":"this.normalizeDate is not a function","lastState":"{\n  base: {\n  }\n  derived: {\n  }\n  analysis: {\n  }\n  ...(1 more)\n}","level":"error","message":"Preprocessing failed:","stack":"TypeError: this.normalizeDate is not a function\n    at /Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/preprocessing/enhancedSpatialPreprocessor.js:1644:20\n    at Array.map (<anonymous>)\n    at EnhancedSpatialPreprocessor.normalizeFlowsData (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/preprocessing/enhancedSpatialPreprocessor.js:1627:22)\n    at /Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/preprocessing/enhancedSpatialPreprocessor.js:1753:19\n    at async EnhancedSpatialPreprocessor.safeFileOperation (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/preprocessing/enhancedSpatialPreprocessor.js:1789:14)\n    at async FileOperationQueue.processQueue (/Users/mohammmadalakkaoui/Documents/GitHub/Yemen_Market_Analysis/scripts/preprocessing/enhancedSpatialPreprocessor.js:2426:22)","timestamp":"2024-11-10T18:12:53.696Z"}
