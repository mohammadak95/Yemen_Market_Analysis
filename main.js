(self.webpackChunkyemen_market_analysis=self.webpackChunkyemen_market_analysis||[]).push([[792],{55425:(e,t,r)=>{"use strict";r.d(t,{Mc:()=>o,Oz:()=>l,kP:()=>s,qV:()=>i,su:()=>a,yh:()=>n});const i={HIGH:.7,MEDIUM:.4,LOW:.2},a={DENSITY:{HIGH:.6,MEDIUM:.3,LOW:.1},CENTRALITY:{HIGH:.8,MEDIUM:.5,LOW:.2}},n={MIN_FLOW_WIDTH:1,MAX_FLOW_WIDTH:5,MIN_OPACITY:.4,MAX_OPACITY:.8,MIN_NODE_SIZE:4,MAX_NODE_SIZE:10,NODE_BORDER_WIDTH:1,NODE_OPACITY:.8,NODE_BORDER_OPACITY:1,SELECTION_SCALE:1.5,HOVER_SCALE:1.2,ANIMATION_DURATION:200},o={POSITIVE:"#1976d2",NEGATIVE:"#d32f2f",NEUTRAL:"#757575",SELECTED:"#ffc107",NODE:{FILL:"#1976d2",BORDER:"#ffffff",SELECTED:"#ffc107",INACTIVE:"#757575"}},s={ACTIVE:"Active",INACTIVE:"Inactive",STABLE:"Stable",PARTIAL:"Partial"},l={filterFlowsByDate:(e,t)=>{if(!Array.isArray(e)||!t)return[];const r=t.substring(0,7);return e.filter((e=>{if(!e)return!1;const t=e.date||e.month||null;if(!t)return!1;return t.substring(0,7)===r}))},isValidCoordinates:e=>!!e&&(Array.isArray(e.source_coordinates)&&Array.isArray(e.target_coordinates)?2===e.source_coordinates.length&&2===e.target_coordinates.length&&e.source_coordinates.every((e=>"number"==typeof e&&!isNaN(e)))&&e.target_coordinates.every((e=>"number"==typeof e&&!isNaN(e))):Array.isArray(e.source)&&Array.isArray(e.target)&&2===e.source.length&&2===e.target.length&&e.source.every((e=>"number"==typeof e&&!isNaN(e)))&&e.target.every((e=>"number"==typeof e&&!isNaN(e)))),isValidFlow:e=>{var t;const r=e&&"object"==typeof e&&"string"==typeof e.source&&"string"==typeof e.target&&"number"==typeof e.flow_weight&&!isNaN(e.flow_weight)&&(null===(t=e.metadata)||void 0===t?void 0:t.valid);if(!r&&e);return r},getFlowValue:e=>!e||"number"!=typeof e.flow_weight||isNaN(e.flow_weight)?0:e.flow_weight,normalizeFlow:(e,t)=>{const r=l.getFlowValue(e);return!t||t<=0?0:r/t},getFlowStatus:e=>"number"!=typeof e||isNaN(e)?s.INACTIVE:e>=i.HIGH?s.ACTIVE:e>=i.MEDIUM?s.STABLE:e>=i.LOW?s.PARTIAL:s.INACTIVE,calculateNodeSize:(e,t)=>{if(!t||t<=0)return n.MIN_NODE_SIZE;const r=e/t;return n.MIN_NODE_SIZE+r*(n.MAX_NODE_SIZE-n.MIN_NODE_SIZE)},calculateFlowMetrics:e=>{if(!Array.isArray(e))return null;const t=e.filter(l.isValidFlow);if(!t.length)return null;const r=t.map(l.getFlowValue),i=r.reduce(((e,t)=>e+t),0),a=i/r.length,n=Math.max(...r),o=Math.min(...r),s=r.reduce(((e,t)=>e+Math.pow(t-a,2)),0)/r.length,c=Math.sqrt(s);return{totalFlow:i,avgFlow:a,maxFlow:n,minFlow:o,stdDev:c,count:t.length,normalized:r.map((e=>e/n))}}}},34953:(e,t,r)=>{"use strict";r.d(t,{IU:()=>o,YP:()=>a,ih:()=>n});const i={abyan:[45.83,13.58],aden:[45.03,12.77],"al bayda":[45.57,14.17],"al dhale'e":[44.73,13.7],"al hudaydah":[42.95,14.8],"al jawf":[45.5,16.6],"al maharah":[51.83,16.52],"al mahwit":[43.55,15.47],"amanat al asimah":[44.21,15.35],amran:[43.94,15.66],dhamar:[44.24,14.54],hadramaut:[48.78,15.93],hajjah:[43.6,15.63],ibb:[44.18,13.97],lahj:[44.88,13.03],marib:[45.32,15.47],raymah:[43.71,14.68],"sana'a":[44.21,15.35],shabwah:[47.01,14.53],taizz:[44.02,13.58],socotra:[53.87,12.47]},a=e=>{if(!e)return"";const t=e.toLowerCase().trim().replace(/\s+/g," ").replace(/ governorate$/i,"").replace(/ʿ/g,"'").replace(/['']/g,"'").trim();return{"'adan governorate":"aden","'adan":"aden",ʿadan:"aden","ad dali' governorate":"al dhale'e","ad dali'":"al dhale'e","ad dali":"al dhale'e","al dhale":"al dhale'e","al dhale'":"al dhale'e","sa'dah governorate":"saada","sa'dah":"saada",sadah:"saada","sa'ada":"saada","al mahrah governorate":"al maharah","al mahrah":"al maharah","al mahra":"al maharah","mahrah governorate":"al maharah","ma'rib governorate":"marib","ma'rib":"marib",mareb:"marib","socotra governorate":"socotra",soqatra:"socotra","sanʿaʾ governorate":"sana'a","san'a'":"sana'a","sana'a":"sana'a","sanaa governorate":"sana'a","ta'izz":"taizz","ta'izz governorate":"taizz",taiz:"taizz"}[t]||t},n=e=>{if(!e)return null;const t=a(e);return i[t]||null},o=e=>{if(!Array.isArray(e)||!e.length)return null;const t=e.filter((e=>Array.isArray(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]&&!isNaN(e[0])&&!isNaN(e[1])));if(!t.length)return null;const r=t.reduce(((e,t)=>[e[0]+t[0],e[1]+t[1]]),[0,0]);return[r[0]/t.length,r[1]/t.length]}},27154:(e,t,r)=>{"use strict";r.d(t,{EU:()=>i});const i={center:[15.3694,44.191],zoom:6}},95197:(e,t,r)=>{"use strict";r.d(t,{TO:()=>d,AD:()=>c,vy:()=>l});var i=r(96540),a=r(2896),n=(r(88239),r(72667)),o=(r(23567),r(42320)),s=r(73151);new class{constructor(){this.cache=new Map,this.maxSize=100,this.ttl=36e5,this.priorityLevels={HIGH:new Set(["timeSeriesData","flowMaps"]),MEDIUM:new Set(["marketClusters","spatialAutocorrelation"]),LOW:new Set(["regressionAnalysis","seasonalAnalysis"])},this.cleanupInterval=setInterval((()=>this.cleanup()),3e5)}get(e,t){const r=o.backgroundMonitor.startMetric("cache-get"),i=this._getKey(e,t);try{const e=this.cache.get(i);return e?Date.now()-e.timestamp>this.ttl?(this.cache.delete(i),r.finish({status:"expired"}),null):(e.accessCount++,e.lastAccessed=Date.now(),r.finish({status:"hit"}),e.data):(r.finish({status:"miss"}),null)}catch(e){return r.finish({status:"error",error:e.message}),null}}set(e,t,r){const i=o.backgroundMonitor.startMetric("cache-set"),a=this._getKey(e,t);try{this.cache.size>=this.maxSize&&this.evictLRU(),this.cache.set(a,{data:r,timestamp:Date.now(),lastAccessed:Date.now(),accessCount:0,size:this._estimateSize(r)}),i.finish({status:"success"})}catch(e){i.finish({status:"error",error:e.message})}}cleanup(){const e=o.backgroundMonitor.startMetric("cache-cleanup"),t=Date.now();let r=0;for(const[e,i]of this.cache.entries())t-i.timestamp>this.ttl&&(this.cache.delete(e),r++);e.finish({status:"success",removedEntries:r})}clear(){this.cache.clear(),o.backgroundMonitor.logMetric("cache-clear",{timestamp:Date.now()})}_getKey(e,t){return`${e}_${t}`}_estimateSize(e){try{return new Blob([JSON.stringify(e)]).size}catch{return 0}}evictLRU(){let e=Date.now(),t=null;for(const[r,i]of this.cache.entries())i.lastAccessed<e&&(e=i.lastAccessed,t=r);t&&(this.cache.delete(t),o.backgroundMonitor.logMetric("cache-eviction",{key:t,reason:"LRU"}))}getStats(){return{size:this.cache.size,maxSize:this.maxSize,totalSize:Array.from(this.cache.values()).reduce(((e,t)=>e+(t.size||0)),0),hitRate:this._calculateHitRate(),entries:Array.from(this.cache.entries()).map((e=>{let[t,r]=e;return{key:t,accessCount:r.accessCount,age:Date.now()-r.timestamp,size:r.size||0}}))}}_calculateHitRate(){return Array.from(this.cache.values()).reduce(((e,t)=>e+t.accessCount),0)/this.cache.size||0}};r(15995);const l=()=>{const[e,t]=(0,i.useState)(null),[r,a]=(0,i.useState)(null),[n,o]=(0,i.useState)("idle"),[l,c]=(0,i.useState)(null);return(0,i.useEffect)((()=>{(async()=>{o("loading");try{const e=(0,s.Ir)("tv_mii_results.json"),r=(0,s.Ir)("tv_mii_market_results.json"),[i,n]=await Promise.all([fetch(e),fetch(r)]);if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const l=await i.json(),c=await n.json(),d=l.map((e=>({...e,date:new Date(e.date),tvmii:e.tv_mii||e.tvmii||e.value}))),u=c.map((e=>({...e,date:new Date(e.date),tvmii:e.tv_mii||e.tvmii||e.value})));t(d),a(u),o("succeeded")}catch(e){c(e.message),o("failed")}})()}),[]),{tvmiiData:e,marketPairsData:r,status:n,error:l}},c=e=>{const[t,r]=(0,i.useState)([]),[a,n]=(0,i.useState)([]),[o,l]=(0,i.useState)([]),[c,d]=(0,i.useState)("idle"),[u,m]=(0,i.useState)(null),h=(0,i.useCallback)(((e,t)=>{const r=e.markets||{},i=[];for(const e in r){const a=(r[e].commodity_results||{})[t];a&&a.forEach((e=>{i.push(e)}))}return i}),[]);return(0,i.useEffect)((()=>{(async()=>{d("loading");try{const t=(0,s.Ir)("price_diff_results/price_differential_results.json"),i=await fetch(t);if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);const a=await i.json(),o=new Set;if(Object.values(a.markets||{}).forEach((e=>{const t=e.commodity_results||{};Object.keys(t).forEach((e=>{o.add(e)}))})),l(Array.from(o)),e){const t=h(a,e);r(t);const i=new Set;t.forEach((e=>{i.add(e.base_market),i.add(e.other_market)})),n(Array.from(i))}else r([]),n([]);d("succeeded")}catch(e){m(e.message),d("failed")}})()}),[e,h]),{data:t,markets:a,commodities:o,status:c,error:u}},d=e=>{const t=(0,a.wA)(),r=(0,a.d4)(n.rf),o=(0,a.d4)(n.fW),s=(0,a.d4)(n.JS),l=(0,a.d4)(n.nT),c=(0,a.d4)(n.xM),d=(0,i.useRef)(!1),u=(0,i.useRef)(!1);(0,i.useEffect)((()=>{e&&t((0,n.hP)(e))}),[e,t]),(0,i.useEffect)((()=>{if(d.current||u.current||!e)return;(async()=>{d.current=!0;try{await t((0,n.kE)({commodity:e})).unwrap(),u.current=!0}catch(e){}finally{d.current=!1}})()}),[t,e]);const m=(0,i.useMemo)((()=>{if(!e)return null;const t=e.toLowerCase(),i=r.filter((e=>{var r;return(null===(r=e.commodity)||void 0===r?void 0:r.toLowerCase())===t})),a=o.northToSouth.filter((e=>{var r;return(null===(r=e.commodity)||void 0===r?void 0:r.toLowerCase())===t})),n=o.southToNorth.filter((e=>{var r;return(null===(r=e.commodity)||void 0===r?void 0:r.toLowerCase())===t}));return{unified:i[0]||null,directional:{northToSouth:a[0]||null,southToNorth:n[0]||null}}}),[e,r,o]),h=u.current?s?"loading":l?"failed":"succeeded":"idle";return{unifiedData:(null==m?void 0:m.unified)||null,unifiedStatus:h,unifiedError:l,directionalData:(null==m?void 0:m.directional)||{northToSouth:null,southToNorth:null},directionalStatus:h,directionalError:l,metrics:e?c:null,isLoading:s,isInitialized:u.current}}},30762:(e,t,r)=>{"use strict";r.d(t,{vy:()=>i.vy,SC:()=>s,lW:()=>o});var i=r(95197),a=r(96540),n=r(34732);function o(){const e="object"==typeof window,t=()=>({width:e?window.innerWidth:void 0,height:e?window.innerHeight:void 0}),[r,i]=(0,a.useState)(t);return(0,a.useEffect)((()=>{if(!e)return;const r=()=>{i(t())};return window.addEventListener("resize",r),r(),()=>window.removeEventListener("resize",r)}),[e]),r}const s=e=>({getTechnicalTooltip:(0,a.useCallback)((t=>{var r;const i=(0,n.QO)(e);return(null==i||null===(r=i.tooltips)||void 0===r?void 0:r[t])||null}),[e]),getTechnicalEquation:(0,a.useCallback)((t=>{var r;const i=(0,n.QO)(e);return(null==i||null===(r=i.equations)||void 0===r?void 0:r[t])||null}),[e]),getTechnicalConcept:(0,a.useCallback)((t=>{var r;const i=(0,n.QO)(e);return(null==i||null===(r=i.concepts)||void 0===r?void 0:r[t])||null}),[e]),getMethodology:(0,a.useCallback)((()=>(0,n.nz)(e)),[e])})},33640:(e,t,r)=>{"use strict";var i=r(96540),a=r(5338),n=r(2896),o=r(5556),s=r.n(o),l=r(81118),c=r(70960),d=r(88239);const u=(0,l.Z0)({name:"theme",initialState:{isDarkMode:!1},reducers:{toggleDarkMode(e){e.isDarkMode=!e.isDarkMode}}}),{toggleDarkMode:m}=u.actions,h=u.reducer,p={hasSeenWelcome:"true"===localStorage.getItem("hasSeenWelcome")},g=(0,l.Z0)({name:"welcomeModal",initialState:p,reducers:{setHasSeenWelcome:(e,t)=>{e.hasSeenWelcome=!0,t.payload&&localStorage.setItem("hasSeenWelcome","true")}}}),{setHasSeenWelcome:y}=g.actions,f=g.reducer;var v=r(72667),b=r(25508),A=r(44809),w=r.n(A),_=r(2543),x=r.n(_),k=r(42320);const S=(e,t)=>{const r=.9996,i=6378137,a=.081819191,n=.006739497;try{const o=e-5e5,s=t/r/6367449.183292391,l=s+(3*n/2-27*Math.pow(n,3)/32)*Math.sin(2*s),c=l+(21*Math.pow(n,2)/16-55*Math.pow(n,4)/32)*Math.sin(4*s)+151*Math.pow(n,3)/96*Math.sin(6*s),d=i/Math.sqrt(1-a*a*Math.sin(c)*Math.sin(c)),u=Math.tan(c)*Math.tan(c),m=a*a*Math.cos(c)*Math.cos(c)/(1-a*a),h=i*(1-a*a)/Math.pow(1-a*a*Math.sin(c)*Math.sin(c),1.5),p=o/(d*r),g=c-d*Math.tan(c)/h*(p*p/2-(5+3*u+10*m-4*Math.pow(m,2)-9*a*a)*Math.pow(p,4)/24+(61+90*u+298*m+45*Math.pow(u,2)-252*a*a-3*Math.pow(m,2))*Math.pow(p,6)/720);return[(p-(1+2*u+m)*Math.pow(p,3)/6+(5-2*m+28*u-3*Math.pow(m,2)+8*a*a+24*Math.pow(u,2))*Math.pow(p,5)/120+45)/Math.cos(c)*(180/Math.PI)*(180/Math.PI),g*(180/Math.PI)]}catch(e){return null}};var M=r(73151);const C=e=>e?7===e.length?`${e}-01`:e:null,Y=e=>e?e.substring(0,7):null,D=(e,t)=>!(!e||!t)&&e.substring(0,7)===t.substring(0,7),I={flows:[],byDate:{},byRegion:{},metadata:{lastUpdated:null,dateRange:{start:null,end:null},commodity:null,totalFlows:0,uniqueMarkets:0,dataQuality:{validFlows:0,invalidFlows:0,processingErrors:[]}},status:{loading:!1,error:null,lastFetch:null,loadedData:{},processingProgress:0}},R=e=>e&&"string"==typeof e.source&&"string"==typeof e.target&&"number"==typeof e.flow_weight&&!isNaN(e.flow_weight)&&e.flow_weight>=0,F=(0,l.zD)("flow/fetchData",(async(e,t)=>{let{commodity:r,date:i}=e,{getState:a,rejectWithValue:n,dispatch:o}=t;const s=k.backgroundMonitor.startMetric("flow-data-fetch"),l=[];try{const e=C(i);if(!r||!e)throw new Error("Invalid parameters",{commodity:r,date:i});const t=(0,M.cv)("time_varying_flows.csv"),a=await(0,M.ZB)((async()=>{const e=await fetch(t);if(!e.ok)throw new Error(`HTTP error ${e.status}`);return e.text()})),n=(await new Promise(((e,t)=>{w().parse(a,{header:!0,dynamicTyping:!0,skipEmptyLines:!0,complete:t=>e(t),error:e=>t(e)})}))).data.filter((t=>{var i;const a=(null===(i=t.commodity)||void 0===i?void 0:i.toLowerCase())===(null==r?void 0:r.toLowerCase()),n=D(t.date,e);return a&&n})),o=n.map((e=>{try{if(!R(e))return null;const t=S(e.source_lng,e.source_lat),r=S(e.target_lng,e.target_lat);return{id:`${e.source}-${e.target}-${e.date}`,date:e.date,source:e.source,target:e.target,source_coordinates:t,target_coordinates:r,price_differential:Number(e.price_differential)||0,source_price:Number(e.source_price)||0,target_price:Number(e.target_price)||0,flow_weight:Number(e.flow_weight)||0,metadata:{processed_at:(new Date).toISOString(),valid:!0}}}catch(t){return l.push({flow:e,error:t.message}),null}})).filter(Boolean),c=x().groupBy(o,(e=>Y(e.date))),d=x().groupBy(o,"source"),u=new Set([...o.map((e=>e.source)),...o.map((e=>e.target))]),m={flows:o,byDate:c,byRegion:d,metadata:{lastUpdated:(new Date).toISOString(),dateRange:{start:Y(e),end:Y(e)},commodity:r,totalFlows:o.length,uniqueMarkets:u.size,dataQuality:{validFlows:o.length,invalidFlows:n.length-o.length,processingErrors:l}}};return s.finish({status:"success",flowCount:o.length,commodity:r,date:e}),m}catch(e){return s.finish({status:"error",error:e.message,commodity:r,date:i}),n(e.message)}})),N=(0,l.Z0)({name:"flow",initialState:I,reducers:{clearFlowData:()=>I,updateFlowMetrics:(e,t)=>{e.metadata={...e.metadata,...t.payload}},resetFlowError:e=>{e.status.error=null},updateProgress:(e,t)=>{e.status.processingProgress=t.payload}},extraReducers:e=>{e.addCase(F.pending,(e=>{e.status.loading=!0,e.status.error=null,e.status.processingProgress=0})).addCase(F.fulfilled,((e,t)=>{const{flows:r,byDate:i,byRegion:a,metadata:n}=t.payload;e.flows=r,e.byDate=i,e.byRegion=a,e.metadata={...n,lastUpdated:(new Date).toISOString()},e.status={loading:!1,error:null,lastFetch:(new Date).toISOString(),loadedData:{...e.status.loadedData,[`${n.commodity}-${n.dateRange.start}`]:!0},processingProgress:1}})).addCase(F.rejected,((e,t)=>{e.status={...e.status,loading:!1,error:t.payload,lastFetch:(new Date).toISOString(),processingProgress:0}}))}}),z=e=>e.flow||I,E=e=>z(e).metadata,T=(0,b.Mz)([z],(e=>({...e,metadata:{...e.metadata,lastChecked:(new Date).toISOString()}}))),P=(0,b.Mz)([e=>z(e).status],(e=>({loading:e.loading,error:e.error,progress:e.processingProgress}))),O=(0,b.Mz)([E],(e=>({...e,lastChecked:(new Date).toISOString()}))),$=(0,b.Mz)([e=>z(e).byDate,(e,t)=>t],((e,t)=>{if(!t)return[];return e[Y(t)]||[]})),L=((0,b.Mz)([e=>z(e).byRegion,(e,t)=>t],((e,t)=>e[t]||[])),(0,b.Mz)([e=>z(e).flows,E],((e,t)=>{if(!e.length)return null;const r=e.filter((e=>e.flow_weight>0)),i=r.reduce(((e,t)=>e+t.flow_weight),0),a=r.length>0?i/r.length:0;return{totalFlows:r.length,averageFlowWeight:a,maxPriceDifferential:Math.max(...r.map((e=>e.price_differential||0))),averagePriceDifferential:r.reduce(((e,t)=>e+(t.price_differential||0)),0)/r.length,marketConnectivity:t.uniqueMarkets>0?r.length/t.uniqueMarkets:0,dataQuality:t.dataQuality}}))),{clearFlowData:j,updateFlowMetrics:q,resetFlowError:W,updateProgress:V}=N.actions,H=N.reducer,B=(0,l.zD)("priceDiff/fetchData",(async(e,t)=>{let{rejectWithValue:r}=t;try{const e=await fetch((0,M.Ir)("price_diff_results/price_differential_results.json"));if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return await e.json()}catch(e){return r(e.message)}})),G=(0,l.Z0)({name:"priceDiff",initialState:{data:null,status:"idle",error:null},reducers:{},extraReducers:e=>{e.addCase(B.pending,(e=>{e.status="loading"})).addCase(B.fulfilled,((e,t)=>{e.status="succeeded",e.data=t.payload})).addCase(B.rejected,((e,t)=>{e.status="failed",e.error=t.payload||t.error.message}))}}).reducer;r(30428);const{logValidation:U}=r(33890);var Z=r(80106);const X={key:"spatial",storage:{getItem:e=>{try{return Promise.resolve(localStorage.getItem(e))}catch(e){return Promise.reject(e)}},setItem:(e,t)=>{try{return localStorage.setItem(e,t),Promise.resolve()}catch(e){return Promise.reject(e)}},removeItem:e=>{try{return localStorage.removeItem(e),Promise.resolve()}catch(e){return Promise.reject(e)}}},whitelist:["geometry","cache"],blacklist:["status","ui"]},J=(0,c.rL)(X,d.Ay);var K=r(16829),Q=r(20477),ee=r(87164),te=r(14519),re=r(8532),ie=r(11641),ae=r(94654),ne=r(11848),oe=r(89828),se=r(33551),le=r(35996),ce=r(82085),de=r(2445);const ue=(0,ne.Ay)(se.A)((e=>{let{theme:t}=e;return{flexGrow:1,fontWeight:600,color:(t.palette.mode,t.palette.primary.contrastText),transition:t.transitions.create(["color"],{duration:t.transitions.duration.short}),[t.breakpoints.down("sm")]:{fontSize:"1rem"}}})),me=(0,ne.Ay)(ie.A)((e=>{let{theme:t}=e;return{color:t.palette.primary.contrastText,transition:t.transitions.create(["color","background-color"],{duration:t.transitions.duration.short}),"&:hover":{backgroundColor:"dark"===t.palette.mode?"rgba(255, 255, 255, 0.08)":"rgba(0, 0, 0, 0.08)"},"& .MuiSvgIcon-root":{transition:t.transitions.create(["transform"],{duration:t.transitions.duration.short})},"&:hover .MuiSvgIcon-root":{transform:"rotate(30deg)"}}})),he=e=>{let{isDarkMode:t,toggleDarkMode:r}=e;return(0,de.FD)(ee.A,{sx:{display:"flex",alignItems:"center",width:"100%",px:2,transition:e=>e.transitions.create(["background-color"],{duration:e.transitions.duration.short})},children:[(0,de.Y)(ue,{variant:"h6",noWrap:!0,component:"div",children:"Yemen Market Analysis Dashboard"}),(0,de.Y)(me,{onClick:r,"aria-label":t?"switch to light mode":"switch to dark mode",size:"large",edge:"end",children:t?(0,de.Y)(ce.A,{}):(0,de.Y)(le.A,{})})]})};he.propTypes={isDarkMode:s().bool.isRequired,toggleDarkMode:s().func.isRequired};const pe=he;var ge=r(44675),ye=r(44090),fe=(r(37211),r(85703)),ve=r(50779),be=r(54433),Ae=r(67130),we=r(18740),_e=r(64389),xe=r(82241),ke=r(78524),Se=r(86990),Me=r(58620),Ce=r(71543),Ye=r(36941);var De=r(15995);const Ie=e=>e.split(/[_\s]+/).map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join(" ");s().func,s().bool,s().node.isRequired;const Re=i.memo((e=>{let{commodities:t=[],selectedCommodity:r="",onSelectCommodity:a}=e;const o=(0,n.wA)(),{data:s,loading:l,fetchData:c}=(()=>{const e=(0,n.wA)(),t=(0,n.d4)((e=>{var t,r;return null!==(t=null===(r=e.spatial)||void 0===r?void 0:r.data)&&void 0!==t?t:d.ue.data}),x().isEqual),r=(0,n.d4)((e=>{var t,r;return null!==(t=null===(r=e.spatial)||void 0===r||null===(r=r.status)||void 0===r?void 0:r.loading)&&void 0!==t?t:d.ue.status.loading}),x().isEqual),a=(0,n.d4)((e=>{var t,r;return null!==(t=null===(r=e.spatial)||void 0===r?void 0:r.status)&&void 0!==t?t:d.ue.status}),x().isEqual),o=(0,i.useRef)(!1),s=(0,i.useRef)(new Map),l=(0,i.useRef)(null),c=(0,i.useCallback)((()=>{l.current&&(l.current.abort(),l.current=null),o.current=!1}),[]);return(0,i.useEffect)((()=>c),[c]),{data:t,loading:r,status:a,fetchData:(0,i.useCallback)((async(t,r)=>{if(o.current)return;const i=`${t}_${r}`;if(s.current.has(i))return s.current.get(i);c();try{var a,n;l.current=new AbortController,o.current=!0;const c=k.backgroundMonitor.startMetric("data-fetch",{commodity:t,date:r,timestamp:Date.now()}),u={commodity:t,date:r,...l.current?{signal:l.current.signal}:{}},m=await e((0,d.kC)(u)).unwrap();return m?(s.current.set(i,m),c.finish({status:"success",dataPoints:null!==(a=null===(n=m.spatialData)||void 0===n||null===(n=n.timeSeriesData)||void 0===n?void 0:n.length)&&void 0!==a?a:0}),m):(c.finish({status:"warning",message:"No data returned"}),d.ue.data)}catch(e){if("AbortError"===e.name)return;return k.backgroundMonitor.startMetric("data-fetch-error",{status:"error",error:e.message,commodity:t,date:r}).finish(),d.ue.data}finally{o.current=!1,l.current&&(l.current=null)}}),[e,c]),cleanup:c}})(),u=(0,i.useRef)(r),m=(0,ge.A)(),h=(0,i.useCallback)((async e=>{const t=e.target.value;if(t!==u.current){u.current=t;try{o({type:"spatial/setSelectedCommodity",payload:t}),await Promise.all([o((0,d.kC)({commodity:t,date:"2020-10-01"})),a(t)])}catch(e){}}}),[o,c,a]);return(0,de.FD)(ve.A,{fullWidth:!0,variant:"outlined",size:"small",margin:"normal",disabled:l,children:[(0,de.FD)(be.A,{id:"commodity-select-label",sx:{color:m.palette.text.primary,"&.Mui-focused":{color:m.palette.primary.main}},children:["Select Commodity ",l?"(Loading...)":""]}),(0,de.Y)(Ae.A,{labelId:"commodity-select-label",id:"commodity-select",value:r,onChange:h,label:"Select Commodity "+(l?"(Loading...)":""),sx:{"& .MuiSelect-select":{color:m.palette.text.primary},"& .MuiOutlinedInput-notchedOutline":{borderColor:m.palette.divider},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:m.palette.primary.main},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:m.palette.primary.main}},children:t.map((e=>(0,de.Y)(we.A,{value:e,sx:{color:m.palette.text.primary,"&:hover":{backgroundColor:(0,fe.X4)(m.palette.primary.main,.08)},"&.Mui-selected":{backgroundColor:(0,fe.X4)(m.palette.primary.main,.12),color:m.palette.primary.main,"&:hover":{backgroundColor:(0,fe.X4)(m.palette.primary.main,.16)}}},children:Ie(e)},e)))})]})}));Re.displayName="CommoditySelector";const Fe=e=>{let{regimes:t,selectedRegimes:r,onSelectRegimes:i}=e;const a=(0,ge.A)(),n={PaperProps:{style:{maxHeight:224,width:250,backgroundColor:a.palette.background.paper}}};return(0,de.FD)(ve.A,{fullWidth:!0,variant:"outlined",size:"small",margin:"normal",children:[(0,de.Y)(be.A,{id:"regime-select-label",sx:{color:a.palette.text.primary,"&.Mui-focused":{color:a.palette.primary.main}},children:"Select Regimes"}),(0,de.Y)(Ae.A,{labelId:"regime-select-label",id:"regime-select",name:"regimes",multiple:!0,value:r,onChange:e=>i(e.target.value),label:"Select Regimes","aria-label":"Select regimes",renderValue:e=>e.map((e=>Ie(e))).join(", "),MenuProps:n,sx:{"& .MuiSelect-select":{color:a.palette.text.primary},"& .MuiOutlinedInput-notchedOutline":{borderColor:a.palette.divider},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:a.palette.primary.main},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:a.palette.primary.main}},children:t.map((e=>(0,de.FD)(we.A,{value:e,sx:{color:a.palette.text.primary,"&:hover":{backgroundColor:(0,fe.X4)(a.palette.primary.main,.08)},"&.Mui-selected":{backgroundColor:(0,fe.X4)(a.palette.primary.main,.12),color:a.palette.primary.main,"&:hover":{backgroundColor:(0,fe.X4)(a.palette.primary.main,.16)}}},children:[(0,de.Y)(_e.A,{checked:r.indexOf(e)>-1,sx:{color:a.palette.text.secondary,"&.Mui-checked":{color:a.palette.primary.main}}}),(0,de.Y)(xe.A,{primary:Ie(e),sx:{"& .MuiTypography-root":{color:a.palette.text.primary}}})]},e)))})]})};Fe.propTypes={regimes:s().arrayOf(s().string).isRequired,selectedRegimes:s().arrayOf(s().string).isRequired,onSelectRegimes:s().func.isRequired};const Ne=e=>{let{commodities:t=[],regimes:r=[],selectedCommodity:a="",setSelectedCommodity:o,selectedAnalysis:s="spatial",setSelectedAnalysis:l,sidebarOpen:c,setSidebarOpen:u,onMethodologyClick:m,selectedRegimes:h,setSelectedRegimes:p,onOpenWelcomeModal:g,handleDrawerToggle:y}=e;const f=(0,ge.A)(),v=(0,Q.A)(f.breakpoints.up("sm")),b=(0,Q.A)(f.breakpoints.down("sm")),A=(0,n.wA)(),{geoData:w,flows:_,analysis:x,uniqueMonths:k}=(0,n.d4)(d.tr),S=((0,n.d4)(d.tr),(0,n.d4)(De.xG),(0,n.d4)(De.HC),(0,i.useCallback)((async e=>{if(e&&e!==a)try{await A((0,d.kC)({commodity:e,date:"2020-10-01"})),o(e),v||u(!1)}catch(e){}}),[A,a,v,o,u])),M=(0,i.useCallback)((e=>{l(e),v||u(!1),"spatial"===e&&a&&A((0,d.R)({selectedCommodity:a,selectedDate:k[0]}))}),[l,v,u,A,a,k]),C=(0,i.useCallback)((e=>{p(e)}),[p]),Y={color:f.palette.text.primary,borderColor:f.palette.divider,"&:hover":{borderColor:f.palette.primary.main,backgroundColor:(0,fe.X4)(f.palette.primary.main,.08)},"&.MuiButton-contained":{backgroundColor:f.palette.primary.main,color:f.palette.primary.contrastText,"&:hover":{backgroundColor:f.palette.primary.dark}},"&.MuiButton-outlined":{borderColor:f.palette.divider,"&:hover":{borderColor:f.palette.primary.main,backgroundColor:(0,fe.X4)(f.palette.primary.main,.08)}}},D=(0,i.useMemo)((()=>(0,de.Y)(ee.A,{sx:{p:2,backgroundColor:f.palette.background.paper,height:"100%"},children:(0,de.FD)(ke.A,{spacing:3,children:[(0,de.Y)(Re,{commodities:t,selectedCommodity:a,onSelectCommodity:S}),(0,de.Y)(Fe,{regimes:r,selectedRegimes:h,onSelectRegimes:C}),(0,de.FD)(ke.A,{spacing:2,children:[(0,de.Y)(Se.A,{variant:"spatial"===s?"contained":"outlined",color:"primary",fullWidth:!0,onClick:()=>M("spatial"),sx:Y,children:"Spatial Analysis"}),(0,de.Y)(Se.A,{variant:"ecm"===s?"contained":"outlined",color:"primary",fullWidth:!0,onClick:()=>M("ecm"),sx:Y,children:"ECM Model"}),(0,de.Y)(Se.A,{variant:"priceDiff"===s?"contained":"outlined",color:"primary",fullWidth:!0,onClick:()=>M("priceDiff"),sx:Y,children:"Price Differential Model"}),(0,de.Y)(Se.A,{variant:"spatial_model"===s?"contained":"outlined",color:"primary",fullWidth:!0,onClick:()=>M("spatial_model"),sx:Y,children:"Spatial Model"}),(0,de.Y)(Se.A,{variant:"tvmii"===s?"contained":"outlined",color:"primary",fullWidth:!0,onClick:()=>M("tvmii"),sx:Y,children:"TV-MII Index"})]}),(0,de.Y)(Se.A,{variant:"contained",sx:{backgroundColor:f.palette.error.main,color:"#ffffff","&:hover":{backgroundColor:f.palette.error.dark}},fullWidth:!0,onClick:m,startIcon:(0,de.Y)(Ye.A,{}),children:"Methodology"}),(0,de.Y)(Se.A,{variant:"contained",sx:{backgroundColor:f.palette.success.main,color:"#ffffff","&:hover":{backgroundColor:f.palette.success.dark}},fullWidth:!0,onClick:g,startIcon:(0,de.Y)(Ye.A,{}),children:"How to Use"})]})})),[f,t,a,r,h,C,s,M,m,g,Y]);return(0,de.FD)(Me.Ay,{variant:b?"temporary":"persistent",open:c,onClose:y,ModalProps:{keepMounted:!0},sx:{"& .MuiDrawer-paper":{width:240,boxSizing:"border-box",backgroundColor:f.palette.background.paper,borderRight:`1px solid ${f.palette.divider}`,[f.breakpoints.down("sm")]:{top:"56px",height:"calc(100% - 56px)"}}},children:[(0,de.Y)(re.A,{}),(0,de.Y)(Ce.A,{sx:{borderColor:f.palette.divider}}),D]})};Ne.propTypes={commodities:s().arrayOf(s().string).isRequired,regimes:s().arrayOf(s().string).isRequired,selectedCommodity:s().string.isRequired,setSelectedCommodity:s().func.isRequired,selectedAnalysis:s().string.isRequired,setSelectedAnalysis:s().func.isRequired,sidebarOpen:s().bool.isRequired,setSidebarOpen:s().func.isRequired,onMethodologyClick:s().func.isRequired,selectedRegimes:s().arrayOf(s().string).isRequired,setSelectedRegimes:s().func.isRequired,onOpenWelcomeModal:s().func.isRequired,handleDrawerToggle:s().func.isRequired};var ze=r(8239);const Ee=e=>{const t=e.filter((e=>null!=e&&!isNaN(e)));return t.length>0?x().mean(t):null},Te=()=>{const[e,t]=(0,i.useState)(null),[r,a]=(0,i.useState)(!0),[n,o]=(0,i.useState)(null),s=(0,i.useCallback)((async()=>{try{const e=(0,M.Ir)("unified_data.geojson"),r=await fetch(e,{headers:{Accept:"application/geo+json"}});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const i=await r.json();if(!i.features||!Array.isArray(i.features))throw new Error("Invalid GeoJSON structure: 'features' array is missing");const a=(e=>{const t=e.reduce(((e,t)=>{const r=t.properties;if(!r.date||!r.exchange_rate_regime||!r.commodity)return e;const i=r.commodity.toLowerCase().trim(),a=`${r.date}_${r.exchange_rate_regime}_${i}`;return e[a]||(e[a]={date:r.date,regime:r.exchange_rate_regime.toLowerCase(),commodity:i,prices:[],usdprices:[],conflict_intensities:[],count:0}),isFinite(r.price)&&e[a].prices.push(Number(r.price)),isFinite(r.usdprice)&&e[a].usdprices.push(Number(r.usdprice)),isFinite(r.conflict_intensity)&&e[a].conflict_intensities.push(Number(r.conflict_intensity)),e[a].count++,e}),{});return Object.values(t).map((e=>({date:e.date,regime:e.regime,commodity:e.commodity,price:e.prices.length>0?x().mean(e.prices):null,usdprice:e.usdprices.length>0?x().mean(e.usdprices):null,conflict_intensity:e.conflict_intensities.length>0?x().mean(e.conflict_intensities):0,sample_size:e.count})))})(i.features);if(0===a.length)throw new Error("No valid data after aggregation");const n=(e=>{const t=x().groupBy(e,(e=>`${e.date}_${e.commodity}`));return Object.entries(t).map((e=>{let[t,r]=e;const i=r.find((e=>"north"===e.regime)),a=r.find((e=>"south"===e.regime));if(!i||!a)return null;const[n,o]=t.split("_");return{date:n,commodity:o,regime:"unified",price:Ee([i.price,a.price]),usdprice:Ee([i.usdprice,a.usdprice]),conflict_intensity:Ee([i.conflict_intensity,a.conflict_intensity]),sample_size:i.sample_size+a.sample_size}})).filter(Boolean)})(a),o=[...a,...n],s=[...new Set(o.map((e=>e.commodity.toLowerCase().trim())))].sort(),l=[...new Set(o.map((e=>e.regime.toLowerCase().trim())))].sort(),c=o.map((e=>new Date(e.date))),d=new Date(Math.min(...c)),u=new Date(Math.max(...c));t({features:o,commodities:s,regimes:l,dateRange:{min:d,max:u}})}catch(e){o(e.message)}finally{a(!1)}}),[]);(0,i.useEffect)((()=>{s()}),[s]);const l=(0,i.useCallback)(((t,r)=>{if(null==e||!e.features||!t||null==r||!r.length)return[];const i=t.toLowerCase().trim(),a=r.map((e=>e.toLowerCase().trim()));return e.features.filter((e=>e.commodity===i&&a.includes(e.regime))).sort(((e,t)=>new Date(e.date)-new Date(t.date)))}),[e]);return{data:e,loading:r,error:n,refetch:s,getFilteredData:l}};var Pe=r(44731),Oe=r(92262),$e=(r(94887),r(64155)),Le=r(37483),je=r(54790),qe=r(34732);const We=()=>{const[e,t]=(0,i.useState)(window.innerWidth);return(0,i.useEffect)((()=>{const e=()=>{t(window.innerWidth)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),e},Ve=e=>e.replace(/\b\w/g,(e=>e.toUpperCase()));Oe.t1.register(Oe.PP,Oe.kc,Oe.FN,Oe.No,Oe.hE,Oe.m_,Oe.s$,Oe.UA,Oe.dN);const He=e=>{let{data:t,selectedCommodity:r,selectedRegimes:a}=e;const n=(0,ge.A)(),o=We(),s=o<600,[l,c]=(0,i.useState)(!0),[d,u]=(0,i.useState)("lcu"),[m,h]=(0,i.useState)(!1),[p,g]=(0,i.useState)(!1),y=(0,i.useMemo)((()=>{if(!t||!r||0===a.length)return null;const e=a.map((e=>({regime:e,data:t.filter((t=>t.commodity.toLowerCase()===r.toLowerCase()&&t.regime.toLowerCase()===e.toLowerCase()))}))).filter((e=>e.data.length>0));if(0===e.length)return null;const i=[];return e.forEach(((e,t)=>{const r=[n.palette.primary.main,n.palette.secondary.main,n.palette.success.main,n.palette.warning.main,n.palette.error.main,n.palette.info.main],a=r[t%r.length];let o=e.data;if(m&&(o=(0,qe.Ul)(o,[e.regime],12,"lcu"===d)),p&&(o=(0,qe.JB)(o,[e.regime],6,"lcu"===d)),i.push({label:`${Ve(e.regime)} Price`,data:o.map((e=>({x:new Date(e.date),y:"lcu"===d?e.price:e.usdprice}))),borderColor:a,backgroundColor:(0,fe.X4)(a,.2),yAxisID:"y",fill:!0,tension:.3,pointRadius:3,pointHoverRadius:5}),l){const t=n.palette.info.main,r=(0,fe.X4)(t,.2);i.push({label:`${Ve(e.regime)} Conflict Intensity`,data:o.map((e=>({x:new Date(e.date),y:e.conflict_intensity}))),borderColor:r,backgroundColor:r,yAxisID:"y1",fill:"origin",tension:.3,pointRadius:0,borderWidth:0})}})),{datasets:i}}),[t,r,a,d,l,m,p,n.palette]),f=(0,i.useMemo)((()=>({responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},scales:{x:{type:"time",time:{unit:s?"month":"quarter"},grid:{display:!0,drawBorder:!1,color:(0,fe.X4)(n.palette.divider,.2),lineWidth:1,drawTicks:!1},border:{display:!1},ticks:{maxTicksLimit:s?5:10,color:n.palette.text.primary,font:{size:s?10:11,family:n.typography.fontFamily},padding:8},title:{display:!0,text:"Analysis Period",color:n.palette.text.primary,font:{size:s?10:11,family:n.typography.fontFamily},padding:{top:5}}},y:{type:"linear",display:!0,position:"left",grid:{display:!0,drawBorder:!1,color:(0,fe.X4)(n.palette.divider,.2),lineWidth:1,drawTicks:!1},border:{display:!1},ticks:{color:n.palette.text.primary,font:{size:s?10:11,family:n.typography.fontFamily},padding:8},title:{display:!0,text:"lcu"===d?"Price (LCU)":"Price (US$)",color:n.palette.text.primary,font:{size:s?10:11,family:n.typography.fontFamily},padding:{bottom:5}}},y1:{type:"linear",display:l,position:"right",grid:{drawOnChartArea:!1,color:(0,fe.X4)(n.palette.divider,.2),lineWidth:1,drawTicks:!1},border:{display:!1},ticks:{color:n.palette.text.primary,font:{size:s?10:11,family:n.typography.fontFamily},padding:8},title:{display:!0,text:"Conflict Intensity",color:n.palette.text.primary,font:{size:s?10:11,family:n.typography.fontFamily},padding:{bottom:5}}}},plugins:{tooltip:{mode:"index",intersect:!1,backgroundColor:n.palette.background.paper,titleColor:n.palette.text.primary,bodyColor:n.palette.text.secondary,borderColor:n.palette.divider,borderWidth:1,padding:8,bodyFont:{size:s?10:11,family:n.typography.fontFamily},titleFont:{size:s?10:11,family:n.typography.fontFamily,weight:"bold"},callbacks:{title:e=>new Date(e[0].parsed.x).toLocaleDateString(),label:e=>{let t=`${e.dataset.label}: `;return t+=e.parsed.y.toLocaleString(),t}}},legend:{position:s?"top":"bottom",align:"start",labels:{color:n.palette.text.primary,font:{size:s?10:11,family:n.typography.fontFamily},padding:8,boxWidth:8,usePointStyle:!0},display:!0,maxHeight:40}}})),[l,d,n,s]),v={minWidth:"auto",backgroundColor:n.palette.background.default,borderRadius:1,"& .MuiToggleButton-root":{fontWeight:600,fontSize:s?"0.7rem":"0.9rem",padding:s?"4px 6px":"6px 12px",margin:s?"2px":"4px",border:`1px solid ${n.palette.divider}`,color:n.palette.text.primary,"&.Mui-selected":{backgroundColor:n.palette.primary.main,color:n.palette.primary.contrastText,"&:hover":{backgroundColor:n.palette.primary.dark}}},flexWrap:s?"wrap":"nowrap"};return y?(0,de.FD)(ee.A,{sx:{width:"100%",mb:3},children:[(0,de.Y)($e.A,{sx:{p:2,mb:3},children:(0,de.FD)(ze.Ay,{container:!0,spacing:2,alignItems:"center",children:[(0,de.Y)(ze.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,de.FD)(Le.A,{value:d,exclusive:!0,onChange:(e,t)=>{null!==t&&u(t)},"aria-label":"Price Type",size:"small",fullWidth:!0,sx:v,children:[(0,de.Y)(je.A,{value:"lcu","aria-label":"Price in LCU",children:"LCU"}),(0,de.Y)(je.A,{value:"usd","aria-label":"Price in US$",children:"US$"})]})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,de.Y)(Le.A,{value:m,exclusive:!0,onChange:()=>h(!m),"aria-label":"Seasonal Adjustment",size:"small",fullWidth:!0,sx:v,children:(0,de.Y)(je.A,{value:!0,selected:m,children:"Seasonal Adj"})})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,de.Y)(Le.A,{value:p,exclusive:!0,onChange:()=>g(!p),"aria-label":"Smoothing",size:"small",fullWidth:!0,sx:v,children:(0,de.Y)(je.A,{value:!0,selected:p,children:"Smoothing"})})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,de.Y)(Le.A,{value:l,exclusive:!0,onChange:()=>c(!l),"aria-label":"Conflict Intensity",size:"small",fullWidth:!0,sx:v,children:(0,de.Y)(je.A,{value:!0,selected:l,children:"Conflict Intensity"})})})]})}),(0,de.Y)(ee.A,{sx:{width:"100%",height:o<600?200:o<960?250:350,position:"relative",bgcolor:n.palette.background.default,borderRadius:1,border:`1px solid ${n.palette.divider}`,overflow:"hidden",mb:3,p:1},children:(0,de.Y)(Pe.N1,{options:f,data:y})})]}):(0,de.Y)($e.A,{sx:{p:2,mb:3},children:(0,de.Y)(se.A,{variant:"body1",color:"text.secondary",children:"Please select at least one regime and a commodity."})})};He.propTypes={data:s().arrayOf(s().shape({date:s().string.isRequired,commodity:s().string.isRequired,regime:s().string.isRequired,price:s().number.isRequired,usdprice:s().number.isRequired,conflict_intensity:s().number.isRequired})).isRequired,selectedCommodity:s().string.isRequired,selectedRegimes:s().arrayOf(s().string).isRequired};const Be=He;var Ge=r(17437),Ue=r(73357);const Ze=Ge.i7`
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
`,Xe=Ge.i7`
  0% {
    opacity: 1;
  }
  50% {
    opacity: 0.7;
  }
  100% {
    opacity: 1;
  }
`,Je=()=>{const e=(0,ge.A)();return(0,de.FD)(ee.A,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100vh",backgroundColor:e.palette.background.default,p:2,animation:`${Ze} 0.3s ease-in`,transition:e.transitions.create(["background-color"],{duration:e.transitions.duration.standard})},children:[(0,de.Y)(Ue.A,{size:60,thickness:4,sx:{color:e.palette.primary.main,"& .MuiCircularProgress-circle":{strokeLinecap:"round",transition:e.transitions.create(["color"],{duration:e.transitions.duration.standard})}}}),(0,de.Y)(se.A,{variant:"h6",sx:{mt:2,color:e.palette.text.primary,fontWeight:500,animation:`${Xe} 2s ease-in-out infinite`,transition:e.transitions.create(["color"],{duration:e.transitions.duration.standard}),textAlign:"center",[e.breakpoints.down("sm")]:{fontSize:"1rem"}},children:"Loading, please wait..."}),(0,de.Y)(se.A,{variant:"body2",sx:{mt:1,color:e.palette.text.secondary,opacity:.8,transition:e.transitions.create(["color"],{duration:e.transitions.duration.standard}),textAlign:"center"},children:"Preparing your analysis dashboard"})]})};var Ke=r(89502);const Qe=e=>{let{message:t}=e;return(0,de.Y)(Ke.A,{severity:"error",sx:{mt:2},children:t})};Qe.propTypes={message:s().string.isRequired};const et=Qe,tt=e=>{let{children:t}=e;return(0,de.Y)("div",{className:"analysis-wrapper",children:t||(0,de.Y)("div",{children:"Loading..."})})};tt.propTypes={children:s().node.isRequired};const rt=tt;var it=r(35673),at=r(10423),nt=r(70203),ot=r(85610),st=r(63018),lt=r(24985),ct=r(97449),dt=r(15326),ut=r(75264),mt=r(30362),ht=r(20973),pt=r(52848),gt=r(49799),yt=r(34986),ft=r(25831),vt=r(11692),bt=r(85916),At=r(66162),wt=r(81344),_t=r(37660),xt=r(53481),kt=r.n(xt);const St=[15.3694,44.191],Mt=e=>{var t;let{clusters:r,selectedClusterId:a,onClusterSelect:n,geometry:o,height:s="100%"}=e;const l=(0,ge.A)(),c=We()<600?"300px":s,d=(0,i.useCallback)((e=>null==r?void 0:r.find((t=>t.connected_markets.includes(e)||t.main_market===e))),[r]),u=(0,i.useCallback)((e=>{const t=e.properties.region_id,r=d(t),i=(null==r?void 0:r.cluster_id)===a;if(!r)return{fillColor:l.palette.background.paper,weight:.5,opacity:.3,color:l.palette.divider,fillOpacity:.1,cursor:"default"};return{fillColor:1===r.cluster_id?l.palette.primary.main:l.palette.secondary.main,weight:i?2:1,opacity:1,color:i?l.palette.common.white:l.palette.grey[400],fillOpacity:i?.8:.5,cursor:"pointer"}}),[l,a,d]),m=(0,i.useCallback)((e=>{const t=e.properties.region_id,r=d(t);r&&n(r.cluster_id)}),[d,n]),h=(0,i.useCallback)((e=>{const t=e.properties.region_id,r=d(t);return r?`\n        <div style="text-align: center;">\n          <strong>${t}</strong>\n          <br />\n          ${r.main_market} cluster\n          <br />\n          <small style="color: ${l.palette.text.secondary};">\n            Click to view details\n          </small>\n        </div>\n      `:`\n          <div style="text-align: center;">\n            <strong>${t}</strong>\n            <br />\n            <small style="color: ${l.palette.text.secondary};">\n              Not part of any cluster\n            </small>\n          </div>\n        `}),[d,l.palette.text.secondary]);return null!=o&&null!==(t=o.unified)&&void 0!==t&&t.features?(0,de.Y)(ee.A,{sx:{height:c,display:"flex",flexDirection:"column",position:"relative"},children:(0,de.FD)(At.W,{center:St,zoom:6,style:{flex:1,width:"100%"},maxZoom:18,minZoom:5,zoomControl:!0,dragging:!0,touchZoom:!0,doubleClickZoom:!0,scrollWheelZoom:!1,boxZoom:!0,keyboard:!0,bounceAtZoomLimits:!0,worldCopyJump:!1,preferCanvas:!0,children:[" ",(0,de.Y)(wt.e,{url:"https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",attribution:"© OpenStreetMap contributors",noWrap:!0,maxNativeZoom:18,maxZoom:18,tileSize:256,zoomOffset:0,keepBuffer:8}),(0,de.Y)(_t.k,{data:o.unified,style:u,onEachFeature:(e,t)=>{t.on({click:()=>m(e),mouseover:t=>{d(e.properties.region_id)&&t.target.setStyle({fillOpacity:.8,weight:2})},mouseout:t=>{const r=d(e.properties.region_id);r&&r.cluster_id!==a?t.target.setStyle({fillOpacity:.5,weight:1}):r||t.target.setStyle({fillOpacity:.1,weight:.5})}}),t.bindTooltip(h(e),{permanent:!1,direction:"center",className:"custom-tooltip"})}})]})}):(0,de.Y)(ee.A,{sx:{height:c,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"background.paper",borderRadius:1},children:(0,de.Y)(se.A,{color:"text.secondary",children:"Loading Cluster Data..."})})};Mt.propTypes={clusters:s().arrayOf(s().shape({cluster_id:s().number.isRequired,main_market:s().string.isRequired,connected_markets:s().arrayOf(s().string).isRequired})),selectedClusterId:s().number,onClusterSelect:s().func.isRequired,geometry:s().shape({unified:s().object}),height:s().oneOfType([s().string,s().number])};const Ct=i.memo(Mt);var Yt=r(14977),Dt=r(37636),It=r(85100);const Rt=e=>{let{title:t,value:r,trend:i,format:a="number",description:n,tooltip:o}=e;const s=(0,ge.A)(),l=i>0?lt.A:It.A;return(0,de.Y)(Yt.A,{elevation:1,sx:{height:"100%",display:"flex",flexDirection:"column","&:hover":{boxShadow:s.shadows[3]}},children:(0,de.FD)(Dt.A,{children:[(0,de.FD)(ee.A,{display:"flex",alignItems:"center",mb:1,children:[(0,de.Y)(se.A,{variant:"subtitle2",color:"textSecondary",children:t}),o&&(0,de.Y)(mt.A,{title:o,placement:"top",children:(0,de.Y)(Ye.A,{sx:{ml:1,fontSize:"1rem",color:s.palette.text.secondary}})})]}),(0,de.FD)(ee.A,{display:"flex",alignItems:"baseline",mb:1,children:[(0,de.Y)(se.A,{variant:"h4",component:"div",sx:{fontWeight:"medium"},children:(e=>{if("number"!=typeof e)return e;switch(a){case"percentage":return`${(100*e).toFixed(1)}%`;case"currency":return`$${e.toFixed(2)}`;case"integer":return Math.round(e).toString();default:return e.toFixed(2)}})(r)}),void 0!==i&&(0,de.FD)(ee.A,{display:"flex",alignItems:"center",ml:1,sx:{color:i?i>0?s.palette.success.main:s.palette.error.main:s.palette.text.secondary},children:[(0,de.Y)(l,{sx:{fontSize:"1rem"}}),(0,de.FD)(se.A,{variant:"body2",component:"span",ml:.5,children:[Math.abs(i),"%"]})]})]}),n&&(0,de.Y)(se.A,{variant:"body2",color:"textSecondary",sx:{mt:1,minHeight:"2.5em",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:n})]})})};Rt.propTypes={title:s().string.isRequired,value:s().oneOfType([s().number,s().string]).isRequired,trend:s().number,format:s().oneOf(["number","percentage","currency","integer"]),description:s().string,tooltip:s().string};const Ft=i.memo(Rt);var Nt=r(87458);const zt=e=>{let{title:t,value:r,target:i,trend:a,format:n="percentage",description:o,tooltip:s,type:l="linear",size:c="medium",showTarget:d=!0,className:u,style:m}=e;const h=(0,ge.A)(),p=e=>{if("number"!=typeof e)return e;switch(n){case"percentage":return`${(100*e).toFixed(1)}%`;case"currency":return`$${e.toFixed(2)}`;case"integer":return Math.round(e).toString();default:return e.toFixed(2)}},g=i?r/i*100:100*r,y=Et(g,h),f=a>0?lt.A:It.A,v=a>0?h.palette.success.main:h.palette.error.main;return(0,de.FD)($e.A,{elevation:1,className:u,sx:{p:2,height:"100%",...m},children:[(0,de.FD)(ee.A,{sx:{display:"flex",alignItems:"center",mb:1},children:[(0,de.Y)(se.A,{variant:"small"===c?"body2":"subtitle2",color:"textSecondary",children:t}),s&&(0,de.Y)(mt.A,{title:s,placement:"top",children:(0,de.Y)(Ye.A,{sx:{ml:1,fontSize:"small"===c?"0.875rem":"1rem",color:h.palette.text.secondary}})})]}),(0,de.FD)(ee.A,{sx:{display:"flex",alignItems:"baseline",mb:1},children:[(0,de.Y)(se.A,{variant:"small"===c?"h6":"h5",component:"div",sx:{fontWeight:"medium"},children:p(r)}),void 0!==a&&(0,de.FD)(ee.A,{sx:{display:"flex",alignItems:"center",ml:1,color:v},children:[(0,de.Y)(f,{sx:{fontSize:"small"===c?"0.875rem":"1rem"}}),(0,de.FD)(se.A,{variant:"small"===c?"caption":"body2",component:"span",sx:{ml:.5},children:[Math.abs(a),"%"]})]})]}),"linear"===l?(0,de.FD)(ee.A,{sx:{width:"100%",position:"relative"},children:[(0,de.Y)(Nt.A,{variant:"determinate",value:Math.min(g,100),sx:{height:"small"===c?4:6,borderRadius:"small"===c?2:3,backgroundColor:h.palette.grey[200],"& .MuiLinearProgress-bar":{backgroundColor:y}}}),d&&i&&(0,de.FD)(se.A,{variant:"caption",color:"textSecondary",sx:{position:"absolute",right:0,top:"100%",mt:.5},children:["Target: ",p(i)]})]}):(0,de.FD)(ee.A,{sx:{position:"relative",display:"inline-flex",alignItems:"center",justifyContent:"center"},children:[(0,de.Y)(Ue.A,{variant:"determinate",value:Math.min(g,100),size:"small"===c?40:56,sx:{color:y,"& .MuiCircularProgress-circle":{strokeLinecap:"round"}}}),(0,de.Y)(se.A,{variant:"small"===c?"caption":"body2",component:"div",color:"textSecondary",sx:{position:"absolute",display:"flex",alignItems:"center",justifyContent:"center"},children:p(r)})]}),o&&(0,de.Y)(se.A,{variant:"small"===c?"caption":"body2",color:"textSecondary",sx:{mt:1},children:o})]})},Et=(e,t)=>e>=90?t.palette.success.main:e>=60?t.palette.warning.main:t.palette.error.main;zt.propTypes={title:s().string.isRequired,value:s().number.isRequired,target:s().number,trend:s().number,format:s().oneOf(["number","percentage","currency","integer"]),description:s().string,tooltip:s().string,type:s().oneOf(["linear","circular"]),size:s().oneOf(["small","medium"]),showTarget:s().bool,className:s().string,style:s().object};const Tt=i.memo(zt);var Pt=r(34953);const Ot={HIGH:.01,MEDIUM:.05,LOW:.1},$t={CONNECTIVITY:.4,PRICE_INTEGRATION:.3,STABILITY:.2,RESILIENCE:.1};function Lt(e,t){if(e.length!==t.length||e.length<3)return{correlation:0,significant:!1};const r=e.reduce(((e,t)=>e+t),0)/e.length,i=t.reduce(((e,t)=>e+t),0)/t.length;let a=0,n=0,o=0;for(let s=0;s<e.length;s++){const l=e[s]-r,c=t[s]-i;a+=l*c,n+=l*l,o+=c*c}const s=Math.sqrt(n*o),l=0===s?0:a/s,c=l*Math.sqrt((e.length-2)/(1-l*l)),d=2*(1-function(e,t){return 1-.5*(r=t/2,i=t/(t+e*e),0===i?0:1===i?1:i**r*(1-i)**.5);var r,i}(Math.abs(c),e.length-2));return{correlation:(l+1)/2,significant:d<=Ot.MEDIUM,details:{rawCorrelation:l,tStatistic:c,pValue:d,sampleSize:e.length}}}function jt(e){const t=new Map;return e.forEach((e=>{const r=(0,Pt.YP)(e.region);t.has(r)||t.set(r,[]),t.get(r).push(e)})),t}function qt(e){const t=new Map;return e.forEach((e=>{const r=(0,Pt.YP)(e.source),i=(0,Pt.YP)(e.target),a=`${r}-${i}`,n=`${i}-${r}`;t.set(a,e),t.set(n,e)})),t}function Wt(e,t){const r=e.length*(e.length-1)/2;let i=0;const a=[];let n=0;for(let r=0;r<e.length;r++)for(let o=r+1;o<e.length;o++){const s=`${e[r]}-${e[o]}`,l=`${e[o]}-${e[r]}`,c=t.get(s)||t.get(l);c&&(i++,a.push({source:e[r],target:e[o],flow:c.total_flow,avgFlow:c.avg_flow}),n+=c.total_flow)}const o=r>0?i/r:0;return{score:o,details:{connections:a,coverage:i/e.length,density:o,summary:{actualConnections:i,potentialConnections:r,totalFlow:n,averageFlow:i>0?n/i:0}}}}function Vt(e,t){const r={markets:[],average:0,coverage:0};let i=0,a=0;return e.forEach((e=>{const n=(t.get(e)||[]).filter((e=>null!=e.conflictIntensity&&!isNaN(e.conflictIntensity))).map((e=>e.conflictIntensity));if(n.length>0){const t=n.reduce(((e,t)=>e+t),0)/n.length;r.markets.push({market:e,conflict:t}),i+=t,a++}})),r.average=a>0?i/a:0,r.coverage=a/e.length,r.score=Math.max(0,1-r.average/10),r}function Ht(e,t){const r={};let i=0;e.forEach((e=>{const a=(t.get(e)||[]).filter((e=>null!=e.usdPrice&&!isNaN(e.usdPrice))).map((e=>e.usdPrice));a.length>=3&&(r[e]=a,i+=a.length)}));const a=function(e){const t={pairs:[],average:0,significant:0,total:0};let r=0,i=0;return Object.entries(e).forEach((a=>{let[n,o]=a;Object.entries(e).forEach((e=>{let[a,s]=e;if(n<a&&o.length>1&&s.length>1){const e=Math.min(o.length,s.length),l=o.slice(0,e),c=s.slice(0,e),{correlation:d,significant:u}=Lt(l,c);isNaN(d)||(t.pairs.push({markets:[n,a],correlation:d,significant:u}),r+=d,i++,u&&t.significant++)}}))})),t.average=i>0?r/i:0,t.total=i,t}(r),n=Object.values(r).flat().reduce(((e,t)=>e+t),0)/Object.values(r).flat().length||0;return{score:a.average,avgPrice:n,dataPoints:i,significance:a.significant/a.total,details:a}}function Bt(e,t){const r=function(e,t){const r={markets:[],average:0,coverage:0};let i=0,a=0;return e.forEach((e=>{const n=(t.get(e)||[]).filter((e=>null!=e.usdPrice&&!isNaN(e.usdPrice))).map((e=>e.usdPrice));if(n.length>=2){const t=n.reduce(((e,t)=>e+t),0)/n.length,o=n.reduce(((e,r)=>e+Math.pow(r-t,2)),0)/n.length,s=Math.sqrt(o)/t;r.markets.push({market:e,volatility:s}),i+=s,a++}})),r.average=a>0?i/a:1,r.coverage=a/e.length,r}(e,t);return{score:Math.max(0,1-Math.min(r.average,1)),details:r}}function Gt(e){let{dataPoints:t,coverage:r,significance:i}=e;return(Math.min(t/100,1)+r+i)/3}const Ut=(e,t,r)=>{if(!Array.isArray(e)||!e.length)return{clusters:[],metrics:null,error:"Invalid clusters data"};if(!Array.isArray(t)||!t.length)return{clusters:[],metrics:null,error:"Invalid time series data"};if(!Array.isArray(r)||!r.length)return{clusters:[],metrics:null,error:"Invalid flows data"};try{const i=jt(t),a=qt(r),n=e.map((e=>{const t=e.connected_markets.map((e=>(0,Pt.YP)(e)));if(t.length<2)return{...e,metrics:{efficiency:0,efficiencyComponents:{connectivity:0,priceIntegration:0,stability:0,conflictResilience:0},avgPrice:0,avgConflict:0,marketCount:0,reliability:0,warning:"Default metrics due to insufficient data"},warning:"Insufficient markets for reliable analysis"};const r=Wt(t,a),n=Ht(t,i),o=Bt(t,i),s=Vt(t,i);var l;const c={efficiency:(l={connectivity:r.score,priceIntegration:n.score,stability:o.score,resilience:s.score}).connectivity*$t.CONNECTIVITY+l.priceIntegration*$t.PRICE_INTEGRATION+l.stability*$t.STABILITY+l.resilience*$t.RESILIENCE,efficiencyComponents:{connectivity:r.score,priceIntegration:n.score,stability:o.score,conflictResilience:s.score},details:{connectivity:r.details,priceIntegration:n.details,stability:o.details,resilience:s.details},avgPrice:n.avgPrice,avgConflict:s.average,marketCount:t.length,reliability:Gt({dataPoints:n.dataPoints,coverage:r.details.coverage,significance:n.significance})};return{...e,metrics:c}})),o=function(e){return{totalMarkets:e.reduce(((e,t)=>e+t.metrics.marketCount),0),avgPrice:e.reduce(((e,t)=>e+t.metrics.avgPrice),0)/e.length,avgConflict:e.reduce(((e,t)=>e+t.metrics.avgConflict),0)/e.length,avgEfficiency:e.reduce(((e,t)=>e+t.metrics.efficiency),0)/e.length,reliability:e.reduce(((e,t)=>e+(t.metrics.reliability||0)),0)/e.length}}(n);return{clusters:n,metrics:o,metadata:{timestamp:(new Date).toISOString(),dataPoints:t.length,flowCount:r.length,clusterCount:e.length}}}catch(e){return{clusters:[],metrics:null,error:e.message}}},Zt=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const t=(0,n.d4)((e=>e.spatial.data.marketClusters)),r=(0,n.d4)((e=>e.spatial.data.flowMaps)),a=(0,n.d4)((e=>e.spatial.data.timeSeriesData));return(0,i.useMemo)((()=>{const i=k.backgroundMonitor.startMetric("cluster-analysis");try{if(null==t||!t.length)return{clusters:[],selectedCluster:null};!Array.isArray(r)||r.length,!Array.isArray(a)||a.length;const{clusters:n,metrics:o}=Ut(t,a,r),s=e?n.find((t=>t.cluster_id===e)):null;if(s);return i.finish({status:"success"}),{clusters:n,selectedCluster:s,metrics:o}}catch(e){return i.finish({status:"error",error:e.message}),{clusters:[],selectedCluster:null,metrics:null}}}),[t,r,a,e])},Xt=e=>{let{efficiencyComponents:t}=e;const r=(0,ge.A)();return(0,i.useEffect)((()=>{}),[t]),(0,de.FD)(ee.A,{sx:{mt:2,p:2,bgcolor:r.palette.grey[50],borderRadius:1,boxShadow:1},children:[(0,de.Y)(se.A,{variant:"subtitle2",gutterBottom:!0,color:"primary",children:"Market Efficiency Components"}),(0,de.FD)(ze.Ay,{container:!0,spacing:2,children:[(0,de.Y)(ze.Ay,{item:!0,xs:12,md:3,children:(0,de.Y)(mt.A,{title:"Measures the strength and density of market connections within the cluster",children:(0,de.FD)(ee.A,{children:[(0,de.Y)(se.A,{variant:"caption",color:"textSecondary",children:"Market Connectivity (40%)"}),(0,de.FD)(se.A,{variant:"body2",fontWeight:"medium",children:[(100*(null==t?void 0:t.connectivity)).toFixed(1),"%"]}),(0,de.Y)(se.A,{variant:"caption",color:"textSecondary",children:"Internal market connections"})]})})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,md:3,children:(0,de.Y)(mt.A,{title:"Evaluates the degree of price correlation between markets in the cluster",children:(0,de.FD)(ee.A,{children:[(0,de.Y)(se.A,{variant:"caption",color:"textSecondary",children:"Price Integration (30%)"}),(0,de.FD)(se.A,{variant:"body2",fontWeight:"medium",children:[(100*(null==t?void 0:t.priceIntegration)).toFixed(1),"%"]}),(0,de.Y)(se.A,{variant:"caption",color:"textSecondary",children:"Price correlation between markets"})]})})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,md:3,children:(0,de.Y)(mt.A,{title:"Measures the consistency and predictability of prices over time",children:(0,de.FD)(ee.A,{children:[(0,de.Y)(se.A,{variant:"caption",color:"textSecondary",children:"Price Stability (20%)"}),(0,de.FD)(se.A,{variant:"body2",fontWeight:"medium",children:[(100*(null==t?void 0:t.stability)).toFixed(1),"%"]}),(0,de.Y)(se.A,{variant:"caption",color:"textSecondary",children:"Price consistency over time"})]})})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,md:3,children:(0,de.Y)(mt.A,{title:"Assesses the market's ability to maintain function during conflict",children:(0,de.FD)(ee.A,{children:[(0,de.Y)(se.A,{variant:"caption",color:"textSecondary",children:"Conflict Resilience (10%)"}),(0,de.FD)(se.A,{variant:"body2",fontWeight:"medium",children:[(100*(null==t?void 0:t.conflictResilience)).toFixed(1),"%"]}),(0,de.Y)(se.A,{variant:"caption",color:"textSecondary",children:"Market function under conflict"})]})})})]})]})},Jt=e=>{let{value:t,showTooltip:r=!1}=e;return(0,i.useEffect)((()=>{}),[t]),(0,de.Y)(Tt,{title:"Cluster Efficiency",value:t,format:"percentage",description:"Market integration efficiency",showTarget:!1,tooltip:r?"\n        Comprehensive measure of market cluster performance:\n        • Market Connectivity (40%): Network strength\n        • Price Integration (30%): Price correlation\n        • Price Stability (20%): Temporal consistency\n        • Conflict Resilience (10%): Stress resistance\n      ":void 0})},Kt=()=>{const e=(0,ge.A)(),[t,r]=(0,i.useState)(null),[a,o]=(0,i.useState)(!0),[s,l]=(0,i.useState)(!1),{clusters:c,selectedCluster:d,metrics:u}=Zt(t),m=(0,n.d4)(De.T9),h={totalMarkets:(null==u?void 0:u.totalMarkets)||0,marketCoverage:(null==u?void 0:u.marketCoverage)||0,avgPrice:(null==u?void 0:u.avgPrice)||0,avgConflict:(null==u?void 0:u.avgConflict)||0};(0,i.useEffect)((()=>{t&&o(!1)}),[t]);const p=(0,i.useCallback)((e=>{r(e)}),[]);return null!=c&&c.length?(0,de.FD)(ze.Ay,{container:!0,spacing:2,children:[(0,de.Y)(ze.Ay,{item:!0,xs:12,children:(0,de.FD)($e.A,{sx:{p:2,boxShadow:2},children:[(0,de.Y)(se.A,{variant:"h6",gutterBottom:!0,color:"primary",children:"Market Cluster Overview"}),(0,de.FD)(ze.Ay,{container:!0,spacing:2,children:[(0,de.Y)(ze.Ay,{item:!0,xs:12,md:3,children:(0,de.Y)(mt.A,{title:"Total number of markets included in identified clusters",children:(0,de.Y)(ee.A,{children:(0,de.Y)(Ft,{title:"Total Markets",value:h.totalMarkets,format:"integer",description:"Markets in clusters"})})})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,md:3,children:(0,de.Y)(mt.A,{title:"Percentage of total markets that are part of identified clusters",children:(0,de.Y)(ee.A,{children:(0,de.Y)(Tt,{title:"Market Coverage",value:h.marketCoverage,format:"percentage",description:"Markets in clusters",showTarget:!1})})})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,md:3,children:(0,de.Y)(mt.A,{title:"Average commodity price across all clustered markets",children:(0,de.Y)(ee.A,{children:(0,de.Y)(Ft,{title:"Average Price",value:h.avgPrice,format:"currency",description:"Across clusters"})})})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,md:3,children:(0,de.Y)(mt.A,{title:"Average conflict intensity affecting market clusters",children:(0,de.Y)(ee.A,{children:(0,de.Y)(Ft,{title:"Conflict Impact",value:h.avgConflict,format:"number",description:"Conflict intensity"})})})})]})]})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,children:(0,de.FD)($e.A,{sx:{height:600,p:2,position:"relative",boxShadow:2},children:[(0,de.Y)(Ct,{clusters:c,selectedClusterId:t,onClusterSelect:p,geometry:m}),(0,de.Y)(ht.A,{in:a,children:(0,de.FD)(ee.A,{sx:{position:"absolute",top:16,right:16,bgcolor:"rgba(255, 255, 255, 0.95)",p:2,borderRadius:1,boxShadow:2,display:"flex",alignItems:"center",gap:1,zIndex:1e3},children:[(0,de.Y)(yt.A,{color:"primary"}),(0,de.Y)(se.A,{variant:"body2",color:"text.secondary",children:"Click on any colored region to view detailed cluster analysis"})]})})]})}),d&&d.metrics&&(0,de.Y)(ze.Ay,{item:!0,xs:12,children:(0,de.FD)($e.A,{sx:{p:2,boxShadow:2},children:[(0,de.FD)(se.A,{variant:"h6",gutterBottom:!0,color:"primary",children:[d.main_market," Market Cluster Analysis"]}),(0,de.FD)(ze.Ay,{container:!0,spacing:2,children:[(0,de.Y)(ze.Ay,{item:!0,xs:12,md:3,children:(0,de.Y)(mt.A,{title:"Number of markets connected within this cluster",children:(0,de.Y)(ee.A,{children:(0,de.Y)(Ft,{title:"Connected Markets",value:d.metrics.marketCount,format:"integer",description:"Active connections"})})})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,md:3,children:(0,de.Y)(Jt,{value:d.metrics.efficiency,showTooltip:!0})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,md:3,children:(0,de.Y)(mt.A,{title:"Average commodity price within this cluster",children:(0,de.Y)(ee.A,{children:(0,de.Y)(Ft,{title:"Average Price",value:d.metrics.avgPrice,format:"currency",description:"Cluster average"})})})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,md:3,children:(0,de.Y)(mt.A,{title:"Average conflict intensity affecting this cluster",children:(0,de.Y)(ee.A,{children:(0,de.Y)(Ft,{title:"Conflict Impact",value:d.metrics.avgConflict,format:"number",description:"Local intensity"})})})})]}),(0,de.Y)(Xt,{efficiencyComponents:d.metrics.efficiencyComponents}),(0,de.Y)(ee.A,{sx:{mt:2,p:2,bgcolor:e.palette.grey[50],borderRadius:1,boxShadow:1},children:(0,de.Y)(se.A,{variant:"body2",color:"text.secondary",children:`This cluster contains ${d.metrics.marketCount} interconnected markets with an efficiency rating of \n                ${(100*d.metrics.efficiency).toFixed(1)}%. \n                ${d.metrics.avgConflict>.5?"High conflict intensity may be impacting market integration and efficiency.":"Market integration remains robust under current conditions."}`})})]})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,children:(0,de.FD)($e.A,{sx:{p:2,boxShadow:2},children:[(0,de.Y)(Se.A,{fullWidth:!0,onClick:()=>l(!s),endIcon:s?(0,de.Y)(bt.A,{}):(0,de.Y)(vt.A,{}),startIcon:(0,de.Y)(ft.A,{}),children:"Market Cluster Analysis Methodology"}),(0,de.FD)(pt.A,{in:s,children:[(0,de.Y)(Ce.A,{sx:{my:2}}),(0,de.Y)(se.A,{variant:"subtitle1",gutterBottom:!0,color:"primary",children:"Understanding Market Cluster Analysis"}),(0,de.Y)(se.A,{variant:"body2",paragraph:!0,children:"Market clusters are identified and analyzed using a comprehensive approach that combines spatial relationships, price dynamics, and conflict impact assessment:"}),(0,de.FD)(gt.A,{dense:!0,children:[(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:(0,de.Y)(se.A,{variant:"subtitle2",color:"primary",children:"Cluster Identification"}),secondary:(0,de.Y)(se.A,{variant:"body2",color:"textSecondary",children:"Markets are grouped based on spatial proximity, trade relationships, and price correlation patterns"})})}),(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:(0,de.Y)(se.A,{variant:"subtitle2",color:"primary",children:"Efficiency Calculation"}),secondary:(0,de.Y)(se.A,{variant:"body2",color:"textSecondary",children:"Cluster efficiency is measured through market connectivity (40%), price integration (30%), stability (20%), and conflict resilience (10%)"})})}),(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:(0,de.Y)(se.A,{variant:"subtitle2",color:"primary",children:"Impact Assessment"}),secondary:(0,de.Y)(se.A,{variant:"body2",color:"textSecondary",children:"Conflict impact is evaluated through market disruption patterns, price volatility, and trade flow changes"})})})]}),(0,de.FD)(ee.A,{sx:{mt:2,p:2,bgcolor:"background.paper",borderRadius:1},children:[(0,de.Y)(se.A,{variant:"subtitle2",gutterBottom:!0,color:"primary",children:"Interpretation Guide:"}),(0,de.FD)(se.A,{variant:"body2",component:"div",children:["• High Efficiency (>70%): Strong market integration and resilience",(0,de.Y)("br",{}),"• Medium Efficiency (40-70%): Moderate market function with some constraints",(0,de.Y)("br",{}),"• Low Efficiency (<40%): Significant market fragmentation or disruption"]})]})]})]})})]}):(0,de.Y)(Ke.A,{severity:"info",sx:{m:2},children:"No market cluster data available for analysis. Please ensure data is properly loaded."})},Qt=i.memo(Kt);var er=r(66559),tr=r(60181);const rr={HIGHLY_SIGNIFICANT:.01,SIGNIFICANT:.05,MARGINALLY_SIGNIFICANT:.1,WEAKLY_SIGNIFICANT:.15},ir={HIGH_HIGH:"high-high",LOW_LOW:"low-low",HIGH_LOW:"high-low",LOW_HIGH:"low-high",NOT_SIGNIFICANT:"not_significant"},ar={[ir.HIGH_HIGH]:"#d73027",[ir.LOW_LOW]:"#313695",[ir.HIGH_LOW]:"#fdae61",[ir.LOW_HIGH]:"#74add1",[ir.NOT_SIGNIFICANT]:"#969696"},nr={globalMoranI:0,pValue:1,zScore:0,avgLocalI:0,maxLocalI:0,spatialAssociation:0,clusterStrength:0,significanceLevels:{highlySignificant:0,significant:0,marginal:0,notSignificant:0},robustness:{variance:0,standardError:0,confidenceInterval:{lower:0,upper:0}}},or={totals:{"high-high":0,"low-low":0,"high-low":0,"low-high":0,not_significant:0},significantCount:0,totalRegions:0,significanceRate:0,hotspotRate:0,coldspotRate:0,outlierRate:0,clusterStrength:0,spatialHeterogeneity:0},sr=s().shape({local_i:s().number.isRequired,p_value:s().number.isRequired,z_score:s().number.isRequired,cluster_type:s().oneOf(Object.values(ir)).isRequired,variance:s().number.isRequired,spatial_lag:s().number.isRequired,standardizedValue:s().number.isRequired,clusterStrength:s().number.isRequired}),lr=(s().shape({moran_i:s().number.isRequired,p_value:s().number.isRequired,z_score:s().number.isRequired,significance:s().bool.isRequired,variance:s().number.isRequired,standardError:s().number.isRequired,confidenceInterval:s().shape({lower:s().number.isRequired,upper:s().number.isRequired}).isRequired}),s().shape({totals:s().objectOf(s().number).isRequired,significantCount:s().number.isRequired,totalRegions:s().number.isRequired,significanceRate:s().number.isRequired,hotspotRate:s().number.isRequired,coldspotRate:s().number.isRequired,outlierRate:s().number.isRequired,clusterStrength:s().number.isRequired,spatialHeterogeneity:s().number.isRequired}),s().shape({globalMoranI:s().number.isRequired,pValue:s().number.isRequired,zScore:s().number.isRequired,avgLocalI:s().number.isRequired,maxLocalI:s().number.isRequired,spatialAssociation:s().number.isRequired,clusterStrength:s().number.isRequired,significanceLevels:s().shape({highlySignificant:s().number.isRequired,significant:s().number.isRequired,marginal:s().number.isRequired,notSignificant:s().number.isRequired}).isRequired,robustness:s().shape({variance:s().number.isRequired,standardError:s().number.isRequired,confidenceInterval:s().shape({lower:s().number.isRequired,upper:s().number.isRequired}).isRequired}).isRequired}),s().objectOf(sr),s().shape({type:s().oneOf(["FeatureCollection"]).isRequired,features:s().arrayOf(s().object).isRequired}).isRequired,s().string,s().func.isRequired,s().objectOf(sr),s().number.isRequired,s().string,s().func.isRequired,s().bool,s().objectOf(s().arrayOf(s().shape({region:s().string.isRequired,...sr}))),s().objectOf(sr),s().string,s().func.isRequired,s().bool,s().objectOf(sr),s().string,s().objectOf(s().arrayOf(s().shape({region:s().string.isRequired,...sr}))),s().bool,s().node.isRequired,s().node,s().func,s().number,s().bool,s().func,s().bool,s().string,s().oneOf(["low","medium","high"]),[15.3694,44.191]),cr=[[10.111,39.814],[21.0025,56.5305]],dr=e=>{let{localStats:t,geometry:r,selectedRegion:a,onRegionSelect:n}=e;const o=(0,ge.A)(),s=(0,Q.A)(o.breakpoints.down("md")),l=(0,i.useMemo)((()=>{if(!(t&&r&&r.features&&Array.isArray(r.features)))return null;try{return{type:"FeatureCollection",features:r.features.map((e=>{var r,i;const n=(null===(r=e.properties)||void 0===r?void 0:r.name)||(null===(i=e.properties)||void 0===i?void 0:i.region_id)||"",o=t[n],s=o?Math.abs(o.local_i)*(o.p_value<=rr.SIGNIFICANT?1:.5):0,l=o?o.p_value<=rr.HIGHLY_SIGNIFICANT?"Highly Significant":o.p_value<=rr.SIGNIFICANT?"Significant":o.p_value<=rr.MARGINALLY_SIGNIFICANT?"Marginally Significant":"Not Significant":"No Data";return{...e,properties:{...e.properties,stats:o?{...o,clusterStrength:s,significanceLevel:l}:null,isSelected:n===a}}}))}}catch(e){return null}}),[t,r,a]),c=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;return null==e?"N/A":"number"==typeof e?e.toFixed(t):e.toString()};return l?(0,de.FD)(ee.A,{sx:{height:"100%",position:"relative"},children:[(0,de.Y)(ee.A,{sx:{position:"absolute",top:10,left:"50%",transform:"translateX(-50%)",zIndex:1e3,bgcolor:"background.paper",p:1,borderRadius:1,boxShadow:1,textAlign:"center",maxWidth:"90%"},children:(0,de.Y)(se.A,{variant:"body2",color:"textSecondary",children:"Click on any region to view detailed market cluster analysis"})}),(0,de.FD)(At.W,{center:lr,zoom:6,style:{height:"100%",width:"100%"},maxBounds:cr,minZoom:5,maxZoom:8,zoomControl:!0,dragging:!0,touchZoom:!0,doubleClickZoom:!0,scrollWheelZoom:!1,boxZoom:!0,keyboard:!0,bounceAtZoomLimits:!0,worldCopyJump:!1,preferCanvas:!0,children:[(0,de.Y)(wt.e,{url:"https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",attribution:"© OpenStreetMap contributors",noWrap:!0,maxNativeZoom:8,maxZoom:8,tileSize:256,zoomOffset:0,keepBuffer:8}),(0,de.Y)(_t.k,{data:l,style:e=>{const t=e.properties.stats,r=e.properties.isSelected;if(!t)return{fillColor:o.palette.grey[300],weight:r?2:1,opacity:1,color:r?o.palette.primary.main:o.palette.grey[500],fillOpacity:.7};const i=t.p_value<=rr.HIGHLY_SIGNIFICANT?.9:t.p_value<=rr.SIGNIFICANT?.7:t.p_value<=rr.MARGINALLY_SIGNIFICANT?.5:.3,a=Math.min(.2*t.clusterStrength,.1),n=Math.min(i+a,1);return{fillColor:ar[t.cluster_type]||o.palette.grey[300],weight:r?3:1,opacity:1,color:r?o.palette.primary.main:o.palette.grey[500],fillOpacity:n}},onEachFeature:(e,t)=>{const r=e.properties.stats,i=e.properties.name||e.properties.region_id||"";t.bindTooltip((()=>r?`\n        <div style="min-width: ${s?"180px":"220px"};">\n          <strong>${i}</strong><br/>\n          Type: ${r.cluster_type.replace("-"," ")}<br/>\n          Significance: ${r.significanceLevel}<br/>\n          Moran’s I: ${c(r.local_i)}<br/>\n          p-value: ${c(r.p_value)}<br/>\n          Z-score: ${c(r.z_score)}\n        </div>\n      `:`<div><strong>${i}</strong><br/>No data available</div>`),{sticky:!0,direction:"auto",className:"lisa-map-tooltip"}),t.on({click:()=>n(i)})}})]}),(0,de.FD)(ee.A,{sx:{position:"absolute",bottom:s?10:20,right:s?10:20,bgcolor:"background.paper",p:s?1:1.5,borderRadius:1,boxShadow:2,zIndex:1e3,maxWidth:s?"150px":"200px"},children:[(0,de.Y)(se.A,{variant:"caption",display:"block",gutterBottom:!0,children:"Spatial Clusters"}),Object.entries(ar).map((e=>{let[t,r]=e;return(0,de.FD)(ee.A,{display:"flex",alignItems:"center",gap:.5,mb:.5,children:[(0,de.Y)(ee.A,{sx:{width:s?10:14,height:s?10:14,bgcolor:r,opacity:"not_significant"===t?.3:.8,border:"1px solid rgba(0,0,0,0.2)",borderRadius:.5}}),(0,de.Y)(se.A,{variant:"caption",sx:{fontSize:s?"0.7rem":"0.8rem"},children:t.split("-").map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join("-")})]},t)})),(0,de.Y)(se.A,{variant:"caption",display:"block",mt:1,sx:{fontSize:s?"0.65rem":"0.75rem",color:o.palette.text.secondary},children:"Opacity indicates significance and strength"})]})]}):(0,de.Y)(ee.A,{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100%",p:2,gap:2,children:(0,de.Y)(se.A,{color:"textSecondary",children:"No map data available"})})},ur=i.memo(dr);var mr=r(76502),hr=r(91454);const pr=e=>{var t;let{data:r,globalMoranI:a,selectedRegion:n,onPointSelect:o}=e;const s=(0,ge.A)(),l=(0,Q.A)(s.breakpoints.down("md")),c=l?{top:40,right:20,bottom:40,left:40}:{top:50,right:30,bottom:50,left:50},d=l?300:500,u=l?300:500,m=d-c.left-c.right,h=u-c.top-c.bottom,p=(0,i.useMemo)((()=>{if(!r)return{points:[],regressionLine:[],confidenceBands:[]};const e=Object.entries(r).map((e=>{let[t,r]=e;return{region:t,x:r.local_i||0,y:r.spatial_lag||0,cluster_type:r.cluster_type||"not_significant",significance:r.p_value<=rr.SIGNIFICANT,p_value:r.p_value,z_score:r.z_score,clusterStrength:Math.abs(r.local_i)*(r.p_value<=rr.SIGNIFICANT?1:.5),variance:r.variance||0,isSelected:t===n}})),t=e.map((e=>e.x)),i=e.map((e=>e.y)),a=e.length,o=t.reduce(((e,t)=>e+t),0),s=i.reduce(((e,t)=>e+t),0),l=t.reduce(((e,t,r)=>e+t*i[r]),0),c=t.reduce(((e,t)=>e+t*t),0),d=(a*l-o*s)/(a*c-o*o),u=(s-d*o)/a,[m,h]=(0,hr.A)(e,(e=>e.x)),p=[{x:m,y:d*m+u},{x:h,y:d*h+u}],g=Math.sqrt(e.reduce(((e,t)=>{const r=d*t.x+u;return e+Math.pow(t.y-r,2)}),0)/(a-2));return{points:e,regressionLine:p,confidenceBands:t.map((e=>{const t=d*e+u,r=1.96*(g*Math.sqrt(1/a+Math.pow(e-o/a,2)/(c-o*o/a)));return{x:e,yLower:t-r,yUpper:t+r}})).sort(((e,t)=>e.x-t.x))}}),[r,n]),g=(0,i.useMemo)((()=>{const[e,t]=(0,hr.A)(p.points,(e=>e.x)),r=.1*Math.abs(t-e);return(0,mr.A)().domain([e-r,t+r]).range([0,m])}),[p,m]),y=(0,i.useMemo)((()=>{const[e,t]=(0,hr.A)(p.points,(e=>e.y)),r=.1*Math.abs(t-e);return(0,mr.A)().domain([e-r,t+r]).range([h,0])}),[p,h]),f=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;return null==e?"N/A":"number"==typeof e?e.toFixed(t):e.toString()};return r&&0!==Object.keys(r).length?(0,de.FD)(ee.A,{sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",alignItems:"center",p:2,position:"relative"},children:[(0,de.Y)(se.A,{variant:"h6",gutterBottom:!0,align:"center",children:"Moran's I Scatter Plot"}),(0,de.FD)(se.A,{variant:"body2",color:"textSecondary",gutterBottom:!0,align:"center",children:["Global Moran's I: ",f(a),(null===(t=r[Object.keys(r)[0]])||void 0===t?void 0:t.p_value)&&` (p-value: ${f(r[Object.keys(r)[0]].p_value)})`]}),(0,de.Y)($e.A,{elevation:1,sx:{position:"absolute",top:c.top,left:"50%",transform:"translateX(-50%)",zIndex:1,p:1,bgcolor:"background.paper",borderRadius:1,maxWidth:"90%",textAlign:"center"},children:(0,de.Y)(se.A,{variant:"body2",color:"textSecondary",children:"Click on any point to view detailed market cluster analysis"})}),(0,de.FD)("svg",{width:"100%",height:"100%",viewBox:`0 0 ${d} ${u}`,style:{maxWidth:d,maxHeight:u},preserveAspectRatio:"xMidYMid meet",children:[(0,de.Y)("defs",{children:(0,de.Y)("clipPath",{id:"plot-area",children:(0,de.Y)("rect",{x:0,y:0,width:m,height:h})})}),(0,de.FD)("g",{transform:`translate(${c.left},${c.top})`,children:[(0,de.Y)("path",{d:`M ${p.confidenceBands.map((e=>`${g(e.x)},${y(e.yLower)}`)).join("L")} \n                L ${p.confidenceBands.reverse().map((e=>`${g(e.x)},${y(e.yUpper)}`)).join("L")} Z`,fill:s.palette.primary.main,opacity:.1,clipPath:"url(#plot-area)"}),(0,de.Y)("path",{d:`M ${p.regressionLine.map((e=>`${g(e.x)},${y(e.y)}`)).join("L")}`,stroke:s.palette.primary.main,strokeWidth:2,strokeDasharray:"4",fill:"none",opacity:.6,clipPath:"url(#plot-area)"}),(0,de.Y)("line",{x1:0,y1:h/2,x2:m,y2:h/2,stroke:s.palette.text.secondary,strokeWidth:1,strokeDasharray:"4"}),(0,de.Y)("line",{x1:m/2,y1:0,x2:m/2,y2:h,stroke:s.palette.text.secondary,strokeWidth:1,strokeDasharray:"4"}),p.points.map(((e,t)=>{const r=e.significance?6:5,i=e.isSelected?r+2:r;return(0,de.FD)("g",{children:[e.variance>0&&(0,de.Y)("circle",{cx:g(e.x),cy:y(e.y),r:i+10*Math.sqrt(e.variance),fill:ar[e.cluster_type],opacity:.1}),(0,de.Y)("circle",{cx:g(e.x),cy:y(e.y),r:i,fill:ar[e.cluster_type],stroke:e.isSelected?s.palette.primary.main:"none",strokeWidth:2,opacity:e.significance?.8:.4,style:{cursor:"pointer"},onClick:()=>o(e.region),children:(0,de.Y)("title",{children:`Region: ${e.region}\n                      Cluster: ${e.cluster_type.replace("-"," ")}\n                      Local Moran's I: ${f(e.x)}\n                      Spatial Lag: ${f(e.y)}\n                      P-value: ${f(e.p_value)}\n                      Z-score: ${f(e.z_score)}\n                      Cluster Strength: ${f(e.clusterStrength)}`})})]},t)})),(0,de.Y)("text",{x:m/2,y:h+c.bottom-10,textAnchor:"middle",fill:s.palette.text.primary,fontSize:l?"0.8rem":"1rem",children:"Local Moran's I"}),(0,de.Y)("text",{x:-h/2,y:15-c.left,transform:"rotate(-90)",textAnchor:"middle",fill:s.palette.text.primary,fontSize:l?"0.8rem":"1rem",children:"Spatial Lag"})]})]}),(0,de.FD)(ee.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:1,mt:2,p:1.5,bgcolor:"background.paper",borderRadius:1,boxShadow:1,width:"100%",maxWidth:l?300:400},children:[(0,de.Y)(se.A,{variant:"caption",sx:{fontWeight:"bold"},children:"Cluster Types and Significance"}),(0,de.Y)(ee.A,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"center",gap:2},children:Object.entries(ar).map((e=>{let[t,r]=e;return(0,de.FD)(ee.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,de.Y)(ee.A,{sx:{width:12,height:12,borderRadius:"50%",bgcolor:r,opacity:"not_significant"===t?.4:.8,border:"1px solid rgba(0,0,0,0.1)"}}),(0,de.Y)(se.A,{variant:"caption",sx:{fontSize:l?"0.7rem":"0.8rem"},children:t.split("-").map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join("-")})]},t)}))}),(0,de.FD)(ee.A,{sx:{textAlign:"center"},children:[(0,de.Y)(se.A,{variant:"caption",sx:{fontSize:l?"0.65rem":"0.75rem",color:s.palette.text.secondary,display:"block"},children:"Opacity indicates significance level"}),(0,de.Y)(se.A,{variant:"caption",sx:{fontSize:l?"0.65rem":"0.75rem",color:s.palette.text.secondary,display:"block"},children:"Circle size shows confidence interval"})]})]})]}):(0,de.Y)(ee.A,{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",children:(0,de.Y)(se.A,{color:"textSecondary",children:"No data available for scatter plot"})})},gr=i.memo(pr);var yr=r(82022);const fr=e=>{let{global:t,local:r,selectedRegion:a,clusters:n,spatialMetrics:o}=e;const s=(0,ge.A)(),[l,c]=((0,Q.A)(s.breakpoints.down("md")),(0,i.useState)(!1)),[d,u]=(0,i.useState)(!1),m=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;return null==e?"N/A":"number"==typeof e?e.toFixed(t):e.toString()},h=(0,i.useMemo)((()=>{if(!r||!t)return null;const e=Object.values(r),i=e.filter((e=>e.p_value<=rr.SIGNIFICANT)).length,a=e.filter((e=>e.p_value<=rr.HIGHLY_SIGNIFICANT)).length;return{totalRegions:e.length,significantCount:i,highlySignificantCount:a,significanceRate:i/e.length,averageLocalI:e.reduce(((e,t)=>e+Math.abs(t.local_i)),0)/e.length,spatialAssociation:Math.abs(t.moran_i)*(t.significance?1:.5),clusterDistribution:{hotspots:e.filter((e=>"high-high"===e.cluster_type)).length,coldspots:e.filter((e=>"low-low"===e.cluster_type)).length,outliers:e.filter((e=>["high-low","low-high"].includes(e.cluster_type))).length}}}),[r,t]),p=(0,i.useMemo)((()=>{if(!a||!r||!r[a])return null;const e=r[a],t=e.variance?{lower:e.local_i-1.96*Math.sqrt(e.variance),upper:e.local_i+1.96*Math.sqrt(e.variance)}:null;return{...e,confidenceInterval:t,standardizedValue:e.z_score,clusterStrength:Math.abs(e.local_i)*(e.p_value<=rr.SIGNIFICANT?1:.5),significanceLevel:e.p_value<=rr.HIGHLY_SIGNIFICANT?"Highly Significant":e.p_value<=rr.SIGNIFICANT?"Significant":e.p_value<=rr.MARGINALLY_SIGNIFICANT?"Marginally Significant":"Not Significant"}}),[a,r]);return(0,de.FD)(ee.A,{sx:{mt:2},children:[(0,de.Y)(Yt.A,{sx:{mb:2,boxShadow:2},children:(0,de.FD)(Dt.A,{children:[(0,de.Y)(se.A,{variant:"h6",gutterBottom:!0,children:"Global Spatial Association"}),(0,de.FD)(ze.Ay,{container:!0,spacing:2,children:[(0,de.Y)(ze.Ay,{item:!0,xs:12,md:4,children:(0,de.Y)(mt.A,{title:"Overall spatial autocorrelation measure",children:(0,de.FD)(ee.A,{children:[(0,de.Y)(se.A,{variant:"subtitle2",color:"textSecondary",children:"Global Moran's I"}),(0,de.Y)(se.A,{variant:"h5",children:m(null==t?void 0:t.moran_i)}),(0,de.FD)(se.A,{variant:"caption",color:"textSecondary",children:["p-value: ",m(null==t?void 0:t.p_value)]})]})})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,md:4,children:(0,de.Y)(mt.A,{title:"Strength of spatial patterns",children:(0,de.FD)(ee.A,{children:[(0,de.Y)(se.A,{variant:"subtitle2",color:"textSecondary",children:"Spatial Association"}),(0,de.Y)(se.A,{variant:"h5",children:m(null==h?void 0:h.spatialAssociation)}),(0,de.FD)(se.A,{variant:"caption",color:"textSecondary",children:[(f=null==h?void 0:h.significanceRate,null==f?"N/A":`${(100*f).toFixed(1)}%`)," significant"]})]})})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,md:4,children:(0,de.Y)(mt.A,{title:"Statistical robustness",children:(0,de.FD)(ee.A,{children:[(0,de.Y)(se.A,{variant:"subtitle2",color:"textSecondary",children:"Z-Score"}),(0,de.Y)(se.A,{variant:"h5",children:m(null==t?void 0:t.z_score)}),(0,de.Y)(se.A,{variant:"caption",color:"textSecondary",children:null!=t&&t.significance?"Significant":"Not Significant"})]})})})]})]})}),(0,de.Y)(Yt.A,{sx:{mb:2,boxShadow:2},children:(0,de.FD)(Dt.A,{children:[(0,de.Y)(se.A,{variant:"h6",gutterBottom:!0,children:"Cluster Analysis"}),(0,de.FD)(ze.Ay,{container:!0,spacing:2,children:[(0,de.Y)(ze.Ay,{item:!0,xs:12,md:4,children:(0,de.FD)(ee.A,{children:[(0,de.Y)(se.A,{variant:"subtitle2",color:"textSecondary",children:"Hot Spots"}),(0,de.Y)(se.A,{variant:"h6",children:(null==h?void 0:h.clusterDistribution.hotspots)||0}),(0,de.Y)(se.A,{variant:"caption",color:"textSecondary",children:"High-High Clusters"})]})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,md:4,children:(0,de.FD)(ee.A,{children:[(0,de.Y)(se.A,{variant:"subtitle2",color:"textSecondary",children:"Cold Spots"}),(0,de.Y)(se.A,{variant:"h6",children:(null==h?void 0:h.clusterDistribution.coldspots)||0}),(0,de.Y)(se.A,{variant:"caption",color:"textSecondary",children:"Low-Low Clusters"})]})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,md:4,children:(0,de.FD)(ee.A,{children:[(0,de.Y)(se.A,{variant:"subtitle2",color:"textSecondary",children:"Spatial Outliers"}),(0,de.Y)(se.A,{variant:"h6",children:(null==h?void 0:h.clusterDistribution.outliers)||0}),(0,de.Y)(se.A,{variant:"caption",color:"textSecondary",children:"High-Low/Low-High"})]})})]})]})}),p&&(0,de.Y)(Yt.A,{sx:{mb:2,boxShadow:2},children:(0,de.FD)(Dt.A,{children:[(0,de.FD)(se.A,{variant:"h6",gutterBottom:!0,children:[a," Analysis"]}),(0,de.FD)(ze.Ay,{container:!0,spacing:2,children:[(0,de.Y)(ze.Ay,{item:!0,xs:12,md:6,children:(0,de.FD)(gt.A,{dense:!0,children:[(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:"Local Moran's I",secondary:(0,de.FD)(ee.A,{children:[(0,de.Y)(se.A,{variant:"body2",children:m(p.local_i)}),p.confidenceInterval&&(0,de.FD)(se.A,{variant:"caption",color:"textSecondary",children:["95% CI: [",m(p.confidenceInterval.lower)," to ",m(p.confidenceInterval.upper),"]"]})]})})}),(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:"Significance",secondary:(0,de.Y)(ee.A,{sx:{mt:.5},children:(g=p.significanceLevel,y=p.p_value,(0,de.Y)(ee.A,{sx:{mt:.5},children:(0,de.Y)(yr.A,{label:g,size:"small",color:y<=rr.HIGHLY_SIGNIFICANT?"success":y<=rr.SIGNIFICANT?"primary":y<=rr.MARGINALLY_SIGNIFICANT?"warning":"default"})}))})})})]})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,md:6,children:(0,de.FD)(gt.A,{dense:!0,children:[(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:"Cluster Type",secondary:(0,de.FD)(ee.A,{sx:{display:"flex",alignItems:"center",gap:1,mt:.5},children:[(0,de.Y)(ee.A,{sx:{width:12,height:12,borderRadius:"50%",bgcolor:ar[p.cluster_type],opacity:.8,border:"1px solid rgba(0,0,0,0.1)"}}),(0,de.Y)(se.A,{variant:"body2",children:p.cluster_type.split("-").map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join("-")})]})})}),(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:"Cluster Strength",secondary:(0,de.Y)(ee.A,{sx:{mt:.5},children:(0,de.Y)(se.A,{variant:"body2",children:m(p.clusterStrength)})})})})]})})]})]})}),(0,de.FD)(ee.A,{sx:{mt:2},children:[(0,de.Y)(Se.A,{fullWidth:!0,onClick:()=>u(!d),endIcon:d?(0,de.Y)(bt.A,{}):(0,de.Y)(vt.A,{}),startIcon:(0,de.Y)(ft.A,{}),sx:{mb:1},children:"Methodology"}),(0,de.Y)(pt.A,{in:d,children:(0,de.FD)($e.A,{sx:{p:2,boxShadow:2},children:[(0,de.Y)(se.A,{variant:"subtitle1",gutterBottom:!0,children:"Spatial Autocorrelation Analysis Methodology"}),(0,de.Y)(se.A,{variant:"body2",paragraph:!0,children:"This analysis uses Local Indicators of Spatial Association (LISA) to identify statistically significant spatial clusters and outliers. The analysis combines:"}),(0,de.FD)(gt.A,{dense:!0,children:[(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:"Global Moran's I",secondary:(0,de.Y)(se.A,{variant:"body2",color:"textSecondary",children:"Measures overall spatial autocorrelation"})})}),(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:"Local Moran's I",secondary:(0,de.Y)(se.A,{variant:"body2",color:"textSecondary",children:"Identifies local spatial patterns and clusters"})})}),(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:"Statistical Significance",secondary:(0,de.Y)(se.A,{variant:"body2",color:"textSecondary",children:"Uses Monte Carlo simulation for hypothesis testing"})})}),(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:"Cluster Classification",secondary:(0,de.Y)(se.A,{variant:"body2",color:"textSecondary",children:"Categorizes regions into hot spots, cold spots, and outliers"})})})]}),(0,de.Y)(se.A,{variant:"body2",sx:{mt:1},children:"Significance levels: Highly Significant (p ≤ 0.01), Significant (p ≤ 0.05), Marginally Significant (p ≤ 0.1)"})]})})]})]});var g,y,f},vr=i.memo(fr);var br=r(33198),Ar=r(64137),wr=r(96627),_r=r(86798),xr=r(14774),kr=r(86477),Sr=r(43884);const Mr=e=>{let{clusters:t,local:r,selectedRegion:a,onRegionSelect:n}=e;const o=(0,ge.A)(),s=(0,Q.A)(o.breakpoints.down("md")),[l,c]=(0,i.useState)("local_i"),[d,u]=(0,i.useState)("desc"),[m,h]=(0,i.useState)(!1),p=(0,i.useMemo)((()=>{if(!r)return{rows:[],summary:{}};const e=Object.entries(r).map((e=>{let[t,r]=e;const i=Math.abs(r.local_i)*(r.p_value<=rr.SIGNIFICANT?1:.5),a=r.p_value<=rr.HIGHLY_SIGNIFICANT?"Highly Significant":r.p_value<=rr.SIGNIFICANT?"Significant":r.p_value<=rr.MARGINALLY_SIGNIFICANT?"Marginally Significant":"Not Significant",n=r.variance?{lower:r.local_i-1.96*Math.sqrt(r.variance),upper:r.local_i+1.96*Math.sqrt(r.variance)}:null;return{region:t,...r,clusterStrength:i,significanceLevel:a,confidenceInterval:n}})),t={totalRegions:e.length,significantClusters:e.filter((e=>e.p_value<=rr.SIGNIFICANT)).length,averageStrength:e.reduce(((e,t)=>e+t.clusterStrength),0)/e.length,clusterCounts:Object.fromEntries(Object.values(ir).map((t=>[t,e.filter((e=>e.cluster_type===t)).length]))),significanceLevels:{highlySignificant:e.filter((e=>e.p_value<=rr.HIGHLY_SIGNIFICANT)).length,significant:e.filter((e=>e.p_value>rr.HIGHLY_SIGNIFICANT&&e.p_value<=rr.SIGNIFICANT)).length,marginal:e.filter((e=>e.p_value>rr.SIGNIFICANT&&e.p_value<=rr.MARGINALLY_SIGNIFICANT)).length}};return{rows:e,summary:t}}),[r]),g=e=>{u(l===e&&"asc"===d?"desc":"asc"),c(e)},y=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;return null==e?"N/A":"number"==typeof e?e.toFixed(t):e.toString()};if(!t||!r)return(0,de.Y)(ee.A,{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",children:(0,de.Y)(se.A,{color:"textSecondary",children:"No cluster data available"})});const f=[...p.rows].sort(((e,t)=>{const r="asc"===d?1:-1;return"region"===l?r*e.region.localeCompare(t.region):r*((e[l]||0)-(t[l]||0))}));return(0,de.FD)(ee.A,{sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",p:2,gap:2,position:"relative"},children:[(0,de.Y)($e.A,{elevation:1,sx:{position:"absolute",top:10,left:"50%",transform:"translateX(-50%)",zIndex:1,p:1,bgcolor:"background.paper",borderRadius:1,maxWidth:"90%",textAlign:"center"},children:(0,de.Y)(se.A,{variant:"body2",color:"textSecondary",children:"Click on any row to view detailed market cluster analysis"})}),(0,de.Y)(Yt.A,{sx:{mb:2,mt:4,boxShadow:2},children:(0,de.FD)(Dt.A,{children:[(0,de.Y)(se.A,{variant:"h6",align:"center",gutterBottom:!0,children:"Market Cluster Analysis"}),(0,de.FD)(ee.A,{sx:{display:"flex",flexWrap:"wrap",gap:2,justifyContent:"center",mb:2},children:[(0,de.Y)(mt.A,{title:"Regions with significant spatial association",children:(0,de.Y)(yr.A,{label:`${p.summary.significantClusters} Significant Clusters`,color:"primary",variant:"outlined"})}),(0,de.Y)(mt.A,{title:"Average cluster strength across all regions",children:(0,de.Y)(yr.A,{label:`Avg Strength: ${y(p.summary.averageStrength)}`,color:"secondary",variant:"outlined"})}),(0,de.Y)(mt.A,{title:"Highly significant spatial patterns",children:(0,de.Y)(yr.A,{label:`${p.summary.significanceLevels.highlySignificant} Highly Significant`,color:"success",variant:"outlined"})})]})]})}),(0,de.Y)(br.A,{component:$e.A,sx:{flexGrow:1,maxHeight:"100%",bgcolor:"background.default",boxShadow:2,"& .MuiTableRow-hover:hover":{backgroundColor:o.palette.action.hover,transition:"background-color 0.2s ease"},"& .Mui-selected":{backgroundColor:`${o.palette.primary.main}15 !important`}},children:(0,de.FD)(Ar.A,{stickyHeader:!0,size:s?"small":"medium",children:[(0,de.Y)(wr.A,{children:(0,de.FD)(_r.A,{children:[(0,de.Y)(xr.A,{children:(0,de.Y)(kr.A,{active:"region"===l,direction:"region"===l?d:"asc",onClick:()=>g("region"),children:(0,de.Y)(mt.A,{title:"Market region name",children:(0,de.Y)("span",{children:"Region"})})})}),(0,de.Y)(xr.A,{align:"right",children:(0,de.Y)(kr.A,{active:"local_i"===l,direction:"local_i"===l?d:"asc",onClick:()=>g("local_i"),children:(0,de.Y)(mt.A,{title:"Local spatial autocorrelation measure",children:(0,de.Y)("span",{children:"Local Moran's I"})})})}),(0,de.Y)(xr.A,{align:"right",children:(0,de.Y)(kr.A,{active:"p_value"===l,direction:"p_value"===l?d:"asc",onClick:()=>g("p_value"),children:(0,de.Y)(mt.A,{title:"Statistical significance level",children:(0,de.Y)("span",{children:"Significance"})})})}),(0,de.Y)(xr.A,{align:"right",children:(0,de.Y)(kr.A,{active:"clusterStrength"===l,direction:"clusterStrength"===l?d:"asc",onClick:()=>g("clusterStrength"),children:(0,de.Y)(mt.A,{title:"Normalized cluster strength indicator",children:(0,de.Y)("span",{children:"Strength"})})})}),(0,de.Y)(xr.A,{children:(0,de.Y)(mt.A,{title:"Type of spatial pattern",children:(0,de.Y)("span",{children:"Pattern"})})})]})}),(0,de.Y)(Sr.A,{children:f.map((e=>(0,de.FD)(_r.A,{hover:!0,selected:e.region===a,onClick:()=>n(e.region),sx:{cursor:"pointer","&:hover":{bgcolor:`${o.palette.action.hover} !important`}},children:[(0,de.Y)(xr.A,{component:"th",scope:"row",children:(0,de.Y)(se.A,{variant:s?"body2":"body1",children:e.region})}),(0,de.Y)(xr.A,{align:"right",children:(0,de.Y)(mt.A,{title:e.confidenceInterval?`95% CI: [${y(e.confidenceInterval.lower)}, ${y(e.confidenceInterval.upper)}]`:"Confidence interval not available",children:(0,de.Y)("span",{children:y(e.local_i)})})}),(0,de.Y)(xr.A,{align:"right",children:(0,de.Y)(mt.A,{title:`p-value: ${y(e.p_value)}`,children:(0,de.Y)(ee.A,{children:(0,de.Y)(yr.A,{label:e.significanceLevel,size:"small",color:e.p_value<=rr.HIGHLY_SIGNIFICANT?"success":e.p_value<=rr.SIGNIFICANT?"primary":e.p_value<=rr.MARGINALLY_SIGNIFICANT?"warning":"default",sx:{fontSize:s?"0.7rem":"0.8rem"}})})})}),(0,de.Y)(xr.A,{align:"right",children:(0,de.Y)(mt.A,{title:`Z-score: ${y(e.z_score)}`,children:(0,de.Y)("span",{children:y(e.clusterStrength)})})}),(0,de.Y)(xr.A,{children:(0,de.FD)(ee.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,de.Y)(ee.A,{sx:{width:12,height:12,borderRadius:"50%",bgcolor:ar[e.cluster_type],opacity:e.p_value<=rr.SIGNIFICANT?.8:.4,border:"1px solid rgba(0,0,0,0.1)"}}),(0,de.Y)(se.A,{variant:s?"body2":"body1",children:e.cluster_type.split("-").map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join("-")})]})})]},e.region)))})]})}),(0,de.FD)(Yt.A,{sx:{p:2,bgcolor:"background.default",boxShadow:2},children:[(0,de.Y)(se.A,{variant:"subtitle2",gutterBottom:!0,align:"center",children:"Cluster Distribution"}),(0,de.Y)(ee.A,{sx:{display:"flex",flexWrap:"wrap",gap:2,justifyContent:"center"},children:Object.entries(p.summary.clusterCounts).map((e=>{let[t,r]=e;return(0,de.Y)(mt.A,{title:`${r} regions (${(r/p.summary.totalRegions*100).toFixed(1)}%)`,children:(0,de.FD)(ee.A,{sx:{display:"flex",alignItems:"center",gap:1,p:1,borderRadius:1,bgcolor:"background.paper",border:`1px solid ${o.palette.divider}`},children:[(0,de.Y)(ee.A,{sx:{width:12,height:12,borderRadius:"50%",bgcolor:ar[t],opacity:.8,border:"1px solid rgba(0,0,0,0.1)"}}),(0,de.Y)(se.A,{variant:"body2",children:`${t.split("-").map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join("-")}: ${r}`})]})},t)}))})]}),(0,de.FD)(ee.A,{sx:{mt:2},children:[(0,de.Y)(Se.A,{fullWidth:!0,onClick:()=>h(!m),endIcon:m?(0,de.Y)(bt.A,{}):(0,de.Y)(vt.A,{}),startIcon:(0,de.Y)(ft.A,{}),sx:{mb:1},children:"Market Cluster Analysis Methodology"}),(0,de.Y)(pt.A,{in:m,children:(0,de.FD)($e.A,{sx:{p:2,boxShadow:2},children:[(0,de.Y)(se.A,{variant:"subtitle1",gutterBottom:!0,children:"Understanding Market Cluster Analysis"}),(0,de.Y)(se.A,{variant:"body2",paragraph:!0,children:"Market clusters are identified using Local Indicators of Spatial Association (LISA) to detect statistically significant spatial patterns in market behavior:"}),(0,de.FD)(gt.A,{dense:!0,children:[(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:"High-High Clusters (Hot Spots)",secondary:(0,de.Y)(se.A,{variant:"body2",color:"textSecondary",children:"Markets with high values surrounded by other high-value markets, indicating concentrated market activity"})})}),(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:"Low-Low Clusters (Cold Spots)",secondary:(0,de.Y)(se.A,{variant:"body2",color:"textSecondary",children:"Markets with low values surrounded by other low-value markets, suggesting potential market barriers"})})}),(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:"High-Low & Low-High (Outliers)",secondary:(0,de.Y)(se.A,{variant:"body2",color:"textSecondary",children:"Markets that differ significantly from their neighbors, indicating potential market anomalies"})})}),(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:"Cluster Strength",secondary:(0,de.Y)(se.A,{variant:"body2",color:"textSecondary",children:"Measures the intensity of spatial association, weighted by statistical significance"})})})]}),(0,de.Y)(se.A,{variant:"body2",sx:{mt:1},children:"Statistical significance is determined using Monte Carlo simulation with three levels: Highly Significant (p ≤ 0.01), Significant (p ≤ 0.05), and Marginally Significant (p ≤ 0.1)"})]})})]})]})},Cr=i.memo(Mr);var Yr=r(97857),Dr=r(54937),Ir=r(40250),Rr=r(16317);class Fr extends i.Component{constructor(e){super(e),(0,Yr.A)(this,"handleRefresh",(()=>{this.setState({hasError:!1,error:null,errorInfo:null,errorType:null}),window.location.reload()})),(0,Yr.A)(this,"handleExpand",(()=>{this.setState((e=>({expanded:!e.expanded})))})),(0,Yr.A)(this,"getErrorMessage",(()=>{const{errorType:e,error:t}=this.state;switch(e){case"geometry":return"Invalid or missing geometry data. Please ensure the geometry data is properly formatted and available.";case"features":return"Error processing map features. The geometry features may be malformed or missing required properties.";case"mapping":return"Error rendering the map. This might be due to invalid coordinates or feature properties.";default:return(null==t?void 0:t.message)||"An unexpected error occurred in the spatial analysis."}})),(0,Yr.A)(this,"getErrorSeverity",(()=>{const{errorType:e}=this.state;switch(e){case"geometry":case"features":default:return"error";case"mapping":return"warning"}})),this.state={hasError:!1,error:null,errorInfo:null,expanded:!1,errorType:null}}static getDerivedStateFromError(e){var t,r,i;let a="unknown";return null!==(t=e.message)&&void 0!==t&&t.includes("geometry")?a="geometry":null!==(r=e.message)&&void 0!==r&&r.includes("features")?a="features":null!==(i=e.message)&&void 0!==i&&i.includes("map")&&(a="mapping"),{hasError:!0,error:e,errorType:a}}componentDidCatch(e,t){this.setState({error:e,errorInfo:t})}render(){const{hasError:e,error:t,errorInfo:r,expanded:i,errorType:a}=this.state,{fallback:n}=this.props;return e?n||(0,de.FD)($e.A,{elevation:3,sx:{p:3,m:2,maxWidth:"100%",overflow:"hidden"},children:[(0,de.FD)(ee.A,{display:"flex",alignItems:"center",mb:2,children:[(0,de.Y)(Rr.A,{color:"error",sx:{mr:2}}),(0,de.Y)(se.A,{variant:"h6",color:"error",children:"Spatial Analysis Error"})]}),(0,de.FD)(Ke.A,{severity:this.getErrorSeverity(),sx:{mb:2},children:[(0,de.Y)(Dr.A,{children:a?`${a.charAt(0).toUpperCase()}${a.slice(1)} Error`:"Error"}),this.getErrorMessage()]}),(0,de.FD)(ee.A,{display:"flex",gap:2,mb:2,children:[(0,de.Y)(Se.A,{variant:"contained",color:"primary",startIcon:(0,de.Y)(Ir.A,{}),onClick:this.handleRefresh,children:"Retry Analysis"}),(0,de.Y)(Se.A,{variant:"outlined",endIcon:i?(0,de.Y)(bt.A,{}):(0,de.Y)(vt.A,{}),onClick:this.handleExpand,children:i?"Hide Details":"Show Details"})]}),(0,de.FD)(pt.A,{in:i,children:[(0,de.FD)($e.A,{variant:"outlined",sx:{p:2,mb:2,bgcolor:"grey.50"},children:[(0,de.Y)(se.A,{variant:"subtitle2",gutterBottom:!0,children:"Technical Details"}),(0,de.FD)(se.A,{variant:"body2",component:"pre",sx:{whiteSpace:"pre-wrap",wordBreak:"break-word",fontFamily:"monospace",fontSize:"0.8rem"},children:["Error Type: ",a,"\n\n",(null==r?void 0:r.componentStack)||(null==t?void 0:t.stack)||"No stack trace available"]})]}),(0,de.FD)(Ke.A,{severity:"info",sx:{mt:2},children:[(0,de.Y)(Dr.A,{children:"Troubleshooting Tips"}),"geometry"===a&&(0,de.FD)(se.A,{variant:"body2",children:["• Verify that the geometry data is properly loaded","\n","• Check if the geometry features contain valid coordinates","\n","• Ensure the geometry follows the GeoJSON specification"]}),"features"===a&&(0,de.FD)(se.A,{variant:"body2",children:["• Check if all features have required properties","\n","• Verify the feature array is properly structured","\n","• Ensure feature IDs or names are correctly set"]}),"mapping"===a&&(0,de.FD)(se.A,{variant:"body2",children:["• Verify coordinate values are within valid ranges","\n","• Check if all required map properties are present","\n","• Ensure the map container has proper dimensions"]})]}),!1]})]}):this.props.children}}const Nr=Fr,zr=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{transformData:r=!1,cacheKey:a=null}=t;return function(t){const n=(0,i.useMemo)((()=>{if(!r)return t;try{if("lisa-map"===a){const{geometry:e,localStats:r,...i}=t;if(!e||!e.features||!Array.isArray(e.features))return{...i,geometry:null,localStats:r};const a={...e,features:e.features.map((e=>(e.properties||(e.properties={}),{...e,properties:{...e.properties,name:e.properties.name||e.properties.region_id||""}})))};return{...i,geometry:a,localStats:r}}return{...t,transformed:!0,timestamp:Date.now()}}catch(e){if("lisa-map"===a){const{geometry:e,...r}=t;return{...r,geometry:null}}return t}}),[t,r,a]);return(0,de.Y)(e,{...n})}};var Er=r(14375),Tr=r(91907);const Pr=e=>{const t={};e.forEach((e=>{t[e.source]||(t[e.source]={}),t[e.target]||(t[e.target]={})}));const r=Math.max(...e.map((e=>e.avg_flow)));return e.forEach((e=>{const i=e.avg_flow/r;t[e.source][e.target]=i,t[e.target][e.source]=i})),Object.keys(t).forEach((e=>{const r=Object.values(t[e]).reduce(((e,t)=>e+t),0);r>0&&Object.keys(t[e]).forEach((i=>{t[e][i]=t[e][i]/r}))})),t},Or=(e,t)=>{if(null==e||!e.length||null==t||!t.length)return{moran_i:0,p_value:1,z_score:0,significance:!1};try{const r=Pr(t),i=e.map((e=>e.usdPrice)),a=(0,Er.A)(i),n=i.map((e=>e-a));let o=0,s=(0,Tr.A)(n.map((e=>e*e))),l=0;e.forEach(((t,i)=>{const a=t.region;e.forEach(((e,t)=>{if(i!==t){var s;const c=(null===(s=r[a])||void 0===s?void 0:s[e.region])||0;o+=c*n[i]*n[t],l+=c}}))})),Math.abs(s)<1e-10&&(s=1e-10);const c=e.length,d=c/l*(o/s),u=-1/(c-1),m=jr(c,l,r,n),h=(d-u)/Math.sqrt(m),p=Wr(h);return{moran_i:d,p_value:p,z_score:h,significance:p<=.05}}catch(e){return{moran_i:0,p_value:1,z_score:0,significance:!1}}},$r=(e,t)=>{if(null==e||!e.length||null==t||!t.length)return{};try{const r=Pr(t),i=e.map((e=>e.usdPrice)),a=(0,Er.A)(i),n=Lr(i),o=i.map((e=>e-a)),s=Math.max(n*n,1e-10),l={};return e.forEach(((t,i)=>{const a=t.region;let c=0,d=0;e.forEach(((e,t)=>{if(i!==t){var n;const i=(null===(n=r[a])||void 0===n?void 0:n[e.region])||0;c+=i*o[t],d+=i}}));const u=o[i]/s*c,m=qr(r[a],o,s,d),h=u/Math.sqrt(m),p=Wr(h),g=Br(o[i]/n,u,p);l[a]={local_i:u,z_score:h,p_value:p,cluster_type:g,variance:m,spatial_lag:c/Math.max(Math.abs(o[i]),1e-10)}})),l}catch(e){return{}}},Lr=e=>{if(null==e||!e.length)return 0;const t=(0,Er.A)(e),r=e.map((e=>Math.pow(e-t,2)));return Math.sqrt(Math.max((0,Er.A)(r),1e-10))},jr=(e,t,r,i)=>{const a=Vr(r),n=Hr(r),o=Math.max((0,Tr.A)(i.map((e=>e*e)))/e,1e-10),s=e*((e*e-3*e+3)*a-e*n+3*t*t),l=Math.max((0,Tr.A)(i.map((e=>e*e*e*e)))/e,1e-10)/(o*o)*((e*e-e)*a-2*e*n+6*t*t),c=-1*(e-1)*(e-2)*(e-3)*t*t;return Math.max((s-l+c)/((e-1)*(e-2)*(e-3)*t*t),1e-10)},qr=(e,t,r,i)=>{if(!e||null==t||!t.length)return 1e-10;const a=Object.values(e).reduce(((e,t)=>e+t*t),0);return Math.max(a*(t.length-1)/((t.length-2)*r),1e-10)},Wr=e=>{if(!isFinite(e))return 1;const t=Math.abs(e);return 2*(1-Gr(t))},Vr=e=>{let t=0;return Object.entries(e).forEach((r=>{let[i,a]=r;Object.entries(a).forEach((r=>{var a;let[n,o]=r;const s=o+((null===(a=e[n])||void 0===a?void 0:a[i])||0);t+=s*s}))})),t/2},Hr=e=>{let t=0;return Object.entries(e).forEach((r=>{let[i,a]=r;const n=Object.values(a).reduce(((e,t)=>e+t),0),o=Object.entries(e).reduce(((e,t)=>{let[r,a]=t;return e+(a[i]||0)}),0);t+=(n+o)*(n+o)})),t},Br=(e,t,r)=>{if(r>.05)return"not_significant";return e>0&&t>0?"high-high":e<-0&&t<-0?"low-low":e>0&&t<-0?"high-low":e<-0&&t>0?"low-high":"not_significant"},Gr=e=>{if(e<-8)return 0;if(e>8)return 1;const t=1/(1+.2316419*Math.abs(e));let r=((((1.330274429*t-1.821255978)*t+1.781477937)*t-.356563782)*t+.31938153)*t;return r=1-.3989423*Math.exp(-.5*e*e)*r,e<0?1-r:r},Ur=()=>{const e=(0,n.d4)(De.gz),t=(0,n.d4)(De.Lr),r=(0,n.d4)(De.T9),a=(0,n.d4)(De.Fp),o=(0,n.d4)(De.Hw),s=(0,n.d4)(De.w_),l=(0,i.useMemo)((()=>{if(!r)return null;try{var e;return"FeatureCollection"===(null===(e=r.unified)||void 0===e?void 0:e.type)?r.unified:Array.isArray(r.polygons)?{type:"FeatureCollection",features:r.polygons.map((e=>{var t,r,i,a;return{type:"Feature",geometry:e.geometry,properties:{name:(null===(t=e.properties)||void 0===t?void 0:t.name)||(null===(r=e.properties)||void 0===r?void 0:r.region_id),region_id:(null===(i=e.properties)||void 0===i?void 0:i.region_id)||(null===(a=e.properties)||void 0===a?void 0:a.name),...e.properties}}}))}:null}catch(e){return null}}),[r]),c=(0,i.useMemo)((()=>{if(null==t||!t.length||null==s||!s.length)return{moran_i:0,p_value:1,z_score:0,significance:!1};try{const e=new Map;t.forEach((t=>{const r=new Date(t.month);(!e.has(t.region)||r>new Date(e.get(t.region).month))&&e.set(t.region,t)}));const r=Array.from(e.values());return Or(r,s)}catch(e){return{moran_i:0,p_value:1,z_score:0,significance:!1}}}),[t,s]),d=(0,i.useMemo)((()=>{if(null==t||!t.length||null==s||!s.length)return{};try{const e=new Map;t.forEach((t=>{const r=new Date(t.month);(!e.has(t.region)||r>new Date(e.get(t.region).month))&&e.set(t.region,t)}));const r=Array.from(e.values());return $r(r,s)}catch(e){return{}}}),[t,s]),u=(0,i.useMemo)((()=>{const e={[ir.HIGH_HIGH]:[],[ir.LOW_LOW]:[],[ir.HIGH_LOW]:[],[ir.LOW_HIGH]:[],[ir.NOT_SIGNIFICANT]:[]};if(!d||0===Object.keys(d).length)return e;try{return Object.entries(d).reduce(((e,t)=>{let[r,i]=t;if(!i)return e;return e[i.cluster_type||ir.NOT_SIGNIFICANT].push({region:r,...i,standardizedValue:i.z_score,significanceLevel:i.p_value<=.01?"Highly Significant":i.p_value<=.05?"Significant":"Not Significant"}),e}),{...e})}catch(t){return e}}),[d]),m=(0,i.useMemo)((()=>{if(!u||Object.values(u).every((e=>0===e.length)))return or;try{const e={[ir.HIGH_HIGH]:u[ir.HIGH_HIGH].length,[ir.LOW_LOW]:u[ir.LOW_LOW].length,[ir.HIGH_LOW]:u[ir.HIGH_LOW].length,[ir.LOW_HIGH]:u[ir.LOW_HIGH].length,[ir.NOT_SIGNIFICANT]:u[ir.NOT_SIGNIFICANT].length},t=Object.values(e).reduce(((e,t)=>e+t),0),r=t-e[ir.NOT_SIGNIFICANT];return{totals:e,significantCount:r,totalRegions:t,significanceRate:t>0?r/t*100:0,hotspotRate:t>0?e[ir.HIGH_HIGH]/t*100:0,coldspotRate:t>0?e[ir.LOW_LOW]/t*100:0,outlierRate:t>0?(e[ir.HIGH_LOW]+e[ir.LOW_HIGH])/t*100:0,clusterStrength:p(u)}}catch(e){return or}}),[u]),h=(0,i.useMemo)((()=>{if(!a||!c)return nr;try{var e;const t=Object.values(d),r=t.length>0?Math.max(...t.map((e=>Math.abs(e.local_i||0)))):0,i=g(c,t);return{globalMoranI:c.moran_i,pValue:c.p_value,zScore:c.z_score,avgLocalI:null!==(e=a.globalIndex)&&void 0!==e?e:0,maxLocalI:r,spatialAssociation:i,significanceLevels:y(t)}}catch(e){return nr}}),[a,c,d]),p=e=>{const t=[...e[ir.HIGH_HIGH],...e[ir.LOW_LOW]];return 0===t.length?0:t.reduce(((e,t)=>e+Math.abs(t.local_i||0)),0)/t.length},g=(e,t)=>{if(!e||!t.length)return 0;const r=t.filter((e=>e.p_value<=.05)),i=r.length>0?r.reduce(((e,t)=>e+Math.abs(t.local_i||0)),0)/r.length:0;return Math.abs(e.moran_i)*(e.significance?1:.5)*(1+i)/2},y=e=>e.reduce(((e,t)=>({highlySignificant:e.highlySignificant+(t.p_value<=.01?1:0),significant:e.significant+(t.p_value<=.05&&t.p_value>.01?1:0),marginal:e.marginal+(t.p_value<=.1&&t.p_value>.05?1:0),notSignificant:e.notSignificant+(t.p_value>.1?1:0)})),{highlySignificant:0,significant:0,marginal:0,notSignificant:0}),f=o.loading||!e&&!o.error||!t&&!o.error||!r&&!o.error||!s&&!o.error,v=null!==o.error;return{global:c,local:d,clusters:u,geometry:l,clusterAnalysis:m,spatialMetrics:h,getRegionMetrics:e=>{if(!d||!d[e])return null;try{const t=d[e],r=t.p_value<=rr.SIGNIFICANT;return{...t,isSignificant:r,significanceLevel:t.p_value<=rr.HIGHLY_SIGNIFICANT?"Highly Significant":t.p_value<=rr.SIGNIFICANT?"Significant":t.p_value<=rr.MARGINALLY_SIGNIFICANT?"Marginally Significant":"Not Significant",standardizedValue:t.z_score,clusterStrength:Math.abs(t.local_i)*(r?1:.5)}}catch(e){return null}},isLoading:f,hasError:v}},Zr=zr(ur,{transformData:!0,cacheKey:"lisa-map"}),Xr=zr(gr,{transformData:!0,cacheKey:"moran-scatter"}),Jr=zr(Cr,{transformData:!0,cacheKey:"cluster-matrix"}),Kr=()=>(0,de.FD)(ee.A,{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100%",minHeight:400,gap:2,children:[(0,de.Y)(Ue.A,{}),(0,de.Y)(se.A,{variant:"h6",color:"textSecondary",children:"Loading spatial analysis data..."})]}),Qr=()=>(0,de.Y)(ee.A,{p:3,children:(0,de.Y)(Ke.A,{severity:"error",children:(0,de.Y)(se.A,{variant:"body1",children:"Unable to load spatial analysis visualization. Please check your data and try again."})})}),ei=()=>{const e=(0,ge.A)(),[t,r]=(0,i.useState)("map"),[a,n]=(0,i.useState)(null),{global:o,local:s,clusters:l,geometry:c,clusterAnalysis:d,spatialMetrics:u,getRegionMetrics:m,isLoading:h,hasError:p}=Ur();if(h)return(0,de.Y)(Kr,{});if(p)return(0,de.Y)(Qr,{});const g=a?m(a):null,y=e=>null==e?"N/A":"number"==typeof e?e.toFixed(3):e.toString();return(0,de.Y)(Nr,{fallback:(0,de.Y)(Qr,{}),children:(0,de.FD)(ze.Ay,{container:!0,spacing:2,children:[(0,de.Y)(ze.Ay,{item:!0,xs:12,children:(0,de.Y)(ee.A,{display:"flex",justifyContent:"center",children:(0,de.Y)($e.A,{sx:{p:2,display:"inline-flex"},children:(0,de.FD)(Le.A,{value:t,exclusive:!0,onChange:(e,t)=>t&&r(t),size:"small",children:[(0,de.FD)(je.A,{value:"map",children:[(0,de.Y)(nt.A,{sx:{mr:1}}),"LISA MAP"]}),(0,de.FD)(je.A,{value:"scatter",children:[(0,de.Y)(er.A,{sx:{mr:1}}),"MORAN SCATTER"]}),(0,de.FD)(je.A,{value:"table",children:[(0,de.Y)(tr.A,{sx:{mr:1}}),"CLUSTER MATRIX"]})]})})})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,children:(0,de.Y)($e.A,{sx:{height:600},children:(0,de.FD)(i.Suspense,{fallback:(0,de.Y)(Kr,{}),children:["map"===t&&(0,de.Y)(Zr,{localStats:s,geometry:c,selectedRegion:a,onRegionSelect:n}),"scatter"===t&&(0,de.Y)(Xr,{data:s,globalMoranI:(null==o?void 0:o.moran_i)||0,selectedRegion:a,onPointSelect:n}),"table"===t&&(0,de.Y)(Jr,{clusters:l,local:s,selectedRegion:a,onRegionSelect:n})]})})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,children:(0,de.Y)($e.A,{sx:{p:3,bgcolor:e.palette.background.default,borderRadius:2,boxShadow:e.shadows[2]},children:(0,de.FD)(ke.A,{spacing:3,children:[(0,de.Y)(ee.A,{children:(0,de.Y)(se.A,{variant:"h6",gutterBottom:!0,color:"primary",children:"Spatial Pattern Analysis"})}),g&&(0,de.FD)(ee.A,{children:[(0,de.Y)(se.A,{variant:"h6",gutterBottom:!0,color:"primary",children:"Selected Region Analysis"}),(0,de.Y)(se.A,{variant:"body1",children:`${a} shows ${(null===(f=g.cluster_type)||void 0===f?void 0:f.replace("-"," "))||"no"} \n                  pattern with local Moran's I of ${y(g.local_i)} \n                  (${g.significanceLevel||"Not Significant"}, p-value: ${y(g.p_value)})`})]}),(0,de.Y)(vr,{global:o,local:s,selectedRegion:a,clusters:l,spatialMetrics:u})]})})})]})});var f},ti=i.memo(ei);zr(ur,{transformData:!0,cacheKey:"lisa-map"}),zr(gr,{transformData:!0,cacheKey:"moran-scatter"}),zr(Cr,{transformData:!0,cacheKey:"cluster-matrix"}),zr(ti);var ri=r(31111),ii=r(34199),ai=r(13489),ni=r(22768),oi=r(25075),si=r(44038),li=r(86634);const ci=e=>{let{title:t,items:r=[],position:i={bottom:32,right:10}}=e;(0,ge.A)();return(0,de.FD)($e.A,{elevation:2,sx:{position:"absolute",...i,zIndex:1e3,backgroundColor:"background.paper",borderRadius:1,p:1.5,minWidth:180,maxWidth:280},children:[t&&(0,de.Y)(se.A,{variant:"subtitle2",sx:{mb:1,fontWeight:500,color:"text.primary"},children:t}),(0,de.Y)(ee.A,{sx:{display:"flex",flexDirection:"column",gap:1},children:r.map(((e,t)=>{var r;return(0,de.FD)(ee.A,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[(0,de.Y)(ee.A,{sx:{width:16,height:16,backgroundColor:e.color,flexShrink:0,...e.style,border:(null===(r=e.style)||void 0===r?void 0:r.border)||"none"}}),(0,de.FD)(ee.A,{sx:{flex:1,minWidth:0},children:[(0,de.Y)(se.A,{variant:"body2",sx:{fontWeight:500,color:"text.primary",lineHeight:1.2},children:e.label}),e.description&&(0,de.Y)(se.A,{variant:"caption",sx:{display:"block",color:"text.secondary",mt:.25,lineHeight:1.2},children:e.description})]})]},t)}))})]})};ci.propTypes={title:s().string,items:s().arrayOf(s().shape({color:s().string.isRequired,label:s().string.isRequired,description:s().string,style:s().object})).isRequired,position:s().shape({top:s().number,right:s().number,bottom:s().number,left:s().number})};const di=i.memo(ci);var ui=r(99682),mi=r(1649),hi=r(24337);const pi=e=>{let{onZoomIn:t,onZoomOut:r,onReset:i,onRefresh:a,position:n={top:10,right:10}}=e;const o=(0,ge.A)();return(0,de.FD)(ee.A,{sx:{position:"absolute",...n,zIndex:1e3,backgroundColor:"background.paper",borderRadius:1,boxShadow:2,"& > button":{borderRadius:0,padding:1,"&:first-of-type":{borderTopLeftRadius:4,borderTopRightRadius:4},"&:last-child":{borderBottomLeftRadius:4,borderBottomRightRadius:4},"&:not(:last-child)":{borderBottom:`1px solid ${o.palette.divider}`}}},children:[(0,de.Y)(ie.A,{onClick:t,title:"Zoom In",size:"small",children:(0,de.Y)(ui.A,{fontSize:"small"})}),(0,de.Y)(ie.A,{onClick:r,title:"Zoom Out",size:"small",children:(0,de.Y)(mi.A,{fontSize:"small"})}),(0,de.Y)(ie.A,{onClick:i,title:"Reset View",size:"small",children:(0,de.Y)(hi.A,{fontSize:"small"})}),(0,de.Y)(ie.A,{onClick:a,title:"Refresh Data",size:"small",children:(0,de.Y)(Ir.A,{fontSize:"small"})})]})};pi.propTypes={onZoomIn:s().func.isRequired,onZoomOut:s().func.isRequired,onReset:s().func.isRequired,onRefresh:s().func.isRequired,position:s().shape({top:s().number,right:s().number,bottom:s().number,left:s().number})};const gi=i.memo(pi);var yi=r(55425);const fi=[15.3694,44.191],vi=5,bi=[[10.111,39.814],[21.0025,56.5305]],Ai=e=>{let{mapRef:t,defaultView:r}=e;const a=(0,ri.ko)(),n=(0,i.useCallback)((e=>{if(t.current)switch(e){case"zoomIn":t.current.setZoom(Math.min((t.current.getZoom()||0)+1,8));break;case"zoomOut":t.current.setZoom(Math.max((t.current.getZoom()||0)-1,5));break;case"reset":t.current.setView(r.center,r.zoom),t.current.fitBounds(bi);break;case"refresh":t.current.invalidateSize()}}),[t,r,a]);return(0,de.Y)(gi,{onZoomIn:e=>{e.preventDefault(),n("zoomIn")},onZoomOut:e=>{e.preventDefault(),n("zoomOut")},onReset:e=>{e.preventDefault(),n("reset")},onRefresh:e=>{e.preventDefault(),n("refresh")}})},wi=e=>{let{flows:t=[],selectedFlow:r,onFlowSelect:a,height:o="100%",defaultView:s={center:fi,zoom:vi}}=e;const l=(0,i.useRef)(null),{commodity:c}=(0,n.d4)(O),{loading:d,error:u}=(0,n.d4)(P),m=(0,i.useMemo)((()=>{try{return oi.Ay.scale([yi.Mc.NEUTRAL,yi.Mc.POSITIVE]).domain([0,1]).mode("lch")}catch(e){return()=>yi.Mc.NEUTRAL}}),[]),{markets:h,connections:p}=(0,i.useMemo)((()=>{if(!Array.isArray(t))return{markets:new Map,connections:[]};const e=new Map,r=[];t.forEach((t=>{var i,a;if(!yi.Oz.isValidFlow(t))return;const n=De.DJ[null===(i=t.source)||void 0===i?void 0:i.toLowerCase()],o=De.DJ[null===(a=t.target)||void 0===a?void 0:a.toLowerCase()];if(!n||!o)return;e.has(t.source)||e.set(t.source,{id:t.source,name:t.source,coordinates:n,totalFlow:0,incomingFlows:0,outgoingFlows:0});const s=e.get(t.source);s.totalFlow+=t.flow_weight,s.outgoingFlows+=1,e.has(t.target)||e.set(t.target,{id:t.target,name:t.target,coordinates:o,totalFlow:0,incomingFlows:0,outgoingFlows:0});const l=e.get(t.target);l.totalFlow+=t.flow_weight,l.incomingFlows+=1,r.push({...t,coordinates:{source:n,target:o}})}));const i=Math.max(...r.map((e=>e.flow_weight)),0),a=r.map((e=>{const t=yi.Oz.normalizeFlow(e,i);return{...e,color:m(t).hex(),width:yi.yh.MIN_FLOW_WIDTH+t*(yi.yh.MAX_FLOW_WIDTH-yi.yh.MIN_FLOW_WIDTH),opacity:yi.yh.MIN_OPACITY+t*(yi.yh.MAX_OPACITY-yi.yh.MIN_OPACITY),normalizedFlow:t}}));return{markets:e,connections:a}}),[t,m]),g=(0,i.useMemo)((()=>[{color:yi.Mc.POSITIVE,label:"High Flow",description:"Flow > 70%"},{color:m(.5).hex(),label:"Medium Flow",description:"40% - 70%"},{color:yi.Mc.NEUTRAL,label:"Low Flow",description:"<40%"},{color:yi.Mc.NODE.FILL,label:"Market Point",style:{borderRadius:"50%",border:`2px solid ${yi.Mc.NODE.BORDER}`},description:"Active market location"}]),[m]),y=(0,i.useCallback)(((e,t)=>{e.preventDefault(),e.stopPropagation(),a&&a(t)}),[a]);return d?(0,de.FD)(ee.A,{sx:{height:o,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"background.paper",borderRadius:1,p:2,flexDirection:"column",gap:2},children:[(0,de.Y)(Ue.A,{size:40}),(0,de.FD)(se.A,{children:["Loading market flows for ",c,"..."]})]}):u?(0,de.Y)(ee.A,{sx:{height:o,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"background.paper",borderRadius:1,p:2},children:(0,de.FD)(se.A,{color:"error",children:["Error loading market flows: ",u]})}):p.length?(0,de.FD)(ee.A,{sx:{height:o,position:"relative"},children:[(0,de.FD)(At.W,{center:s.center,zoom:s.zoom,style:{height:"100%",width:"100%"},zoomControl:!1,maxBounds:bi,minZoom:5,maxZoom:8,scrollWheelZoom:!1,dragging:!0,touchZoom:!0,doubleClickZoom:!1,boxZoom:!1,keyboard:!1,bounceAtZoomLimits:!0,worldCopyJump:!1,preferCanvas:!0,ref:l,children:[(0,de.Y)(wt.e,{url:"https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png",attribution:"© OpenStreetMap, © CARTO"}),(0,de.Y)(Ai,{mapRef:l,defaultView:s}),(0,de.Y)(si.A,{component:null,children:p.map((e=>{const t=r&&r.source===e.source&&r.target===e.target;return(0,de.Y)(li.A,{classNames:"flow",timeout:300,children:(0,de.Y)(ii.R,{positions:[[e.coordinates.source[1],e.coordinates.source[0]],[e.coordinates.target[1],e.coordinates.target[0]]],pathOptions:{color:t?yi.Mc.SELECTED:e.color,weight:t?e.width*yi.yh.SELECTION_SCALE:e.width,opacity:t?e.opacity*yi.yh.SELECTION_SCALE:e.opacity,lineCap:"round",lineJoin:"round",interactive:!0},eventHandlers:{click:t=>y(t,e),mouseover:t=>{t.preventDefault(),t.target.setStyle({weight:1.5*e.width})},mouseout:r=>{r.preventDefault(),t||r.target.setStyle({weight:e.width})}},children:(0,de.Y)(ai.z,{children:(0,de.FD)(ee.A,{sx:{p:1,minWidth:200},children:[(0,de.Y)(se.A,{variant:"subtitle2",gutterBottom:!0,children:"Market Flow Details"}),(0,de.FD)(ee.A,{sx:{display:"flex",flexDirection:"column",gap:.5},children:[(0,de.FD)(se.A,{variant:"body2",children:["Source: ",e.source]}),(0,de.FD)(se.A,{variant:"body2",children:["Target: ",e.target]}),(0,de.FD)(se.A,{variant:"body2",children:["Flow Volume: ",e.flow_weight.toFixed(2)]}),(0,de.FD)(se.A,{variant:"body2",children:["Flow Strength: ",(100*e.normalizedFlow).toFixed(1),"%"]}),e.price_differential&&(0,de.FD)(se.A,{variant:"body2",children:["Price Differential: ",e.price_differential.toFixed(2)]})]})]})})})},`${e.source}-${e.target}`)}))}),Array.from(h.values()).map((e=>{const t=Math.max(...Array.from(h.values()).map((e=>e.totalFlow))),r=yi.Oz.calculateNodeSize(e.totalFlow,t);return(0,de.Y)(ni.p,{center:[e.coordinates[1],e.coordinates[0]],radius:r,pathOptions:{fillColor:yi.Mc.NODE.FILL,color:yi.Mc.NODE.BORDER,weight:yi.yh.NODE_BORDER_WIDTH,opacity:yi.yh.NODE_BORDER_OPACITY,fillOpacity:yi.yh.NODE_OPACITY},children:(0,de.Y)(ai.z,{children:(0,de.FD)(ee.A,{sx:{p:1,minWidth:200},children:[(0,de.Y)(se.A,{variant:"subtitle2",gutterBottom:!0,children:e.name}),(0,de.FD)(ee.A,{sx:{display:"flex",flexDirection:"column",gap:.5},children:[(0,de.FD)(se.A,{variant:"body2",children:["Total Flow: ",e.totalFlow.toFixed(2)]}),(0,de.FD)(se.A,{variant:"body2",children:["Incoming: ",e.incomingFlows]}),(0,de.FD)(se.A,{variant:"body2",children:["Outgoing: ",e.outgoingFlows]})]})]})})},`market-${e.id}`)}))]}),(0,de.Y)(di,{title:`Market Flow Analysis - ${c}`,items:g})]}):(0,de.Y)(ee.A,{sx:{height:o,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"background.paper",borderRadius:1,p:2},children:(0,de.FD)(se.A,{color:"text.secondary",children:["No valid market flow data available for ",c,"."]})})};wi.propTypes={flows:s().arrayOf(s().shape({source:s().string.isRequired,target:s().string.isRequired,flow_weight:s().number.isRequired,price_differential:s().number,metadata:s().shape({valid:s().bool.isRequired,processed_at:s().string.isRequired}).isRequired})).isRequired,selectedFlow:s().shape({source:s().string.isRequired,target:s().string.isRequired}),onFlowSelect:s().func,height:s().oneOfType([s().string,s().number]),defaultView:s().shape({center:s().arrayOf(s().number),zoom:s().number})};const _i=i.memo(wi,((e,t)=>{if(e.height!==t.height)return!1;if(e.flows.length!==t.flows.length)return!1;const r=e.selectedFlow,i=t.selectedFlow;if(!r&&i||r&&!i)return!1;if(r&&i&&(r.source!==i.source||r.target!==i.target))return!1;if(e.defaultView||t.defaultView){var a,n,o,s;const r=e.defaultView||{},i=t.defaultView||{};if(r.zoom!==i.zoom)return!1;if((null===(a=r.center)||void 0===a?void 0:a[0])!==(null===(n=i.center)||void 0===n?void 0:n[0])||(null===(o=r.center)||void 0===o?void 0:o[1])!==(null===(s=i.center)||void 0===s?void 0:s[1]))return!1}return e.flows.length===t.flows.length&&e.flows.every(((e,r)=>{const i=t.flows[r];return e.source===i.source&&e.target===i.target&&e.flow_weight===i.flow_weight}))})),xi=(e,t)=>function(){const t=performance.now();try{const t=e(...arguments);performance.now();return t}catch(e){throw e}},ki=xi(((e,t,r)=>{if(!r||"number"!=typeof e||"number"!=typeof t)return{significant:!1,zScore:0,pValue:1};const i=(e-t)/r;return{significant:Math.abs(i)>1.96,zScore:i,pValue:2*(1-Si(Math.abs(i)))}})),Si=e=>{if("number"!=typeof e)return 0;const t=1/(1+.2316419*Math.abs(e)),r=.3989423*Math.exp(-e*e/2)*t*(.3193815+t*(t*(1.781478+t*(1.330274*t-1.821256))-.3565638));return e>0?1-r:r},Mi=e=>{var t;return e&&"string"==typeof e.source&&"string"==typeof e.target&&"number"==typeof e.flow_weight&&!0===(null===(t=e.metadata)||void 0===t?void 0:t.valid)},Ci=e=>{let{flows:t=[],selectedFlow:r,timeRange:a}=e;const[o,s]=(0,i.useState)(!1),{commodity:l}=((0,n.d4)(L),(0,n.d4)(O)),{loading:c,error:d}=(0,n.d4)(P),u=(0,i.useMemo)((()=>Array.isArray(t)?t.filter(Mi):[]),[t]),m=(0,i.useMemo)((()=>xi((()=>{const e={basic:{totalFlow:0,avgFlow:0,maxFlow:0,minFlow:0,stdDev:0,count:0},distribution:{q1:0,q3:0,iqr:0,skewness:0,kurtosis:0},networkMetrics:{density:0,connectivity:0,centralization:0}};if(!u.length)return e;try{const e=u.map((e=>yi.Oz.getFlowValue(e))),t=e.reduce(((e,t)=>e+t),0),r=e.length>0?t/e.length:0,i=Math.max(...e,0),a=Math.min(...e),n=e.length>0?e.reduce(((e,t)=>e+Math.pow(t-r,2)),0)/e.length:0,o=Math.sqrt(n),s=[...e].sort(((e,t)=>e-t)),l=s[Math.floor(.25*e.length)]||0,c=s[Math.floor(.75*e.length)]||0,d=c-l,m=e.filter((e=>e>0)).length,h=u.length*(u.length-1)/2,p=h>0?Math.min(1,Math.max(0,m/h)):0,g=o>0?e.reduce(((e,t)=>e+Math.pow((t-r)/o,3)),0)/(e.length||1):0,y=o>0?e.reduce(((e,t)=>e+Math.pow((t-r)/o,4)),0)/(e.length||1)-3:0;return{basic:{totalFlow:Math.max(0,t),avgFlow:Math.max(0,r),maxFlow:Math.max(0,i),minFlow:Math.max(0,a),stdDev:Math.max(0,o),count:u.length},distribution:{q1:Math.max(0,l),q3:Math.max(0,c),iqr:Math.max(0,d),skewness:Math.max(-3,Math.min(3,g)),kurtosis:Math.max(-3,Math.min(3,y))},networkMetrics:{density:Math.min(1,Math.max(0,p)),connectivity:Math.min(1,Math.max(0,u.length>0?m/u.length:0)),centralization:Math.min(1,Math.max(0,h>0?m/h:0))}}}catch(t){return e}}))()),[u]),h=(0,i.useMemo)((()=>xi((()=>{const e={normalizedFlow:0,relativeStrength:0,percentile:0,significance:{significant:!1,zScore:0,pValue:1},status:yi.kP.INACTIVE,metrics:{zScore:0,pValue:1,standardizedValue:0}};if(!r||!m||!u.length)return e;try{const t=u.find((e=>e.source===r.source&&e.target===r.target));if(!t)return e;const i=yi.Oz.getFlowValue(t),a=m.basic.avgFlow>0?Math.min(1,Math.max(0,i/m.basic.avgFlow)):0,n=u.length>0?Math.min(100,Math.max(0,u.filter((e=>yi.Oz.getFlowValue(e)<=i)).length/u.length*100)):0,o=ki(i,m.basic.avgFlow,m.basic.stdDev),s=m.basic.maxFlow>0?Math.min(1,Math.max(0,i/m.basic.maxFlow)):0,l=yi.Oz.getFlowStatus(s);return{...t,relativeStrength:a,percentile:n,normalizedFlow:s,significance:o,status:l,metrics:{zScore:Math.max(-10,Math.min(10,o.zScore)),pValue:Math.min(1,Math.max(0,o.pValue)),standardizedValue:m.basic.stdDev>0?Math.max(-10,Math.min(10,(i-m.basic.avgFlow)/m.basic.stdDev)):0}}}catch(t){return e}}))()),[r,u,m]),p=(0,i.useCallback)((e=>{e&&(e.preventDefault(),e.stopPropagation()),s((e=>!e))}),[]),g=(0,i.useMemo)((()=>{var e,t,r;return{network:{density:(null==m||null===(e=m.networkMetrics)||void 0===e?void 0:e.density)||0,connectivity:(null==m||null===(t=m.networkMetrics)||void 0===t?void 0:t.connectivity)||0,centralization:(null==m||null===(r=m.networkMetrics)||void 0===r?void 0:r.centralization)||0},selected:{normalizedFlow:(null==h?void 0:h.normalizedFlow)||0,significance:(null==h?void 0:h.significance)||{significant:!1,zScore:0,pValue:1}}}}),[m,h]);return c?(0,de.Y)($e.A,{sx:{p:2,height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,de.FD)(ee.A,{sx:{textAlign:"center"},children:[(0,de.Y)(Ue.A,{size:40,sx:{mb:2}}),(0,de.FD)(se.A,{children:["Loading flow metrics for ",l,"..."]})]})}):d?(0,de.Y)($e.A,{sx:{p:2,height:"100%"},children:(0,de.FD)(Ke.A,{severity:"error",children:["Error loading flow metrics: ",d]})}):m&&m.basic.count?(0,de.FD)($e.A,{sx:{p:2,height:"100%",overflow:"auto"},children:[(0,de.FD)(ee.A,{sx:{mb:3},children:[(0,de.FD)(se.A,{variant:"h6",gutterBottom:!0,children:["Network Flow Analysis",a&&(0,de.FD)(se.A,{variant:"caption",display:"block",color:"textSecondary",children:[l," - Period: ",a]})]}),(0,de.FD)(ze.Ay,{container:!0,spacing:2,children:[(0,de.Y)(ze.Ay,{item:!0,xs:12,children:(0,de.Y)(Tt,{title:"Network Flow Strength",value:g.network.density,target:yi.su.DENSITY.HIGH,format:"percentage",description:"Overall network utilization",tooltip:"Measures how close the network is to its theoretical maximum capacity"})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,md:6,children:(0,de.Y)(Ft,{title:"Flow Density",value:m.networkMetrics.density,format:"percentage",description:"Active market connections",tooltip:"Percentage of potential market connections that are active",thresholds:yi.su.DENSITY})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,md:6,children:(0,de.Y)(Ft,{title:"Network Connectivity",value:m.networkMetrics.connectivity,format:"percentage",description:"Market integration level",tooltip:"Degree of market integration in the network"})})]}),(0,de.Y)(Ce.A,{sx:{my:2}}),(0,de.Y)(se.A,{variant:"subtitle1",gutterBottom:!0,children:"Flow Distribution"}),(0,de.FD)(ze.Ay,{container:!0,spacing:2,children:[(0,de.Y)(ze.Ay,{item:!0,xs:12,md:6,children:(0,de.Y)(Ft,{title:"Variability",value:m.basic.stdDev/m.basic.avgFlow,format:"number",description:"Flow consistency",tooltip:"Lower values indicate more uniform flow distribution"})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,md:6,children:(0,de.Y)(Ft,{title:"Distribution Shape",value:m.distribution.skewness,format:"number",description:"Flow symmetry",tooltip:"Positive values indicate right-skewed distribution"})})]})]}),h&&(0,de.FD)(de.FK,{children:[(0,de.Y)(Ce.A,{sx:{my:3}}),(0,de.Y)(se.A,{variant:"h6",gutterBottom:!0,children:"Selected Flow Analysis"}),(0,de.FD)(se.A,{variant:"subtitle2",color:"textSecondary",gutterBottom:!0,sx:{mb:2},children:[h.source," → ",h.target]}),(0,de.FD)(ze.Ay,{container:!0,spacing:2,children:[(0,de.Y)(ze.Ay,{item:!0,xs:12,children:(0,de.Y)(Tt,{title:"Flow Strength",value:g.selected.normalizedFlow,target:yi.qV.HIGH,format:"percentage",description:"Relative to maximum flow",tooltip:"How strong this flow is compared to the strongest flow in the network"})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,md:6,children:(0,de.Y)(Ft,{title:"Statistical Significance",value:Math.abs(h.metrics.zScore),format:"number",description:`p-value: ${h.metrics.pValue.toFixed(4)}`,tooltip:"Z-score indicates deviation from mean in standard deviations"})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,md:6,children:(0,de.Y)(Ft,{title:"Flow Percentile",value:h.percentile/100,format:"percentage",description:"Relative ranking",tooltip:"Percentage of flows that are weaker than this one"})})]}),h.significance.significant&&(0,de.Y)(Ke.A,{severity:"info",sx:{mt:2},icon:(0,de.Y)(ft.A,{}),children:"This is a statistically significant flow (p < 0.05), indicating a strong market connection."})]}),(0,de.FD)(ee.A,{sx:{mt:3},children:[(0,de.Y)(Se.A,{fullWidth:!0,onClick:p,onMouseDown:e=>e.preventDefault(),endIcon:o?(0,de.Y)(bt.A,{}):(0,de.Y)(vt.A,{}),startIcon:(0,de.Y)(ft.A,{}),children:"Flow Analysis Methodology"}),(0,de.Y)(pt.A,{in:o,children:(0,de.FD)(ee.A,{sx:{mt:2,p:2,bgcolor:"background.paper",borderRadius:1},children:[(0,de.Y)(se.A,{variant:"subtitle1",gutterBottom:!0,children:"Understanding Flow Metrics"}),(0,de.FD)(gt.A,{dense:!0,children:[(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:"Network Metrics",secondary:"Measures overall market integration and connectivity patterns"})}),(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:"Flow Distribution",secondary:"Analyzes the pattern and consistency of market flows"})}),(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:"Statistical Significance",secondary:"Uses z-scores and p-values to identify important market connections"})})]}),(0,de.Y)(se.A,{variant:"subtitle2",gutterBottom:!0,sx:{mt:2},children:"Interpretation Guide:"}),(0,de.FD)(se.A,{variant:"body2",component:"div",children:["• Strong Flow (>",100*yi.qV.HIGH,"%): Robust market connection",(0,de.Y)("br",{}),"• Medium Flow (",100*yi.qV.MEDIUM,"-",100*yi.qV.HIGH,"%): Moderate trade",(0,de.Y)("br",{}),"• Weak Flow (<",100*yi.qV.MEDIUM,"%): Limited market interaction"]})]})})]})]}):(0,de.Y)($e.A,{sx:{p:2,height:"100%"},children:(0,de.FD)(Ke.A,{severity:"warning",children:["No valid flow metrics available for ",l," in ",a,"."]})})};Ci.propTypes={flows:s().arrayOf(s().shape({source:s().string.isRequired,target:s().string.isRequired,flow_weight:s().number.isRequired,price_differential:s().number,metadata:s().shape({valid:s().bool.isRequired,processed_at:s().string.isRequired}).isRequired})).isRequired,selectedFlow:s().shape({source:s().string.isRequired,target:s().string.isRequired}),timeRange:s().string};const Yi=i.memo(Ci);var Di=r(69486),Ii=r(36694),Ri=r(22859),Fi=r(34779),Ni=r(21403),zi=r(31390);const Ei={toFlowDate:e=>e?7===e.length?`${e}-01`:e:null,toSpatialDate:e=>e?e.substring(0,7):null,formatDate:e=>{try{const t=Ei.toSpatialDate(e);return new Date(`${t}-01`).toLocaleDateString("en-US",{year:"numeric",month:"short"})}catch(t){return e}}},Ti=e=>{let{dates:t,currentDate:r,onChange:a,autoPlayInterval:n=1e3,loading:o=!1}=e;const s=(0,ge.A)(),[l,c]=(0,i.useState)(!1),[d,u]=(0,i.useState)(1),[m,h]=(0,i.useState)(0),[p,g]=(0,i.useState)(r),y=(0,i.useRef)(!0),f=(0,i.useRef)(null),v=(0,i.useRef)(null),b=(0,i.useMemo)((()=>t.map(Ei.toSpatialDate)),[t]),A=(0,i.useMemo)((()=>Ei.toSpatialDate(r)),[r]),w=(0,i.useCallback)((e=>{const t=Date.now();if(v.current&&t-v.current<200)return;v.current=t;const r=Ei.toSpatialDate(e);a(r)}),[a]),x=(0,i.useMemo)((()=>(0,_.debounce)(w,200,{leading:!0,trailing:!0})),[w]);(0,i.useEffect)((()=>{const e=b.indexOf(A);if(e>=0)h(e),g(A);else if(t.length>0&&!y.current){h(0);const e=Ei.toSpatialDate(t[0]);g(e),w(e)}y.current=!1}),[r,t,A,b,w]);const k=(0,i.useCallback)((()=>{l&&h((e=>{const r=e+1;if(r>=t.length)return c(!1),0;const i=Ei.toSpatialDate(t[r]);return g(i),x(i),r}))}),[l,t,x]);(0,i.useEffect)((()=>(l&&!o&&(f.current=setInterval(k,n/d)),()=>{f.current&&(clearInterval(f.current),f.current=null)})),[l,n,d,k,o]);const S=(0,i.useCallback)((()=>{c((e=>!e))}),[]),M=(0,i.useCallback)((()=>{const e=Math.max(0,m-1),r=Ei.toSpatialDate(t[e]);h(e),g(r),x(r)}),[m,t,x]),C=(0,i.useCallback)((()=>{const e=Math.min(t.length-1,m+1),r=Ei.toSpatialDate(t[e]);h(e),g(r),x(r)}),[t.length,m,t,x]),Y=(0,i.useCallback)((()=>{u((e=>4===e?1:2*e))}),[]),D=(0,i.useCallback)(((e,r)=>{if(r!==m){const e=Ei.toSpatialDate(t[r]);h(r),g(e),x(e)}}),[t,m,x]);return(0,i.useEffect)((()=>()=>{f.current&&clearInterval(f.current),x.cancel()}),[x]),(0,de.FD)($e.A,{elevation:2,sx:{width:"100%",backgroundColor:s.palette.background.paper,borderRadius:1,p:2,position:"relative"},children:[o&&(0,de.Y)(ee.A,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:999,backgroundColor:"rgba(255,255,255,0.7)",borderRadius:"50%",p:2},children:(0,de.Y)(Ue.A,{size:24})}),(0,de.FD)(ee.A,{sx:{width:"100%",opacity:o?.5:1,transition:"opacity 0.3s"},children:[(0,de.Y)(se.A,{variant:"subtitle2",color:"textPrimary",sx:{display:"block",mb:1,textAlign:"center",fontWeight:500},children:Ei.formatDate(t[m])}),(0,de.Y)(Di.Ay,{value:m,min:0,max:t.length-1,onChange:D,disabled:o,sx:{mb:2,"& .MuiSlider-thumb":{width:12,height:12}}}),(0,de.FD)(ee.A,{sx:{display:"flex",justifyContent:"center",gap:1,"& .MuiIconButton-root":{padding:1,"&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"}}},children:[(0,de.Y)(ie.A,{size:"small",onClick:M,disabled:0===m||o,title:"Previous",children:(0,de.Y)(Fi.A,{fontSize:"small"})}),(0,de.Y)(ie.A,{size:"small",onClick:S,disabled:o,title:l?"Pause":"Play",children:l?(0,de.Y)(Ri.A,{fontSize:"small"}):(0,de.Y)(Ii.A,{fontSize:"small"})}),(0,de.Y)(ie.A,{size:"small",onClick:C,disabled:m===t.length-1||o,title:"Next",children:(0,de.Y)(Ni.A,{fontSize:"small"})}),(0,de.FD)(ie.A,{size:"small",onClick:Y,disabled:o,title:`Playback Speed: ${d}x`,sx:{position:"relative"},children:[(0,de.Y)(zi.A,{fontSize:"small"}),(0,de.FD)(se.A,{variant:"caption",sx:{position:"absolute",bottom:2,right:2,fontSize:"0.6rem",fontWeight:"bold",backgroundColor:s.palette.background.paper,borderRadius:"50%",width:12,height:12,display:"flex",alignItems:"center",justifyContent:"center"},children:[d,"x"]})]})]})]})]})};Ti.propTypes={dates:s().arrayOf(s().string).isRequired,currentDate:s().string.isRequired,onChange:s().func.isRequired,autoPlayInterval:s().number,loading:s().bool};const Pi=i.memo(Ti),Oi=e=>e?7===e.length?`${e}-01`:e:null,$i=()=>{const e=(0,n.wA)(),t=(0,n.d4)(T),{loading:r,error:a}=(0,n.d4)(P),o=(0,n.d4)((e=>e.spatial.ui.selectedDate)),s=(0,n.d4)((e=>e.spatial.ui.selectedCommodity||e.ecm.ui.selectedCommodity)),l=(0,n.d4)((e=>{const t=Oi(o);return $(e,t)})),c=(0,i.useRef)(null),d=(0,i.useRef)(null),u=(0,i.useCallback)((async()=>{if(!s||!o)return;const t=Oi(o),r=`${s}-${t}`;if(c.current!==r){c.current=r;try{d.current&&d.current.abort(),d.current=new AbortController,await e(F({commodity:s,date:t,signal:d.current.signal})).unwrap()}catch(e){e.name}}}),[s,o,e]);return(0,i.useEffect)((()=>(u(),()=>{d.current&&d.current.abort()})),[u]),{flows:l,byDate:t.byDate,byRegion:t.byRegion,metadata:t.metadata,loading:r,error:a,selectedCommodity:s,selectedDate:o,refreshData:()=>{c.current=null,u()}}},Li={center:[15.3694,44.191],zoom:6.5},ji=()=>{const e=(0,n.wA)(),[t,r]=(0,i.useState)(null),[a,o]=(0,i.useState)(!1),s=(0,n.d4)((e=>e.spatial.ui.selectedDate)),l=(0,n.d4)((e=>e.spatial.ui.selectedCommodity)),c=(0,n.d4)(L),u=(0,n.d4)((e=>e.spatial.data.uniqueMonths||[])),{flows:m,metadata:{totalFlows:h,uniqueMarkets:p},loading:g,error:y,refreshData:f}=$i(),v=(0,i.useMemo)((()=>{if(!Array.isArray(m)||!m.length)return[];try{const e=m.filter((e=>e&&"object"==typeof e&&"number"==typeof e.flow_weight&&!isNaN(e.flow_weight)));if(0===e.length)return[];const t=Math.max(...e.map((e=>e.flow_weight)));return e.map((e=>{try{const r=yi.Oz.normalizeFlow(e,t),i=yi.Oz.getFlowStatus(r);return{...e,normalizedFlow:r,normalizedPriceDiff:t>0?Math.abs(e.price_differential||0)/t:0,status:i}}catch(e){return null}})).filter(Boolean)}catch(e){return[]}}),[m,s,l]),b=(0,i.useCallback)((t=>{t!==s&&(r(null),e((0,d.un)(t)))}),[e,s,l]),A=(0,i.useCallback)((e=>{r(e)}),[]),w=(0,i.useCallback)((()=>{o((e=>!e))}),[]),_=(0,i.useCallback)((()=>{f()}),[f]);return(0,i.useEffect)((()=>()=>{}),[l,s,m]),l?y?(0,de.FD)(Ke.A,{severity:"error",sx:{m:2},action:(0,de.Y)(Se.A,{color:"inherit",size:"small",onClick:_,children:"Reload"}),children:["Error loading flow analysis: ",y]}):(0,de.FD)(ze.Ay,{container:!0,spacing:2,children:[(0,de.Y)(ze.Ay,{item:!0,xs:12,children:(0,de.Y)($e.A,{sx:{p:2},children:(0,de.FD)(ze.Ay,{container:!0,spacing:2,children:[(0,de.Y)(ze.Ay,{item:!0,xs:12,children:(0,de.FD)(se.A,{variant:"h6",gutterBottom:!0,children:[l," Market Flows",s&&(0,de.FD)(se.A,{variant:"caption",display:"block",color:"textSecondary",children:["Period: ",s]})]})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,md:3,children:(0,de.Y)(ee.A,{children:(0,de.Y)(Ft,{title:"Total Flow Volume",value:(null==c?void 0:c.totalFlows)||0,format:"number",description:"Sum of all market flows"})})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,md:3,children:(0,de.Y)(ee.A,{children:(0,de.Y)(Ft,{title:"Average Flow",value:(null==c?void 0:c.averageFlowWeight)||0,format:"number",description:"Average flow per connection"})})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,md:3,children:(0,de.Y)(ee.A,{children:(0,de.Y)(Ft,{title:"Market Connectivity",value:(null==c?void 0:c.marketConnectivity)||0,format:"percentage",description:"Network connection density",thresholds:yi.su.DENSITY})})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,md:3,children:(0,de.Y)(ee.A,{children:(0,de.Y)(Ft,{title:"Active Markets",value:p||0,format:"integer",description:"Unique market locations"})})})]})})}),u.length>0&&(0,de.Y)(ze.Ay,{item:!0,xs:12,children:(0,de.Y)(Pi,{dates:u,currentDate:s||u[0],onChange:b,loading:g})}),g&&(0,de.Y)(ze.Ay,{item:!0,xs:12,children:(0,de.FD)(Ke.A,{severity:"info",children:["Loading flow data for ",l," (",s,")..."]})}),!g&&!y&&(!m||0===m.length)&&(0,de.Y)(ze.Ay,{item:!0,xs:12,children:(0,de.FD)(Ke.A,{severity:"warning",children:["No flow data available for ",l," in ",s]})}),v.length>0&&(0,de.Y)(ze.Ay,{item:!0,xs:12,children:(0,de.Y)($e.A,{sx:{p:2,height:500},children:(0,de.Y)(_i,{flows:v,selectedFlow:t,onFlowSelect:A,defaultView:Li})})}),v.length>0&&(0,de.Y)(ze.Ay,{item:!0,xs:12,children:(0,de.Y)(Yi,{flows:v,selectedFlow:t,timeRange:s})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,children:(0,de.FD)($e.A,{sx:{p:2},children:[(0,de.Y)(Se.A,{fullWidth:!0,onClick:w,endIcon:a?(0,de.Y)(bt.A,{}):(0,de.Y)(vt.A,{}),startIcon:(0,de.Y)(ft.A,{}),children:"Methodology"}),(0,de.Y)(pt.A,{in:a,children:(0,de.FD)(ee.A,{sx:{mt:2,p:2},children:[(0,de.Y)(se.A,{variant:"body2",paragraph:!0,children:"This analysis examines market flows across Yemen using geographic visualization and statistical metrics to understand trade patterns and market integration. Flow strength is represented through line thickness and color intensity, while market points indicate trading locations."}),(0,de.FD)(gt.A,{dense:!0,children:[(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:(0,de.Y)(se.A,{variant:"subtitle2",color:"primary",children:"Flow Analysis"}),secondary:(0,de.Y)(se.A,{variant:"body2",color:"textSecondary",children:"Measures trade volume and consistency between markets, normalized for regional variations and market size"})})}),(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:(0,de.Y)(se.A,{variant:"subtitle2",color:"primary",children:"Market Integration"}),secondary:(0,de.Y)(se.A,{variant:"body2",color:"textSecondary",children:"Evaluates market connectivity through flow density and price correlation analysis"})})})]}),(0,de.Y)(se.A,{variant:"subtitle2",gutterBottom:!0,sx:{mt:2},color:"primary",children:"Flow Classification:"}),(0,de.FD)(se.A,{variant:"body2",component:"div",children:["• Strong Flow (>",100*yi.qV.HIGH,"%): Robust market connection",(0,de.Y)("br",{}),"• Medium Flow (",100*yi.qV.MEDIUM,"-",100*yi.qV.HIGH,"%): Moderate trade",(0,de.Y)("br",{}),"• Weak Flow (<",100*yi.qV.MEDIUM,"%): Limited market interaction"]})]})})]})})]}):(0,de.Y)(Ke.A,{severity:"warning",sx:{m:2},children:"Please select a commodity from the sidebar to view market flows."})},qi=i.memo(ji),Wi=e=>{let{title:t,content:r,metrics:i,className:a,style:n}=e;const o=(0,ge.A)();return(0,de.FD)($e.A,{elevation:3,className:a,sx:{padding:1.5,minWidth:200,maxWidth:300,backgroundColor:"rgba(255, 255, 255, 0.95)",borderRadius:1,...n},children:[t&&(0,de.Y)(se.A,{variant:"subtitle2",sx:{fontWeight:"medium",color:o.palette.text.primary,mb:r||i?1:0,borderBottom:i?`1px solid ${o.palette.divider}`:"none",pb:i?.5:0},children:t}),r&&(0,de.Y)(se.A,{variant:"body2",color:"textSecondary",sx:{mb:i?1:0},children:r}),i&&(0,de.Y)(ee.A,{sx:{display:"flex",flexDirection:"column",gap:.5},children:i.map(((e,t)=>(0,de.FD)(ee.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"baseline"},children:[(0,de.FD)(se.A,{variant:"caption",color:"textSecondary",sx:{mr:2},children:[e.label,":"]}),(0,de.Y)(se.A,{variant:"body2",sx:{fontWeight:"medium",color:e.color||o.palette.text.primary},children:Vi(e)})]},t)))})]})},Vi=e=>{const t=e.value;if("number"!=typeof t)return t;switch(e.format){case"percentage":return`${(100*t).toFixed(1)}%`;case"currency":return`$${t.toFixed(2)}`;case"integer":return Math.round(t).toString();default:return t.toFixed(2)}};Wi.propTypes={title:s().string,content:s().string,metrics:s().arrayOf(s().shape({label:s().string.isRequired,value:s().oneOfType([s().number,s().string]).isRequired,format:s().oneOf(["number","percentage","currency","integer"]),color:s().string})),className:s().string,style:s().object};const Hi=i.memo(Wi),Bi=[[12.7,42.6],[18.5,53.2]],Gi={center:[15.3694,47.8],zoom:5.5},Ui=e=>{let{defaultView:t,defaultBounds:r}=e;const a=(0,ri.ko)();return(0,i.useEffect)((()=>{if(a)if(a.setMaxBounds(Bi),a.setMinZoom(5),a.setMaxZoom(9),a.keyboard.disable(),a.scrollWheelZoom.disable(),a.on("drag",(()=>{a.panInsideBounds(Bi,{animate:!1})})),r)try{a.fitBounds(r,{padding:[20,20],maxZoom:8,animate:!0,duration:1})}catch(e){a.setView((null==t?void 0:t.center)||Gi.center,(null==t?void 0:t.zoom)||Gi.zoom,{animate:!0})}else t&&t.center&&t.zoom&&a.setView(t.center,t.zoom,{animate:!0})}),[a,t,r]),null},Zi=e=>{let{children:t,height:r="100%",defaultView:i=Gi,defaultBounds:a=null}=e;return(0,de.FD)(At.W,{center:i.center,zoom:i.zoom,style:{height:r,width:"100%",backgroundColor:"#f8f9fa"},zoomControl:!1,attributionControl:!1,children:[(0,de.Y)(wt.e,{url:"https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png",attribution:'© <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>, © <a href="https://carto.com/attribution">CARTO</a>'}),(0,de.Y)(Ui,{defaultView:i,defaultBounds:a}),t]})};Zi.propTypes={children:s().node,height:s().oneOfType([s().string,s().number]),defaultView:s().shape({center:s().arrayOf(s().number),zoom:s().number}),defaultBounds:s().arrayOf(s().arrayOf(s().number))};const Xi=Zi,Ji=e=>null===e||"object"!=typeof e?e:Array.isArray(e)?e.map(Ji):Object.fromEntries(Object.entries(e).map((e=>{let[t,r]=e;return[t,Ji(r)]}))),Ki=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"general";try{if(!e||"object"!=typeof e)return null;const r=Ji(e);if(!r.type||!r.features)return null;return{type:"FeatureCollection",features:r.features.map((e=>{var r,i;const a={type:"Feature",properties:{...e.properties}||{},geometry:{...e.geometry}};switch(null!==(r=a.geometry)&&void 0!==r&&r.type&&(a.geometry.type=a.geometry.type.charAt(0).toUpperCase()+a.geometry.type.slice(1)),a.properties.name&&(a.properties.normalizedName=(0,Pt.YP)(a.properties.name),a.properties.originalName=a.properties.name),null!==(i=a.geometry)&&void 0!==i&&i.coordinates&&(a.geometry.coordinates=Qi(a.geometry.coordinates,a.geometry.type)),t){case"clusters":return ea(a);case"flows":return ta(a);case"shocks":return ra(a);case"autocorrelation":return ia(a);default:return a}})).filter(Boolean),crs:r.crs||{type:"name",properties:{name:"EPSG:4326"}}}}catch(e){return null}},Qi=(e,t)=>{if(!Array.isArray(e))return e;const r=e=>{let[t,r]=e;if("number"!=typeof t||"number"!=typeof r||isNaN(t)||isNaN(r)||Math.abs(r)>90)return null;const i=(e=>"number"!=typeof e||isNaN(e)?null:((e%=360)>180&&(e-=360),e<-180&&(e+=360),e))(t);return null===i?null:[i,r]};switch(t){case"Point":return r(e);case"LineString":return e.map(r).filter(Boolean);case"Polygon":return e.map((e=>e.map(r).filter(Boolean)));case"MultiPolygon":return e.map((e=>e.map((e=>e.map(r).filter(Boolean)))));default:return e}},ea=e=>{try{return{...e,properties:{...e.properties,cluster_id:e.properties.cluster_id||null,efficiency:e.properties.efficiency||0,market_count:e.properties.market_count||0}}}catch(t){return e}},ta=e=>{try{return{...e,properties:{...e.properties,flow_volume:e.properties.flow_volume||0,flow_direction:e.properties.flow_direction||"bidirectional",price_differential:e.properties.price_differential||0}}}catch(t){return e}},ra=e=>{try{return{...e,properties:{...e.properties,shock_magnitude:e.properties.shock_magnitude||0,shock_type:e.properties.shock_type||"unknown",affected_markets:e.properties.affected_markets||[]}}}catch(t){return e}},ia=e=>{try{return{...e,properties:{...e.properties,local_i:e.properties.local_i||0,p_value:e.properties.p_value||1,cluster_type:e.properties.cluster_type||"not-significant",z_score:e.properties.z_score||0}}}catch(t){return e}},aa={SEVERE:.25,MODERATE:.15,MILD:.1},na={DISTANCE:{HIGH:300,MEDIUM:150,LOW:50},TIME:{FAST:7,MEDIUM:14,SLOW:30}},oa={MIN_SHOCK_SIZE:6,MAX_SHOCK_SIZE:15,MIN_OPACITY:.6,MAX_OPACITY:1,PROPAGATION_OPACITY:.4,PROPAGATION_WEIGHT:2,SELECTION_SCALE:1.5,HOVER_SCALE:1.2,ANIMATION_DURATION:300},sa={PRICE_SURGE:"#d32f2f",PRICE_DROP:"#1976d2",VOLATILITY:"#ff9800",PROPAGATION:"#757575",SELECTED:"#ffc107",INACTIVE:"#bdbdbd"},la={filterShocksByDate:(e,t)=>{if(!Array.isArray(e)||!t)return[];const r=t.substring(0,7);return e.filter((e=>{if(!e||!e.date)return!1;return e.date.substring(0,7)===r}))},isValidShock:e=>{const t=e&&"object"==typeof e&&"string"==typeof e.region&&"string"==typeof e.date&&"number"==typeof e.magnitude&&!isNaN(e.magnitude)&&"string"==typeof e.shock_type&&["price_surge","price_drop"].includes(e.shock_type);return t},getShockMagnitude:e=>!e||"number"!=typeof e.magnitude||isNaN(e.magnitude)?0:e.magnitude,getShockSeverity:e=>"number"!=typeof e||isNaN(e)?"mild":e>=aa.SEVERE?"severe":e>=aa.MODERATE?"moderate":e>=aa.MILD?"mild":"insignificant",calculateShockMetrics:e=>{if(!Array.isArray(e))return null;const t=e.filter(la.isValidShock);if(!t.length)return null;const r=t.map(la.getShockMagnitude),i=r.reduce(((e,t)=>e+t),0)/r.length,a=Math.max(...r),n=Math.min(...r),o=r.reduce(((e,t)=>e+Math.pow(t-i,2)),0)/r.length,s=Math.sqrt(o),l=t.filter((e=>"price_surge"===e.shock_type)).length,c=t.filter((e=>"price_drop"===e.shock_type)).length;return{totalShocks:t.length,avgMagnitude:i,maxMagnitude:a,minMagnitude:n,stdDev:s,priceSurges:l,priceDrops:c,affectedRegions:new Set(t.map((e=>e.region))).size}}},ca=e=>{let{shocks:t,geometry:r,selectedRegion:a,onRegionSelect:n,height:o="100%"}=e;const s=(0,ge.A)(),l=(0,i.useMemo)((()=>({price_surge:oi.Ay.scale([sa.INACTIVE,sa.PRICE_SURGE]),price_drop:oi.Ay.scale([sa.INACTIVE,sa.PRICE_DROP])})),[]),c=(0,i.useMemo)((()=>{if(null==t||!t.length)return[];const e=t.filter(la.isValidShock),r=e.reduce(((e,t)=>{const r=la.getShockMagnitude(t);return e[t.shock_type]?e[t.shock_type]=Math.max(e[t.shock_type],r):e[t.shock_type]=r,e}),{});return e.map((e=>{const t=(0,Pt.ih)(e.region);if(!t)return null;const i=la.getShockMagnitude(e),a=i/r[e.shock_type],n=l[e.shock_type]||l.price_surge,o=la.getShockSeverity(i),s=oa.MIN_SHOCK_SIZE+a*(oa.MAX_SHOCK_SIZE-oa.MIN_SHOCK_SIZE),c=oa.MIN_OPACITY+a*(oa.MAX_OPACITY-oa.MIN_OPACITY);return{...e,coordinates:t,color:n(a).hex(),radius:s,opacity:c,normalizedMagnitude:a,severity:o}})).filter(Boolean)}),[t,l]),d=(0,i.useMemo)((()=>{var e;if(!r)return null;const t={type:"FeatureCollection",features:((null===(e=r.unified)||void 0===e?void 0:e.features)||[...r.polygons||[],...r.points||[]]).map((e=>{var t,r,i,a,n,o,s;return{type:"Feature",properties:{...e.properties,name:(null===(t=e.properties)||void 0===t?void 0:t.name)||"",normalizedName:(null===(r=e.properties)||void 0===r?void 0:r.normalizedName)||(0,Pt.YP)((null===(i=e.properties)||void 0===i?void 0:i.name)||""),region_id:(null===(a=e.properties)||void 0===a?void 0:a.region_id)||(null===(n=e.properties)||void 0===n?void 0:n.normalizedName)},geometry:{type:(null===(o=e.geometry)||void 0===o?void 0:o.type)||"Polygon",coordinates:(null===(s=e.geometry)||void 0===s?void 0:s.coordinates)||[]}}})),crs:{type:"name",properties:{name:"EPSG:4326"}}};return Ki(t,"shocks")}),[r]),u=(0,i.useCallback)((e=>{var t;if(null==e||null===(t=e.properties)||void 0===t||!t.normalizedName)return{};const r=a===e.properties.region_id,i=c.some((t=>(0,Pt.YP)(t.region)===e.properties.normalizedName));return{fillColor:i?sa.PROPAGATION:s.palette.grey[300],weight:r?2:1,opacity:1,color:r?sa.SELECTED:sa.INACTIVE,fillOpacity:i?oa.PROPAGATION_OPACITY:.3}}),[c,a,s]);return d?(0,de.FD)(ee.A,{sx:{height:o,position:"relative"},children:[(0,de.FD)(Xi,{height:o,children:[(0,de.Y)(_t.k,{data:d,style:u,onEachFeature:(e,t)=>{t.on({click:()=>n(e.properties.region_id)})}}),c.map(((e,t)=>(0,de.Y)(ni.p,{center:[e.coordinates[1],e.coordinates[0]],radius:e.radius,pathOptions:{fillColor:e.color,color:"white",weight:1,opacity:e.opacity,fillOpacity:.8*e.opacity},children:(0,de.Y)(Hi,{title:e.region,metrics:[{label:"Magnitude",value:e.magnitude,format:"percentage"},{label:"Severity",value:e.severity.toUpperCase()},{label:"Current Price",value:e.current_price,format:"number"},{label:"Previous Price",value:e.previous_price,format:"number"},{label:"Type",value:e.shock_type.replace("_"," ").toUpperCase()}]})},`shock-${t}`)))]}),(0,de.Y)(gi,{onZoomIn:()=>{},onZoomOut:()=>{},onReset:()=>{},onRefresh:()=>{}})]}):(0,de.Y)(ee.A,{sx:{height:o,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"background.paper",borderRadius:1},children:(0,de.Y)(se.A,{color:"text.secondary",children:"Invalid geometry data for visualization"})})};ca.propTypes={shocks:s().arrayOf(s().shape({region:s().string.isRequired,date:s().string.isRequired,magnitude:s().number,current_price:s().number,previous_price:s().number,shock_type:s().string})).isRequired,geometry:s().shape({unified:s().shape({features:s().array}),polygons:s().array,points:s().array}).isRequired,selectedRegion:s().string,onRegionSelect:s().func,height:s().oneOfType([s().string,s().number])};const da=i.memo(ca),ua=()=>{const e=(0,ge.A)(),t=[{type:"Price Surge",icon:(0,de.Y)(lt.A,{sx:{color:sa.PRICE_SURGE}}),color:sa.PRICE_SURGE,levels:[{label:"Severe",value:`>${(100*aa.SEVERE).toFixed(0)}%`,opacity:1},{label:"Moderate",value:`>${(100*aa.MODERATE).toFixed(0)}%`,opacity:.7}]},{type:"Price Drop",icon:(0,de.Y)(It.A,{sx:{color:sa.PRICE_DROP}}),color:sa.PRICE_DROP,levels:[{label:"Severe",value:`>${(100*aa.SEVERE).toFixed(0)}%`,opacity:1},{label:"Moderate",value:`>${(100*aa.MODERATE).toFixed(0)}%`,opacity:.7}]}];return(0,de.FD)($e.A,{elevation:2,sx:{position:"absolute",top:e.spacing(2),right:e.spacing(2),width:200,p:1.5,backgroundColor:"rgba(255, 255, 255, 0.95)",zIndex:400,border:`1px solid ${e.palette.divider}`,boxShadow:e.shadows[2]},children:[(0,de.Y)(se.A,{variant:"subtitle2",gutterBottom:!0,children:"Price Shocks"}),t.map(((e,t)=>(0,de.FD)(i.Fragment,{children:[t>0&&(0,de.Y)(Ce.A,{sx:{my:1}}),(0,de.FD)(ee.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[e.icon,(0,de.Y)(se.A,{variant:"body2",children:e.type})]}),e.levels.map(((t,r)=>(0,de.FD)(ee.A,{sx:{display:"flex",alignItems:"center",gap:1,ml:3,mt:.5},children:[(0,de.Y)(ee.A,{sx:{width:12,height:12,backgroundColor:e.color,borderRadius:"2px",opacity:t.opacity}}),(0,de.FD)(se.A,{variant:"caption",color:"textSecondary",children:[t.label," (",t.value,")"]})]},r)))]},t))),(0,de.Y)(Ce.A,{sx:{my:1}}),(0,de.FD)(ee.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,de.Y)(ee.A,{sx:{width:12,height:12,backgroundColor:sa.PROPAGATION,borderRadius:"2px"}}),(0,de.Y)(se.A,{variant:"caption",color:"textSecondary",children:"Affected Region"})]})]})},ma=i.memo(ua),ha=e=>{try{return null==e?void 0:e.substring(0,7)}catch(t){return e}},pa=e=>{let{dates:t,currentDate:r,onChange:a,autoPlayInterval:n=1e3,position:o=null}=e;const s=(0,ge.A)(),[l,c]=(0,i.useState)(!1),[d,u]=(0,i.useState)(1),[m,h]=(0,i.useState)(0),[p,g]=(0,i.useState)(r),y=(0,i.useMemo)((()=>t.map(ha)),[t]),f=(0,i.useMemo)((()=>ha(r)),[r]),v=(0,i.useMemo)((()=>(0,_.debounce)((e=>{a(e)}),150)),[a]);(0,i.useEffect)((()=>{const e=y.indexOf(f);e>=0?(h(e),g(f)):t.length>0&&(h(0),g(ha(t[0])),a(ha(t[0])))}),[r,t,f,y,a]);const b=(0,i.useCallback)((()=>{l&&h((e=>{const r=e+1;if(r>=t.length)return c(!1),0;const i=ha(t[r]);return g(i),v(i),r}))}),[l,t.length,v]);(0,i.useEffect)((()=>{let e;return l&&(e=setInterval(b,n/d)),()=>clearInterval(e)}),[l,n,d,b]);const A=(0,i.useCallback)(((e,r)=>{if(r!==m){const e=ha(t[r]);h(r),g(e),v(e)}}),[t,m,v]),w=(0,i.useCallback)((()=>{c((e=>!e))}),[]),x=(0,i.useCallback)((()=>{const e=Math.max(0,m-1);A(null,e)}),[m,A]),k=(0,i.useCallback)((()=>{const e=Math.min(t.length-1,m+1);A(null,e)}),[t.length,m,A]),S=(0,i.useCallback)((()=>{u((e=>4===e?1:2*e))}),[]);(0,i.useEffect)((()=>()=>{v.cancel()}),[v]);const M=(0,i.useMemo)((()=>(e=>{try{const t=`${ha(e)}-01`;return new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short"})}catch(t){return e}})(t[m])),[t,m]);return(0,de.Y)($e.A,{elevation:2,sx:{width:"100%",backgroundColor:s.palette.background.paper,borderRadius:1,p:2,...o&&{position:"absolute",zIndex:1e3,...o}},children:(0,de.FD)(ee.A,{sx:{width:"100%"},children:[(0,de.Y)(se.A,{variant:"subtitle2",color:"textPrimary",sx:{display:"block",mb:1,textAlign:"center",fontWeight:500},children:M}),(0,de.Y)(Di.Ay,{value:m,min:0,max:t.length-1,onChange:A,sx:{mb:2,"& .MuiSlider-thumb":{width:12,height:12}}}),(0,de.FD)(ee.A,{sx:{display:"flex",justifyContent:"center",gap:1,"& .MuiIconButton-root":{padding:1,"&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"}}},children:[(0,de.Y)(ie.A,{size:"small",onClick:x,disabled:0===m,title:"Previous",children:(0,de.Y)(Fi.A,{fontSize:"small"})}),(0,de.Y)(ie.A,{size:"small",onClick:w,title:l?"Pause":"Play",children:l?(0,de.Y)(Ri.A,{fontSize:"small"}):(0,de.Y)(Ii.A,{fontSize:"small"})}),(0,de.Y)(ie.A,{size:"small",onClick:k,disabled:m===t.length-1,title:"Next",children:(0,de.Y)(Ni.A,{fontSize:"small"})}),(0,de.FD)(ie.A,{size:"small",onClick:S,title:`Playback Speed: ${d}x`,sx:{position:"relative"},children:[(0,de.Y)(zi.A,{fontSize:"small"}),(0,de.FD)(se.A,{variant:"caption",sx:{position:"absolute",bottom:2,right:2,fontSize:"0.6rem",fontWeight:"bold",backgroundColor:s.palette.background.paper,borderRadius:"50%",width:12,height:12,display:"flex",alignItems:"center",justifyContent:"center"},children:[d,"x"]})]})]})]})})};pa.propTypes={dates:s().arrayOf(s().string).isRequired,currentDate:s().string.isRequired,onChange:s().func.isRequired,autoPlayInterval:s().number,position:s().shape({top:s().oneOfType([s().number,s().string]),right:s().oneOfType([s().number,s().string]),bottom:s().oneOfType([s().number,s().string]),left:s().oneOfType([s().number,s().string]),transform:s().string})};const ga=i.memo(pa,((e,t)=>e.currentDate===t.currentDate&&e.dates.length===t.dates.length&&e.autoPlayInterval===t.autoPlayInterval&&JSON.stringify(e.position)===JSON.stringify(t.position)));var ya=r(80903);const fa=e=>{var t;return null===(t=e.spatial)||void 0===t||null===(t=t.ui)||void 0===t?void 0:t.selectedDate},va=e=>{var t;return null===(t=e.spatial)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.geometry},ba=e=>{var t;return(null===(t=e.spatial)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.flowMaps)||[]},Aa=(0,ya._8)([e=>{var t;return(null===(t=e.spatial)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.timeSeriesData)||[]},fa],((e,t)=>e.length&&t?yi.Oz.filterFlowsByDate(e,t):[])),wa=(0,ya._8)([ba,fa],((e,t)=>{if(!Array.isArray(e)||!t)return[];return yi.Oz.filterFlowsByDate(e,t)})),_a=(0,ya._8)([wa],(e=>{if(!Array.isArray(e)||!e.length)return{flows:{total:0,average:0,count:0,maxFlow:0,minFlow:0,stdDev:0}};const t=yi.Oz.calculateFlowMetrics(e);return t?{flows:{total:t.totalFlow,average:t.avgFlow,count:t.count,maxFlow:t.maxFlow,minFlow:t.minFlow,stdDev:t.stdDev}}:null})),xa=(0,ya._8)([ba,fa],((e,t)=>{if(!Array.isArray(e))return{hasData:!1,dateRange:{start:null,end:null},lastUpdated:(new Date).toISOString(),totalFlows:0,dateFlows:0,uniqueDates:0};const r=e.filter(yi.Oz.isValidFlow),i=yi.Oz.filterFlowsByDate(r,t),a=[...new Set(r.map((e=>{var t;return null===(t=e.date)||void 0===t?void 0:t.substring(0,7)})))].sort();return{hasData:r.length>0,dateRange:{start:a[0]||null,end:a[a.length-1]||null},lastUpdated:(new Date).toISOString(),totalFlows:r.length,dateFlows:i.length,uniqueDates:a.length}})),ka=(0,ya._8)([e=>{var t;return(null===(t=e.spatial)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.marketShocks)||[]},fa],((e,t)=>e.length&&t?yi.Oz.filterFlowsByDate(e,t):[])),Sa=(0,ya._8)([ka],(e=>{if(!e.length)return{totalShocks:0,priceDrops:0,priceSurges:0,avgMagnitude:0,maxMagnitude:0,affectedRegions:[]};const t=e.filter((e=>"price_drop"===e.shock_type)),r=e.filter((e=>"price_surge"===e.shock_type)),i=e.reduce(((e,t)=>e+t.magnitude),0),a=i/e.length,n=Math.max(...e.map((e=>e.magnitude))),o=x().uniq(e.map((e=>e.region)));return{totalShocks:e.length,priceDrops:t.length,priceSurges:r.length,avgMagnitude:a,maxMagnitude:n,affectedRegions:o}})),Ma=(0,ya._8)([ka,va,Sa],((e,t,r)=>{if(!e.length||!t)return null;const i=e.reduce(((e,t)=>(e[t.region]||(e[t.region]=[]),e[t.region].push(t),e)),{}),a=Object.entries(i).map((e=>{let[t,r]=e;const i=r.length,a=r.reduce(((e,t)=>e+t.magnitude),0);return{region:t,shockCount:i,avgMagnitude:a/i,maxMagnitude:Math.max(...r.map((e=>e.magnitude))),priceDrops:r.filter((e=>"price_drop"===e.shock_type)).length,priceSurges:r.filter((e=>"price_surge"===e.shock_type)).length}}));return{shocks:e,geometry:t,metrics:r,regionalMetrics:a,shocksByRegion:i}})),Ca=(0,ya._8)([Aa],(e=>{if(!e.length)return{avgPrice:0,maxPrice:0,minPrice:0,priceRange:0,avgConflict:0,maxConflict:0};const t=e.map((e=>e.usdPrice||0)),r=e.map((e=>e.conflictIntensity||0)),i=t.reduce(((e,t)=>e+t),0)/t.length,a=Math.max(...t),n=Math.min(...t),o=a-n,s=r.reduce(((e,t)=>e+t),0)/r.length;return{avgPrice:i,maxPrice:a,minPrice:n,priceRange:o,avgConflict:s,maxConflict:Math.max(...r)}})),Ya=(0,ya._8)([Ma,va],((e,t)=>e&&t?{...e,geometry:t}:null)),Da=((0,ya._8)([Aa,wa,_a,xa,Ma,Ca,Ya],((e,t,r,i,a,n,o)=>({dateFilteredData:e,dateFilteredFlows:t,dateFilteredMetrics:r,flowDataStatus:i,shockAnalysisData:a,timeSeriesMetrics:n,comprehensiveShockAnalysis:o}))),()=>{(0,ge.A)();const e=(0,n.wA)(),[t,r]=(0,i.useState)(null),[a,o]=(0,i.useState)(!1),s=(0,n.d4)((e=>e.spatial.data.geometry)),l=(0,n.d4)((e=>e.spatial.data.timeSeriesData||[])),c=(0,n.d4)((e=>e.spatial.status.loading)),u=(0,n.d4)((e=>e.spatial.status.error)),m=(0,n.d4)((e=>e.spatial.ui.selectedDate)),h=(0,n.d4)((e=>ka(e))),p=(0,n.d4)((e=>Sa(e))),g=(0,n.d4)((e=>Ma(e))),y=i.useMemo((()=>null!=l&&l.length?[...new Set(l.map((e=>e.month)))].sort():[]),[l]);return c?(0,de.Y)(ee.A,{sx:{display:"flex",justifyContent:"center",p:3},children:(0,de.Y)(se.A,{children:"Loading shock analysis..."})}):u?(0,de.Y)(Ke.A,{severity:"error",sx:{m:2},children:u}):(0,de.FD)(ze.Ay,{container:!0,spacing:2,children:[(0,de.Y)(ze.Ay,{item:!0,xs:12,children:(0,de.FD)(ze.Ay,{container:!0,spacing:2,children:[(0,de.Y)(ze.Ay,{item:!0,xs:12,md:3,children:(0,de.Y)(Ft,{title:"Total Shocks",value:p.totalShocks,format:"integer",description:"Number of detected price shocks"})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,md:3,children:(0,de.Y)(Ft,{title:"Price Drops",value:p.priceDrops,format:"integer",description:"Number of price drop shocks"})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,md:3,children:(0,de.Y)(Ft,{title:"Price Surges",value:p.priceSurges,format:"integer",description:"Number of price surge shocks"})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,md:3,children:(0,de.Y)(Ft,{title:"Average Magnitude",value:p.avgMagnitude,format:"percentage",description:"Average shock magnitude"})})]})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,children:(0,de.Y)($e.A,{sx:{p:2},children:y.length>0&&(0,de.Y)(ee.A,{sx:{width:"100%"},children:(0,de.Y)(ga,{dates:y,currentDate:m||y[0],onChange:t=>{e((0,d.un)(t))},position:null})})})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,children:(0,de.Y)($e.A,{sx:{p:2,height:600,position:"relative",overflow:"hidden"},children:(0,de.FD)(ee.A,{sx:{position:"relative",width:"100%",height:"100%"},children:[(0,de.Y)(da,{shocks:h,geometry:s,selectedRegion:t,onRegionSelect:r}),(0,de.Y)(ma,{})]})})}),(null==g?void 0:g.regionalMetrics)&&g.regionalMetrics.length>0&&(0,de.Y)(ze.Ay,{item:!0,xs:12,children:(0,de.FD)($e.A,{sx:{p:2},children:[(0,de.Y)(se.A,{variant:"h6",gutterBottom:!0,children:"Regional Impact Analysis"}),(0,de.Y)(ze.Ay,{container:!0,spacing:2,children:g.regionalMetrics.map((e=>(0,de.Y)(ze.Ay,{item:!0,xs:12,md:4,children:(0,de.FD)($e.A,{sx:{p:2,bgcolor:e.region===t?"action.selected":"background.paper"},children:[(0,de.Y)(se.A,{variant:"subtitle1",gutterBottom:!0,children:e.region}),(0,de.FD)(gt.A,{dense:!0,children:[(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:`Shocks: ${e.shockCount}`,secondary:`${e.priceDrops} drops, ${e.priceSurges} surges`})}),(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:`Average Magnitude: ${e.avgMagnitude.toFixed(1)}%`,secondary:`Max: ${e.maxMagnitude.toFixed(1)}%`})})]})]})},e.region)))})]})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,children:(0,de.FD)($e.A,{sx:{p:2},children:[(0,de.Y)(Se.A,{fullWidth:!0,onClick:()=>o(!a),endIcon:a?(0,de.Y)(bt.A,{}):(0,de.Y)(vt.A,{}),startIcon:(0,de.Y)(ft.A,{}),children:"Methodology"}),(0,de.Y)(pt.A,{in:a,children:(0,de.FD)(ee.A,{sx:{mt:2,p:2},children:[(0,de.Y)(se.A,{variant:"body2",paragraph:!0,children:"This analysis employs advanced statistical methods to identify and analyze price shocks across Yemen's market network. The methodology combines temporal price analysis with spatial propagation patterns to understand market vulnerabilities and shock transmission mechanisms."}),(0,de.FD)(gt.A,{dense:!0,children:[(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:(0,de.Y)(se.A,{variant:"subtitle2",color:"primary",children:"Shock Detection"}),secondary:(0,de.Y)(se.A,{variant:"body2",color:"textSecondary",children:"Identifies significant price changes using statistical thresholds, accounting for historical volatility and seasonal patterns"})})}),(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:(0,de.Y)(se.A,{variant:"subtitle2",color:"primary",children:"Propagation Analysis"}),secondary:(0,de.Y)(se.A,{variant:"body2",color:"textSecondary",children:"Tracks shock transmission through market networks using spatial econometric techniques and network analysis"})})}),(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:(0,de.Y)(se.A,{variant:"subtitle2",color:"primary",children:"Impact Assessment"}),secondary:(0,de.Y)(se.A,{variant:"body2",color:"textSecondary",children:"Evaluates market resilience and vulnerability through shock magnitude, duration, and geographic spread metrics"})})})]}),(0,de.Y)(se.A,{variant:"subtitle2",gutterBottom:!0,sx:{mt:2},color:"primary",children:"Shock Classification:"}),(0,de.FD)(se.A,{variant:"body2",component:"div",children:["• Severe Shock (>",100*aa.SEVERE,"%): Major market disruption",(0,de.Y)("br",{}),"• Moderate Shock (",100*aa.MODERATE,"-",100*aa.SEVERE,"%): Significant price movement",(0,de.Y)("br",{}),"• Mild Shock (",100*aa.MILD,"-",100*aa.MODERATE,"%): Notable price deviation"]}),(0,de.Y)(se.A,{variant:"subtitle2",gutterBottom:!0,sx:{mt:2},color:"primary",children:"Propagation Speed:"}),(0,de.FD)(se.A,{variant:"body2",component:"div",children:["• Fast (<",na.TIME.FAST," days): Rapid shock transmission",(0,de.Y)("br",{}),"• Medium (",na.TIME.FAST,"-",na.TIME.MEDIUM," days): Gradual spread",(0,de.Y)("br",{}),"• Slow (>",na.TIME.MEDIUM," days): Delayed impact"]})]})})]})})]})}),Ia=i.memo(Da);var Ra=r(6119);const Fa=e=>{let{timeSeriesData:t,geometry:r,selectedRegion:a,onRegionSelect:n,timeWindow:o,height:s="100%"}=e;const l=(0,ge.A)(),c=(0,i.useMemo)((()=>oi.Ay.scale(["#fee5d9","#a50f15"]).domain([0,1])),[]),d=(0,i.useMemo)((()=>oi.Ay.scale(["#edf8e9","#006d2c"]).domain([0,1])),[]),u=(0,i.useMemo)((()=>{if(null==t||!t.length)return null;const e=o?t.filter((e=>e.month===o)):t;if(!e.length)return null;const r=Math.max(...e.map((e=>e.conflictIntensity||0))),i=Math.max(...e.map((e=>e.usdPrice||0)));return e.map((e=>{const t=(0,Pt.ih)(e.region);if(!t)return null;const a=r>0?(e.conflictIntensity||0)/r:0,n=i>0?(e.usdPrice||0)/i:0;return{...e,coordinates:t,normalizedIntensity:a,normalizedPrice:n,conflictColor:c(a).hex(),marketColor:d(n).hex()}})).filter(Boolean)}),[t,o,c,d]),m=(0,i.useMemo)((()=>{var e;if(!r)return null;const t={type:"FeatureCollection",features:((null===(e=r.unified)||void 0===e?void 0:e.features)||[...r.polygons||[],...r.points||[]]).map((e=>{var t,r,i,a,n,o,s;return{type:"Feature",properties:{...e.properties,name:(null===(t=e.properties)||void 0===t?void 0:t.name)||"",normalizedName:(null===(r=e.properties)||void 0===r?void 0:r.normalizedName)||(0,Pt.YP)((null===(i=e.properties)||void 0===i?void 0:i.name)||""),region_id:(null===(a=e.properties)||void 0===a?void 0:a.region_id)||(null===(n=e.properties)||void 0===n?void 0:n.normalizedName)},geometry:{type:(null===(o=e.geometry)||void 0===o?void 0:o.type)||"Polygon",coordinates:(null===(s=e.geometry)||void 0===s?void 0:s.coordinates)||[]}}})),crs:{type:"name",properties:{name:"EPSG:4326"}}};return Ki(t,"conflict")}),[r]),h=(0,i.useCallback)((e=>{if(!u)return{};const t=u.find((t=>(0,Pt.YP)(t.region)===e.properties.normalizedName)),r=a===e.properties.region_id;return{fillColor:(null==t?void 0:t.conflictColor)||l.palette.grey[300],weight:r?2:1,opacity:1,color:r?l.palette.secondary.main:"white",fillOpacity:t?.7:.3}}),[u,a,l]),p=(0,i.useMemo)((()=>[{color:"#a50f15",label:"High Conflict"},{color:"#fee5d9",label:"Low Conflict"},{color:l.palette.secondary.main,label:"Selected Region",style:{borderWidth:2}},{color:"#006d2c",label:"High Market Activity",style:{borderRadius:"50%"}},{color:"#edf8e9",label:"Low Market Activity",style:{borderRadius:"50%"}}]),[l]);return u&&m?(0,de.FD)(ee.A,{sx:{height:s,position:"relative"},children:[(0,de.FD)(Xi,{height:s,children:[(0,de.Y)(_t.k,{data:m,style:h,onEachFeature:(e,t)=>{t.on({click:()=>n(e.properties.region_id)});const r=u.find((t=>(0,Pt.YP)(t.region)===e.properties.normalizedName));r&&t.bindTooltip((()=>(0,de.Y)(Hi,{title:e.properties.originalName,metrics:[{label:"Conflict Intensity",value:r.conflictIntensity,format:"number"},{label:"Market Price",value:r.usdPrice,format:"currency"},{label:"Market Status",value:r.conflictIntensity>.5?"Severely Affected":"Operational"}]})),{sticky:!0})}}),u.map(((e,t)=>(0,de.Y)(ni.p,{center:[e.coordinates[1],e.coordinates[0]],radius:6,pathOptions:{fillColor:e.marketColor,color:"white",weight:1,opacity:.8,fillOpacity:.6},children:(0,de.Y)(Hi,{title:e.region,metrics:[{label:"Market Price",value:e.usdPrice,format:"currency"},{label:"Price Change",value:e.priceChange,format:"percentage"},{label:"Market Status",value:e.marketStatus}]})},t)))]}),(0,de.Y)(gi,{onZoomIn:()=>{},onZoomOut:()=>{},onReset:()=>{},onRefresh:()=>{}}),(0,de.Y)(di,{title:"Conflict Impact",items:p})]}):(0,de.Y)(ee.A,{sx:{height:s,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"background.paper",borderRadius:1},children:(0,de.Y)(se.A,{color:"text.secondary",children:"No conflict data available for visualization"})})};Fa.propTypes={timeSeriesData:s().arrayOf(s().shape({month:s().string.isRequired,region:s().string.isRequired,conflictIntensity:s().number,usdPrice:s().number})).isRequired,geometry:s().shape({unified:s().shape({features:s().array}),polygons:s().array,points:s().array}).isRequired,selectedRegion:s().string,onRegionSelect:s().func,timeWindow:s().string,height:s().oneOfType([s().string,s().number])};const Na=i.memo(Fa),za=e=>{let{timeSeriesData:t,selectedRegion:r,timeWindow:a,marketIntegration:n}=e;const o=(0,ge.A)(),s=(0,i.useMemo)((()=>{var e;if(!r||null==t||!t.length)return{currentIntensity:0,intensityTrend:0,currentPrice:0,priceTrend:0,accessibility:0,resilience:0,riskLevel:0};const i=t.filter((e=>e.region===r)).sort(((e,t)=>new Date(e.month)-new Date(t.month)));if(!i.length)return{currentIntensity:0,intensityTrend:0,currentPrice:0,priceTrend:0,accessibility:0,resilience:0,riskLevel:0};const o=i.find((e=>e.month===a))||i[i.length-1],s=i[i.length-2],l=(null==o?void 0:o.conflictIntensity)||0,c=(null==s?void 0:s.conflictIntensity)||0,d=(null==o?void 0:o.usdPrice)||0,u=(null==s?void 0:s.usdPrice)||0,m=(null==n||null===(e=n.accessibility)||void 0===e?void 0:e[r])||0,h=c?(l-c)/c*100:0,p=u?(d-u)/u*100:0,g=Ea(l,m,p);return{currentIntensity:Math.max(0,Math.min(1,l)),intensityTrend:Math.max(-100,Math.min(100,h)),currentPrice:Math.max(0,d),priceTrend:Math.max(-100,Math.min(100,p)),accessibility:Math.max(0,Math.min(1,m)),resilience:Math.max(0,Math.min(1,g)),riskLevel:Ta(l,m)}}),[r,t,a,n]),l=(0,i.useMemo)((()=>{if(!r||null==t||!t.length)return{volatility:0,trend:0,duration:0,peakIntensity:0};const e=t.filter((e=>e.region===r)).sort(((e,t)=>new Date(e.month)-new Date(t.month)));var i;if(e.length<2)return{volatility:0,trend:0,duration:e.length,peakIntensity:(null===(i=e[0])||void 0===i?void 0:i.conflictIntensity)||0};const a=e.map((e=>e.conflictIntensity||0)),n=a.reduce(((e,t)=>e+t),0)/a.length||1,o=a.reduce(((e,t)=>e+Math.pow(t-n,2)),0)/a.length,s=n?Math.sqrt(o)/n:0,l=e.slice(-6),c=Pa(l);return{volatility:Math.max(0,Math.min(1,s)),trend:Math.max(-100,Math.min(100,c)),duration:e.length,peakIntensity:Math.max(0,Math.min(1,Math.max(...a)))}}),[r,t]),c={currentIntensity:(null==s?void 0:s.currentIntensity)||0,intensityTrend:(null==s?void 0:s.intensityTrend)||0,accessibility:(null==s?void 0:s.accessibility)||0,resilience:(null==s?void 0:s.resilience)||0,riskLevel:(null==s?void 0:s.riskLevel)||0};return r?s?(0,de.FD)($e.A,{sx:{p:2,height:"100%"},children:[(0,de.FD)(se.A,{variant:"h6",gutterBottom:!0,children:[r," Impact Analysis"]}),(0,de.FD)(ze.Ay,{container:!0,spacing:2,children:[(0,de.Y)(ze.Ay,{item:!0,xs:12,children:(0,de.Y)(Tt,{title:"Conflict Impact",value:c.currentIntensity,target:.5,format:"percentage",description:"Current conflict intensity level",trend:c.intensityTrend})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,md:6,children:(0,de.Y)(Ft,{title:"Market Accessibility",value:c.accessibility,format:"percentage",description:"Current market access level"})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,md:6,children:(0,de.Y)(Ft,{title:"Market Resilience",value:c.resilience,format:"percentage",description:"Market adaptation capacity"})})]}),(0,de.Y)(Ce.A,{sx:{my:2}}),(0,de.Y)(se.A,{variant:"subtitle2",gutterBottom:!0,children:"Risk Assessment"}),(0,de.FD)(ee.A,{sx:{mb:2},children:[(0,de.FD)(ee.A,{sx:{display:"flex",alignItems:"center",mb:1},children:[(0,de.Y)(ct.A,{sx:{color:Oa(s.riskLevel,o),mr:1}}),(0,de.Y)(se.A,{variant:"body2",children:$a(s.riskLevel)})]}),(0,de.Y)(Nt.A,{variant:"determinate",value:100*s.riskLevel,sx:{height:8,borderRadius:4,backgroundColor:o.palette.grey[200],"& .MuiLinearProgress-bar":{backgroundColor:Oa(s.riskLevel,o)}}})]}),l&&(0,de.FD)(de.FK,{children:[(0,de.Y)(se.A,{variant:"subtitle2",gutterBottom:!0,children:"Temporal Patterns"}),(0,de.FD)(ze.Ay,{container:!0,spacing:2,children:[(0,de.Y)(ze.Ay,{item:!0,xs:6,children:(0,de.FD)(ee.A,{children:[(0,de.Y)(se.A,{variant:"caption",color:"textSecondary",children:"Volatility"}),(0,de.FD)(se.A,{variant:"body1",children:[(100*l.volatility).toFixed(1),"%"]})]})}),(0,de.Y)(ze.Ay,{item:!0,xs:6,children:(0,de.FD)(ee.A,{children:[(0,de.Y)(se.A,{variant:"caption",color:"textSecondary",children:"Duration"}),(0,de.FD)(se.A,{variant:"body1",children:[l.duration," months"]})]})})]}),(0,de.FD)(ee.A,{sx:{mt:2},children:[(0,de.Y)(se.A,{variant:"caption",color:"textSecondary",children:"Trend Analysis"}),(0,de.FD)(ee.A,{sx:{display:"flex",alignItems:"center",color:l.trend>0?o.palette.error.main:o.palette.success.main},children:[l.trend>0?(0,de.Y)(lt.A,{sx:{mr:1}}):(0,de.Y)(It.A,{sx:{mr:1}}),(0,de.FD)(se.A,{variant:"body2",children:[Math.abs(l.trend).toFixed(1),"% per month"]})]})]})]}),(0,de.FD)(ee.A,{sx:{mt:2,p:1.5,bgcolor:o.palette.grey[50],borderRadius:1},children:[(0,de.Y)(se.A,{variant:"subtitle2",gutterBottom:!0,children:"Impact Summary"}),(0,de.Y)(se.A,{variant:"body2",color:"textSecondary",children:La(s,l)})]})]}):(0,de.Y)($e.A,{sx:{p:2,height:"100%"},children:(0,de.Y)(se.A,{color:"textSecondary",align:"center",children:"No metrics available for selected region"})}):(0,de.Y)($e.A,{sx:{p:2,height:"100%"},children:(0,de.Y)(se.A,{color:"textSecondary",align:"center",children:"Select a region to view conflict impact metrics"})})},Ea=(e,t,r)=>(t*(1-e)+(1-Math.min(Math.abs(r)/100,1)))/2,Ta=(e,t)=>Math.min(e*(1-t)*1.5,1),Pa=e=>{if(e.length<2)return 0;const t=e[0].conflictIntensity||0,r=e[e.length-1].conflictIntensity||0,i=e.length-1;return i>0?(r-t)/t*(100/i):0},Oa=(e,t)=>e>=.7?t.palette.error.main:e>=.4?t.palette.warning.main:t.palette.success.main,$a=e=>e>=.7?"High Risk - Severe Market Disruption":e>=.4?"Medium Risk - Significant Impact":"Low Risk - Manageable Impact",La=(e,t)=>{const r=[];return e.currentIntensity>.7?r.push("Severe conflict impact with critical market disruption."):e.currentIntensity>.4?r.push("Moderate conflict impact affecting market operations."):r.push("Limited conflict impact with maintained market function."),t&&(t.trend>0?r.push("Deteriorating conditions require immediate attention."):r.push("Showing signs of stability or improvement.")),e.resilience>.6?r.push("Markets demonstrate strong resilience."):r.push("Support needed to enhance market resilience."),r.join(" ")};za.propTypes={timeSeriesData:s().arrayOf(s().shape({month:s().string.isRequired,region:s().string.isRequired,conflictIntensity:s().number,usdPrice:s().number})).isRequired,selectedRegion:s().string,timeWindow:s().string.isRequired,marketIntegration:s().shape({accessibility:s().object})};const ja=i.memo(za),qa=()=>{(0,ge.A)();const e=(0,n.wA)(),[t,r]=(0,i.useState)("map"),[a,o]=(0,i.useState)(null),s=(0,n.d4)((e=>e.spatial.data.geometry)),l=(0,n.d4)((e=>e.spatial.data.timeSeriesData||[])),c=(0,n.d4)((e=>e.spatial.data.marketIntegration||{})),u=(0,n.d4)((e=>e.spatial.status.loading)),m=(0,n.d4)((e=>e.spatial.status.error)),h=(0,n.d4)((e=>e.spatial.ui.selectedDate)),p=(0,n.d4)((e=>Aa(e))),g=(0,n.d4)((e=>Ca(e))),y=(0,i.useMemo)((()=>null!=l&&l.length?[...new Set(l.map((e=>e.month)))].sort():[]),[l]);return u?(0,de.Y)(ee.A,{sx:{display:"flex",justifyContent:"center",p:3},children:(0,de.Y)(se.A,{children:"Loading conflict analysis..."})}):m?(0,de.Y)(Ke.A,{severity:"error",sx:{m:2},children:m}):(0,de.FD)(ze.Ay,{container:!0,spacing:2,children:[(0,de.Y)(ze.Ay,{item:!0,xs:12,children:(0,de.FD)(ze.Ay,{container:!0,spacing:2,children:[(0,de.Y)(ze.Ay,{item:!0,xs:12,md:3,children:(0,de.Y)(Ft,{title:"Average Price",value:g.avgPrice,format:"currency",description:"Average market price"})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,md:3,children:(0,de.Y)(Ft,{title:"Price Range",value:g.priceRange,format:"currency",description:"Price range (max - min)"})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,md:3,children:(0,de.Y)(Ft,{title:"Conflict Intensity",value:g.avgConflict,format:"number",description:"Average conflict intensity"})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,md:3,children:(0,de.Y)(Ft,{title:"Market Accessibility",value:(null==c?void 0:c.accessibility)||0,format:"percentage",description:"Average market accessibility"})})]})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,children:(0,de.FD)($e.A,{sx:{p:2},children:[(0,de.Y)(ee.A,{sx:{mb:y.length>0?2:0},children:(0,de.FD)(Le.A,{value:t,exclusive:!0,onChange:(e,t)=>t&&r(t),size:"small",children:[(0,de.FD)(je.A,{value:"map",children:[(0,de.Y)(nt.A,{sx:{mr:1}}),"Impact Map"]}),(0,de.FD)(je.A,{value:"timeline",children:[(0,de.Y)(ot.A,{sx:{mr:1}}),"Time Analysis"]}),(0,de.FD)(je.A,{value:"metrics",children:[(0,de.Y)(Ra.A,{sx:{mr:1}}),"Detailed Metrics"]})]})}),y.length>0&&(0,de.FD)(de.FK,{children:[(0,de.Y)(Ce.A,{sx:{my:2}}),(0,de.Y)(ee.A,{sx:{width:"100%"},children:(0,de.Y)(ga,{dates:y,currentDate:h||y[0],onChange:t=>{e((0,d.un)(t))},position:null})})]})]})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,md:8,children:(0,de.Y)($e.A,{sx:{p:2,height:600},children:(0,de.Y)(Na,{timeSeriesData:p,geometry:s,selectedRegion:a,onRegionSelect:o,timeWindow:h||y[0]})})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,md:4,children:(0,de.Y)(ja,{timeSeriesData:p,selectedRegion:a,marketIntegration:c,timeWindow:h||y[0]})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,children:(0,de.FD)($e.A,{sx:{p:2},children:[(0,de.Y)(se.A,{variant:"h6",gutterBottom:!0,children:"About Conflict Impact Analysis"}),(0,de.Y)(se.A,{paragraph:!0,children:"This analysis examines how conflict affects market dynamics in Yemen, revealing patterns of market disruption and resilience in conflict zones."}),(0,de.FD)(ze.Ay,{container:!0,spacing:2,children:[(0,de.FD)(ze.Ay,{item:!0,xs:12,md:4,children:[(0,de.Y)(se.A,{variant:"subtitle2",gutterBottom:!0,children:"Impact Assessment"}),(0,de.FD)(gt.A,{dense:!0,children:[(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:"Market accessibility changes"})}),(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:"Price volatility in conflict zones"})}),(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:"Supply chain disruptions"})}),(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:"Market isolation patterns"})})]})]}),(0,de.FD)(ze.Ay,{item:!0,xs:12,md:4,children:[(0,de.Y)(se.A,{variant:"subtitle2",gutterBottom:!0,children:"Resilience Factors"}),(0,de.FD)(gt.A,{dense:!0,children:[(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:"Alternative trade routes"})}),(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:"Market adaptation strategies"})}),(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:"Community support networks"})}),(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:"Recovery patterns"})})]})]}),(0,de.FD)(ze.Ay,{item:!0,xs:12,md:4,children:[(0,de.Y)(se.A,{variant:"subtitle2",gutterBottom:!0,children:"Response Planning"}),(0,de.FD)(gt.A,{dense:!0,children:[(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:"Critical market identification"})}),(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:"Intervention prioritization"})}),(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:"Resource allocation"})}),(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:"Support strategy development"})})]})]})]})]})})]})},Wa=i.memo(qa);var Va=r(9542);const Ha=e=>{let{timeSeriesData:t,geometry:r,selectedRegion:a,onRegionSelect:n,selectedMonth:o,seasonalMetrics:s,height:l="100%"}=e;const c=(0,ge.A)(),d=(0,i.useMemo)((()=>oi.Ay.scale(["#edf8e9","#006d2c"]).domain([0,1])),[]),u=(0,i.useMemo)((()=>oi.Ay.scale(["#f7fbff","#08519c"]).domain([0,1])),[]),m=(0,i.useMemo)((()=>{if(null==t||!t.length)return null;const e=o?t.filter((e=>e.month===o)):t;if(!e.length)return null;const r=Math.max(...e.map((e=>e.usdPrice||0))),i=(null==s?void 0:s.seasonalStrength)||1;return e.map((e=>{var t;const a=(0,Pt.ih)(e.region);if(!a)return null;const n=(null==s||null===(t=s.regionalPatterns)||void 0===t?void 0:t[e.region])||{seasonalStrength:0,meanPrice:0,variance:0},o=r>0?(e.usdPrice||0)/r:0,l=i>0?n.seasonalStrength/i:0;return{...e,coordinates:a,normalizedPrice:o,normalizedSeasonality:l,priceColor:d(o).hex(),seasonalityColor:u(l).hex(),seasonalMetrics:n}})).filter(Boolean)}),[t,o,s,d,u]),h=(0,i.useMemo)((()=>{var e;if(!r)return null;const t={type:"FeatureCollection",features:((null===(e=r.unified)||void 0===e?void 0:e.features)||[...r.polygons||[],...r.points||[]]).map((e=>{var t,r,i,a,n,o,s;return{type:"Feature",properties:{...e.properties,name:(null===(t=e.properties)||void 0===t?void 0:t.name)||"",normalizedName:(null===(r=e.properties)||void 0===r?void 0:r.normalizedName)||(0,Pt.YP)((null===(i=e.properties)||void 0===i?void 0:i.name)||""),region_id:(null===(a=e.properties)||void 0===a?void 0:a.region_id)||(null===(n=e.properties)||void 0===n?void 0:n.normalizedName)},geometry:{type:(null===(o=e.geometry)||void 0===o?void 0:o.type)||"Polygon",coordinates:(null===(s=e.geometry)||void 0===s?void 0:s.coordinates)||[]}}})),crs:{type:"name",properties:{name:"EPSG:4326"}}};return Ki(t,"seasonal")}),[r]),p=(0,i.useCallback)((e=>{if(!m)return{};const t=m.find((t=>(0,Pt.YP)(t.region)===e.properties.normalizedName)),r=a===e.properties.region_id;return{fillColor:(null==t?void 0:t.seasonalityColor)||c.palette.grey[300],weight:r?2:1,opacity:1,color:r?c.palette.secondary.main:"white",fillOpacity:t?.7:.3}}),[m,a,c]),g=(0,i.useMemo)((()=>[{color:"#006d2c",label:"High Price"},{color:"#edf8e9",label:"Low Price"},{color:"#08519c",label:"Strong Seasonality"},{color:"#f7fbff",label:"Weak Seasonality"},{color:c.palette.secondary.main,label:"Selected Region",style:{borderWidth:2}}]),[c]);return m&&h?(0,de.FD)(ee.A,{sx:{height:l,position:"relative"},children:[(0,de.FD)(Xi,{height:l,children:[(0,de.Y)(_t.k,{data:h,style:p,onEachFeature:(e,t)=>{t.on({click:()=>n(e.properties.region_id)});const r=m.find((t=>(0,Pt.YP)(t.region)===e.properties.normalizedName));r&&t.bindTooltip((()=>(0,de.Y)(Hi,{title:e.properties.originalName,metrics:[{label:"Current Price",value:r.usdPrice,format:"currency"},{label:"Seasonality",value:r.seasonalMetrics.seasonalStrength,format:"percentage"},{label:"Price Trend",value:r.priceChange,format:"percentage"}]})),{sticky:!0})}}),m.map(((e,t)=>(0,de.Y)(ni.p,{center:[e.coordinates[1],e.coordinates[0]],radius:6,pathOptions:{fillColor:e.priceColor,color:"white",weight:1,opacity:.8,fillOpacity:.6},children:(0,de.Y)(Hi,{title:e.region,metrics:[{label:"Market Price",value:e.usdPrice,format:"currency"},{label:"Seasonal Pattern",value:e.seasonalMetrics.seasonalStrength>.5?"Strong":"Weak"},{label:"Monthly Change",value:e.priceChange,format:"percentage"}]})},t)))]}),(0,de.Y)(gi,{onZoomIn:()=>{},onZoomOut:()=>{},onReset:()=>{},onRefresh:()=>{}}),(0,de.Y)(di,{title:"Seasonal Patterns",items:g})]}):(0,de.Y)(ee.A,{sx:{height:l,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"background.paper",borderRadius:1},children:(0,de.Y)(se.A,{color:"text.secondary",children:"No seasonal data available for visualization"})})};Ha.propTypes={timeSeriesData:s().arrayOf(s().shape({month:s().string.isRequired,region:s().string.isRequired,usdPrice:s().number})).isRequired,geometry:s().shape({unified:s().shape({features:s().array}),polygons:s().array,points:s().array}).isRequired,selectedRegion:s().string,onRegionSelect:s().func,selectedMonth:s().string,seasonalMetrics:s().shape({seasonalStrength:s().number,trendStrength:s().number,seasonalPattern:s().arrayOf(s().number),regionalPatterns:s().object}),height:s().oneOfType([s().string,s().number])};const Ba=i.memo(Ha),Ga=e=>{let{seasonalMetrics:t,selectedMonth:r,selectedRegion:a,timeSeriesData:n}=e;const o=(0,ge.A)(),s=r?new Date(r).toLocaleString("default",{month:"long"}):"",{peakMonth:l,troughMonth:c}=(0,i.useMemo)((()=>{if(null==n||!n.length)return{peakMonth:{month:0,avgPrice:0},troughMonth:{month:0,avgPrice:0}};const e=n.reduce(((e,t)=>{const r=new Date(t.month).getMonth();return e[r]||(e[r]=[]),e[r].push(t.usdPrice||0),e}),{}),t=Object.entries(e).map((e=>{let[t,r]=e;return{month:parseInt(t),avgPrice:r.reduce(((e,t)=>e+t),0)/r.length}}));return{peakMonth:t.reduce(((e,t)=>t.avgPrice>e.avgPrice?t:e),t[0]),troughMonth:t.reduce(((e,t)=>t.avgPrice<e.avgPrice?t:e),t[0])}}),[n]);return(0,de.FD)($e.A,{elevation:2,sx:{height:"100%",p:2,display:"flex",flexDirection:"column"},children:[(0,de.FD)(ee.A,{sx:{mb:2},children:[(0,de.Y)(se.A,{variant:"subtitle2",gutterBottom:!0,children:"Selected Period"}),(0,de.FD)(ee.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,de.Y)(dt.A,{color:"primary"}),(0,de.Y)(se.A,{children:s||"No month selected"})]})]}),(0,de.Y)(Ce.A,{sx:{my:1.5}}),(0,de.FD)(ee.A,{sx:{mb:2},children:[(0,de.Y)(se.A,{variant:"subtitle2",gutterBottom:!0,children:"Seasonal Patterns"}),[{label:"Strong Seasonal",color:"#08519c",description:"Clear and consistent annual patterns",threshold:"> 70%"},{label:"Moderate Seasonal",color:"#3182bd",description:"Notable but variable patterns",threshold:"40-70%"},{label:"Weak Seasonal",color:"#9ecae1",description:"Limited seasonal influence",threshold:"20-40%"},{label:"Non-Seasonal",color:"#f7fbff",description:"No clear seasonal patterns",threshold:"< 20%"}].map(((e,t)=>(0,de.FD)(ee.A,{sx:{display:"flex",alignItems:"flex-start",gap:1,mt:1},children:[(0,de.Y)(ee.A,{sx:{width:20,height:20,backgroundColor:e.color,borderRadius:"2px",border:`1px solid ${o.palette.divider}`,flexShrink:0,mt:.5}}),(0,de.FD)(ee.A,{children:[(0,de.Y)(se.A,{variant:"body2",children:e.label}),(0,de.Y)(se.A,{variant:"caption",color:"textSecondary",children:e.description}),(0,de.FD)(se.A,{variant:"caption",sx:{display:"block"},children:["Seasonality: ",e.threshold]})]})]},t)))]}),(0,de.Y)(Ce.A,{sx:{my:1.5}}),(0,de.FD)(ee.A,{sx:{mb:2},children:[(0,de.Y)(se.A,{variant:"subtitle2",gutterBottom:!0,children:"Price Variations"}),[{label:"High Price",color:"#006d2c",description:"Above average prices"},{label:"Moderate Price",color:"#74c476",description:"Average price range"},{label:"Low Price",color:"#edf8e9",description:"Below average prices"}].map(((e,t)=>(0,de.FD)(ee.A,{sx:{display:"flex",alignItems:"center",gap:1,mt:1},children:[(0,de.Y)(ee.A,{sx:{width:20,height:20,backgroundColor:e.color,borderRadius:"2px",border:`1px solid ${o.palette.divider}`}}),(0,de.FD)(ee.A,{children:[(0,de.Y)(se.A,{variant:"body2",children:e.label}),(0,de.Y)(se.A,{variant:"caption",color:"textSecondary",children:e.description})]})]},t)))]}),(0,de.Y)(Ce.A,{sx:{my:1.5}}),(0,de.FD)(ee.A,{sx:{mb:2},children:[(0,de.Y)(se.A,{variant:"subtitle2",gutterBottom:!0,children:"Overall Seasonal Strength"}),(0,de.FD)(ee.A,{sx:{mt:1},children:[(0,de.FD)(ee.A,{sx:{display:"flex",justifyContent:"space-between",mb:.5},children:[(0,de.Y)(se.A,{variant:"caption",color:"textSecondary",children:"Weak"}),(0,de.Y)(se.A,{variant:"caption",color:"textSecondary",children:"Strong"})]}),(0,de.Y)(Nt.A,{variant:"determinate",value:100*((null==t?void 0:t.seasonalStrength)||0),sx:{height:8,borderRadius:4,backgroundColor:o.palette.grey[200],"& .MuiLinearProgress-bar":{backgroundColor:"#08519c"}}}),(0,de.FD)(se.A,{variant:"body2",align:"center",sx:{mt:.5},children:[(100*((null==t?void 0:t.seasonalStrength)||0)).toFixed(1),"%"]})]})]}),(0,de.FD)(ee.A,{children:[(0,de.Y)(se.A,{variant:"subtitle2",gutterBottom:!0,children:"Monthly Price Trends"}),(0,de.FD)(ee.A,{sx:{display:"flex",justifyContent:"space-between",mt:1},children:[(0,de.FD)(ee.A,{children:[(0,de.Y)(se.A,{variant:"caption",color:"textSecondary",children:"Peak Month"}),(0,de.FD)(ee.A,{sx:{display:"flex",alignItems:"center",color:o.palette.error.main},children:[(0,de.Y)(lt.A,{sx:{mr:.5},fontSize:"small"}),(0,de.Y)(se.A,{variant:"body2",children:Ua(l.month)})]})]}),(0,de.FD)(ee.A,{children:[(0,de.Y)(se.A,{variant:"caption",color:"textSecondary",children:"Trough Month"}),(0,de.FD)(ee.A,{sx:{display:"flex",alignItems:"center",color:o.palette.success.main},children:[(0,de.Y)(It.A,{sx:{mr:.5},fontSize:"small"}),(0,de.Y)(se.A,{variant:"body2",children:Ua(c.month)})]})]})]})]}),(0,de.Y)(ee.A,{sx:{mt:"auto",pt:2,borderTop:`1px solid ${o.palette.divider}`},children:(0,de.Y)(se.A,{variant:"caption",color:"textSecondary",children:"Click on regions to view detailed seasonal patterns and price trends. Use the time control to explore monthly variations."})})]})},Ua=e=>["January","February","March","April","May","June","July","August","September","October","November","December"][e];Ga.propTypes={seasonalMetrics:s().shape({seasonalStrength:s().number,trendStrength:s().number,seasonalPattern:s().arrayOf(s().number),regionalPatterns:s().object}),selectedMonth:s().string,selectedRegion:s().string,timeSeriesData:s().arrayOf(s().shape({month:s().string.isRequired,usdPrice:s().number}))};const Za=i.memo(Ga),Xa=()=>{(0,ge.A)();const e=(0,n.wA)(),[t,r]=(0,i.useState)("map"),[a,o]=(0,i.useState)(null),s=(0,n.d4)((e=>e.spatial.data.geometry)),l=(0,n.d4)((e=>e.spatial.data.timeSeriesData||[])),c=(0,n.d4)((e=>e.spatial.data.marketIntegration||{})),u=(0,n.d4)((e=>e.spatial.data.seasonalAnalysis||{})),m=(0,n.d4)((e=>e.spatial.status.loading)),h=(0,n.d4)((e=>e.spatial.status.error)),p=(0,n.d4)((e=>e.spatial.ui.selectedDate)),g=(0,n.d4)((e=>Aa(e))),y=(0,n.d4)((e=>Ca(e))),f=(0,i.useMemo)((()=>{if(!u||null==l||!l.length)return{seasonalStrength:0,trendStrength:0,peakMonth:null,troughMonth:null,seasonalPattern:[],regionalPatterns:{}};const e=l.reduce(((e,t)=>(e[t.region]||(e[t.region]=[]),e[t.region].push(t),e)),{}),t=Object.entries(e).reduce(((e,t)=>{let[r,i]=t;const a=i.map((e=>e.usdPrice||0)),n=a.reduce(((e,t)=>e+t),0)/a.length,o=a.reduce(((e,t)=>e+Math.pow(t-n,2)),0)/a.length;return e[r]={seasonalStrength:o/n,meanPrice:n,variance:o},e}),{});return{...u,regionalPatterns:t}}),[u,l]),v=(0,i.useMemo)((()=>null!=l&&l.length?[...new Set(l.map((e=>e.month)))].sort():[]),[l]);return m?(0,de.Y)(ee.A,{sx:{display:"flex",justifyContent:"center",p:3},children:(0,de.Y)(se.A,{children:"Loading seasonal analysis..."})}):h?(0,de.Y)(Ke.A,{severity:"error",sx:{m:2},children:h}):(0,de.FD)(ze.Ay,{container:!0,spacing:2,children:[(0,de.Y)(ze.Ay,{item:!0,xs:12,children:(0,de.FD)(ze.Ay,{container:!0,spacing:2,children:[(0,de.Y)(ze.Ay,{item:!0,xs:12,md:3,children:(0,de.Y)(Ft,{title:"Average Price",value:y.avgPrice,format:"currency",description:"Average market price"})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,md:3,children:(0,de.Y)(Ft,{title:"Price Range",value:y.priceRange,format:"currency",description:"Price range (max - min)"})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,md:3,children:(0,de.Y)(Ft,{title:"Market Integration",value:(null==c?void 0:c.integration_score)||0,format:"percentage",description:"Market integration score"})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,md:3,children:(0,de.Y)(Ft,{title:"Seasonal Strength",value:f.seasonalStrength||0,format:"percentage",description:"Seasonal pattern strength"})})]})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,children:(0,de.FD)($e.A,{sx:{p:2},children:[(0,de.Y)(ee.A,{sx:{mb:v.length>0?2:0},children:(0,de.FD)(Le.A,{value:t,exclusive:!0,onChange:(e,t)=>t&&r(t),size:"small",children:[(0,de.FD)(je.A,{value:"map",children:[(0,de.Y)(Va.A,{sx:{mr:1}}),"Seasonal Map"]}),(0,de.FD)(je.A,{value:"timeline",children:[(0,de.Y)(ot.A,{sx:{mr:1}}),"Price Trends"]}),(0,de.FD)(je.A,{value:"analysis",children:[(0,de.Y)(Ra.A,{sx:{mr:1}}),"Pattern Analysis"]})]})}),v.length>0&&(0,de.FD)(de.FK,{children:[(0,de.Y)(Ce.A,{sx:{my:2}}),(0,de.Y)(ee.A,{sx:{width:"100%"},children:(0,de.Y)(ga,{dates:v,currentDate:p||v[0],onChange:t=>{e((0,d.un)(t))},position:null})})]})]})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,md:8,children:(0,de.Y)($e.A,{sx:{p:2,height:600},children:(0,de.Y)(Ba,{timeSeriesData:g,geometry:s,selectedRegion:a,onRegionSelect:o,selectedMonth:p||v[0],seasonalMetrics:f})})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,md:4,children:(0,de.Y)(Za,{selectedMonth:p||v[0],seasonalMetrics:f,selectedRegion:a,timeSeriesData:g})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,children:(0,de.FD)($e.A,{sx:{p:2},children:[(0,de.Y)(se.A,{variant:"h6",gutterBottom:!0,children:"About Seasonal Analysis"}),(0,de.Y)(se.A,{paragraph:!0,children:"This analysis examines seasonal price patterns in Yemen's markets, revealing cyclical variations and their impact on market dynamics."}),(0,de.FD)(ze.Ay,{container:!0,spacing:2,children:[(0,de.FD)(ze.Ay,{item:!0,xs:12,md:4,children:[(0,de.Y)(se.A,{variant:"subtitle2",gutterBottom:!0,children:"Seasonal Patterns"}),(0,de.FD)(gt.A,{dense:!0,children:[(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:"Monthly price variations"})}),(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:"Peak and trough periods"})}),(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:"Regional differences"})}),(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:"Pattern stability"})})]})]}),(0,de.FD)(ze.Ay,{item:!0,xs:12,md:4,children:[(0,de.Y)(se.A,{variant:"subtitle2",gutterBottom:!0,children:"Market Implications"}),(0,de.FD)(gt.A,{dense:!0,children:[(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:"Supply chain planning"})}),(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:"Price forecasting"})}),(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:"Stock management"})}),(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:"Trade optimization"})})]})]}),(0,de.FD)(ze.Ay,{item:!0,xs:12,md:4,children:[(0,de.Y)(se.A,{variant:"subtitle2",gutterBottom:!0,children:"Response Planning"}),(0,de.FD)(gt.A,{dense:!0,children:[(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:"Intervention timing"})}),(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:"Resource allocation"})}),(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:"Buffer stock planning"})}),(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:"Market support strategies"})})]})]})]})]})})]})},Ja=i.memo(Xa),Ka=e=>{let{timeSeriesData:t,marketIntegration:r,networkMetrics:a,spatialAutocorrelation:n,selectedRegion:o}=e;(0,ge.A)();const s=(0,i.useMemo)((()=>{if(null==t||!t.length)return{overall:0,integration:{score:0,factors:{},trend:0},stability:{score:0,factors:{},trend:0},resilience:{score:0,factors:{},trend:0},accessibility:{score:0,factors:{},trend:0}};const e=Qa(r),i=en(t),o=tn(a,n),s=rn(r);return{overall:Math.max(0,Math.min(1,(e.score+i.score+o.score+s.score)/4)),integration:e,stability:i,resilience:o,accessibility:s}}),[t,r,a,n]),l=(0,i.useMemo)((()=>{if(!o||null==t||!t.length)return null;return an(o,t,r,a)||{overall:0,marketRole:"Unknown",riskLevel:"Unknown",metrics:{}}}),[o,t,r,a]),c={overall:(null==s?void 0:s.overall)||0,integration:(null==s?void 0:s.integration)||{score:0,factors:{},trend:0},stability:(null==s?void 0:s.stability)||{score:0,factors:{},trend:0},resilience:(null==s?void 0:s.resilience)||{score:0,factors:{},trend:0},accessibility:(null==s?void 0:s.accessibility)||{score:0,factors:{},trend:0}};return null!=t&&t.length?(0,de.FD)(ze.Ay,{container:!0,spacing:2,children:[(0,de.Y)(ze.Ay,{item:!0,xs:12,children:(0,de.FD)($e.A,{sx:{p:2},children:[(0,de.Y)(se.A,{variant:"h6",gutterBottom:!0,children:"Market System Health"}),(0,de.Y)(Tt,{title:"Overall Health Score",value:c.overall,target:.7,format:"percentage",description:"Composite market health indicator"})]})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,children:(0,de.FD)($e.A,{sx:{p:2},children:[(0,de.Y)(se.A,{variant:"subtitle2",gutterBottom:!0,children:"Core Health Indicators"}),(0,de.FD)(ze.Ay,{container:!0,spacing:2,children:[(0,de.Y)(ze.Ay,{item:!0,xs:12,md:3,children:(0,de.Y)(Ft,{title:"Market Integration",value:c.integration.score,format:"percentage",description:"Price correlation and trade flow strength",trend:c.integration.trend})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,md:3,children:(0,de.Y)(Ft,{title:"Market Stability",value:c.stability.score,format:"percentage",description:"Price and supply consistency",trend:c.stability.trend})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,md:3,children:(0,de.Y)(Ft,{title:"Market Resilience",value:c.resilience.score,format:"percentage",description:"Shock absorption capacity",trend:c.resilience.trend})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,md:3,children:(0,de.Y)(Ft,{title:"Market Accessibility",value:c.accessibility.score,format:"percentage",description:"Physical and economic access",trend:c.accessibility.trend})})]})]})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,children:(0,de.FD)($e.A,{sx:{p:2},children:[(0,de.Y)(se.A,{variant:"subtitle2",gutterBottom:!0,children:"Health Analysis Details"}),(0,de.FD)(ze.Ay,{container:!0,spacing:2,children:[(0,de.Y)(ze.Ay,{item:!0,xs:12,md:6,children:(0,de.FD)(ee.A,{children:[(0,de.Y)(se.A,{variant:"body2",color:"textSecondary",gutterBottom:!0,children:"Integration Factors"}),(0,de.Y)(ee.A,{sx:{pl:2},children:Object.entries(s.integration.factors).map((e=>{let[t,r]=e;return(0,de.FD)(se.A,{variant:"body2",children:["• ",t,": ",(100*r).toFixed(1),"%"]},t)}))})]})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,md:6,children:(0,de.FD)(ee.A,{children:[(0,de.Y)(se.A,{variant:"body2",color:"textSecondary",gutterBottom:!0,children:"Stability Factors"}),(0,de.Y)(ee.A,{sx:{pl:2},children:Object.entries(s.stability.factors).map((e=>{let[t,r]=e;return(0,de.FD)(se.A,{variant:"body2",children:["• ",t,": ",(100*r).toFixed(1),"%"]},t)}))})]})})]}),(0,de.Y)(Ce.A,{sx:{my:2}}),(0,de.FD)(ze.Ay,{container:!0,spacing:2,children:[(0,de.Y)(ze.Ay,{item:!0,xs:12,md:6,children:(0,de.FD)(ee.A,{children:[(0,de.Y)(se.A,{variant:"body2",color:"textSecondary",gutterBottom:!0,children:"Resilience Factors"}),(0,de.Y)(ee.A,{sx:{pl:2},children:Object.entries(s.resilience.factors).map((e=>{let[t,r]=e;return(0,de.FD)(se.A,{variant:"body2",children:["• ",t,": ",(100*r).toFixed(1),"%"]},t)}))})]})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,md:6,children:(0,de.FD)(ee.A,{children:[(0,de.Y)(se.A,{variant:"body2",color:"textSecondary",gutterBottom:!0,children:"Accessibility Factors"}),(0,de.Y)(ee.A,{sx:{pl:2},children:Object.entries(s.accessibility.factors).map((e=>{let[t,r]=e;return(0,de.FD)(se.A,{variant:"body2",children:["• ",t,": ",(100*r).toFixed(1),"%"]},t)}))})]})})]})]})}),l&&(0,de.Y)(ze.Ay,{item:!0,xs:12,children:(0,de.FD)($e.A,{sx:{p:2},children:[(0,de.FD)(se.A,{variant:"subtitle2",gutterBottom:!0,children:["Regional Health Analysis: ",o]}),(0,de.FD)(ze.Ay,{container:!0,spacing:2,children:[(0,de.Y)(ze.Ay,{item:!0,xs:12,md:4,children:(0,de.Y)(Ft,{title:"Regional Health Score",value:l.overall,format:"percentage",description:"Overall regional market health"})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,md:4,children:(0,de.Y)(Ft,{title:"Market Role",value:l.marketRole,format:"string",description:"Market's role in the system"})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,md:4,children:(0,de.Y)(Ft,{title:"Risk Level",value:l.riskLevel,format:"string",description:"Current risk assessment"})})]}),(0,de.FD)(ee.A,{sx:{mt:2},children:[(0,de.Y)(se.A,{variant:"body2",color:"textSecondary",gutterBottom:!0,children:"Key Metrics"}),(0,de.Y)(ze.Ay,{container:!0,spacing:2,children:Object.entries(l.metrics).map((e=>{let[t,r]=e;return(0,de.FD)(ze.Ay,{item:!0,xs:6,md:3,children:[(0,de.Y)(se.A,{variant:"caption",color:"textSecondary",children:t}),(0,de.Y)(se.A,{variant:"body2",children:"number"==typeof r?`${(100*r).toFixed(1)}%`:r})]},t)}))})]})]})}),(0,de.Y)(ze.Ay,{item:!0,xs:12,children:(0,de.FD)($e.A,{sx:{p:2},children:[(0,de.Y)(se.A,{variant:"subtitle2",gutterBottom:!0,children:"Health Assessment Summary"}),(0,de.Y)(se.A,{variant:"body2",color:"textSecondary",children:mn(s,l)})]})})]}):(0,de.Y)(Ke.A,{severity:"warning",sx:{m:2},children:"No market health data available for analysis"})},Qa=e=>{const t={priceCorrelation:Object.values((null==e?void 0:e.price_correlation)||{}).reduce(((e,t)=>e+Object.values(t).reduce(((e,t)=>e+Math.abs(t)),0)),0)/(Object.keys((null==e?void 0:e.price_correlation)||{}).length||1),marketConnectivity:Object.values((null==e?void 0:e.accessibility)||{}).reduce(((e,t)=>e+t),0)/(Object.keys((null==e?void 0:e.accessibility)||{}).length||1)};return{score:(t.priceCorrelation+t.marketConnectivity)/2,factors:t,trend:0}},en=e=>{const t={priceStability:nn(e),supplyConsistency:on(e),seasonalPattern:sn(e)};return{score:Object.values(t).reduce(((e,t)=>e+t),0)/3,factors:t,trend:ln(e)}},tn=(e,t)=>{var r,i;const a={networkRedundancy:(null==e?void 0:e.clustering)||0,spatialDiversity:1-((null==t||null===(r=t.global)||void 0===r?void 0:r.moran_i)||0),marketAdaptability:(null==e||null===(i=e.health)||void 0===i?void 0:i.resilience)||0};return{score:Object.values(a).reduce(((e,t)=>e+t),0)/3,factors:a,trend:0}},rn=e=>{const t={physicalAccess:Object.values((null==e?void 0:e.accessibility)||{}).reduce(((e,t)=>e+t),0)/(Object.keys((null==e?void 0:e.accessibility)||{}).length||1),economicAccess:.7,infrastructureQuality:.6};return{score:Object.values(t).reduce(((e,t)=>e+t),0)/3,factors:t,trend:0}},an=(e,t,r,i)=>{var a,n;const o=t.filter((t=>t.region===e));if(!o.length)return null;const s={priceStability:nn(o),marketAccess:(null==r||null===(a=r.accessibility)||void 0===a?void 0:a[e])||0,networkCentrality:(null==i||null===(n=i.centrality)||void 0===n||null===(n=n[e])||void 0===n?void 0:n.degree)||0,tradingVolume:cn(e,t)};return{overall:Object.values(s).reduce(((e,t)=>e+("number"==typeof t?t:0)),0)/Object.values(s).length,marketRole:dn(s),riskLevel:un(s),metrics:s}},nn=e=>{if(null==e||!e.length)return 0;const t=e.map((e=>e.usdPrice||0)),r=t.reduce(((e,t)=>e+t),0)/t.length,i=t.reduce(((e,t)=>e+Math.pow(t-r,2)),0)/t.length;return 1-Math.min(Math.sqrt(i)/r,1)},on=e=>.75,sn=e=>.8,ln=e=>.05,cn=(e,t)=>.7,dn=e=>e.networkCentrality>.7?"Hub Market":e.networkCentrality>.4?"Regional Center":"Local Market",un=e=>{const t=(1-e.priceStability+(1-e.marketAccess)+(1-e.networkCentrality))/3;return t>.7?"High Risk":t>.4?"Medium Risk":"Low Risk"},mn=(e,t)=>{const r=[];e.overall>.7?r.push("Market system shows strong overall health with robust integration and stability."):e.overall>.4?r.push("Market system demonstrates moderate health with areas for improvement."):r.push("Market system shows significant health challenges requiring attention.");const i=[{name:"Integration",score:e.integration.score},{name:"Stability",score:e.stability.score},{name:"Resilience",score:e.resilience.score},{name:"Accessibility",score:e.accessibility.score}],a=i.filter((e=>e.score>.7)).map((e=>e.name.toLowerCase())),n=i.filter((e=>e.score<.4)).map((e=>e.name.toLowerCase()));return a.length&&r.push(`Strong performance in ${a.join(", ")}.`),n.length&&r.push(`Improvement needed in ${n.join(", ")}.`),t&&r.push(`${t.marketRole} shows ${t.overall>.7?"strong":t.overall>.4?"moderate":"weak"} health with ${t.riskLevel.toLowerCase()} risk level.`),r.join(" ")};Ka.propTypes={timeSeriesData:s().arrayOf(s().shape({month:s().string.isRequired,region:s().string.isRequired,usdPrice:s().number})).isRequired,marketIntegration:s().shape({price_correlation:s().object,accessibility:s().object}),networkMetrics:s().shape({centrality:s().object,clustering:s().number,health:s().object}),spatialAutocorrelation:s().shape({global:s().shape({moran_i:s().number})}),selectedRegion:s().string};const hn=i.memo(Ka);var pn=r(92685);class gn extends i.Component{constructor(e){super(e),(0,Yr.A)(this,"handleReset",(()=>{this.setState({hasError:!1,error:null,errorInfo:null})})),(0,Yr.A)(this,"handleReload",(()=>{window.location.reload()})),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,t){this.setState({error:e,errorInfo:t}),this.props.onError&&this.props.onError(e,t)}render(){if(this.state.hasError){var e;const t=!1;return(0,de.Y)(ee.A,{sx:{p:3,height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,de.FD)($e.A,{elevation:3,sx:{p:4,maxWidth:600,width:"100%"},children:[(0,de.FD)(Ke.A,{severity:"error",variant:"filled",sx:{mb:3},children:[(0,de.Y)(Dr.A,{children:"An Error Has Occurred"}),this.props.message||"Something went wrong while rendering this component."]}),(0,de.FD)(ee.A,{sx:{mb:3},children:[(0,de.Y)(se.A,{variant:"subtitle1",gutterBottom:!0,children:"Actions:"}),(0,de.FD)(ee.A,{sx:{display:"flex",gap:2},children:[(0,de.Y)(Se.A,{variant:"contained",color:"primary",startIcon:(0,de.Y)(Ir.A,{}),onClick:this.handleReset,children:"Try Again"}),(0,de.Y)(Se.A,{variant:"outlined",color:"primary",startIcon:(0,de.Y)(Ir.A,{}),onClick:this.handleReload,children:"Reload Page"})]})]}),t&&this.state.error&&(0,de.FD)(de.FK,{children:[(0,de.FD)(ee.A,{sx:{mb:2},children:[(0,de.FD)(se.A,{variant:"subtitle1",color:"error",gutterBottom:!0,children:[(0,de.Y)(pn.A,{sx:{mr:1,verticalAlign:"middle"}}),"Error Details:"]}),(0,de.Y)($e.A,{variant:"outlined",sx:{p:2,bgcolor:"grey.100",maxHeight:200,overflow:"auto"},children:(0,de.Y)(se.A,{variant:"body2",component:"pre",sx:{fontFamily:"monospace",whiteSpace:"pre-wrap",wordBreak:"break-word"},children:this.state.error.toString()})})]}),(0,de.FD)(ee.A,{children:[(0,de.FD)(se.A,{variant:"subtitle1",color:"error",gutterBottom:!0,children:[(0,de.Y)(pn.A,{sx:{mr:1,verticalAlign:"middle"}}),"Stack Trace:"]}),(0,de.Y)($e.A,{variant:"outlined",sx:{p:2,bgcolor:"grey.100",maxHeight:300,overflow:"auto"},children:(0,de.Y)(se.A,{variant:"body2",component:"pre",sx:{fontFamily:"monospace",whiteSpace:"pre-wrap",wordBreak:"break-word"},children:null===(e=this.state.errorInfo)||void 0===e?void 0:e.componentStack})})]})]}),this.props.children&&(0,de.FD)(ee.A,{sx:{mt:3},children:[(0,de.Y)(se.A,{variant:"subtitle1",gutterBottom:!0,children:"Fallback UI:"}),this.props.children]})]})})}return this.props.children}}gn.propTypes={children:s().node,message:s().string,onError:s().func};const yn=gn,fn=e=>{let{message:t="Loading...",progress:r,variant:i="circular",fullscreen:a=!1,overlay:n=!1,height:o="100%"}=e;const s=(0,ge.A)(),l=(0,de.FD)(ee.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:a?"100vh":o,width:"100%",...n&&{position:"absolute",top:0,left:0,zIndex:s.zIndex.modal,backgroundColor:"rgba(255, 255, 255, 0.9)"}},children:["circular"===i?(0,de.Y)(Ue.A,{size:48,thickness:4,sx:{mb:2},..."number"==typeof r&&{variant:"determinate",value:r}}):(0,de.Y)(ee.A,{sx:{width:"60%",maxWidth:400,mb:2},children:(0,de.Y)(Nt.A,{..."number"==typeof r&&{variant:"determinate",value:r}})}),t&&(0,de.Y)(se.A,{variant:"body1",color:"textSecondary",align:"center",sx:{maxWidth:400,px:2,..."number"==typeof r&&{mb:1}},children:t}),"number"==typeof r&&(0,de.FD)(se.A,{variant:"body2",color:"textSecondary",children:[Math.round(r),"%"]})]});return a||n?l:(0,de.Y)($e.A,{elevation:0,sx:{height:o,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"transparent"},children:l})};fn.propTypes={message:s().string,progress:s().number,variant:s().oneOf(["circular","linear"]),fullscreen:s().bool,overlay:s().bool,height:s().oneOfType([s().string,s().number])};const vn=fn,bn=[{id:"clusters",label:"Market Clusters",icon:(0,de.Y)(nt.A,{}),component:Qt,description:"Analyze market clustering patterns and relationships"},{id:"autocorrelation",label:"Spatial Patterns",icon:(0,de.Y)(ot.A,{}),component:ti,description:"Examine spatial price dependencies and patterns"},{id:"flows",label:"Market Flows",icon:(0,de.Y)(st.A,{}),component:qi,description:"Visualize and analyze market flow networks"},{id:"shocks",label:"Price Shocks",icon:(0,de.Y)(lt.A,{}),component:Ia,description:"Track and analyze price shock propagation"},{id:"conflict",label:"Conflict Impact",icon:(0,de.Y)(ct.A,{}),component:Wa,description:"Assess conflict impact on market dynamics"},{id:"seasonal",label:"Seasonal Patterns",icon:(0,de.Y)(dt.A,{}),component:Ja,description:"Analyze seasonal price patterns and variations"},{id:"health",label:"Market Health",icon:(0,de.Y)(ut.A,{}),component:hn,description:"Monitor overall market system health"}],An=()=>{var e,t,r;const a=(0,ge.A)(),[o,s]=(0,i.useState)("clusters"),[l,c]=(0,i.useState)(null),d=(0,n.d4)(De.Lr),u=(0,n.d4)(De.T9),m=(0,n.d4)(De.BS),h=(0,n.d4)(De.JS),p=(0,n.d4)(De.Hw),g=null===(e=bn.find((e=>e.id===o)))||void 0===e?void 0:e.component;return h.loading?(0,de.Y)(vn,{message:h.stage||"Loading spatial analysis...",progress:h.progress,variant:"linear"}):"error"===p?(0,de.Y)(Ke.A,{severity:"error",sx:{m:2},action:(0,de.Y)(Se.A,{color:"inherit",onClick:()=>window.location.reload(),children:"Retry"}),children:"An error occurred while loading spatial analysis data."}):(0,de.FD)(ee.A,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[(0,de.Y)($e.A,{sx:{borderRadius:0,borderBottom:`1px solid ${a.palette.divider}`},elevation:0,children:(0,de.Y)(it.A,{value:o,onChange:(e,t)=>{t!==o&&(s(t),c(null))},variant:"scrollable",scrollButtons:"auto",sx:{px:2},TabIndicatorProps:{style:{transition:"none"}},children:bn.map((e=>(0,de.Y)(at.A,{value:e.id,label:e.label,icon:e.icon,iconPosition:"start",sx:{cursor:"pointer",WebkitTapHighlightColor:"transparent","&:focus":{outline:"none"}},component:"div"},e.id)))})}),(0,de.Y)($e.A,{sx:{p:2,borderRadius:0,borderBottom:`1px solid ${a.palette.divider}`,bgcolor:a.palette.grey[50]},elevation:0,children:(0,de.Y)(se.A,{variant:"body2",color:"textSecondary",children:null===(t=bn.find((e=>e.id===o)))||void 0===t?void 0:t.description})}),(0,de.FD)(ee.A,{sx:{flexGrow:1,overflow:"auto",p:2},children:[(0,de.Y)(yn,{message:`An error occurred while rendering the ${null===(r=bn.find((e=>e.id===o)))||void 0===r?void 0:r.label} feature.`,onError:e=>{c(e)},children:g&&(0,de.Y)(g,{timeSeriesData:d,geometryData:u,marketIntegration:m})}),l&&(0,de.Y)(Ke.A,{severity:"error",sx:{mt:2},onClose:()=>c(null),children:l.message})]})]})},wn=i.memo(An),_n={"high-high":"#d7191c","low-low":"#2c7bb6","high-low":"#fdae61","low-high":"#abd9e9","not-significant":"#eeeeee"},xn=[15.3694,44.191],kn=[[10.111,39.814],[21.0025,56.5305]],Sn=()=>{const e=(0,ri.ko)();return(0,i.useEffect)((()=>{const t=setTimeout((()=>{e.setView(xn,6),e.fitBounds(kn)}),100),r=()=>{e.setView(xn,6),e.fitBounds(kn)};return e.on("mouseout",r),e.on("dragend",(()=>{e.getBounds().intersects(kn)||r()})),()=>{clearTimeout(t),e.off("mouseout",r),e.off("dragend",r)}}),[e]),null},Mn=e=>{let{localMorans:t,geometry:r,height:a="100%",onRegionClick:n}=e;const o=(0,ge.A)(),s=(0,i.useRef)(null),l=(0,i.useMemo)((()=>null!=r&&r.features&&t?{type:"FeatureCollection",features:r.features.map((e=>{var r;const i=null===(r=e.properties)||void 0===r?void 0:r.region_id,a=t[i]||{};return{...e,properties:{...e.properties,cluster_type:a.cluster_type||"not-significant",local_i:a.local_i||0,p_value:a.p_value||1,z_score:a.z_score||0}}}))}:null),[r,t]),c=(0,i.useCallback)((e=>{var t;const r=(null===(t=e.properties)||void 0===t?void 0:t.cluster_type)||"not-significant";return{fillColor:_n[r],weight:1,opacity:1,color:"white",fillOpacity:.7}}),[]),d=(0,i.useCallback)((()=>{var e;null===(e=s.current)||void 0===e||e.zoomIn()}),[]),u=(0,i.useCallback)((()=>{var e;null===(e=s.current)||void 0===e||e.zoomOut()}),[]),m=(0,i.useCallback)((()=>{var e;if(null!=r&&null!==(e=r.features)&&void 0!==e&&e.length){var t;const e=kt().geoJSON(r).getBounds();null===(t=s.current)||void 0===t||t.fitBounds(e)}}),[r]),h=(0,i.useMemo)((()=>[{color:_n["high-high"],label:"High-High Cluster"},{color:_n["low-low"],label:"Low-Low Cluster"},{color:_n["high-low"],label:"High-Low Outlier"},{color:_n["low-high"],label:"Low-High Outlier"},{color:_n["not-significant"],label:"Not Significant"}]),[]);return l?(0,de.FD)(ee.A,{sx:{height:a,position:"relative"},children:[(0,de.FD)(At.W,{ref:s,center:xn,zoom:6,bounds:kn,style:{height:"100%",width:"100%"},maxBounds:kn,minZoom:5,maxZoom:8,zoomControl:!0,dragging:!0,touchZoom:!0,doubleClickZoom:!0,scrollWheelZoom:!1,boxZoom:!0,keyboard:!0,bounceAtZoomLimits:!0,worldCopyJump:!1,preferCanvas:!0,children:[(0,de.Y)(Sn,{}),(0,de.Y)(wt.e,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"© OpenStreetMap contributors"}),(0,de.Y)(_t.k,{data:l,style:c,onEachFeature:(e,t)=>{n&&t.on({click:()=>n(e.properties.region_id)});const r=`\n              <div style="\n                background: ${o.palette.background.paper};\n                padding: 8px;\n                border-radius: 4px;\n                border: 1px solid ${o.palette.divider};\n                font-family: ${o.typography.fontFamily};\n              ">\n                <div style="font-weight: 600; margin-bottom: 4px;">\n                  ${e.properties.originalName||e.properties.region_id}\n                </div>\n                <div style="color: ${o.palette.text.secondary};">\n                  Cluster Type: ${e.properties.cluster_type.replace(/-/g," ").split(" ").map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join("-")}\n                </div>\n                <div style="color: ${o.palette.text.secondary};">\n                  Local Moran's I: ${e.properties.local_i}\n                </div>\n                <div style="color: ${o.palette.text.secondary};">\n                  P-Value: ${e.properties.p_value}\n                </div>\n                <div style="color: ${o.palette.text.secondary};">\n                  Z-Score: ${e.properties.z_score}\n                </div>\n              </div>\n            `;t.bindTooltip(r,{sticky:!0,direction:"top"})}})]}),(0,de.Y)(gi,{onZoomIn:d,onZoomOut:u,onReset:m,onRefresh:()=>{}}),(0,de.Y)(di,{title:"LISA Clusters",items:h})]}):(0,de.Y)(ee.A,{sx:{height:a,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"background.paper",borderRadius:1},children:(0,de.Y)(se.A,{color:"text.secondary",children:"No LISA data available for visualization"})})};Mn.propTypes={localMorans:s().object.isRequired,geometry:s().shape({type:s().string,features:s().arrayOf(s().object)}).isRequired,height:s().oneOfType([s().string,s().number]),onRegionClick:s().func};const Cn=[15.3694,44.191],Yn=[[8.111,37.814],[23.0025,58.5305]],Dn=()=>{const e=(0,ri.ko)();return(0,i.useEffect)((()=>{const t=setTimeout((()=>{e.setView(Cn,3),e.fitBounds(Yn)}),100),r=()=>{e.setView(Cn,3),e.fitBounds(Yn)};return e.on("mouseout",r),e.on("dragend",(()=>{e.getBounds().intersects(Yn)||r()})),()=>{clearTimeout(t),e.off("mouseout",r),e.off("dragend",r)}}),[e]),null},In=e=>{let{flows:t=[],geometry:r,selectedFlow:a,onFlowSelect:n,height:o="100%"}=e;const s=(0,ge.A)(),l=(0,i.useRef)(null),c=(0,i.useMemo)((()=>oi.Ay.scale(["#fde0dd","#c51b8a"]).domain([0,1])),[]),d=(0,i.useMemo)((()=>{if(null==t||!t.length||null==r||!r.features)return[];const e=t.filter((e=>yi.Oz.isValidFlow(e))),i=Math.max(...e.map((e=>e.flow_weight||0)));return e.map((e=>{var t,a;const n=r.features.find((t=>t.properties.normalizedName===(0,Pt.YP)(e.source))),o=r.features.find((t=>t.properties.normalizedName===(0,Pt.YP)(e.target)));if(null==n||null===(t=n.geometry)||void 0===t||!t.coordinates||null==o||null===(a=o.geometry)||void 0===a||!a.coordinates)return null;const s=yi.Oz.normalizeFlow(e,i),l=yi.Oz.getFlowStatus(s);return{...e,sourceCoords:n.geometry.coordinates,targetCoords:o.geometry.coordinates,color:c(s).hex(),width:1+4*s,normalizedFlow:s,status:l}})).filter(Boolean)}),[t,r,c]),u=(0,i.useCallback)((e=>{const t=d.some((t=>(0,Pt.YP)(t.source)===e.properties.normalizedName||(0,Pt.YP)(t.target)===e.properties.normalizedName));return{fillColor:t?s.palette.primary.light:s.palette.grey[300],weight:1,opacity:1,color:"white",fillOpacity:t?.6:.3}}),[d,s]),m=(0,i.useCallback)((()=>{var e;null===(e=l.current)||void 0===e||e.zoomIn()}),[]),h=(0,i.useCallback)((()=>{var e;null===(e=l.current)||void 0===e||e.zoomOut()}),[]),p=(0,i.useCallback)((()=>{var e;if(null!=r&&null!==(e=r.features)&&void 0!==e&&e.length){var t;const e=kt().geoJSON(r).getBounds();null===(t=l.current)||void 0===t||t.fitBounds(e)}}),[r]),g=(0,i.useMemo)((()=>[{color:"#c51b8a",label:"High Flow"},{color:"#fde0dd",label:"Low Flow"},{color:s.palette.primary.light,label:"Market Point",style:{borderRadius:"50%"}}]),[s]);return d.length&&r?(0,de.FD)(ee.A,{sx:{height:o,position:"relative"},children:[(0,de.FD)(At.W,{ref:l,center:Cn,zoom:3,bounds:Yn,style:{height:"100%",width:"100%"},maxBounds:Yn,minZoom:2,maxZoom:10,zoomControl:!0,dragging:!0,touchZoom:!0,doubleClickZoom:!0,scrollWheelZoom:!0,boxZoom:!0,keyboard:!0,bounceAtZoomLimits:!0,worldCopyJump:!1,preferCanvas:!0,children:[(0,de.Y)(Dn,{}),(0,de.Y)(wt.e,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"© OpenStreetMap contributors"}),(0,de.Y)(_t.k,{data:r,style:u}),d.map(((e,t)=>{const r=a&&a.source===e.source&&a.target===e.target;return(0,de.FD)(i.Fragment,{children:[(0,de.Y)(ii.R,{positions:[[e.sourceCoords[1],e.sourceCoords[0]],[e.targetCoords[1],e.targetCoords[0]]],pathOptions:{color:e.color,weight:r?2*e.width:e.width,opacity:r?.8:.5},eventHandlers:{click:()=>null==n?void 0:n(e)},children:(0,de.Y)(Hi,{title:"Market Flow",metrics:[{label:"Source",value:e.source},{label:"Target",value:e.target},{label:"Flow Volume",value:e.flow_weight,format:"number"},{label:"Flow Strength",value:e.normalizedFlow,format:"percentage"},{label:"Status",value:e.status},{label:"Price Differential",value:e.price_differential||0,format:"percentage"}]})}),[{coords:e.sourceCoords,name:e.source},{coords:e.targetCoords,name:e.target}].map(((e,r)=>(0,de.Y)(ni.p,{center:[e.coords[1],e.coords[0]],radius:6,pathOptions:{fillColor:s.palette.primary.light,color:"white",weight:1,opacity:.8,fillOpacity:.6},children:(0,de.Y)(Hi,{title:e.name,content:"Market Location"})},`${t}-${r}`)))]},t)}))]}),(0,de.Y)(gi,{onZoomIn:m,onZoomOut:h,onReset:p,onRefresh:()=>{}}),(0,de.Y)(di,{title:"Market Flows",items:g})]}):(0,de.Y)(ee.A,{sx:{height:o,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"background.paper",borderRadius:1},children:(0,de.Y)(se.A,{color:"text.secondary",children:"No flow data available for visualization"})})};In.propTypes={flows:s().arrayOf(s().shape({source:s().string.isRequired,target:s().string.isRequired,flow_weight:s().number.isRequired,price_differential:s().number,metadata:s().shape({valid:s().bool.isRequired,processed_at:s().string.isRequired}).isRequired})),geometry:s().shape({type:s().string,features:s().arrayOf(s().object)}).isRequired,selectedFlow:s().shape({source:s().string.isRequired,target:s().string.isRequired}),onFlowSelect:s().func,height:s().oneOfType([s().string,s().number])};const Rn={avgPrice:0,avgConflict:0,marketCount:0},Fn={totalMarkets:0,avgPrice:0,avgConflict:0},Nn=(0,ya._8)((e=>e.spatialAnalysis),(e=>e||{timeSeriesData:[],spatialAutocorrelation:{global:null,local:null}})),zn=(0,ya._8)([Nn],(e=>e.timeSeriesData||[])),En=(0,ya._8)([Nn],(e=>e.spatialAutocorrelation||{global:null,local:null})),Tn=(0,ya._8)([En],(e=>e.global||{moran_i:0,p_value:null,z_score:null,significance:!1})),Pn=(0,ya._8)([En],(e=>e.local||{})),On=((0,ya._8)([Pn],(e=>{const t={"high-high":[],"low-low":[],"high-low":[],"low-high":[],not_significant:[]};return e?(Object.entries(e).forEach((e=>{let[r,i]=e;const a=i.cluster_type||"not_significant";t[a].push({region:r,...i})})),t):t})),(0,ya._8)([Tn,Pn],((e,t)=>{const r=Object.keys(t).length,i=Object.values(t).filter((e=>e.p_value&&e.p_value<.05)).length;return{globalMoranI:e.moran_i,globalSignificance:e.significance,totalRegions:r,significantRegions:i,significanceRate:r?i/r*100:0}})),(0,ya._8)([Pn,(e,t)=>t],((e,t)=>e[t]||null)),(0,ya._8)([De.Ot,zn],((e,t)=>null!=e&&e.length&&null!=t&&t.length?e.map((e=>{const r=t.filter((t=>e.connected_markets.includes(t.region)));if(!r.length)return{...e,metrics:Rn};const i=r.reduce(((e,t)=>e+(t.usdPrice||0)),0)/r.length,a=r.reduce(((e,t)=>e+(t.conflictIntensity||0)),0)/r.length;return{...e,metrics:{avgPrice:i,avgConflict:a,marketCount:e.connected_markets.length}}})):[]))),$n=(0,ya._8)([On],(e=>{if(null==e||!e.length)return Fn;const t=e.reduce(((e,t)=>e+t.metrics.marketCount),0),r=e.reduce(((e,t)=>e+t.metrics.avgPrice),0)/e.length,i=e.reduce(((e,t)=>e+t.metrics.avgConflict),0)/e.length;return{totalMarkets:t,avgPrice:r,avgConflict:i}})),Ln=((0,ya._8)([On,$n,De.T9],((e,t,r)=>({clusters:e,metrics:t,geometry:r}))),(0,ya._8)([De.w_,De.T9],((e,t)=>{if(null==e||!e.length)return null;const r=e.map((e=>({source:e.source,target:e.target,totalFlow:e.total_flow||e.value,avgFlow:e.avg_flow||e.average,flowCount:e.flow_count||e.count,avgPriceDifferential:e.avg_price_differential||e.priceDiff})));return{flows:r,geometry:t,summary:{totalFlows:r.length,averageFlowStrength:r.reduce(((e,t)=>e+t.avgFlow),0)/r.length,maxFlow:Math.max(...r.map((e=>e.totalFlow)))}}})),(0,ya._8)([De.oe,De.T9],((e,t)=>{if(null==e||!e.length)return null;const r=e.reduce(((e,t)=>{const r=t.shock_type;return e[r]||(e[r]=[]),e[r].push(t),e}),{});return{shocks:e,shocksByType:r,geometry:t,summary:{totalShocks:e.length,priceDrops:e.filter((e=>"price_drop"===e.shock_type)).length,priceSurges:e.filter((e=>"price_surge"===e.shock_type)).length,averageMagnitude:e.reduce(((e,t)=>e+t.magnitude),0)/e.length}}})),(0,ya._8)([zn,De.T9],((e,t)=>{if(null==e||!e.length)return null;const r=e.reduce(((e,t)=>(e[t.region]||(e[t.region]={intensities:[],average:0,max:0}),e[t.region].intensities.push(t.conflictIntensity||0),e)),{});return Object.keys(r).forEach((e=>{const t=r[e].intensities;r[e].average=t.reduce(((e,t)=>e+t),0)/t.length,r[e].max=Math.max(...t)})),{conflictData:r,geometry:t,summary:{averageIntensity:Object.values(r).reduce(((e,t)=>e+t.average),0)/Object.keys(r).length,maxIntensity:Math.max(...Object.values(r).map((e=>e.max)))}}})),(0,ya._8)([zn],(e=>{if(null==e||!e.length)return null;const t=e.reduce(((e,t)=>{const r=t.month.split("-")[1];return e[r]||(e[r]=[]),e[r].push(t.usdPrice),e}),{}),r=Object.entries(t).map((e=>{let[t,r]=e;const i=r.reduce(((e,t)=>e+t),0)/r.length,a=r.reduce(((e,t)=>e+Math.pow(t-i,2)),0)/r.length,n=0!==i?Math.sqrt(a)/i:0;return{month:t,averagePrice:i,volatility:n}}));return{monthlyStats:r,summary:{highestPriceMonth:r.reduce(((e,t)=>t.averagePrice>e.averagePrice?t:e)),lowestPriceMonth:r.reduce(((e,t)=>t.averagePrice<e.averagePrice?t:e))}}})),(0,ya._8)([De.w_,De.Ot],((e,t)=>{if(null==e||!e.length||null==t||!t.length)return null;const r=t.map((e=>({id:e.region,label:e.main_market,group:e.cluster_id,markets:e.connected_markets.length}))),i=e.map((e=>({from:e.source,to:e.target,value:e.total_flow||e.value,title:`Flow: ${(e.total_flow||e.value).toFixed(2)}`})));return{network:{nodes:r,edges:i},summary:{nodes:r.length,edges:i.length,density:r.length>1?2*i.length/(r.length*(r.length-1)):0}}})),(0,ya._8)([Nn,(e,t)=>t],((e,t)=>{const r=k.backgroundMonitor.startMetric("regression-analysis");try{var i,a,n,o,s;const l=null==e?void 0:e.regressionAnalysis;if(!l||!t)return r.finish({status:"success",commodity:t}),null;const c=l.metadata||{};if(t&&c.commodity!==t)return r.finish({status:"success",commodity:t}),null;const d={model:l.model||{},spatial:{moran_i:(null===(i=l.spatial)||void 0===i?void 0:i.moran_i)||{I:0,"p-value":null},vif:Array.isArray(null===(a=l.spatial)||void 0===a?void 0:a.vif)?l.spatial.vif:[]},residuals:{raw:Array.isArray(null===(n=l.residuals)||void 0===n?void 0:n.raw)?l.residuals.raw:[],byRegion:(null===(o=l.residuals)||void 0===o?void 0:o.byRegion)||{},stats:{mean:0,variance:0,maxAbsolute:0,...null===(s=l.residuals)||void 0===s?void 0:s.stats}},metadata:{commodity:t,timestamp:c.timestamp||(new Date).toISOString(),version:c.version||"1.0"}};return r.finish({status:"success",commodity:t}),d}catch(e){return r.finish({status:"error",error:e.message}),null}})),(0,ya._8)([De.Ot,De.T9],((e,t)=>null!=e&&e.length&&null!=t&&t.features?e.map((e=>({...e,coordinates:(0,Pt.ih)(e.region)||[0,0]}))):[]))),jn=(0,ya._8)([De.w_,De.T9],((e,t)=>null!=e&&e.length&&null!=t&&t.features?e.map((e=>({...e,sourceCoords:(0,Pt.ih)(e.source)||[0,0],targetCoords:(0,Pt.ih)(e.target)||[0,0]}))):[]));(0,ya._8)([Ln,jn],((e,t)=>({clusters:e,flows:t}))),(0,ya._8)([zn,De.oe,De.w_],((e,t,r)=>{if(null==e||!e.length)return null;const i={};e.forEach((e=>{i[e.region]||(i[e.region]={prices:[],shocks:0,flows:0,conflictIntensity:0}),i[e.region].prices.push(e.usdPrice),i[e.region].conflictIntensity=e.conflictIntensity||0})),(t||[]).forEach((e=>{i[e.region]&&i[e.region].shocks++})),(r||[]).forEach((e=>{i[e.source]&&i[e.source].flows++,i[e.target]&&i[e.target].flows++})),Object.keys(i).forEach((e=>{const t=i[e],r=t.prices.reduce(((e,t)=>e+t),0)/t.prices.length,a=t.prices.reduce(((e,t)=>e+Math.pow(t-r,2)),0)/t.prices.length,n=r?1-Math.sqrt(a)/r:0;i[e].healthScore=.4*n+.3*(t.shocks<10?1-t.shocks/10:0)+t.flows/10*.2+.1*(1-t.conflictIntensity/10)}));const a=Object.keys(i).length,n=Object.values(i).reduce(((e,t)=>e+t.healthScore),0),o=a?n/a:0,s=Object.values(i).filter((e=>e.healthScore>.7)).length;return{marketHealth:i,summary:{averageHealth:o,healthyMarkets:s}}}));Error;Oe.t1.register(Oe.PP,Oe.kc,Oe.FN,Oe.No,Oe.UA,Oe.m_,Oe.s$,Oe.dN);const qn=async(e,t)=>{const r=k.backgroundMonitor.startMetric(k.MetricTypes.SYSTEM.PERFORMANCE,{action:"load-component",component:t});try{const i=await e();if(!i.default)throw new Error(`${t} component not found`);return null==r||r.finish({status:"success"}),i}catch(e){throw null==r||r.finish({status:"error",error:e.message}),k.backgroundMonitor.logError(k.MetricTypes.SYSTEM.ERROR,{component:t,error:e.message,stack:e.stack}),e}},Wn=i.lazy((()=>qn((()=>Promise.all([r.e(210),r.e(855),r.e(172)]).then(r.bind(r,25172))),"ECMAnalysis"))),Vn=i.lazy((()=>qn((()=>Promise.all([r.e(210),r.e(855),r.e(132),r.e(607)]).then(r.bind(r,8607))),"PriceDifferentialAnalysis"))),Hn=i.lazy((()=>qn((()=>Promise.all([r.e(210),r.e(936)]).then(r.bind(r,40936))),"TVMIIAnalysis"))),Bn=i.lazy((()=>qn((()=>Promise.all([r.e(210),r.e(855),r.e(132),r.e(40)]).then(r.bind(r,91040))),"SpatialAnalysis"))),Gn=i.memo((e=>{let{selectedAnalysis:t="spatial",selectedCommodity:r,selectedRegimes:a,windowWidth:n,spatialViewConfig:o,onSpatialViewChange:s}=e;const l=(0,ge.A)(),c=(0,Q.A)(l.breakpoints.down("sm")),{data:d,loading:u,error:m,getFilteredData:h}=Te(),p=(0,i.useMemo)((()=>{const e=k.backgroundMonitor.startMetric(k.MetricTypes.SYSTEM.PERFORMANCE,{action:"filter-data",commodity:r});try{const t=h(r,a);return null==e||e.finish({status:"success",dataPoints:(null==t?void 0:t.length)||0}),t}catch(t){return null==e||e.finish({status:"error",error:t.message}),k.backgroundMonitor.logError(k.MetricTypes.SYSTEM.ERROR,{component:"dashboard-filter",error:t.message,stack:t.stack}),[]}}),[h,r,a]),g=(0,i.useMemo)((()=>({spatial:wn,ecm:Wn,priceDiff:Vn,spatial_model:Bn,tvmii:Hn})),[]),y=(0,i.useCallback)((e=>{try{const t=g[e];return t||k.backgroundMonitor.logError(k.MetricTypes.SYSTEM.ERROR,{component:"analysis-loader",error:`Unknown analysis type: ${e}`}),t}catch(e){return k.backgroundMonitor.logError(k.MetricTypes.SYSTEM.ERROR,{component:"analysis-loader",error:e.message,stack:e.stack}),null}}),[g]),f=(0,i.useCallback)((()=>{const e=k.backgroundMonitor.startMetric(k.MetricTypes.SYSTEM.PERFORMANCE,{action:"render-chart",commodity:r});try{return r&&null!=a&&a.length?null!=p&&p.length?(null==e||e.finish({status:"success",dataPoints:p.length}),(0,de.Y)(Be,{data:p,selectedCommodity:r,selectedRegimes:a})):(null==e||e.finish({status:"skipped",reason:"no-data"}),(0,de.Y)(et,{message:"No data available for the selected criteria."})):(null==e||e.finish({status:"skipped",reason:"missing-selection"}),(0,de.Y)(et,{message:"Please select at least one regime and a commodity from the sidebar."}))}catch(t){return null==e||e.finish({status:"error",error:t.message}),(0,de.Y)(et,{message:t.message})}}),[p,r,a]),v=(0,i.useCallback)((()=>{const e=k.backgroundMonitor.startMetric(k.MetricTypes.SYSTEM.PERFORMANCE,{action:"render-analysis",type:t});try{if(!t)return null==e||e.finish({status:"skipped",reason:"no-selection"}),null;const a=y(t);if(!a)return null==e||e.finish({status:"error",reason:"component-not-found"}),(0,de.Y)(et,{message:"Selected analysis type is not available."});const l="spatial"===t||"spatial_model"===t?{timeSeriesData:d,selectedCommodity:r,windowWidth:n,spatialViewConfig:o,onSpatialViewChange:s,mode:"spatial_model"===t?"model":"analysis"}:{data:d,selectedCommodity:r,windowWidth:n};return null==e||e.finish({status:"success"}),(0,de.Y)(i.Suspense,{fallback:(0,de.Y)(Je,{}),children:(0,de.Y)(rt,{children:(0,de.Y)(a,{...l})})})}catch(t){return null==e||e.finish({status:"error",error:t.message}),(0,de.Y)(et,{message:t.message})}}),[t,d,r,n,o,s,y]);return u?(0,de.Y)(ee.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:(0,de.Y)(Je,{})}):m?(0,de.Y)(et,{message:m}):(0,de.Y)(ee.A,{sx:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden",p:c?1:2},children:(0,de.FD)(ze.Ay,{container:!0,spacing:2,sx:{flexGrow:1,overflow:"auto"},children:[(0,de.Y)(ze.Ay,{item:!0,xs:12,md:12,children:(0,de.Y)(ee.A,{sx:{width:"100%",height:c?"250px":{xs:"300px",sm:"400px",md:"400px"},position:"relative",mb:2},children:f()})}),t&&(0,de.Y)(ze.Ay,{item:!0,xs:12,children:v()})]})})}));Gn.displayName="Dashboard",Gn.propTypes={selectedAnalysis:s().string,selectedCommodity:s().string.isRequired,selectedRegimes:s().arrayOf(s().string).isRequired,windowWidth:s().number.isRequired,spatialViewConfig:s().shape({center:s().arrayOf(s().number).isRequired,zoom:s().number.isRequired}),onSpatialViewChange:s().func};const Un=Gn;var Zn=r(72102),Xn=r(75107),Jn=r(15977);const Kn=(0,ne.Ay)($e.A)((e=>{let{theme:t}=e;return{padding:t.spacing(3),backgroundColor:"dark"===t.palette.mode?(0,fe.X4)(t.palette.error.dark,.2):(0,fe.X4)(t.palette.error.light,.1),border:`1px solid ${"dark"===t.palette.mode?t.palette.error.dark:t.palette.error.light}`,color:t.palette.error.main,marginTop:t.spacing(2),transition:t.transitions.create(["background-color","border-color","box-shadow"],{duration:t.transitions.duration.short}),"&:hover":{boxShadow:"dark"===t.palette.mode?`0 0 10px ${(0,fe.X4)(t.palette.error.main,.3)}`:`0 0 10px ${(0,fe.X4)(t.palette.error.light,.2)}`}}})),Qn=(0,ne.Ay)(ee.A)((e=>{let{theme:t}=e;return{marginTop:t.spacing(2),padding:t.spacing(2),backgroundColor:(t.palette.mode,(0,fe.X4)(t.palette.background.paper,.1)),borderRadius:t.shape.borderRadius,fontFamily:"monospace",fontSize:"0.875rem",whiteSpace:"pre-wrap",color:t.palette.text.primary,border:`1px solid ${t.palette.divider}`,transition:t.transitions.create(["background-color","border-color"],{duration:t.transitions.duration.short})}})),eo=e=>{let{error:t,title:r="Error",onRetry:a,showDetails:n=!1,className:o}=e;const[s,l]=(0,i.useState)(!1),c=(0,ge.A)(),d="string"==typeof t?t:null==t?void 0:t.message,u="object"==typeof t?null==t?void 0:t.details:null;return t?(0,de.Y)(Kn,{className:o,elevation:3,children:(0,de.FD)(ee.A,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:[(0,de.FD)(ee.A,{sx:{flex:1},children:[(0,de.Y)(se.A,{variant:"h6",gutterBottom:!0,sx:{color:c.palette.error.main,fontWeight:600},children:r}),(0,de.Y)(se.A,{variant:"body1",gutterBottom:!0,sx:{color:c.palette.text.primary,opacity:.9},children:d}),u&&n&&(0,de.FD)(de.FK,{children:[(0,de.FD)(Se.A,{size:"small",onClick:()=>l(!s),startIcon:s?(0,de.Y)(Zn.A,{size:18}):(0,de.Y)(Xn.A,{size:18}),sx:{mt:1,color:c.palette.text.secondary,"&:hover":{backgroundColor:"dark"===c.palette.mode?(0,fe.X4)(c.palette.common.white,.05):(0,fe.X4)(c.palette.common.black,.05)}},children:[s?"Hide":"Show"," Details"]}),(0,de.Y)(pt.A,{in:s,children:(0,de.Y)(Qn,{children:"string"==typeof u?u:JSON.stringify(u,null,2)})})]})]}),a&&(0,de.Y)(Se.A,{variant:"outlined",size:"small",startIcon:(0,de.Y)(Jn.A,{size:18}),onClick:a,sx:{color:c.palette.error.main,borderColor:c.palette.error.main,"&:hover":{borderColor:c.palette.error.dark,backgroundColor:"dark"===c.palette.mode?(0,fe.X4)(c.palette.error.main,.1):(0,fe.X4)(c.palette.error.light,.1)},transition:c.transitions.create(["background-color","border-color","color"],{duration:c.transitions.duration.short})},children:"Retry"})]})}):null};eo.propTypes={error:s().oneOfType([s().string,s().shape({message:s().string.isRequired,details:s().any})]).isRequired,title:s().string,onRetry:s().func,showDetails:s().bool,className:s().string};const to=eo;var ro=r(418);class io extends i.Component{constructor(e){super(e),(0,Yr.A)(this,"handleRetry",(async()=>{this.setState({isRetrying:!0});try{var e,t;await(null===(e=(t=this.props).onRetry)||void 0===e?void 0:e.call(t)),this.setState({hasError:!1,error:null,errorInfo:null,isRetrying:!1})}catch(e){this.setState({hasError:!0,error:e,isRetrying:!1})}})),this.state={hasError:!1,error:null,errorInfo:null,isRetrying:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){var r;this.setState({errorInfo:t}),null!==(r=window)&&void 0!==r&&r.Sentry&&window.Sentry.captureException(e,{extra:t})}render(){var e;return this.state.hasError?(0,de.FD)(ee.A,{sx:{p:3,maxWidth:"100%",backgroundColor:"background.paper",borderRadius:1,boxShadow:1},children:[(0,de.FD)(ee.A,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[(0,de.Y)(ro.A,{size:24,color:"error"}),(0,de.Y)(se.A,{variant:"h6",color:"error",children:"Application Error"})]}),(0,de.Y)(se.A,{variant:"body1",gutterBottom:!0,color:"text.primary",children:(null===(e=this.state.error)||void 0===e?void 0:e.message)||"An unexpected error occurred"}),!1,(0,de.FD)(ee.A,{sx:{mt:3,display:"flex",gap:2},children:[(0,de.Y)(Se.A,{onClick:this.handleRetry,disabled:this.state.isRetrying,startIcon:this.state.isRetrying?(0,de.Y)(Ue.A,{size:16}):(0,de.Y)(Jn.A,{className:"w-4 h-4"}),variant:"contained",color:"primary",children:this.state.isRetrying?"Retrying...":"Retry"}),(0,de.Y)(Se.A,{onClick:()=>window.location.reload(),variant:"outlined",color:"primary",children:"Reload Page"})]})]}):this.props.children}}io.propTypes={children:s().node.isRequired,onRetry:s().func};const ao=io;var no=r(80412),oo=r(46831),so=r(22477),lo=r(17809),co=r(10474),uo=r(30222),mo=r(19337),ho=r(55629),po=r(69149);const go=e=>{let{language:t,code:r}=e;const a=(0,ge.A)(),n="dark"===a.palette.mode,[o,s]=(0,i.useState)(!1),l=n?{...uo.A,'pre[class*="language-"]':{...uo.A['pre[class*="language-"]'],background:(0,fe.X4)(a.palette.background.paper,.5)},'code[class*="language-"]':{...uo.A['code[class*="language-"]'],color:a.palette.primary.light}}:{...mo.A,'pre[class*="language-"]':{...mo.A['pre[class*="language-"]'],background:(0,fe.X4)(a.palette.background.paper,.5)},'code[class*="language-"]':{...mo.A['code[class*="language-"]'],color:a.palette.primary.dark}};return(0,de.FD)(ee.A,{sx:{position:"relative",my:2,borderRadius:a.shape.borderRadius,overflow:"hidden",bgcolor:"dark"===a.palette.mode?(0,fe.X4)(a.palette.background.paper,.2):(0,fe.X4)(a.palette.background.paper,.5),border:`1px solid ${a.palette.divider}`,transition:a.transitions.create(["background-color","border-color","box-shadow"],{duration:a.transitions.duration.standard}),"&:hover":{boxShadow:"dark"===a.palette.mode?`0 4px 20px ${(0,fe.X4)(a.palette.common.black,.5)}`:a.shadows[4],borderColor:a.palette.primary.main}},children:[(0,de.Y)(ee.A,{sx:{position:"absolute",top:0,right:0,padding:a.spacing(1),background:"dark"===a.palette.mode?"linear-gradient(90deg, transparent, rgba(18, 18, 18, 0.8) 50%)":"linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.8) 50%)",borderBottomLeftRadius:a.shape.borderRadius,transition:a.transitions.create("background",{duration:a.transitions.duration.standard})},children:(0,de.Y)(mt.A,{title:o?"Copied!":"Copy Code",placement:"left",TransitionComponent:ht.A,TransitionProps:{timeout:300},children:(0,de.Y)(ie.A,{onClick:async()=>{try{await navigator.clipboard.writeText(r),s(!0),setTimeout((()=>s(!1)),2e3)}catch(e){}},size:"small",sx:{backgroundColor:"dark"===a.palette.mode?(0,fe.X4)(a.palette.background.paper,.1):(0,fe.X4)(a.palette.background.paper,.8),color:o?a.palette.success.main:a.palette.text.secondary,"&:hover":{backgroundColor:"dark"===a.palette.mode?(0,fe.X4)(a.palette.background.paper,.2):(0,fe.X4)(a.palette.background.paper,.9),transform:"scale(1.1)"},transition:a.transitions.create(["background-color","transform","color"],{duration:a.transitions.duration.shorter})},children:o?(0,de.Y)(po.A,{fontSize:"small"}):(0,de.Y)(ho.A,{fontSize:"small"})})})}),(0,de.Y)(ee.A,{sx:{position:"relative","&:before":{content:`"${t}"`,position:"absolute",top:a.spacing(1),left:a.spacing(1),color:a.palette.text.secondary,fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.1em",opacity:.7}},children:(0,de.Y)(co.A,{language:t,style:l,customStyle:{margin:0,padding:a.spacing(4,2,2,2),fontSize:"0.9rem",backgroundColor:"transparent",overflowX:"auto",fontFamily:'Consolas, Monaco, "Andale Mono", "Ubuntu Mono", monospace',transition:a.transitions.create("background-color",{duration:a.transitions.duration.standard})},wrapLongLines:!0,children:r})})]})};go.propTypes={language:s().string.isRequired,code:s().string.isRequired};const yo=go;var fo=r(64146);const vo=e=>{let{section:t,level:r}=e;const i=(0,ge.A)(),a={1:"h4",2:"h5",3:"h6",4:"subtitle1",5:"subtitle2",6:"body1"}[r]||"body1";return(0,de.FD)(ee.A,{sx:{mb:4,"&:hover":{"& > .MuiTypography-root:first-of-type":{color:"dark"===i.palette.mode?i.palette.primary.light:i.palette.primary.main}}},children:[(0,de.Y)(se.A,{component:"div",variant:a,sx:{mb:2,fontWeight:600,color:"dark"===i.palette.mode?i.palette.primary.light:i.palette.primary.main,transition:i.transitions.create("color",{duration:i.transitions.duration.standard}),borderBottom:`1px solid ${(0,fe.X4)("dark"===i.palette.mode?i.palette.primary.light:i.palette.primary.main,.1)}`,pb:1,"&:hover":{color:"dark"===i.palette.mode?i.palette.primary.main:i.palette.primary.dark}},children:t.title}),t.content&&(0,de.Y)(se.A,{variant:"body1",sx:{mb:2,textAlign:"justify",color:i.palette.text.primary,lineHeight:1.7,transition:i.transitions.create("color",{duration:i.transitions.duration.standard}),"& strong":{color:"dark"===i.palette.mode?i.palette.primary.light:i.palette.primary.main,fontWeight:600},"& em":{color:i.palette.text.secondary,fontStyle:"italic"}},children:(n=t.content,"string"==typeof n?n.split(/(\$.*?\$)/).map(((e,t)=>e.startsWith("$")&&e.endsWith("$")?(0,de.Y)(ee.A,{component:"span",sx:{display:"inline-flex",alignItems:"center",mx:.5,color:"dark"===i.palette.mode?i.palette.primary.light:i.palette.primary.main,transition:i.transitions.create("color",{duration:i.transitions.duration.standard})},children:(0,de.Y)(fo.InlineMath,{children:e.slice(1,-1)},t)}):e)):n)}),t.equation&&(0,de.Y)(ee.A,{sx:{my:3,px:2,py:3,backgroundColor:"dark"===i.palette.mode?(0,fe.X4)(i.palette.background.paper,.2):(0,fe.X4)(i.palette.background.paper,.5),borderRadius:i.shape.borderRadius,border:`1px solid ${i.palette.divider}`,transition:i.transitions.create(["background-color","border-color"],{duration:i.transitions.duration.standard}),"& .katex":{color:"dark"===i.palette.mode?i.palette.primary.light:i.palette.primary.main,transition:i.transitions.create("color",{duration:i.transitions.duration.standard})}},children:(0,de.Y)(fo.BlockMath,{children:t.equation})}),t.code&&t.code.map(((e,t)=>(0,de.Y)(ee.A,{sx:{my:3,transition:i.transitions.create("transform",{duration:i.transitions.duration.standard}),"&:hover":{transform:"scale(1.01)"}},children:(0,de.Y)(yo,{language:e.language,code:e.code})},t))),t.children&&t.children.map(((e,t)=>(0,de.Y)(ee.A,{sx:{ml:i.spacing(2),borderLeft:`2px solid ${i.palette.divider}`,pl:i.spacing(2),transition:i.transitions.create("border-color",{duration:i.transitions.duration.standard}),"&:hover":{borderColor:"dark"===i.palette.mode?i.palette.primary.light:i.palette.primary.main}},children:(0,de.Y)(vo,{section:e,level:r+1})},t)))]});var n};vo.propTypes={section:s().shape({id:s().string,title:s().string.isRequired,content:s().string,equation:s().string,code:s().arrayOf(s().shape({language:s().string,code:s().string})),children:s().array}).isRequired,level:s().number.isRequired};const bo=vo,Ao=[{title:"Methodology Overview",content:"The Yemen Market Analysis project employs a comprehensive methodological framework that integrates advanced econometric and spatial analysis techniques to examine the influence of conflict intensity on commodity prices across different regions of Yemen. This section delineates the systematic approach undertaken, encompassing data preprocessing, econometric modeling, spatial analysis, and data preparation for visualization. The methodology leverages robust statistical models, spatial econometric techniques, and parallel processing to ensure rigorous and scalable analyses."},{title:"1. Data Collection and Preprocessing",content:"This phase encompasses the acquisition, cleaning, and transformation of the data to prepare it for further analysis.",children:[{title:"1.1. Data Loading",content:"The analysis begins with the acquisition of spatial and temporal data encapsulated in GeoJSON files. The primary dataset, unified_data.geojson, contains detailed records of commodity prices, conflict intensity, and other relevant variables across multiple regions and time periods in Yemen.",children:[{title:"Loading Mechanism",content:"Utilizes GeoPandas to read GeoJSON files, ensuring efficient handling of geospatial data.",code:[{language:"python",code:"import geopandas as gpd\n  gdf = gpd.read_file('unified_data.geojson')"}]},{title:"Configuration Management",content:"Employs a YAML configuration file (config.yaml) to manage file paths, directories, and analysis parameters, promoting flexibility and scalability.",code:[{language:"yaml",code:"directories:\n    data_dir: 'project/data/'\n    processed_data_dir: 'project/data/processed/'\n    results_dir: 'results/'\n    logs_dir: 'results/logs/'\n    external_data_dir: 'external_data/'\n  \n  files:\n    spatial_geojson: 'project/data/processed/unified_data.geojson'\n    enhanced_geojson: 'project/data/processed/enhanced_unified_data_with_residuals.geojson'\n    spatial_analysis_results: 'results/spatial_analysis_results.json'\n    ecm_results: 'results/ecm/ecm_analysis_results.json'\n    spatial_weights_json: 'results/spatial_weights/spatial_weights.json'\n    naturalearth_lowres: 'external_data/naturalearth_lowres/ne_110m_admin_0_countries.shp'\n  \n  parameters:\n    frequency: 'M'\n    initial_k: 5\n    max_k: 20\n    min_common_dates: 20\n    lag_periods: 2\n    cointegration_max_lags: 5\n    granger_max_lags: 4\n    distance_threshold: 200\n    regimes_to_unify: ['north', 'south']\n    new_regime_name: 'unified'\n    exchange_rate_regime_column: 'exchange_rate_regime'\n    region_identifier: 'admin1'\n    time_column: 'date'\n    lag_variable: 'usdprice'\n    commodities: ['commodity1', 'commodity2']\n    exchange_rate_regimes: ['north', 'south', 'unified']\n    stationarity_significance_level: 0.05\n    cointegration_significance_level: 0.05\n    ridge_alpha: 1.0\n    max_epochs: 1000\n    learning_rate: 0.01\n    min_regions: 5\n    spatial_weights:\n      threshold_multiplier: 1\n    min_neighbors: 2\n  \n  logging:\n    level: 'INFO'\n    format: '%(asctime)s - %(levelname)s - %(message)s'"}]}]},{title:"1.2. Data Cleaning and Transformation",content:"Ensures the quality of the data by addressing issues such as duplicates, missing values, and inconsistent formats.",children:[{title:"Duplicate Removal",content:"Eliminates duplicate records to maintain data integrity.",code:[{language:"python",code:"gdf.drop_duplicates(inplace=True)"}]},{title:"Missing Values Handling",content:"Addresses missing values through imputation strategies, such as replacing with median values, to prevent skewed analyses.",code:[{language:"python",code:"from sklearn.impute import SimpleImputer\n  imputer = SimpleImputer(strategy='median')\n  gdf['usdprice'] = imputer.fit_transform(gdf[['usdprice']])"}]},{title:"Date Processing",content:"Converts date columns to datetime objects to facilitate time-series analyses.",code:[{language:"python",code:"gdf['date'] = pd.to_datetime(gdf['date'], errors='coerce')"}]},{title:"Categorical Data Encoding",content:"Transforms categorical variables (e.g., commodity, exchange_rate_regime) into suitable formats for modeling, including the creation of dummy variables.",code:[{language:"python",code:"gdf = pd.get_dummies(gdf, columns=['exchange_rate_regime'], drop_first=True)"}]},{title:"Regime Unification",content:"Consolidates specified exchange rate regimes into a unified category (unified) to streamline analyses across different economic conditions.",code:[{language:"python",code:"gdf.loc[gdf['exchange_rate_regime'].isin(['north', 'south']), 'exchange_rate_regime'] = 'unified'"}]}]},{title:"1.3. Data Resampling and Alignment",content:"Aligns the dataset to a consistent temporal frequency, ensuring uniformity across time-series analyses.",children:[{title:"Frequency Alignment",content:"Resamples the dataset to a consistent temporal frequency (e.g., monthly) to ensure uniformity across time-series analyses.",code:[{language:"python",code:"gdf.set_index('date', inplace=True)\n  gdf = gdf.groupby('region_id').resample('M').mean().reset_index()"}]},{title:"Grouping",content:"Aggregates data by commodity and exchange_rate_regime to facilitate targeted analyses within specific market conditions.",code:[{language:"python",code:"grouped_data = gdf.groupby(['commodity', 'exchange_rate_regime'])"}]}]}]},{title:"2. Econometric Modeling",content:"The project integrates multiple econometric models to dissect the relationship between conflict intensity and commodity prices.",children:[{title:"2.1. Error Correction Model (ECM)",content:"The ECM framework captures both short-term dynamics and long-term equilibrium relationships between variables, enabling the analysis of how deviations from equilibrium are corrected over time.",children:[{title:"Model Specification",content:"The ECM is derived from the Vector Error Correction Model (VECM), which is suitable for multivariate time series data exhibiting cointegration.",equation:"\\Delta Y_t = \\alpha \\beta' Y_{t-1} + \\sum_{i=1}^{p-1} \\Gamma_i \\Delta Y_{t-i} + u_t",children:[{title:"Variables",content:"Where:\n$\\Delta$ denotes the first difference operator.\n$Y_t$ is a vector of endogenous variables (e.g., usdprice, conflict_intensity).\n$\\alpha\\beta'$ captures the long-term equilibrium relationships.\n$\\Gamma_i$ are short-term adjustment coefficients.\n$u_t$ is the error term."}]},{title:"Stationarity Tests",content:"Conducts Augmented Dickey-Fuller (ADF) and Kwiatkowski-Phillips-Schmidt-Shin (KPSS) tests to ascertain the stationarity of time series data.",equation:"ADF: \\Delta y_t = \\alpha + \\beta t + \\gamma y_{t-1} + \\delta_1 \\Delta y_{t-1} + \\cdots + \\delta_p \\Delta y_{t-p} + \\epsilon_t\n\nKPSS: y_t = \\xi t + r_t + \\epsilon_t",children:[{title:"ADF Hypotheses",content:"$H_0$: Unit root present (non-stationary).\n$H_1$: No unit root (stationary)."},{title:"KPSS Hypotheses",content:"$H_0$: Stationary.\n$H_1$: Non-stationary."}]},{title:"Cointegration Analysis",content:"Utilizes the Engle-Granger method to detect cointegrated relationships, indicating a long-term equilibrium between commodity prices and conflict intensity.",children:[{title:"Engle-Granger Cointegration Test",content:"Step 1: Regress $y_t$ on $x_t$:\n$y_t = \\beta_0 + \\beta_1 x_t + u_t$\n\nStep 2: Test the residuals $u_t$ for stationarity using the ADF test.\n$H_0$: Residuals have a unit root (no cointegration).\n$H_1$: Residuals are stationary (cointegrated)."}]},{title:"Model Estimation",content:"Implements Vector Error Correction Models (VECM) using Statsmodels, selecting optimal lag orders based on Akaike Information Criterion (AIC).",equation:"AIC = 2k - 2\\ln(\\hat{L})",children:[{title:"Variables",content:"Where:\n$k$ is the number of parameters.\n$\\hat{L}$ is the maximized value of the likelihood function."}]},{title:"Diagnostics",content:"Performs a suite of diagnostic tests to validate the ECM.",children:[{title:"Breusch-Godfrey Test for Autocorrelation",equation:"LM = (n-p)R^2"},{title:"ARCH Test for Heteroskedasticity",equation:"LM = nR^2"},{title:"Jarque-Bera Test for Normality",equation:"JB = \\frac{n}{6}(S^2 + \\frac{1}{4}(K-3)^2)"},{title:"Durbin-Watson Test for Residual Autocorrelation",equation:"DW = \\frac{\\sum_{t=2}^T (e_t - e_{t-1})^2}{\\sum_{t=1}^T e_t^2}",content:"Where $e_t$ is the autocorrelation coefficient."}]},{title:"Impulse Response Functions (IRFs)",content:"Generates IRFs to assess the impact of shocks in conflict intensity on commodity prices over time.",equation:"IRF_{i,j,h} = \\frac{\\partial y_{i,t+h}}{\\partial \\varepsilon_{j,t}}",children:[{title:"Variables",content:"Where:\n$IRF_{i,j,h}$ measures the response of variable $i$ at horizon $h$ to a shock in variable $j$ at time 0."}]},{title:"Spatial Autocorrelation",content:"Evaluates Moran's I to detect spatial dependencies in the residuals, ensuring the validity of the model.",equation:"I = \\frac{N}{\\sum_{i=1}^{N} \\sum_{j=1}^{N} w_{ij}} \\cdot \\frac{\\sum_{i=1}^{N} \\sum_{j=1}^{N} w_{ij}(y_i - \\bar{y})(y_j - \\bar{y})}{\\sum_{i=1}^{N} (y_i - \\bar{y})^2}",children:[{title:"Variables",content:"Where:\n$N$ is the number of spatial units.\n$w_{ij}$ is the spatial weight between units $i$ and $j$.\n$y_i$ is the residual for unit $i$."}]}]},{title:"2.2. Price Differential Model",content:"This model examines the price disparities between different markets, considering the influence of conflict intensity and geographic factors.",children:[{title:"Price Differential Calculation",content:"Computes log price differentials between market pairs to analyze relative price movements.",equation:"\\Delta P_{ijt} = \\ln(P_{it}) - \\ln(P_{jt})",children:[{title:"Variables",content:"Where:\n$P_{it}$ is the price of commodity $i$ in market $t$.\n$P_{jt}$ is the price of commodity $j$ in market $t$."}]},{title:"Correlation Analysis",content:"Assesses Pearson correlations between conflict intensities across markets to understand inter-market conflict dynamics.",equation:"r = \\frac{\\sum_{i=1}^n (x_i - \\bar{x})(y_i - \\bar{y})}{\\sqrt{\\sum_{i=1}^n (x_i - \\bar{x})^2} \\sqrt{\\sum_{i=1}^n (y_i - \\bar{y})^2}}"},{title:"Regression Models",children:[{title:"Ordinary Least Squares (OLS)",content:"Estimates the relationship between price differentials and predictors with clustered standard errors to account for intra-group correlations.",equation:"\\Delta P_{ijt} = \\beta_0 + \\beta_1 Distance_{ij} + \\beta_2 ConflictCorr_{ijt} + \\alpha_i + \\epsilon_{ijt}",children:[{title:"Variables",content:"Where:\n$\\beta_0$ is the intercept.\n$\\beta_1$ and $\\beta_2$ are coefficients for distance and conflict correlation, respectively.\n$\\alpha_i$ captures fixed effects for entities.\n$\\epsilon_{ijt}$ is the error term."}]},{title:"Fixed Effects (FE) Model",content:"Controls for unobserved heterogeneity by incorporating entity-specific effects.",equation:"y_{it} = \\alpha_i + X_{it}\\beta + \\epsilon_{it}",children:[{title:"Variables",content:"Where:\n$\\alpha_i$ represents fixed effects for each entity (e.g., market)."}]},{title:"Random Effects (RE) Model",content:"Assumes random variations across entities, providing a comparison to the FE model.",equation:"y_{it} = \\alpha + X_{it}\\beta + u_i + \\epsilon_{it}",children:[{title:"Variables",content:"Where:\n$u_i$ is the random effect."}]},{title:"Instrumental Variables (IV) Model (IV2SLS)",content:"Addresses potential endogeneity issues by using instrumental variables.",equation:"y = X\\beta + \\epsilon, \\ X = Z\\Pi + v",children:[{title:"Variables",content:"Where $X$ is endogenous and instrumented by $Z$."}]}]},{title:"Diagnostics",content:"Includes Variance Inflation Factor (VIF) for multicollinearity assessment, Breusch-Pagan for heteroskedasticity, Durbin-Watson for autocorrelation, Jarque-Bera for normality, and Ramsey RESET for model specification.",children:[{title:"Variance Inflation Factor (VIF)",equation:"VIF_j = \\frac{1}{1-R_j^2}",content:"Where $R_j^2$ is the coefficient of determination of regressing the $j$th predictor on all other predictors."},{title:"Breusch-Pagan Test",equation:"BP = nR^2"},{title:"Durbin-Watson Test",equation:"DW = \\frac{\\sum_{t=2}^T (e_t - e_{t-1})^2}{\\sum_{t=1}^T e_t^2}"},{title:"Jarque-Bera Test",equation:"JB = \\frac{n}{6}(S^2 + \\frac{1}{4}(K-3)^2)",content:"Where $S$ is skewness and $K$ is kurtosis."},{title:"Ramsey RESET Test",equation:"RESET = \\frac{(RSS_1 - RSS_2) / q}{RSS_2 / (n-k-q)}"}]},{title:"Model Comparison",content:"Evaluates models based on Akaike Information Criterion (AIC) and Bayesian Information Criterion (BIC) to determine the best-fitting model.",children:[{title:"AIC",equation:"AIC = 2k - 2\\ln(\\hat{L})"},{title:"BIC",equation:"BIC = k\\ln(n) - 2\\ln(\\hat{L})",children:[{title:"Variables",content:"Where:\n$k$ is the number of parameters.\n$\\hat{L}$ is the maximized value of the likelihood function.\n$n$ is the number of observations."}]}]}]}]},{title:"3. Spatial Econometric Analysis",content:"Spatial econometric techniques are pivotal in understanding the geographical interdependencies and spatial spillover effects in the data.",children:[{title:"3.1. Spatial Weights Matrix Construction",content:"Constructs spatial weights matrices using KNN, dynamically adjusting the number of neighbors (k) to ensure full connectivity of the spatial network.",children:[{title:"K-Nearest Neighbors (KNN)",content:"Constructs spatial weights matrices using KNN, dynamically adjusting the number of neighbors (k) to ensure full connectivity of the spatial network.",equation:"w_{ij} = \\begin{cases} 1 & \\text{if } j \\text{ is one of the } k \\text{ nearest neighbors of } i \\\\ 0 & \\text{otherwise} \\end{cases}"},{title:"Connectivity Verification",content:"Ensures that the spatial weights matrix is fully connected, preventing isolated regions from skewing the analysis.",code:[{language:"python",code:"import networkx as nx\n  G = w.to_networkx()\n  is_connected = nx.is_connected(G.to_undirected())"}]},{title:"Exporting Weights",content:"Saves the spatial weights matrices in JSON format for reproducibility and further analyses.",code:[{language:"python",code:"import json\n  with open('spatial_weights.json', 'w') as f:\n      json.dump(weights_dict, f, indent=2)"}]}]},{title:"3.2. Spatial Lag Calculation",content:"Computes spatial lags (e.g., spatial lag of usdprice) to incorporate the influence of neighboring regions into the regression models.",equation:"Wy = \\rho \\sum_{j=1}^n w_{ij}y_j",children:[{title:"Variables",content:"Where:\n$\\rho$ is the spatial autoregressive parameter.\n$w_{ij}$ is the spatial weight between regions $i$ and $j$."},{title:"Ridge Regression with Spatial Lag",content:"Performs Ridge regression, including spatially lagged variables to mitigate multicollinearity and stabilize coefficient estimates.",equation:"\\hat{\\beta} = (X^TX + \\lambda I)^{-1}X^Ty",children:[{title:"Variables",content:"Where:\n$\\lambda$ is the regularization parameter.\n$X$ are the predictors, including spatial lags."}]}]},{title:"3.3. Spatial Autocorrelation Assessment",content:"Calculates Moran's I statistic on residuals from regression models to detect spatial autocorrelation, ensuring that spatial dependencies are appropriately modeled.",equation:"I = \\frac{N}{\\sum_{i=1}^{N} \\sum_{j=1}^{N} w_{ij}} \\cdot \\frac{\\sum_{i=1}^{N} \\sum_{j=1}^{N} w_{ij}(y_i - \\bar{y})(y_j - \\bar{y})}{\\sum_{i=1}^{N} (y_i - \\bar{y})^2}",children:[{title:"Interpretation",content:"$I > 0$: Positive spatial autocorrelation.\n$I < 0$: Negative spatial autocorrelation.\n$I \\approx 0$: No spatial autocorrelation."},{title:"Implementation",code:[{language:"python",code:"from esda.moran import Moran\n  moran = Moran(residual, w)"}]}]},{title:"Network Flow Maps",content:"Generates flow maps representing spatial relationships and dependencies between regions, facilitating the visualization of spatial interactions.",children:[{title:"Flow Map Specification",content:"Each flow represents the spatial interaction between a source region and its neighboring target regions, weighted by the spatial lag or other relevant metrics.",code:[{language:"python",code:"import pandas as pd\n  flow_df = pd.DataFrame(flow_data)\n  flow_df.to_csv('flow_maps.csv', index=False)"}]}]}]},{title:"4. Data Preparation for Visualization",content:"Effective visualization is integral to interpreting the analytical outcomes and communicating findings.",children:[{title:"4.1. Choropleth Maps",content:"Maps the mean commodity prices across regions and time periods to identify spatial price distributions.",children:[{title:"Average Prices",equation:"\\text{Avg\\_Price}_{it} = \\frac{1}{N_{it}} \\sum_{j=1}^{N_{it}} P_{ijt}",children:[{title:"Variables",content:"Where:\n$\\text{Avg\\_Price}_{it}$ is the average price of commodity $i$ in region $t$.\n$N_{it}$ is the number of observations for commodity $i$ in region $t$.\n$P_{ijt}$ is the price of commodity $i$ in sub-region $j$ at time $t$."}]},{title:"Conflict Intensity",content:"Visualizes the average conflict intensity per region, highlighting areas with heightened conflict.",equation:"\\text{Avg\\_Conflict}_{it} = \\frac{1}{N_{it}} \\sum_{j=1}^{N_{it}} C_{ijt}",children:[{title:"Variables",content:"Where:\n$C_{ijt}$ is the conflict intensity in sub-region $j$ for region $i$."}]},{title:"Price Changes",content:"Illustrates percentage changes in prices over time, revealing temporal trends and volatility.",equation:"\\text{Price\\_Change}_{it} (\\%) = \\left( \\frac{P_{it} - P_{i(t-1)}}{P_{i(t-1)}} \\right) \\times 100"},{title:"Residuals",content:"Depicts residuals from econometric models to identify unexplained variations and potential areas of interest.",equation:"e_{it} = y_{it} - \\hat{y}_{it}",children:[{title:"Variables",content:"Where:\n$y_{it}$ is the observed value.\n$\\hat{y}_{it}$ is the predicted value from the model."}]}]},{title:"4.2. Time Series Data",content:"Prepares time series datasets for commodity prices and conflict intensity, enabling temporal trend analyses and forecasting.",children:[{title:"Price Time Series",equation:"P_{it} = f(t, D_{ij}, CC_{ijt})",children:[{title:"Variables",content:"Where:\n$D_{ij}$ is the distance metric between markets.\n$CC_{ijt}$ is the conflict correlation."}]},{title:"Conflict Intensity Time Series",equation:"CI_{it} = f(t, X_{it})",children:[{title:"Variables",content:"Where:\n$X_{it}$ represents structural variables influencing conflict intensity."}]}]},{title:"4.3. Network Flow Maps",content:"Constructs network graphs illustrating the flow of economic interactions and dependencies between regions, informed by the spatial weights matrices.",children:[{title:"Flow Map Construction",content:"Each edge in the network represents a spatial interaction between two regions, weighted by spatial lag variables or economic metrics.",code:[{language:"python",code:"import networkx as nx\n  G = nx.from_pandas_edgelist(flow_df, 'source', 'target', ['weight'])"}]}]}]},{title:"5. Parallel Processing and Optimization",content:"To handle computationally intensive tasks efficiently, the project leverages parallel processing techniques.",children:[{title:"Multiprocessing",content:"Utilizes Python's multiprocessing and concurrent.futures modules to execute multiple analyses concurrently, significantly reducing processing time.",code:[{language:"python",code:"from concurrent.futures import ProcessPoolExecutor, as_completed\n  with ProcessPoolExecutor(max_workers=cpu_count()) as executor:\n      futures = [executor.submit(analyze, args) for args in analysis_args]\n      for future in as_completed(futures):\n          results.append(future.result())"}]},{title:"Caching Mechanisms",content:"Implements caching strategies using Joblib to optimize repeated data loading and processing steps.",code:[{language:"python",code:"from joblib import Memory\n  memory = Memory(location='cache', verbose=0)\n  \n  @memory.cache\n  def load_data(file_path):\n      return pd.read_csv(file_path)"}]},{title:"Data Optimization",content:"Simplifies geometries and optimizes data types to enhance performance and minimize memory usage, ensuring scalability for large datasets.",code:[{language:"python",code:"gdf['geometry'] = gdf['geometry'].simplify(tolerance=0.01, preserve_topology=True)\n  gdf['usdprice'] = gdf['usdprice'].astype('float32')"}]}]},{title:"6. Result Aggregation and Saving",content:"All analytical outcomes are systematically aggregated and stored for downstream applications and reporting.",children:[{title:"JSON and CSV Outputs",content:"Saves results in JSON and CSV formats, facilitating ease of access and integration with visualization tools.",code:[{language:"python",code:"import json\n  with open('results.json', 'w') as f:\n      json.dump(results, f, indent=4, cls=NumpyEncoder)"}]},{title:"Logging",content:"Maintains detailed logs of all processes and analyses, ensuring transparency and facilitating debugging and reproducibility.",code:[{language:"python",code:"import logging\n  logging.basicConfig(filename='analysis.log', level=logging.INFO)\n  logger = logging.getLogger(__name__)"}]}]}],wo=e=>{let{searchQuery:t}=e;const r=(0,ge.A)(),a=(0,i.useMemo)((()=>{if(!t)return Ao;const e=t.toLowerCase(),r=t=>t.map((t=>{const i=t.title.toLowerCase().includes(e)||t.content&&t.content.toLowerCase().includes(e),a=t.children?r(t.children):[];return i||a.length>0?{...t,children:a}:null})).filter(Boolean);return r(Ao)}),[t]);return(0,de.Y)(ee.A,{sx:{padding:r.spacing(2),color:r.palette.text.primary,backgroundColor:"dark"===r.palette.mode?(0,fe.X4)(r.palette.background.paper,.6):r.palette.background.paper,borderRadius:r.shape.borderRadius,transition:r.transitions.create(["background-color","color"],{duration:r.transitions.duration.standard}),"& > *:not(:last-child)":{marginBottom:r.spacing(4)},"& h1, & h2, & h3, & h4, & h5, & h6":{color:"dark"===r.palette.mode?r.palette.primary.light:r.palette.primary.main,fontWeight:600,marginBottom:r.spacing(2),transition:r.transitions.create("color",{duration:r.transitions.duration.standard})},"& p":{color:r.palette.text.primary,lineHeight:1.7,marginBottom:r.spacing(2),transition:r.transitions.create("color",{duration:r.transitions.duration.standard})},"& a":{color:"dark"===r.palette.mode?r.palette.primary.light:r.palette.primary.main,textDecoration:"none",borderBottom:`1px solid ${(0,fe.X4)(r.palette.primary.main,.3)}`,transition:r.transitions.create(["color","border-color"],{duration:r.transitions.duration.standard}),"&:hover":{color:r.palette.primary.main,borderBottomColor:r.palette.primary.main}},"& code":{backgroundColor:"dark"===r.palette.mode?(0,fe.X4)(r.palette.common.white,.1):(0,fe.X4)(r.palette.common.black,.05),padding:r.spacing(.5,1),borderRadius:r.shape.borderRadius,fontFamily:'Consolas, Monaco, "Andale Mono", "Ubuntu Mono", monospace',fontSize:"0.875em",color:"dark"===r.palette.mode?r.palette.primary.light:r.palette.primary.dark,transition:r.transitions.create(["background-color","color"],{duration:r.transitions.duration.standard})},"& pre":{backgroundColor:"dark"===r.palette.mode?(0,fe.X4)(r.palette.common.black,.3):(0,fe.X4)(r.palette.common.black,.05),padding:r.spacing(2),borderRadius:r.shape.borderRadius,overflow:"auto",marginBottom:r.spacing(2),transition:r.transitions.create("background-color",{duration:r.transitions.duration.standard}),"& code":{backgroundColor:"transparent",padding:0}},"& ul, & ol":{paddingLeft:r.spacing(3),marginBottom:r.spacing(2),"& li":{marginBottom:r.spacing(1),color:r.palette.text.primary,transition:r.transitions.create("color",{duration:r.transitions.duration.standard})}},"& blockquote":{borderLeft:`4px solid ${"dark"===r.palette.mode?r.palette.primary.light:r.palette.primary.main}`,margin:r.spacing(2,0),padding:r.spacing(1,2),backgroundColor:"dark"===r.palette.mode?(0,fe.X4)(r.palette.primary.main,.1):(0,fe.X4)(r.palette.primary.light,.1),color:r.palette.text.primary,transition:r.transitions.create(["background-color","border-color","color"],{duration:r.transitions.duration.standard})}},children:a.map(((e,t)=>(0,de.Y)(bo,{section:e,level:1},t)))})};wo.propTypes={searchQuery:s().string};const _o=wo,xo=e=>{let{open:t,onClose:r}=e;const i=(0,ge.A)(),a=(0,Q.A)(i.breakpoints.up("sm"));return(0,de.FD)(no.A,{open:t,onClose:r,fullScreen:!a,fullWidth:!0,maxWidth:"lg",scroll:"paper",PaperProps:{sx:{borderRadius:{xs:0,sm:2},boxShadow:"dark"===i.palette.mode?`0 8px 32px ${(0,fe.X4)(i.palette.common.black,.5)}`:i.shadows[5],maxHeight:"90vh",bgcolor:i.palette.background.paper,backgroundImage:"none",transition:i.transitions.create(["background-color","box-shadow"],{duration:i.transitions.duration.standard})}},TransitionProps:{timeout:{enter:i.transitions.duration.enteringScreen,exit:i.transitions.duration.leavingScreen}},slotProps:{backdrop:{sx:{backgroundColor:"dark"===i.palette.mode?(0,fe.X4)(i.palette.common.black,.8):(0,fe.X4)(i.palette.common.black,.5)}}},children:[(0,de.FD)(oo.A,{sx:{m:0,p:2,bgcolor:"dark"===i.palette.mode?(0,fe.X4)(i.palette.primary.dark,.9):i.palette.primary.main,color:i.palette.primary.contrastText,position:"relative",display:"flex",alignItems:"center",transition:i.transitions.create(["background-color","color"],{duration:i.transitions.duration.standard}),borderBottom:`1px solid ${i.palette.divider}`},children:[(0,de.Y)(se.A,{variant:"h6",sx:{flexGrow:1,fontWeight:600,letterSpacing:.5},children:"Methodology"}),(0,de.Y)(ie.A,{"aria-label":"close",onClick:r,size:"large",sx:{color:i.palette.primary.contrastText,transition:i.transitions.create(["background-color","transform"],{duration:i.transitions.duration.shorter}),"&:hover":{backgroundColor:"dark"===i.palette.mode?(0,fe.X4)(i.palette.common.white,.1):(0,fe.X4)(i.palette.common.black,.1),transform:"rotate(90deg)"}},children:(0,de.Y)(lo.A,{})})]}),(0,de.Y)(so.A,{dividers:!0,sx:{padding:i.spacing(3),bgcolor:i.palette.background.default,transition:i.transitions.create(["background-color"],{duration:i.transitions.duration.standard}),"& > *":{transition:i.transitions.create(["color","background-color"],{duration:i.transitions.duration.standard})},overflowY:"auto",scrollbarWidth:"thin",scrollbarColor:"dark"===i.palette.mode?`${(0,fe.X4)(i.palette.common.white,.2)} ${(0,fe.X4)(i.palette.common.black,.3)}`:`${(0,fe.X4)(i.palette.common.black,.2)} ${(0,fe.X4)(i.palette.common.white,.3)}`,"&::-webkit-scrollbar":{width:"8px"},"&::-webkit-scrollbar-track":{backgroundColor:"dark"===i.palette.mode?(0,fe.X4)(i.palette.common.black,.3):(0,fe.X4)(i.palette.common.white,.3)},"&::-webkit-scrollbar-thumb":{backgroundColor:"dark"===i.palette.mode?(0,fe.X4)(i.palette.common.white,.2):(0,fe.X4)(i.palette.common.black,.2),borderRadius:"4px","&:hover":{backgroundColor:"dark"===i.palette.mode?(0,fe.X4)(i.palette.common.white,.3):(0,fe.X4)(i.palette.common.black,.3)}}},children:(0,de.Y)(_o,{})})]})};xo.propTypes={open:s().bool.isRequired,onClose:s().func.isRequired};const ko=xo;var So=r(77867),Mo=r(58763),Co=r(68864);const Yo=i.memo((e=>{let{open:t,onClose:r}=e;const[a,n]=i.useState(!1),o=(0,ge.A)(),s=(0,Q.A)(o.breakpoints.down("sm")),l=()=>{r(a)};return(0,de.FD)(no.A,{open:t,onClose:l,fullWidth:!0,maxWidth:"md",fullScreen:s,"aria-labelledby":"welcome-modal-title","aria-describedby":"welcome-modal-description",children:[(0,de.Y)(oo.A,{id:"welcome-modal-title",children:"Welcome to the Commodity and Conflict Analysis Dashboard"}),(0,de.Y)(so.A,{dividers:!0,children:(0,de.FD)(So.A,{id:"welcome-modal-description",component:"div",children:[(0,de.Y)(se.A,{variant:"body1",gutterBottom:!0,children:"This dashboard allows you to explore the relationship between commodity prices and conflict intensity through interactive analyses and visualizations."}),(0,de.Y)(se.A,{variant:"h6",gutterBottom:!0,sx:{mt:2},children:"How to Use the Dashboard:"}),(0,de.FD)(gt.A,{children:[(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:(0,de.FD)(de.FK,{children:[(0,de.Y)("strong",{children:"Select a Commodity:"})," Use the dropdown menu in the sidebar to choose a commodity you're interested in analyzing."]})})}),(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:(0,de.FD)(de.FK,{children:[(0,de.Y)("strong",{children:"Navigate Analyses:"})," Explore different analyses such as Error Correction Model (ECM) and Price Differential Analysis using the buttons in the sidebar."]})})}),(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:(0,de.FD)(de.FK,{children:[(0,de.Y)("strong",{children:"Interactive Charts:"})," Hover over charts to see detailed information, and use the provided controls to customize your view."]})})}),(0,de.Y)(ye.Ay,{children:(0,de.Y)(xe.A,{primary:(0,de.FD)(de.FK,{children:[(0,de.Y)("strong",{children:"Access Tutorials:"}),' Click on the "Tutorials" button in the sidebar to learn more about the methods used.']})})})]}),(0,de.Y)(se.A,{variant:"body1",gutterBottom:!0,sx:{mt:2},children:"We hope this dashboard provides valuable insights into commodity markets and conflict dynamics. If you have any questions or feedback, feel free to contact us."})]})}),(0,de.FD)(Mo.A,{children:[(0,de.Y)(Co.A,{control:(0,de.Y)(_e.A,{checked:a,onChange:e=>{n(e.target.checked)},color:"primary"}),label:"Don't show this again"}),(0,de.Y)(Se.A,{onClick:l,variant:"contained",color:"primary","aria-label":"Close Welcome Modal",children:"Get Started"})]})]})}));Yo.displayName="WelcomeModal",Yo.propTypes={open:s().bool.isRequired,onClose:s().func.isRequired};var Do=r(87992),Io=r(98821);const Ro=()=>{const e=(0,n.d4)(De.tr),t=(0,n.d4)(De.nF),r=(0,n.d4)(De.T9);return(0,de.Y)(mt.A,{title:"Export Analysis Data",children:(0,de.Y)(Do.A,{color:"primary",onClick:()=>{const i={spatial:e,flows:t,geometry:r},a=new Blob([JSON.stringify(i,null,2)],{type:"application/json"}),n=URL.createObjectURL(a),o=document.createElement("a");o.href=n,o.download=`market-analysis-export-${(new Date).toISOString()}.json`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(n)},sx:{position:"fixed",bottom:16,right:16},children:(0,de.Y)(Io.A,{})})})};var Fo=r(30762),No=r(2562);const zo={breakpoints:{values:{xs:0,sm:600,md:960,lg:1280,xl:1920}},typography:{fontFamily:'"Roboto", "Helvetica Neue", "Arial", sans-serif',h1:{fontFamily:'"Roboto", "Helvetica Neue", "Arial", sans-serif',fontWeight:700},h2:{fontFamily:'"Roboto", "Helvetica Neue", "Arial", sans-serif',fontWeight:700},h3:{fontFamily:'"Roboto", "Helvetica Neue", "Arial", sans-serif',fontWeight:700},h4:{fontFamily:'"Roboto", "Helvetica Neue", "Arial", sans-serif',fontWeight:700},h5:{fontFamily:'"Roboto", "Helvetica Neue", "Arial", sans-serif',fontWeight:700},h6:{fontFamily:'"Roboto", "Helvetica Neue", "Arial", sans-serif',fontWeight:700},subtitle1:{fontWeight:600},body1:{fontSize:"1rem",lineHeight:1.7},body2:{fontSize:"0.875rem",lineHeight:1.7}},shape:{borderRadius:4},spacing:8},Eo={primary:{main:"#002244",light:"#003366",dark:"#001a33",contrastText:"#ffffff"},secondary:{main:"#009FDA",light:"#33b1e1",dark:"#006e98",contrastText:"#ffffff"},success:{main:"#4C9F38",light:"#6ab553",dark:"#357027"},warning:{main:"#F0AB00",light:"#ffbe2f",dark:"#b88000"},error:{main:"#E73F3F",light:"#eb6565",dark:"#c62828"},info:{main:"#0077BB",light:"#3391c9",dark:"#005282"}},To=(0,No.A)({...zo,palette:{mode:"light",...Eo,background:{default:"#f8f9fa",paper:"#ffffff",sidebar:"#ffffff"},text:{primary:"#1a1a1a",secondary:"#4f4f4f"},divider:"rgba(0, 0, 0, 0.12)",action:{hover:(0,fe.X4)("#000000",.04),selected:(0,fe.X4)(Eo.primary.main,.08),selectedOpacity:.08,focus:(0,fe.X4)(Eo.primary.main,.12)}}}),Po=(0,No.A)({...zo,palette:{mode:"dark",...Eo,background:{default:"#1a1a1a",paper:"#262626",sidebar:"#1e1e1e"},text:{primary:"#ffffff",secondary:"#b3b3b3"},divider:"rgba(255, 255, 255, 0.12)",action:{hover:(0,fe.X4)("#ffffff",.08),selected:(0,fe.X4)(Eo.primary.light,.16),selectedOpacity:.16,focus:(0,fe.X4)(Eo.primary.light,.12)}}}),Oo={components:{MuiCssBaseline:{styleOverrides:e=>({":root":{"--mui-palette-primary-main":e.palette.primary.main,"--mui-palette-background-paper":e.palette.background.paper,"--mui-palette-background-default":e.palette.background.default,"--mui-palette-text-primary":e.palette.text.primary,"--mui-palette-text-secondary":e.palette.text.secondary,"--mui-palette-action-hover":e.palette.action.hover,"--mui-shadow-1":e.shadows[1],"--mui-shadow-2":e.shadows[2]}})},MuiDrawer:{styleOverrides:{paper:e=>{let{theme:t}=e;return{backgroundColor:t.palette.background.sidebar,backgroundImage:"none","& .MuiDivider-root":{borderColor:t.palette.divider}}}}},MuiListItemButton:{styleOverrides:{root:e=>{let{theme:t}=e;return{"&.Mui-selected":{backgroundColor:t.palette.action.selected,"&:hover":{backgroundColor:(0,fe.X4)(t.palette.primary.main,t.palette.action.selectedOpacity+.04)}},"&:hover":{backgroundColor:t.palette.action.hover}}}}},MuiSelect:{styleOverrides:{icon:e=>{let{theme:t}=e;return{color:t.palette.text.secondary}}}},MuiButton:{styleOverrides:{root:{textTransform:"none",borderRadius:4,fontWeight:600,padding:"8px 24px"},contained:{boxShadow:"none","&:hover":{boxShadow:"0 2px 4px rgba(0,0,0,0.15)"}},outlined:e=>{let{theme:t}=e;return{borderColor:t.palette.divider,"&:hover":{borderColor:t.palette.primary.main,backgroundColor:(0,fe.X4)(t.palette.primary.main,.04)}}}}},MuiPaper:{styleOverrides:{root:{borderRadius:4,boxShadow:"0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24)"},elevation1:{boxShadow:"0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24)"}}},MuiCard:{styleOverrides:{root:{borderRadius:4,boxShadow:"0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24)"}}},MuiTypography:{styleOverrides:{root:{"&.MuiTypography-h1, &.MuiTypography-h2, &.MuiTypography-h3, &.MuiTypography-h4, &.MuiTypography-h5, &.MuiTypography-h6":{fontFamily:'"Roboto", "Helvetica Neue", "Arial", sans-serif',marginBottom:"0.5em"}}}},MuiToggleButton:{styleOverrides:{root:{fontWeight:600,"&.Mui-selected":{backgroundColor:Eo.primary.main,color:"#ffffff","&:hover":{backgroundColor:Eo.primary.dark}}}}},MuiChart:{styleOverrides:{root:e=>({"& .recharts-cartesian-grid-horizontal line, & .recharts-cartesian-grid-vertical line":{stroke:e.palette.divider},"& .recharts-text":{fill:e.palette.text.primary},"& .recharts-legend-item-text":{color:e.palette.text.primary},"& .recharts-tooltip":{backgroundColor:e.palette.background.paper,border:`1px solid ${e.palette.divider}`,boxShadow:e.shadows[2]}})}}}},$o=(0,No.A)(To,Oo),Lo=(0,No.A)(Po,Oo),jo=(e,t)=>r=>{try{var i;return null!==(i=e(r))&&void 0!==i?i:t}catch(e){return t}};var qo=r(68238),Wo=r(79448);const Vo={theme:h,welcomeModal:f};const Ho={whitelist:["theme","welcomeModal"],storage:window.localStorage,key:"yemen-market-analysis"};function Bo(){try{const e=Ho.storage.getItem(Ho.key);return e?JSON.parse(e):{}}catch(e){return k.backgroundMonitor.logError("state-load-error",e),{}}}const Go=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=k.backgroundMonitor.startMetric(k.MetricTypes.SYSTEM.INIT,{component:"store-config"});try{const r=function(e){const t={...e};let r=(0,qo.HY)(t),i=[];return{getReducerMap:()=>t,reduce:(e,t)=>{if(i.length>0){e={...e};for(const t of i)delete e[t];i=[]}return r(e,t)},add:(e,i)=>{if(!e||t[e])return;const a=k.backgroundMonitor.startMetric(k.MetricTypes.SYSTEM.INIT,{action:"add-reducer",reducer:e});try{t[e]=i,r=(0,qo.HY)(t),a.finish({status:"success"})}catch(e){throw a.finish({status:"error",error:e.message}),e}},remove:e=>{if(!e||!t[e])return;const a=k.backgroundMonitor.startMetric(k.MetricTypes.SYSTEM.INIT,{action:"remove-reducer",reducer:e});try{delete t[e],i.push(e),r=(0,qo.HY)(t),a.finish({status:"success"})}catch(e){throw a.finish({status:"error",error:e.message}),e}}}}(Vo),i=!1,a=e=>{const t=[...e({thunk:{extraArgument:{backgroundMonitor:k.backgroundMonitor,MetricTypes:k.MetricTypes},timeout:3e4},serializableCheck:{warnAfter:2e3},immutableCheck:{warnAfter:1e3}})];if(i){const e=(0,Wo.createLogger)({collapsed:!0,duration:!0,timestamp:!0,colors:{title:e=>e.error?"red":"blue",prevState:()=>"#9E9E9E",action:()=>"#03A9F4",nextState:()=>"#4CAF50",error:()=>"#F20404"},predicate:(e,t)=>!!t.type});t.push(e)}return t},n=(0,l.U1)({reducer:r.reduce,middleware:a,preloadedState:{...e,...Bo()},devTools:i&&{maxAge:50,trace:!0,traceLimit:25}});return n.reducerManager=r,n.injectReducer=async(e,t)=>{const r=k.backgroundMonitor.startMetric(k.MetricTypes.SYSTEM.INIT,{action:"inject-reducer",reducer:e});try{if(n.reducerManager.getReducerMap()[e])return void r.finish({status:"skipped",reason:"already-exists"});const i=await t();return n.reducerManager.add(e,i.default||i),r.finish({status:"success"}),i}catch(e){throw r.finish({status:"error",error:e.message}),e}},function(e){e.subscribe((()=>{const t=e.getState(),r={};Ho.whitelist.forEach((e=>{t[e]&&(r[e]=t[e])}));try{Ho.storage.setItem(Ho.key,JSON.stringify(r))}catch(e){k.backgroundMonitor.logError("state-persistence-error",e)}}))}(n),t.finish({status:"success",reducerCount:Object.keys(r.getReducerMap()).length}),n}catch(e){throw t.finish({status:"error",error:e.message}),e}};let Uo=null;const Zo=240,Xo="2020-10-01",Jo=(0,ne.Ay)(oe.A,{shouldForwardProp:e=>"open"!==e})((e=>{let{theme:t,open:r}=e;return{zIndex:t.zIndex.drawer+1,transition:t.transitions.create(["margin-left","width"],{easing:t.transitions.easing.sharp,duration:t.transitions.duration.leavingScreen}),[t.breakpoints.up("sm")]:{width:`calc(100% - ${r?Zo:0}px)`,marginLeft:r?"240px":0}}})),Ko=()=>{const{dispatch:e,data:t,loading:r,error:a,hasSeenWelcome:o,isDarkMode:s,commodities:l,theme:c}=(()=>{const e=(0,n.wA)(),t=(0,n.d4)(jo((e=>{var t;return null===(t=e.spatial)||void 0===t||null===(t=t.status)||void 0===t?void 0:t.error}),d.ue.status.error),x().isEqual),r=(0,n.d4)(jo((e=>{var t;return null===(t=e.welcomeModal)||void 0===t?void 0:t.hasSeenWelcome}),!1),x().isEqual),a=(0,n.d4)(jo((e=>{var t;return null===(t=e.theme)||void 0===t?void 0:t.isDarkMode}),!1),x().isEqual),o=(0,n.d4)(jo(d.a5,{commodities:[],selectedCommodity:"",loading:!1,uniqueMonths:[]}),x().isEqual),s=(0,n.d4)(jo((e=>{var t;return null===(t=e.spatial)||void 0===t?void 0:t.data}),d.ue.data),x().isEqual),l=(0,n.d4)(jo((e=>{var t;return null===(t=e.spatial)||void 0===t||null===(t=t.status)||void 0===t?void 0:t.loading}),d.ue.status.loading),x().isEqual),c=(0,n.d4)(jo((e=>{var t;return null===(t=e.flow)||void 0===t||null===(t=t.status)||void 0===t?void 0:t.loading}),!1),x().isEqual),u=(0,n.d4)(jo((e=>Boolean(e.spatial&&e.theme&&e.welcomeModal)),!1),x().isEqual),m=(0,i.useMemo)((()=>!u||l||c),[u,l,c]),h=(0,i.useMemo)((()=>a?Lo:$o),[a]),p=(0,i.useMemo)((()=>o.commodities||[]),[o.commodities]);return{dispatch:e,data:(0,i.useMemo)((()=>s||d.ue.data),[s]),loading:m,error:t,hasSeenWelcome:r,isDarkMode:a,commodities:p,theme:h,storeInitialized:u}})(),u=(0,i.useRef)(!1),p=(0,i.useRef)(!1),g=(0,i.useRef)(null),f=(0,Q.A)(c.breakpoints.up("sm")),v=(0,Fo.lW)(),[b,A]=(0,i.useState)(f),[w,_]=(0,i.useState)(""),[S,M]=(0,i.useState)(Xo),[C,Y]=(0,i.useState)("spatial"),[D,I]=(0,i.useState)(["unified"]),[R,N]=(0,i.useState)({center:[15.3694,44.191],zoom:6}),[z,E]=(0,i.useState)({methodology:!1});(0,i.useEffect)((()=>{(async()=>{if(!p.current)try{await(async()=>{const e=k.backgroundMonitor.startMetric(k.MetricTypes.SYSTEM.INIT,{component:"store"});try{return Uo=Go({theme:h}),e.finish({status:"success",reducerCount:Object.keys(Uo.reducerManager.getReducerMap()).length}),Uo}catch(t){throw e.finish({status:"error",error:t.message}),t}})(),p.current=!0}catch(e){}})()}),[]),(0,i.useEffect)((()=>((async()=>{if(!p.current||u.current||r)return;const t=k.backgroundMonitor.startMetric(k.MetricTypes.SYSTEM.INIT,{component:"app",startTime:performance.now()});try{var i;if(g.current||(g.current=new AbortController),await e((0,d.kC)({commodity:"",date:Xo,signal:null===(i=g.current)||void 0===i?void 0:i.signal})),l.length>0){var a;const t=null===(a=l[0])||void 0===a?void 0:a.toLowerCase();var n;if(t&&!w)_(t),await e((0,d.kC)({commodity:t,date:Xo,signal:null===(n=g.current)||void 0===n?void 0:n.signal}))}u.current=!0,t.finish({status:"success",initTime:performance.now()-t.startTime})}catch(e){"AbortError"!==e.name&&t.finish({status:"error",error:e.message})}})(),()=>{g.current&&(g.current.abort(),g.current=null)})),[r,e,l,w,p]);const T=(0,i.useCallback)((t=>{var i,a;if(!t||t===w||r)return;g.current&&g.current.abort(),_(t),g.current=new AbortController;const n=k.backgroundMonitor.startMetric(k.MetricTypes.SYSTEM.PERFORMANCE,{action:"commodity-change",commodity:t});Promise.all([e((0,d.kC)({commodity:t,date:S,signal:null===(i=g.current)||void 0===i?void 0:i.signal})),e(F({commodity:t,date:S,signal:null===(a=g.current)||void 0===a?void 0:a.signal}))]).then((()=>{n.finish({status:"success"})})).catch((e=>{"AbortError"!==e.name&&n.finish({status:"error",error:e.message})}))}),[w,S,r,e]),P=(0,i.useCallback)((t=>{if(t&&t!==S&&(M(t),w)){var r,i;const a=k.backgroundMonitor.startMetric(k.MetricTypes.SYSTEM.PERFORMANCE,{action:"date-change",date:t});g.current&&g.current.abort(),g.current=new AbortController,Promise.all([e((0,d.kC)({commodity:w,date:t,signal:null===(r=g.current)||void 0===r?void 0:r.signal})),e(F({commodity:w,date:t,signal:null===(i=g.current)||void 0===i?void 0:i.signal}))]).then((()=>{a.finish({status:"success"})})).catch((e=>{"AbortError"!==e.name&&a.finish({status:"error",error:e.message})}))}}),[w,S,e]),O=(0,i.useCallback)((()=>{e(m())}),[e]),$=(0,i.useCallback)((()=>{A((e=>!e))}),[]),L=(0,i.useCallback)(((e,t)=>{"welcome"!==e&&E((r=>({...r,[e]:t})))}),[]),j=(0,i.useCallback)((t=>{e(y(t))}),[e]);return a?(0,de.Y)(to,{error:a,title:"Application Error",showDetails:!1,onRetry:()=>window.location.reload()}):p.current?(0,de.FD)(K.A,{theme:c,children:[(0,de.Y)(te.Ay,{}),(0,de.Y)(ao,{children:(0,de.FD)(ee.A,{sx:{display:"flex",minHeight:"100vh"},className:s?"mui-dark-mode":"",children:[(0,de.Y)(Jo,{position:"fixed",open:b&&f,children:(0,de.FD)(re.A,{children:[(0,de.Y)(ie.A,{color:"inherit","aria-label":"toggle drawer",edge:"start",onClick:$,sx:{marginRight:2},children:(0,de.Y)(ae.A,{})}),(0,de.Y)(pe,{isDarkMode:s,toggleDarkMode:O})]})}),(0,de.Y)(Ne,{commodities:l.map((e=>e.toLowerCase())),regimes:(null==t?void 0:t.regimes)||["unified","north","south"],selectedCommodity:w.toLowerCase(),setSelectedCommodity:T,selectedDate:S,setSelectedDate:P,selectedAnalysis:C,setSelectedAnalysis:Y,sidebarOpen:b,setSidebarOpen:A,isSmUp:f,onMethodologyClick:()=>L("methodology",!0),selectedRegimes:D,setSelectedRegimes:I,onOpenWelcomeModal:()=>L("welcome",!0),handleDrawerToggle:$}),(0,de.FD)(ee.A,{component:"main",sx:{flexGrow:1,p:3,width:{sm:"calc(100% - 240px)"},ml:{sm:"240px"}},children:[(0,de.Y)(re.A,{}),r?(0,de.Y)(ee.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:(0,de.Y)(Je,{})}):(0,de.Y)(Un,{spatialData:t,selectedCommodity:w,selectedDate:S,selectedRegimes:D,selectedAnalysis:C,windowWidth:v.width,spatialViewConfig:R,onSpatialViewChange:N})]}),(0,de.Y)(Ro,{}),(0,de.Y)(ko,{open:z.methodology,onClose:()=>L("methodology",!1)}),(0,de.Y)(Yo,{open:!o,onClose:j})]})})]}):(0,de.Y)(ee.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:(0,de.Y)(Je,{message:"Initializing application..."})})},Qo=e=>{let{children:t}=e;const r=(0,n.Pj)();return(0,i.useEffect)((()=>{}),[r]),(0,de.Y)(de.FK,{children:t})};Qo.propTypes={children:s().node.isRequired};const es=Qo;var ts=r(23567);s().node.isRequired;s().node.isRequired;new class{constructor(){this.debugMode=!1,this.logStack=[],this.MAX_LOG_SIZE=100}initDebugTools(){this.debugMode&&(window.__REGRESSION_DEBUG__={inspectData:this.inspectRegressionData.bind(this),validateData:this.validateRegressionData.bind(this),getLogs:()=>this.logStack,clearLogs:()=>this.clearLogs(),testDataLoad:this.testDataLoad.bind(this),monitorRegression:this.monitorRegression.bind(this)})}log(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!this.debugMode)return;const i={timestamp:(new Date).toISOString(),category:e,message:t,data:r};this.logStack.push(i),this.logStack.length>this.MAX_LOG_SIZE&&this.logStack.shift(),k.backgroundMonitor.logMetric("regression-debug",i)}clearLogs(){this.logStack=[],this.log("System","Logs cleared")}inspectRegressionData(e){if(!e)return this.log("Inspection","No data provided"),null;const t={hasRequiredSections:{model:Boolean(e.model),spatial:Boolean(e.spatial),residuals:Boolean(e.residuals)},modelMetrics:e.model?{hasCoefficients:Boolean(e.model.coefficients),coefficientCount:Object.keys(e.model.coefficients||{}).length,hasValidRSquared:"number"==typeof e.model.r_squared,hasValidObservations:"number"==typeof e.model.observations}:null,spatialMetrics:e.spatial?{hasMoranI:Boolean(e.spatial.moran_i),hasValidVIF:Array.isArray(e.spatial.vif),vifCount:(e.spatial.vif||[]).length}:null,residualMetrics:e.residuals?{rawCount:(e.residuals.raw||[]).length,regionCount:Object.keys(e.residuals.byRegion||{}).length,hasValidStats:Boolean(e.residuals.stats)}:null,comparisonWithDefault:this.compareWithDefault(e)};return this.log("Inspection","Data inspection complete",t),t}compareWithDefault(e){const t=[],r=[],i=function(e,a){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";Object.keys(a).forEach((r=>{r in e||t.push(n?`${n}.${r}`:r)})),Object.keys(e).forEach((e=>{e in a||r.push(n?`${n}.${e}`:e)})),Object.keys(a).forEach((t=>{"object"==typeof a[t]&&null!==a[t]&&"object"==typeof e[t]&&null!==e[t]&&i(e[t],a[t],n?`${n}.${t}`:t)}))};return i(e,ts.vS),{missingKeys:t,unexpectedKeys:r,structureMatch:0===t.length&&0===r.length}}validateRegressionData(e){const t={isValid:(0,ts.kV)(e),validationSteps:[]};return t.validationSteps.push({step:"Basic Structure",passed:Boolean(e&&e.model&&e.spatial&&e.residuals),details:"Checking presence of main sections"}),null!=e&&e.model&&t.validationSteps.push({step:"Model Validation",passed:"number"==typeof e.model.r_squared&&"number"==typeof e.model.adj_r_squared&&"number"==typeof e.model.mse&&"number"==typeof e.model.observations,details:"Checking model metrics types and presence"}),null!=e&&e.spatial&&t.validationSteps.push({step:"Spatial Validation",passed:e.spatial.moran_i&&"number"==typeof e.spatial.moran_i.I&&Array.isArray(e.spatial.vif),details:"Checking spatial statistics structure"}),null!=e&&e.residuals&&t.validationSteps.push({step:"Residuals Validation",passed:Array.isArray(e.residuals.raw)&&"object"==typeof e.residuals.byRegion&&"object"==typeof e.residuals.stats,details:"Checking residuals data structure"}),this.log("Validation",t.isValid?"Validation passed":"Validation failed",t),t}async testDataLoad(e){this.log("Test",`Starting test data load for commodity: ${e}`);const t=k.backgroundMonitor.startMetric("regression-test-load");try{const r=getRegressionDataPath();this.log("Test","Path resolved",{path:r});const i=await fetch(r);this.log("Test","Fetch response received",{status:i.status,ok:i.ok,headers:Object.fromEntries(i.headers)});const a=await i.text();this.log("Test","Response text received",{length:a.length,preview:a.substring(0,100)+"..."});const n=JSON.parse(a);this.log("Test","JSON parsing successful",{entries:n.length,keys:Object.keys(n[0]||{})});const o=normalizeCommodityName(e),s=n.find((e=>normalizeCommodityName(e.commodity)===o));this.log("Test","Commodity filtering result",{found:Boolean(s),normalizedName:o});const l=processRegressionData(s);return this.log("Test","Data processing complete",this.inspectRegressionData(l)),t.finish({status:"success"}),l}catch(e){throw this.log("Test","Test failed",{error:e.message,stack:e.stack}),t.finish({status:"error",error:e.message}),e}}monitorRegression(){let e=null;return t=>{if(!t)return void this.log("Monitor","No data to monitor");const r=this.detectChanges(e,t);r.hasChanges&&this.log("Monitor","Regression data changed",r),e=JSON.parse(JSON.stringify(t))}}detectChanges(e,t){var r,i,a,n,o,s;if(!e)return{hasChanges:!0,changes:"Initial data"};const l={hasChanges:!1,modelChanges:{},spatialChanges:{},residualChanges:{}};var c,d,u,m,h,p;(null===(r=e.model)||void 0===r?void 0:r.r_squared)!==(null===(i=t.model)||void 0===i?void 0:i.r_squared)&&(l.hasChanges=!0,l.modelChanges.r_squared={old:null===(c=e.model)||void 0===c?void 0:c.r_squared,new:null===(d=t.model)||void 0===d?void 0:d.r_squared});(null===(a=e.spatial)||void 0===a||null===(a=a.moran_i)||void 0===a?void 0:a.I)!==(null===(n=t.spatial)||void 0===n||null===(n=n.moran_i)||void 0===n?void 0:n.I)&&(l.hasChanges=!0,l.spatialChanges.moran_i={old:null===(u=e.spatial)||void 0===u||null===(u=u.moran_i)||void 0===u?void 0:u.I,new:null===(m=t.spatial)||void 0===m||null===(m=m.moran_i)||void 0===m?void 0:m.I});(null===(o=e.residuals)||void 0===o||null===(o=o.raw)||void 0===o?void 0:o.length)!==(null===(s=t.residuals)||void 0===s||null===(s=s.raw)||void 0===s?void 0:s.length)&&(l.hasChanges=!0,l.residualChanges.count={old:null===(h=e.residuals)||void 0===h||null===(h=h.raw)||void 0===h?void 0:h.length,new:null===(p=t.residuals)||void 0===p||null===(p=p.raw)||void 0===p?void 0:p.length});return l}};var rs=r(71272),is=r(19927),as=r(68980);delete kt().Icon.Default.prototype._getIconUrl,kt().Icon.Default.mergeOptions({iconRetinaUrl:rs,iconUrl:is,shadowUrl:as,iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41],shadowAnchor:[12,41]});const ns=i.memo((e=>{let{selectedCommodity:t,selectedDate:r}=e;const[a,o]=i.useState(!1),s=(0,n.wA)();return i.useEffect((()=>{if(!t||a)return;let e;try{e=k.backgroundMonitor.startMetric(k.MetricTypes.SYSTEM.INIT,{component:"data-loader",commodity:t,date:r})}catch(e){}(async()=>{try{var i,a;await Promise.all([s((0,d.kC)({commodity:t,date:r})),s(F({commodity:t,date:r}))]),o(!0),null===(i=e)||void 0===i||null===(a=i.finish)||void 0===a||a.call(i,{status:"success",commodity:t,date:r,timestamp:Date.now()})}catch(i){var n,l;null===(n=e)||void 0===n||null===(l=n.finish)||void 0===l||l.call(n,{status:"error",error:i.message,commodity:t,date:r});try{var c;null===(c=k.backgroundMonitor.logError)||void 0===c||c.call(k.backgroundMonitor,"data-load-failed",{error:i.message,stack:i.stack,commodity:t,date:r})}catch(e){}}})()}),[t,r,a,s]),null}));ns.propTypes={selectedCommodity:s().string.isRequired,selectedDate:s().string.isRequired},ns.displayName="DataLoader";const os=i.memo((e=>{let{store:t}=e;const r=(0,i.useMemo)((()=>"beans (kidney red)"),[]),a=(0,i.useMemo)((()=>"2020-10-01"),[]);return(0,de.Y)(n.Kq,{store:t,children:(0,de.FD)(es,{children:[(0,de.Y)(ns,{selectedCommodity:r,selectedDate:a}),(0,de.Y)(Ko,{})]})})}));os.propTypes={store:s().object.isRequired},os.displayName="AppWithProviders";(async()=>{const e=performance.now();let t;try{var r,n;try{await k.backgroundMonitor.init(),t=k.backgroundMonitor.startMetric(k.MetricTypes.SYSTEM.INIT,{component:"app",startTime:e})}catch(e){}const o=(0,l.U1)({reducer:{spatial:J,theme:h,welcomeModal:f,ecm:v.Ay,flow:H,priceDiff:G},middleware:e=>e({serializableCheck:!1}),devTools:!1});0,await Z.H.initializeGeometry();(0,a.H)(document.getElementById("root")).render((0,de.Y)(i.StrictMode,{children:(0,de.Y)(os,{store:o})})),null===(r=t)||void 0===r||null===(n=r.finish)||void 0===n||n.call(r,{status:"success",initTime:performance.now()-e,environment:"production",timestamp:Date.now()})}catch(r){var o,s;null===(o=t)||void 0===o||null===(s=o.finish)||void 0===s||s.call(o,{status:"error",error:r.message,stack:r.stack,initTime:performance.now()-e});try{k.backgroundMonitor.logError(k.MetricTypes.SYSTEM.ERROR,{component:"app-init",error:r.message,stack:r.stack,initTime:performance.now()-e})}catch(e){}(0,a.H)(document.getElementById("root")).render((0,de.FD)("div",{style:{padding:"20px",color:"#721c24",backgroundColor:"#f8d7da",border:"1px solid #f5c6cb",borderRadius:"4px",margin:"20px"},children:[(0,de.Y)("h2",{children:"Application Initialization Failed"}),(0,de.Y)("p",{children:"Please refresh the page or contact support if the problem persists."}),!1]}))}})()},15995:(e,t,r)=>{"use strict";r.d(t,{DJ:()=>h,Fp:()=>N,nF:()=>P,T9:()=>C,JS:()=>S,Ot:()=>T,w_:()=>Y,BS:()=>D,oe:()=>R,gz:()=>F,tr:()=>w,aW:()=>O,HC:()=>L,xG:()=>$,Hw:()=>M,Lr:()=>z});var i=r(25508),a=r(2543),n=r.n(a),o=r(34953),s=r(42320),l=r(55425);const c=()=>({averagePrice:0,priceVolatility:0,conflictIntensity:0,dataPoints:0,lastUpdate:null}),d=e=>Object.entries(e).reduce(((e,t)=>{let[r,i]=t;const a=i.map((e=>e.usdPrice)).filter((e=>"number"==typeof e)),n=i.map((e=>e.conflictIntensity)).filter((e=>"number"==typeof e));return e[r]={averagePrice:a.length?_.mean(a):0,priceVolatility:a.length>1?calculateVolatility(a):0,conflictIntensity:n.length?_.mean(n):0,dataPoints:i.length,lastUpdate:i.reduce(((e,t)=>{var r;const i=null===(r=t.additionalProperties)||void 0===r?void 0:r.date;return i&&(!e||new Date(i)>new Date(e))?i:e}),null)},e}),{}),u=(e,t)=>{var r,i;return{marketCount:(null===(r=e.connected_markets)||void 0===r?void 0:r.length)||0,spatial_coverage:t.length/((null===(i=e.connected_markets)||void 0===i?void 0:i.length)||1),avg_distance:calculateAverageDistance(t.map((e=>e.coordinates))),spatial_metrics:{centerLat:e.center?e.center[1]:0,centerLon:e.center?e.center[0]:0,boundingBox:calculateBoundingBox(t.map((e=>e.coordinates))),marketDensity:t.length/(calculateAverageDistance(t.map((e=>e.coordinates)))||1),spatialDispersion:calculateSpatialDispersion(t.map((e=>e.coordinates)))},...e.metrics}},m=e=>"number"!=typeof e||isNaN(e)?0:e,h={abyan:[45.83,13.58],aden:[45.03,12.77],"al bayda":[45.57,14.17],"al dhale'e":[44.73,13.7],"al hudaydah":[42.95,14.8],"al jawf":[45.5,16.6],"al maharah":[51.83,16.52],"al mahwit":[43.55,15.47],"amanat al asimah":[44.21,15.35],amran:[43.94,15.66],dhamar:[44.24,14.54],hadramaut:[48.78,15.93],hajjah:[43.6,15.63],ibb:[44.18,13.97],lahj:[44.88,13.03],marib:[45.32,15.47],raymah:[43.71,14.68],"sana'a":[44.21,15.35],shabwah:[47.01,14.53],taizz:[44.02,13.58],socotra:[53.87,12.47]},p=(e,t)=>{if(!e||!t)return 0;const[r,i]=e,[a,n]=t,o=e=>e*Math.PI/180,s=o(n-i),l=o(a-r),c=Math.sin(s/2)*Math.sin(s/2)+Math.cos(o(i))*Math.cos(o(n))*Math.sin(l/2)*Math.sin(l/2);return 6371*(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)))},g=e=>{if(e.length<2)return 0;let t=0,r=0;for(let i=0;i<e.length;i++)for(let a=i+1;a<e.length;a++){const n=p(e[i],e[a]);isNaN(n)||(t+=n,r++)}return r>0?t/r:0},y=e=>"number"!=typeof e||isNaN(e)?0:e,f=e=>{if(!Array.isArray(e)||e.length<12)return 0;try{const t=e.length,r=n().mean(e);let i=0,a=0;for(let a=0;a<t-12;a++)i+=(e[a]-r)*(e[a+12]-r);for(let i=0;i<t;i++)a+=Math.pow(e[i]-r,2);return 0!==a?i/a:0}catch{return 0}},v=(e,t,r)=>{if(!t.length||!r.length)return 0;const i=t.map((e=>e.flow_weight)),a=Math.max(...i),o=n().mean(i),s=r.length*(r.length-1)/2,l=t.length,c=s>0?l/s:0,d=g(r.map((e=>e.coordinates))),u=(e=>{if(e.length<2)return 0;let t=0;for(let r=0;r<e.length;r++)for(let i=r+1;i<e.length;i++){const a=p(e[r],e[i]);t=Math.max(t,a)}return t})(r.map((e=>e.coordinates)));return.4*c+o/a*.3+.3*(u>0?d/u:0)},b=(0,i.Ad)(i.i5,n().isEqual),A=e=>{const t=s.backgroundMonitor.startMetric("spatial-root-selector");try{var r;const i=null!==(r=e.spatial)&&void 0!==r?r:{data:{},status:{},ui:{}};return t.finish({status:"success"}),i}catch(e){return t.finish({status:"error",error:e.message}),{data:{},status:{},ui:{}}}},w=(0,i.Mz)([A],(e=>{var t;return null!==(t=e.data)&&void 0!==t?t:{}})),x=(0,i.Mz)([A],(e=>{var t;return null!==(t=e.status)&&void 0!==t?t:{}})),k=(0,i.Mz)([A],(e=>{var t;return null!==(t=e.ui)&&void 0!==t?t:{}})),S=(0,i.Mz)([x],(e=>({loading:(null==e?void 0:e.loading)||!1,stage:(null==e?void 0:e.stage)||"",progress:(null==e?void 0:e.progress)||0}))),M=(0,i.Mz)([x],(e=>e)),C=(0,i.Mz)([w],(e=>(null==e?void 0:e.geometry)||{})),Y=(0,i.Mz)([w],(e=>(null==e?void 0:e.flowMaps)||[])),D=(0,i.Mz)([w],(e=>(null==e?void 0:e.marketIntegration)||{})),I=((0,i.Mz)([k],(e=>(null==e?void 0:e.visualizationMode)||"prices")),(0,i.Mz)([k],(e=>(null==e?void 0:e.selectedDate)||"")),(0,i.Mz)([k],(e=>(null==e?void 0:e.selectedCommodity)||""))),R=(0,i.Mz)([w],(e=>(null==e?void 0:e.marketShocks)||[])),F=((0,i.Mz)([w],(e=>(null==e?void 0:e.seasonalAnalysis)||{})),(0,i.Mz)([w],(e=>(null==e?void 0:e.spatialAutocorrelation)||{global:{moran_i:0,p_value:1},local:{}}))),N=(0,i.Mz)([F],(e=>(e=>{if(null==e||!e.local)return{highHigh:0,lowLow:0,highLow:0,lowHigh:0,notSignificant:0,totalClusters:0,globalIndex:0,significance:!1};try{var t,r;const i=Object.values(e.local),a=i.map((e=>e.cluster_type));return{highHigh:a.filter((e=>"high-high"===e)).length,lowLow:a.filter((e=>"low-low"===e)).length,highLow:a.filter((e=>"high-low"===e)).length,lowHigh:a.filter((e=>"low-high"===e)).length,notSignificant:a.filter((e=>"not-significant"===e)).length,totalClusters:i.length,globalIndex:(null===(t=e.global)||void 0===t?void 0:t.moran_i)||0,significance:(null===(r=e.global)||void 0===r?void 0:r.p_value)<.05}}catch(e){return{highHigh:0,lowLow:0,highLow:0,lowHigh:0,notSignificant:0,totalClusters:0,globalIndex:0,significance:!1}}})(e))),z=b([w,e=>e.spatial.ui.selectedRegimes,e=>e.spatial.ui.selectedDate],((e,t,r)=>{const i=s.backgroundMonitor.startMetric("time-series-analysis");try{const a=e.timeSeriesData;if(!Array.isArray(a))return i.finish({status:"success",seriesCount:0,date:r}),[];const o=a.filter((e=>{const i=!r||e.month===r,a=!t.length||t.includes(e.regime);return i&&a})).map((e=>{var t;const r=(null===(t=e.prices)||void 0===t?void 0:t.filter((e=>"number"==typeof e)))||[],i=(e=>{if(!Array.isArray(e)||e.length<2)return 0;try{const t=[];for(let r=1;r<e.length;r++)e[r-1]>0&&t.push(Math.log(e[r]/e[r-1]));if(!t.length)return 0;const r=n().mean(t),i=n().meanBy(t,(e=>Math.pow(e-r,2)));return Math.sqrt(i)}catch{return 0}})(r),a=(e=>{if(!Array.isArray(e)||e.length<2)return 0;try{const t=Array.from({length:e.length},((e,t)=>t)),r=n().mean(t),i=n().mean(e);let a=0,o=0;for(let n=0;n<e.length;n++){const s=t[n]-r;a+=s*(e[n]-i),o+=s*s}return 0!==o?a/o:0}catch{return 0}})(r);return{...e,metrics:{volatility:i,trend:a,average:r.length?n().mean(r):0,seasonality:f(r)}}}));return i.finish({status:"success",seriesCount:o.length,date:r}),o}catch(e){return i.finish({status:"error",error:e.message}),[]}})),E=(0,i.Mz)([C,z],((e,t)=>((e,t)=>{if(null==e||!e.points||!Array.isArray(t))return null;try{const r=_.groupBy(t,"region"),i=d(r);return{points:e.points.map((e=>{var t,r,a,n;return{...e,properties:{...e.properties,metrics:i[null===(t=e.properties)||void 0===t?void 0:t.region_id]||c(),region_id:transformRegionName((null===(r=e.properties)||void 0===r?void 0:r.normalizedName)||(null===(a=e.properties)||void 0===a?void 0:a.region_id)||(null===(n=e.properties)||void 0===n?void 0:n.name)),coordinates:validateCoordinates(e.coordinates)}}})),metrics:i,timestamp:Date.now()}}catch(e){return null}})(e,t))),T=b([w,e=>{var t;return(null===(t=e.flow)||void 0===t?void 0:t.flows)||[]}],((e,t)=>{const r=s.backgroundMonitor.startMetric("market-cluster-analysis");try{var i;if(null===(i=e.marketClusters)||void 0===i||!i.length)return r.finish({status:"success",clusterCount:0}),[];const a=e.marketClusters.map((e=>{const r=t.filter((t=>e.connected_markets.includes(t.source)||e.connected_markets.includes(t.target))),i=e.connected_markets.map((e=>{const t=(0,o.ih)(e);return t?{market:e,coordinates:t}:null})).filter(Boolean),a=r.reduce(((e,t)=>e+t.flow_weight),0),n=r.filter((t=>e.connected_markets.includes(t.source)&&e.connected_markets.includes(t.target)));return{...e,metrics:{marketCount:e.connected_markets.length,totalFlow:a,internalFlowRatio:n.length/Math.max(r.length,1),spatialCoverage:i.length/e.connected_markets.length,avgDistance:g(i.map((e=>e.coordinates))),efficiency:v(0,r,i)}}}));return r.finish({status:"success",clusterCount:a.length}),a}catch(e){return r.finish({status:"error",error:e.message}),[]}})),P=b([e=>{var t;return(null===(t=e.flow)||void 0===t?void 0:t.flows)||[]},e=>e.spatial.ui.selectedDate,e=>e.spatial.ui.selectedCommodity],((e,t,r)=>{const i=s.backgroundMonitor.startMetric("flow-data-selection");try{if(!e.length||!t||!r)return i.finish({status:"success",flowCount:0,date:t,commodity:r}),[];const a=e.filter((e=>{var r;if(!l.Oz.isValidFlow(e))return!1;return(null===(r=e.date)||void 0===r?void 0:r.substring(0,7))===t}));return i.finish({status:"success",flowCount:a.length,date:t,commodity:r}),a}catch(e){return i.finish({status:"error",error:e.message}),[]}})),O=(b([P],(e=>{const t=s.backgroundMonitor.startMetric("market-metrics-calculation");try{if(!e.length)return t.finish({status:"success",marketCount:0,flowCount:0}),{totalFlows:0,averageFlow:0,maxFlow:0,activeMarkets:0,flowDensity:0};const r=e.filter((e=>e.flow_weight>0)),i=new Set;r.forEach((e=>{e.source&&i.add(e.source),e.target&&i.add(e.target)}));const a=r.map((e=>e.flow_weight)),o=n().sum(a)/a.length,s={totalFlows:r.length,averageFlow:o,maxFlow:Math.max(...a),activeMarkets:i.size,flowDensity:i.size>1?r.length/(i.size*(i.size-1)/2):0};return t.finish({status:"success",marketCount:i.size,flowCount:r.length}),s}catch(e){return t.finish({status:"error",error:e.message}),{totalFlows:0,averageFlow:0,maxFlow:0,activeMarkets:0,flowDensity:0}}})),b([P,w],((e,t)=>{const r=s.backgroundMonitor.startMetric("spatial-network-analysis");try{if(!e.length||!t.geometry)return r.finish({status:"success",marketCount:0,connectionCount:0}),null;const i=new Map,a=[];e.forEach((e=>{const t=(0,o.ih)(e.source),r=(0,o.ih)(e.target);if(!t||!r)return;i.has(e.source)||i.set(e.source,{id:e.source,coordinates:t,totalFlow:0,incomingFlows:0,outgoingFlows:0});const n=i.get(e.source),s=i.get(e.target)||{id:e.target,coordinates:r,totalFlow:0,incomingFlows:0,outgoingFlows:0};n.totalFlow+=e.flow_weight,n.outgoingFlows++,s.totalFlow+=e.flow_weight,s.incomingFlows++,i.has(e.target)||i.set(e.target,s),a.push({source:e.source,target:e.target,weight:e.flow_weight,coordinates:{source:t,target:r}})}));const n={markets:Array.from(i.values()),connections:a,metrics:{totalMarkets:i.size,totalConnections:a.length,networkDensity:i.size>1?a.length/(i.size*(i.size-1)/2):0,averageConnections:i.size>0?a.length/i.size:0}};return r.finish({status:"success",marketCount:i.size,connectionCount:a.length}),n}catch(e){return r.finish({status:"error",error:e.message}),null}})),b([w,I],((e,t)=>{const r=s.backgroundMonitor.startMetric("regression-analysis");try{var i,a,n,o,l,c,d;const s=e.regressionAnalysis;if(!s||!t)return r.finish({status:"success",commodity:t}),null;const u=s.metadata||{};if(t&&u.commodity!==t)return r.finish({status:"success",commodity:t}),null;const m={model:s.model||{},spatial:{moran_i:(null===(i=s.spatial)||void 0===i?void 0:i.moran_i)||{I:0,"p-value":1},vif:Array.isArray(null===(a=s.spatial)||void 0===a?void 0:a.vif)?s.spatial.vif:[]},residuals:{raw:Array.isArray(null===(n=s.residuals)||void 0===n?void 0:n.raw)?s.residuals.raw:[],byRegion:(null===(o=s.residuals)||void 0===o?void 0:o.byRegion)||{},stats:{mean:y(null===(l=s.residuals)||void 0===l||null===(l=l.stats)||void 0===l?void 0:l.mean),variance:y(null===(c=s.residuals)||void 0===c||null===(c=c.stats)||void 0===c?void 0:c.variance),maxAbsolute:y(null===(d=s.residuals)||void 0===d||null===(d=d.stats)||void 0===d?void 0:d.maxAbsolute)}},metadata:{commodity:t,timestamp:u.timestamp||(new Date).toISOString(),version:u.version||"1.0"}};return r.finish({status:"success",commodity:t}),m}catch(e){return r.finish({status:"error",error:e.message}),null}})),(0,i.Mz)([T,C],((e,t)=>((e,t)=>{if(null==e||!e.length||null==t||!t.points)return[];try{const r=new Map;return t.points.forEach((e=>{var t,i,a;const n=transformRegionName((null===(t=e.properties)||void 0===t?void 0:t.normalizedName)||(null===(i=e.properties)||void 0===i?void 0:i.region_id)||(null===(a=e.properties)||void 0===a?void 0:a.name));n&&Array.isArray(e.coordinates)&&r.set(n,validateCoordinates(e.coordinates))})),e.map((e=>{const t=(e.connected_markets||[]).map((t=>{const i=transformRegionName(t),a=r.get(i)||getRegionCoordinates(i);return a?{name:t,normalizedName:i,coordinates:a,isMainMarket:t===e.main_market}:null})).filter(Boolean),i=calculateCenter(t.map((e=>e.coordinates)));return{...e,markets:t,center:i||[0,0],metrics:u(e,t)}}))}catch(e){return[]}})(e,t))),(0,i.Mz)([Y,C],((e,t)=>((e,t)=>{if(!e||null==t||!t.points)return[];try{const r=new Map;return t.points.forEach((e=>{var t,i,a;const n=transformRegionName((null===(t=e.properties)||void 0===t?void 0:t.normalizedName)||(null===(i=e.properties)||void 0===i?void 0:i.region_id)||(null===(a=e.properties)||void 0===a?void 0:a.name));n&&Array.isArray(e.coordinates)&&r.set(n,validateCoordinates(e.coordinates))})),e.map((e=>{const t=transformRegionName(e.source),i=transformRegionName(e.target),a=r.get(t)||getRegionCoordinates(e.source),n=r.get(i)||getRegionCoordinates(e.target);return a&&n?{...e,source_normalized:t,target_normalized:i,sourceCoordinates:a,targetCoordinates:n,flow_strength:m(e.total_flow),price_differential:m(e.avg_price_differential)}:null})).filter(Boolean)}catch(e){return[]}})(e,t))),b([E,Y,T],((e,t,r)=>{const i=s.backgroundMonitor.startMetric("visualization-data-processing");try{const a=(t||[]).map((e=>{const t=(0,o.ih)(e.source),r=(0,o.ih)(e.target);return t&&r?{...e,coordinates:{source:t,target:r},normalized:{source:(0,o.YP)(e.source),target:(0,o.YP)(e.target)}}:null})).filter(Boolean),n=(r||[]).map((e=>{const t=(e.connected_markets||[]).map((e=>{const t=(0,o.ih)(e);return t?{name:e,coordinates:t}:null})).filter(Boolean);return{...e,markets:t,center:(0,o.IU)(t.map((e=>e.coordinates)))||[0,0]}})),s={features:(null==e?void 0:e.points)||[],flows:a,clusters:n,timestamp:Date.now()};return i.finish({status:"success",flowCount:a.length,clusterCount:n.length}),s}catch(e){return i.finish({status:"error",error:e.message}),{features:[],flows:[],clusters:[],timestamp:Date.now()}}})),b([C,T,Y],((e,t,r)=>({geometry:e,clusters:t,flows:r})))),$=e=>{var t;return(null===(t=e.spatial)||void 0===t||null===(t=t.status)||void 0===t?void 0:t.loading)||!1},L=e=>{var t;return(null===(t=e.spatial)||void 0===t||null===(t=t.status)||void 0===t?void 0:t.error)||null}},80903:(e,t,r)=>{"use strict";r.d(t,{_8:()=>o});var i=r(25508),a=r(2404),n=r.n(a);const o=(0,i.Ad)((e=>{let t=null,r=null;return function(){for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return t&&n()(a,t)||(t=a,r=e(...a)),r}}))},72667:(e,t,r)=>{"use strict";r.d(t,{Ay:()=>_,JS:()=>h,fW:()=>y,hP:()=>v,kE:()=>l,nT:()=>p,rf:()=>g,xM:()=>f});var i=r(81118),a=r(80903),n=(r(2543),r(73151)),o=r(42320);const s={data:{unified:[],directional:{northToSouth:[],southToNorth:[]},residuals:null,commodities:[],cache:{}},status:{loading:!1,error:null,lastUpdated:null,retryCount:0},ui:{selectedCommodity:null,selectedRegime:"unified",selectedDirection:"northToSouth"}},l=(0,i.zD)("ecm/fetchData",(async(e,t)=>{let{commodity:r}=e,{rejectWithValue:i}=t;const a=o.backgroundMonitor.startMetric("ecm-data-fetch");try{const e={unified:(0,n.Ir)("ecm/ecm_analysis_results.json"),northToSouth:(0,n.Ir)("ecm/ecm_results_north_to_south.json"),southToNorth:(0,n.Ir)("ecm/ecm_results_south_to_north.json")},[t,r,i]=await Promise.all([fetch(e.unified).then((e=>e.json())),fetch(e.northToSouth).then((e=>e.json())),fetch(e.southToNorth).then((e=>e.json()))]);return a.finish({status:"success"}),{unified:t,directional:{northToSouth:r,southToNorth:i}}}catch(e){return a.finish({status:"error",error:e.message}),i(e.message)}})),c=(0,i.Z0)({name:"ecm",initialState:s,reducers:{setSelectedCommodity(e,t){e.ui.selectedCommodity=t.payload},setSelectedRegime(e,t){e.ui.selectedRegime=t.payload},setSelectedDirection(e,t){e.ui.selectedDirection=t.payload},clearCache(e){e.data.cache={}}},extraReducers:e=>{e.addCase(l.pending,(e=>{e.status.loading=!0,e.status.error=null})).addCase(l.fulfilled,((e,t)=>{e.data.unified=t.payload.unified,e.data.directional.northToSouth=t.payload.directional.northToSouth,e.data.directional.southToNorth=t.payload.directional.southToNorth,e.status.loading=!1,e.status.error=null,e.status.lastUpdated=(new Date).toISOString()})).addCase(l.rejected,((e,t)=>{e.status.loading=!1,e.status.error=t.payload}))}}),d=e=>(null==e?void 0:e.ecm)||s,u=e=>d(e).data,m=e=>d(e).status,h=(0,a._8)([m],(e=>e.loading)),p=(0,a._8)([m],(e=>e.error)),g=(0,a._8)([u],(e=>e.unified||[])),y=(0,a._8)([u],(e=>{var t,r;return{northToSouth:(null===(t=e.directional)||void 0===t?void 0:t.northToSouth)||[],southToNorth:(null===(r=e.directional)||void 0===r?void 0:r.southToNorth)||[]}})),f=(0,a._8)([g,y,e=>d(e).ui],((e,t,r)=>{var i;let a;if(a="unified"===r.selectedRegime?e:t[r.selectedDirection],null===(i=a)||void 0===i||!i.length||!r.selectedCommodity)return null;const n=a.find((e=>{var t,i;return(null===(t=e.commodity)||void 0===t?void 0:t.toLowerCase())===(null===(i=r.selectedCommodity)||void 0===i?void 0:i.toLowerCase())}));return n?{alpha:n.alpha,beta:n.beta,gamma:n.gamma,diagnostics:n.diagnostics,spatialAutocorrelation:n.spatial_autocorrelation,aic:n.aic,bic:n.bic,hqic:n.hqic}:null})),{setSelectedCommodity:v,setSelectedRegime:b,setSelectedDirection:A,clearCache:w}=c.actions,_=c.reducer},88239:(e,t,r)=>{"use strict";r.d(t,{Ay:()=>ce,kC:()=>w,KY:()=>x,R:()=>_,ue:()=>b,a5:()=>G,tr:()=>I,un:()=>Q});var i=r(81118),a=r(25508),n=r(2404),o=r.n(n),s=r(2543),l=r.n(s),c=r(80106),d=r(23567),u=r(42320),m=(r(5307),r(27154));const h=e=>{if(null==e||!e.coordinates)return null;let t=[];if("Polygon"===e.type)t=e.coordinates[0];else{if("MultiPolygon"!==e.type)return null;t=e.coordinates.flatMap((e=>e[0]))}const r=t.reduce(((e,t)=>{let[r,i]=t;return{minLat:Math.min(e.minLat,i),maxLat:Math.max(e.maxLat,i),minLng:Math.min(e.minLng,r),maxLng:Math.max(e.maxLng,r)}}),{minLat:1/0,maxLat:-1/0,minLng:1/0,maxLng:-1/0});return{southWest:{lat:r.minLat,lng:r.minLng},northEast:{lat:r.maxLat,lng:r.maxLng}}};function p(e){const t=e.map((e=>e.usdprice)).filter((e=>null!=e)),r=e.map((e=>new Date(e.date).getTime()));if(t.length!==r.length||0===t.length)return null;const i=t.length,a=r.reduce(((e,t)=>e+t),0),n=t.reduce(((e,t)=>e+t),0),o=(i*r.reduce(((e,r,i)=>e+r*t[i]),0)-a*n)/(i*r.reduce(((e,t)=>e+t*t),0)-a*a);return{slope:o,intercept:(n-o*a)/i}}function g(e){const t=l().groupBy(e,(e=>new Date(e.date).getMonth())),r=l().mapValues(t,(e=>l().meanBy(e,"usdprice"))),i=l().mean(Object.values(r)),a=Math.sqrt(l().mean(Object.values(r).map((e=>Math.pow(e-i,2)))));return{seasonal:a>.05*i,monthlyAverages:r,stdDev:a}}function y(e){const t=e.map((e=>e.usdprice)).filter((e=>null!=e)),r=t.reduce(((e,t)=>e+t),0)/t.length,i=Math.sqrt(t.reduce(((e,t)=>e+Math.pow(t-r,2)),0)/t.length);return e.filter((e=>Math.abs(e.usdprice-r)>2*i))}const f=(0,a.Ad)((e=>{let t=[],r=null;return function(){for(var i=arguments.length,a=new Array(i),n=0;n<i;n++)a[n]=arguments[n];return o()(a,t)||(r=e(...a),t=a),r}})),v=e=>{if(!Array.isArray(e))return{flows:[],byDate:{},metadata:{lastUpdated:(new Date).toISOString(),dateRange:{start:null,end:null}}};const t=e.reduce(((e,t)=>{try{if(!t||"object"!=typeof t)return e;if(!t.source||!t.target||!t.flow_weight)return e;const r=t.date||t.month;if(!r||"string"!=typeof r)return e;if(r.length<7)return e;const i=r.substring(0,7);return e[i]||(e[i]=[]),e[i].push({source:String(t.source),target:String(t.target),flow_weight:Number(t.flow_weight)||0,price_differential:Number(t.price_differential)||0,source_price:Number(t.source_price)||0,target_price:Number(t.target_price)||0,total_flow:Number(t.total_flow||t.flow_weight)||0,avg_flow:Number(t.avg_flow||t.total_flow||t.flow_weight)||0,flow_count:Number(t.flow_count)||1,date:i}),e}catch(t){return e}}),{}),r=Object.keys(t).sort(),i={start:r[0]||null,end:r[r.length-1]||null},a=Object.values(t).flat();return{flows:a,byDate:t,metadata:{lastUpdated:(new Date).toISOString(),dateRange:i,totalFlows:a.length,uniqueDates:r.length}}},b={data:{geometry:{polygons:null,points:null,unified:null},flowMaps:[],timeSeriesData:[],marketClusters:[],marketShocks:[],spatialAutocorrelation:{},regressionAnalysis:{...d.vS,metadata:{...d.vS.metadata,commodity:"beans (kidney red)",timestamp:(new Date).toISOString(),version:"1.0"},model:{...d.vS.model,coefficients:{spatial_lag_price:0},p_values:{spatial_lag_price:1}},residuals:{raw:[],byRegion:{},stats:{mean:0,variance:0,maxAbsolute:0}},spatial:{moran_i:{I:0,"p-value":1},vif:[]}},uniqueMonths:[],visualizationData:{prices:null,integration:null,clusters:null,shocks:null},metadata:null,cache:{},flowData:{flows:[],byDate:{},metadata:{lastUpdated:null,dateRange:{start:null,end:null}}},spatialAnalysis:{moranI:null,clusters:[],regressionResults:null},commodities:[]},status:{loading:!1,error:null,progress:0,stage:"idle",geometryLoading:!1,geometryError:null,regressionLoading:!1,regressionError:null,visualizationLoading:!1,visualizationError:null,dataFetching:!1,dataCaching:!1,lastUpdated:null,retryCount:0,lastError:null},ui:{selectedCommodity:"beans (kidney red)",selectedDate:"",selectedRegimes:["unified"],selectedRegion:null,view:m.EU,activeLayers:[],visualizationMode:"prices",analysisFilters:{minMarketCount:0,minFlowWeight:0,shockThreshold:0}}},A=((0,i.pU)({selectId:e=>e.id,sortComparer:(e,t)=>e.name.localeCompare(t.name)}),(0,i.pU)(),(0,i.zD)("spatial/fetchFlowData",(async(e,t)=>{let{commodity:r,date:i}=e,{getState:a,rejectWithValue:n}=t;const o=u.backgroundMonitor.startMetric("flow-data-fetch");try{const e=await c.H.loadFlowDataWithRecovery(r);return o.finish({status:"success"}),e}catch(e){return o.finish({status:"error",error:e.message}),n(e.message)}}))),w=(0,i.zD)("spatial/fetchAllSpatialData",(async(e,t)=>{let{commodity:r,date:i,visualizationMode:a,filters:n,skipGeometry:o=!1,regressionOnly:s=!1,visualizationOnly:l=!1,forceRefresh:m=!1,signal:h}=e,{getState:p,rejectWithValue:g}=t;const y=u.backgroundMonitor.startMetric("spatial-data-fetch"),f=p(),v=`${r}_${i}`;try{var b;let e={geometry:null,spatialData:null,regressionData:null,visualizationData:null,metadata:{commodity:r,date:i,timestamp:(new Date).toISOString()}};if(s){try{const t=await c.H.loadRegressionAnalysis(r,h);e.regressionData=t}catch(t){if("AbortError"===t.name)throw t;e.regressionData=d.vS}return y.finish({status:"success"}),e}if(l&&a){try{var A;const t=await c.H.processVisualizationData(null===(A=f.spatial)||void 0===A?void 0:A.data,a,n);e.visualizationData={mode:a,data:t}}catch(e){if("AbortError"===e.name)throw e}return y.finish({status:"success"}),e}o||(await Promise.all([c.H.initializeGeometry(h),c.H.initializePoints(h)]),e.geometry={polygons:Array.from(c.H.geometryCache.values()),points:Array.from(c.H.pointCache.values()),unified:await c.H.createUnifiedGeoJSON([],h)});const t=await c.H.getSpatialData(r,i,h);e.spatialData={timeSeriesData:t.timeSeriesData||[],flowMaps:t.flowMaps||[],marketClusters:t.marketClusters||[],marketShocks:t.marketShocks||[],spatialAutocorrelation:t.spatialAutocorrelation||{},uniqueMonths:[...new Set((null===(b=t.timeSeriesData)||void 0===b?void 0:b.map((e=>e.month)))||[])].sort(),commodities:t.commodities||[]},e.cacheTimestamp=Date.now();const u={...e,cacheKey:v};return y.finish({status:"success"}),u}catch(e){var w;if("AbortError"===e.name)throw y.finish({status:"aborted"}),e;const t={message:e.message,details:{params:{commodity:r,date:i},state:null===(w=p().spatial)||void 0===w?void 0:w.status,timestamp:Date.now()}};return u.backgroundMonitor.logError("spatial-data-fetch",t),y.finish({status:"error",error:e.message}),g(t)}})),_=((0,i.zD)("spatial/progressiveLoad",(async(e,t)=>{let{dispatch:r}=t;await r(fetchCriticalData()),r(fetchGeometryData()),r(fetchSupplementaryData())})),e=>{let{commodity:t,date:r}=e;return w({commodity:t,date:r})}),x=e=>{let{selectedCommodity:t}=e;return w({commodity:t,skipGeometry:!0,regressionOnly:!0})},k=e=>e.spatial?{data:e.spatial.data,status:e.spatial.status,ui:e.spatial.ui}:b,S=f([k],(e=>(null==e?void 0:e.data)||b.data)),M=f([k],(e=>(null==e?void 0:e.status)||b.status)),C=f([k],(e=>(null==e?void 0:e.ui)||b.ui)),Y=(f([k],(()=>({}))),f([k],(()=>null)),f([M],(e=>Boolean(e.loading)))),D=f([S],(e=>e.uniqueMonths||[])),I=e=>e.spatial.data,R=f([C],(e=>({selectedCommodity:e.selectedCommodity||"",selectedDate:e.selectedDate||"",selectedRegimes:e.selectedRegimes||["unified"],selectedRegion:e.selectedRegion||null,view:e.view,activeLayers:e.activeLayers||[],visualizationMode:e.visualizationMode||null,analysisFilters:e.analysisFilters||{}}))),F=f([e=>{var t;return(null===(t=k(e))||void 0===t||null===(t=t.data)||void 0===t?void 0:t.timeSeriesData)||[]},e=>{var t;return(null===(t=k(e))||void 0===t||null===(t=t.ui)||void 0===t?void 0:t.selectedRegimes)||["unified"]},e=>{var t;return(null===(t=k(e))||void 0===t||null===(t=t.ui)||void 0===t?void 0:t.selectedDate)||""}],((e,t,r)=>e.filter((e=>(!r||e.month===r)&&(!t.length||t.includes(e.regime)))))),N=(f([e=>{var t;return(null===(t=k(e))||void 0===t||null===(t=t.data)||void 0===t?void 0:t.marketClusters)||[]},e=>{var t;return null===(t=k(e))||void 0===t||null===(t=t.ui)||void 0===t?void 0:t.selectedRegion}],((e,t)=>t?e.filter((e=>{var r;return e.main_market===t||(null===(r=e.connected_markets)||void 0===r?void 0:r.includes(t))})):e)),f([F,e=>{var t;return(null===(t=k(e))||void 0===t||null===(t=t.data)||void 0===t?void 0:t.regressionAnalysis)||d.vS},R],((e,t,r)=>e.length&&t?{priceStats:{trend:p(e),seasonality:g(e),outliers:y(e)},spatialDependence:{moranI:l().get(t,"spatial.moran_i.I",0),pValue:l().get(t,'spatial.moran_i["p-value"]',1),spatialLag:l().get(t,"model.coefficients.spatial_lag_price",0)},modelFit:{rSquared:l().get(t,"model.r_squared",0),adjRSquared:l().get(t,"model.adj_r_squared",0),mse:l().get(t,"model.mse",0),observations:l().get(t,"model.observations",0)}}:null)),f([k],(e=>{var t;return(null==e||null===(t=e.data)||void 0===t?void 0:t.marketClusters)||[]})),f([k],(e=>{var t;return(null==e||null===(t=e.data)||void 0===t?void 0:t.spatialAutocorrelation)||{}})),f([k],(e=>{var t;return(null==e||null===(t=e.data)||void 0===t?void 0:t.marketShocks)||[]}))),z=f([k],(e=>{var t;return(null==e||null===(t=e.data)||void 0===t||null===(t=t.geometry)||void 0===t?void 0:t.unified)||{}})),E=(f([k],(e=>{var t;return(null==e||null===(t=e.data)||void 0===t?void 0:t.metadata)||{}})),f([k],(e=>{var t;return(null==e||null===(t=e.data)||void 0===t?void 0:t.flowMaps)||[]}))),T=f([k],(e=>{var t;return(null==e||null===(t=e.data)||void 0===t||null===(t=t.regressionAnalysis)||void 0===t?void 0:t.residuals)||{}})),P=f([k],(e=>{var t;return(null==e||null===(t=e.data)||void 0===t?void 0:t.regressionAnalysis)||{}})),O=f([P],(e=>(null==e?void 0:e.model)||{})),$=f([P],(e=>(null==e?void 0:e.spatial)||{})),L=(f([R],(e=>(null==e?void 0:e.activeLayers)||[])),f([R],(e=>(null==e?void 0:e.analysisFilters)||{}))),j=f([k],(e=>{var t;return(null==e||null===(t=e.data)||void 0===t?void 0:t.geometry)||{}})),q=(f([M],(e=>(null==e?void 0:e.error)||null)),f([R],(e=>(null==e?void 0:e.selectedCommodity)||"")),f([R],(e=>(null==e?void 0:e.selectedDate)||"")),f([R],(e=>(null==e?void 0:e.visualizationMode)||"prices")),f([j],(e=>(null==e?void 0:e.cached)||e)),f([N,R],((e,t)=>(e||[]).filter((e=>e.region===t.selectedRegion))))),W=(f([F,e=>{var t;return null===(t=k(e))||void 0===t||null===(t=t.ui)||void 0===t?void 0:t.selectedRegimes},e=>{var t;return null===(t=k(e))||void 0===t||null===(t=t.ui)||void 0===t?void 0:t.selectedDate}],((e,t,r)=>e?e.filter((e=>(!r||e.month===r)&&(!t.length||t.includes(e.regime)))):[])),f([F,R],((e,t)=>{if(null==e||!e.length)return null;const r=e.filter((e=>t.selectedRegimes.includes(e.regime)));return r.length?{averagePrice:r.reduce(((e,t)=>e+(t.avgUsdPrice||0)),0)/r.length,volatility:r.reduce(((e,t)=>e+(t.volatility||0)),0)/r.length,conflictIntensity:r.reduce(((e,t)=>e+(t.conflict_intensity||0)),0)/r.length}:null})),f([I],(e=>({clusters:null==e?void 0:e.marketClusters,autocorrelation:null==e?void 0:e.spatialAutocorrelation,flows:null==e?void 0:e.flowMaps}))),f([T,(e,t)=>t],((e,t)=>{var r;return(null==e||null===(r=e.byRegion)||void 0===r?void 0:r[t])||[]})),f([O],(e=>({r_squared:(null==e?void 0:e.r_squared)||0,adjRSquared:(null==e?void 0:e.adj_r_squared)||0,mse:(null==e?void 0:e.mse)||0,observations:(null==e?void 0:e.observations)||0}))),f([$],(e=>({moran_i:(null==e?void 0:e.moran_i)||{I:0,"p-value":0},vif:(null==e?void 0:e.vif)||[]}))),f([I,L],((e,t)=>e?{marketClusters:(e.marketClusters||[]).filter((e=>e.market_count>=(t.minMarketCount||0))),flowMaps:(e.flowMaps||[]).filter((e=>e.flow_weight>=(t.minFlowWeight||0))),marketShocks:(e.marketShocks||[]).filter((e=>Math.abs(e.magnitude)>=(t.shockThreshold||0)))}:null)),f([z,R],((e,t)=>null!=e&&e.features&&t.selectedRegion?e.features.find((e=>e.properties.region_id===t.selectedRegion)):null)),f([z,F,R],((e,t,r)=>{if(null==e||!e.features||!r.selectedRegion)return null;const i=e.features.find((e=>e.properties.region_id===r.selectedRegion));if(!i)return null;const a=t.filter((e=>e.region===r.selectedRegion||e.admin1===r.selectedRegion));return{...i,properties:{...i.properties,timeData:a}}}))),V=f([E,R],((e,t)=>e&&t.selectedRegion?e.filter((e=>e.source===t.selectedRegion||e.target===t.selectedRegion)).map((e=>({...e,isSource:e.source===t.selectedRegion,coordinates:e.source===t.selectedRegion?e.target_coordinates:e.source_coordinates}))):[])),H=f([W,V,q],((e,t,r)=>({geometry:e,connections:t,shocks:r,hasData:Boolean(e&&e.properties.timeData.length)}))),B=(f([H,j,R],((e,t,r)=>{if(null==e||!e.geometry||!t)return null;try{const i=(e=>{if(null==e||!e.coordinates)return null;let t=[];if("Polygon"===e.type)t=e.coordinates[0];else{if("MultiPolygon"!==e.type)return null;t=e.coordinates.flatMap((e=>e[0]))}const r=t.reduce(((e,t)=>{let[r,i]=t;return{lat:e.lat+i,lng:e.lng+r}}),{lat:0,lng:0});return{lat:r.lat/t.length,lng:r.lng/t.length}})(e.geometry),a=h(e.geometry),n=((e,t,r)=>{if(!e||!r)return[];const i=h(e);if(!i)return[];const a=[],n=.001;return Object.entries(r).forEach((e=>{let[r,o]=e;if(r===t)return;const s=h(o);s&&!(s.northEast.lat+n<i.southWest.lat||s.southWest.lat-n>i.northEast.lat||s.northEast.lng+n<i.southWest.lng||s.southWest.lng-n>i.northEast.lng)&&a.push(r)})),a})(e.geometry,r.selectedRegion,t.polygons);return{...e,computedMetrics:{centerOfMass:i,boundingBox:a,neighbors:n,hasComputedMetrics:!0}}}catch(t){return{...e,computedMetrics:{centerOfMass:null,boundingBox:null,neighbors:[],hasComputedMetrics:!1,error:t.message}}}})),f([j],(e=>({hasPolygons:Boolean(null==e?void 0:e.polygons),hasPoints:Boolean(null==e?void 0:e.points),hasUnified:Boolean(null==e?void 0:e.unified),isComplete:Boolean((null==e?void 0:e.polygons)&&(null==e?void 0:e.points)&&(null==e?void 0:e.unified))}))),f([I],(e=>{var t;return(null==e||null===(t=e.flowData)||void 0===t?void 0:t.flows)||[]}))),G=(f([I],(e=>(null==e?void 0:e.spatialAnalysis)||null)),f([I],(e=>{var t;return(null==e||null===(t=e.flowData)||void 0===t?void 0:t.metadata)||null})),f([B,(e,t)=>t],((e,t)=>e.filter((e=>e.source===t||e.target===t)))),f([e=>{var t;return(null===(t=k(e))||void 0===t||null===(t=t.data)||void 0===t?void 0:t.commodities)||[]},e=>{var t;return(null===(t=k(e))||void 0===t||null===(t=t.ui)||void 0===t?void 0:t.selectedCommodity)||""},Y,D],((e,t,r,i)=>({commodities:[...e||[]],selectedCommodity:t||"",loading:r||!1,uniqueMonths:[...i||[]]})))),U=(0,i.Z0)({name:"spatial",initialState:b,reducers:{setProgress:(e,t)=>{e.status.progress=t.payload},setLoadingStage:(e,t)=>{e.status.stage=t.payload},setView:(e,t)=>{e.ui.view=t.payload},setSelectedCommodity(e,t){e.ui.selectedCommodity=t.payload},setSelectedDate(e,t){e.ui.selectedDate=t.payload},setVisualizationMode(e,t){e.ui.visualizationMode=t.payload},setSelectedRegion:(e,t)=>{e.ui.selectedRegion=t.payload},setSelectedRegimes:(e,t)=>{e.ui.selectedRegimes=t.payload},setActiveLayers:(e,t)=>{e.ui.activeLayers=t.payload},resetVisualizationData:e=>{e.data.visualizationData=b.data.visualizationData},setRetryCount:(e,t)=>{e.status.retryCount=t.payload},updateGeometry:(e,t)=>{e.data.geometry=t.payload},updateData:(e,t)=>{e.data={...e.data,...t.payload}},updateUI:(e,t)=>{e.ui={...e.ui,...t.payload}}},extraReducers:e=>{e.addCase(w.pending,((e,t)=>{const{regressionOnly:r,visualizationOnly:i}=t.meta.arg;e.status.loading=!r&&!i,e.status.regressionLoading=r,e.status.visualizationLoading=i,e.status.error=null,e.status.dataFetching=!0})).addCase(w.fulfilled,((e,t)=>{var r;const{geometry:i,spatialData:a,regressionData:n,visualizationData:o,metadata:s,cacheKey:l,cacheTimestamp:c}=t.payload,{regressionOnly:d,visualizationOnly:u,commodity:m}=t.meta.arg;if((null==a||null===(r=a.commodities)||void 0===r?void 0:r.length)>0&&(e.data.commodities=[...new Set([...e.data.commodities||[],...a.commodities])].sort()),null!=a&&a.flowMaps&&(e.data.flowData=v(a.flowMaps)),n){const t=m||e.ui.selectedCommodity;e.data.regressionAnalysis={...n,model:n.model||{},spatial:n.spatial||{moran_i:{I:0,"p-value":1},vif:[]},residuals:n.residuals||{raw:[],byRegion:{},stats:{}},metadata:{commodity:t,timestamp:(new Date).toISOString(),version:"1.0"}}}return d?(e.status.regressionLoading=!1,void(e.status.dataFetching=!1)):u?(o&&(e.data.visualizationData[o.mode]=o.data),e.status.visualizationLoading=!1,void(e.status.dataFetching=!1)):(i&&(e.data.geometry=i),a&&(e.data={...e.data,timeSeriesData:a.timeSeriesData||[],flowMaps:a.flowMaps||[],marketClusters:a.marketClusters||[],marketShocks:a.marketShocks||[],spatialAutocorrelation:a.spatialAutocorrelation||{},uniqueMonths:a.uniqueMonths||[]}),s&&(e.data.metadata=s,e.ui.selectedCommodity=s.commodity,e.ui.selectedDate=s.date),l&&(e.data.cache[l]={geometry:e.data.geometry,spatialData:{timeSeriesData:e.data.timeSeriesData,flowMaps:e.data.flowMaps,marketClusters:e.data.marketClusters,marketShocks:e.data.marketShocks,spatialAutocorrelation:e.data.spatialAutocorrelation,uniqueMonths:e.data.uniqueMonths},regressionData:e.data.regressionAnalysis,visualizationData:o,metadata:s,cacheTimestamp:c},e.status.lastUpdated=c),void(e.status={...e.status,loading:!1,dataFetching:!1,error:null,progress:100,stage:"complete",geometryLoading:!1,regressionLoading:!1,visualizationLoading:!1}))})).addCase(w.rejected,((e,t)=>{e.status.loading=!1,e.status.error=t.payload,e.status.stage="error",e.status.geometryLoading=!1,e.status.regressionLoading=!1,e.status.visualizationLoading=!1,e.status.dataFetching=!1,e.status.lastError=t.payload})).addCase(A.pending,(e=>{e.status.dataFetching=!0,e.status.error=null})).addCase(A.fulfilled,((e,t)=>{e.data.flowData=v(t.payload),e.status.dataFetching=!1,e.status.error=null})).addCase(A.rejected,((e,t)=>{e.status.dataFetching=!1,e.status.error=t.payload}))}}),{setProgress:Z,setLoadingStage:X,setView:J,setSelectedCommodity:K,setSelectedDate:Q,setVisualizationMode:ee,setSelectedRegion:te,setSelectedRegimes:re,setActiveLayers:ie,resetVisualizationData:ae,setRetryCount:ne,updateGeometry:oe,updateData:se,updateUI:le}=U.actions,ce=U.reducer},23567:(e,t,r)=>{"use strict";r.d(t,{kV:()=>a,vS:()=>i});const i={model:{coefficients:{},r_squared:0,adj_r_squared:0,f_statistic:0,p_value:1,observations:0,mse:0},spatial:{moran_i:{I:0,"p-value":1},vif:[]},residuals:{raw:[],byRegion:{},stats:{mean:0,variance:0,maxAbsolute:0}},metadata:{timestamp:null,version:"1.0",commodity:"",period:{start:null,end:null}}},a=e=>{if(!e||"object"!=typeof e)return!1;if(!(e.model&&"object"==typeof e.model&&"object"==typeof e.model.coefficients&&"number"==typeof e.model.r_squared&&"number"==typeof e.model.adj_r_squared&&"number"==typeof e.model.f_statistic&&"number"==typeof e.model.p_value&&"number"==typeof e.model.observations&&"number"==typeof e.model.mse))return!1;if(!(e.spatial&&"object"==typeof e.spatial&&e.spatial.moran_i&&"number"==typeof e.spatial.moran_i.I&&"number"==typeof e.spatial.moran_i["p-value"]&&Array.isArray(e.spatial.vif)))return!1;if(!(e.residuals&&"object"==typeof e.residuals&&Array.isArray(e.residuals.raw)&&"object"==typeof e.residuals.byRegion&&e.residuals.stats&&"number"==typeof e.residuals.stats.mean&&"number"==typeof e.residuals.stats.variance&&"number"==typeof e.residuals.stats.maxAbsolute))return!1;return e.metadata&&"object"==typeof e.metadata&&"string"==typeof e.metadata.version&&"string"==typeof e.metadata.commodity&&e.metadata.period&&"object"==typeof e.metadata.period}},34732:(e,t,r)=>{"use strict";r.d(t,{IN:()=>i,JB:()=>o,QO:()=>d,Ul:()=>n,nz:()=>c});const i=["sa'dah_governorate"],a=(e,t)=>{const r=[];let i=0;return e.forEach(((a,n)=>{if(i+=a,n>=t&&(i-=e[n-t]),n>=t-1){const e=i/t;r.push(isNaN(e)?0:e)}else r.push(a)})),r},n=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!Array.isArray(e)||0===e.length)return e;const n=i?"price":"usdprice",o=e.map((e=>({...e})));return t.forEach((e=>{const t=o.filter((t=>t.regime===e)),i=t.map((e=>e[n]));if(i.some((e=>void 0===e||isNaN(e))))return;const s=a(i,r),l=((e,t)=>{const r=Array(t).fill(0),i=Array(t).fill(0);return e.forEach(((e,a)=>{const n=a%t;r[n]+=e,i[n]+=1})),r.map(((e,t)=>e/(i[t]||1)))})(i.map(((e,t)=>e-s[t])),r);t.forEach(((e,t)=>{const i=l[t%r];e[n]=e[n]-i}))})),o},o=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!Array.isArray(e)||0===e.length)return e;const n=i?"price":"usdprice",o=e.map((e=>({...e})));return t.forEach((e=>{const t=o.filter((t=>t.regime===e)),i=t.map((e=>e[n]));if(i.some((e=>void 0===e||isNaN(e))))return;const s=a(i,r);t.forEach(((e,t)=>{e[n]=s[t]}))})),o},s={ecm:{section:"2.1. Error Correction Model (ECM)",equations:{main:{latex:"\\Delta Y_t = \\alpha \\beta' Y_{t-1} + \\sum_{i=1}^{p-1} \\Gamma_i \\Delta Y_{t-i} + u_t",description:"Vector Error Correction Model specification",variables:{"\\alpha":"Speed of adjustment coefficient","\\beta":"Long-run cointegration vector","\\Gamma_i":"Short-run dynamics coefficients",u_t:"Error term"}},diagnostics:{moransI:{latex:"I = \\frac{N}{\\sum_{i=1}^{N} \\sum_{j=1}^{N} w_{ij}} \\cdot \\frac{\\sum_{i=1}^{N} \\sum_{j=1}^{N} w_{ij}(y_i - \\bar{y})(y_j - \\bar{y})}{\\sum_{i=1}^{N} (y_i - \\bar{y})^2}",description:"Moran's I spatial autocorrelation statistic"},jarqueBera:{latex:"JB = \\frac{n}{6}(S^2 + \\frac{1}{4}(K-3)^2)",description:"Jarque-Bera normality test statistic"}}},concepts:{cointegration:"Long-run equilibrium relationship between variables",errorCorrection:"Adjustment process towards long-run equilibrium",grangerCausality:"Statistical prediction relationship between variables"}},priceDiff:{section:"2.2. Price Differential Model",equations:{main:{latex:"\\Delta P_{ijt} = \\ln(P_{it}) - \\ln(P_{jt})",description:"Log price differential between markets i and j at time t",variables:{"P_{it}":"Price in market i at time t","P_{jt}":"Price in market j at time t"}}},concepts:{arbitrage:"Price convergence through market mechanisms",priceTransmission:"Speed and extent of price signal propagation"}},spatial:{section:"3. Spatial Econometric Analysis",equations:{weights:{latex:"w_{ij} = \\begin{cases} 1 & \\text{if } j \\text{ is one of the } k \\text{ nearest neighbors of } i \\\\ 0 & \\text{otherwise} \\end{cases}",description:"K-nearest neighbors spatial weights specification"}},concepts:{spatialAutocorrelation:"Spatial dependence in price patterns",marketClustering:"Geographic clustering of similar market behaviors"}},tvmii:{section:"Time-Varying Market Integration Index",equations:{index:{latex:"TVMII_{ijt} = f(\\rho_{ijt}, \\sigma_{ijt}, d_{ij})",description:"Time-varying market integration index",variables:{"\\rho_{ijt}":"Time-varying price correlation","\\sigma_{ijt}":"Time-varying volatility","d_{ij}":"Distance between markets"}}},concepts:{marketIntegration:"Degree of price co-movement between markets",timeVaryingRelationship:"Evolution of market relationships over time"}}},l={"price-diff":{section:"price-differential",tooltips:{main:"Price differential analysis examines the differences in prices between markets",chart:"Visualizes price differences over time with confidence intervals",diagnostics:"Statistical tests to validate price differential patterns",market_pairs:"Comparison of price relationships between market pairs"},equations:{main:{latex:"\\Delta P_{ij,t} = \\ln(P_{i,t}) - \\ln(P_{j,t})",description:"Price differential between markets i and j at time t",variables:{"P_{i,t}":"Price in market i at time t","P_{j,t}":"Price in market j at time t","\\Delta P_{ij,t}":"Log price differential"}}}},ecm:{section:"error-correction-model",tooltips:{main:"Error Correction Model analyzes long-run equilibrium relationships",diagnostics:"Model diagnostics and statistical validation tests",cointegration:"Tests for long-run relationships between price series"},equations:{main:{latex:"\\Delta y_t = \\alpha(y_{t-1} - \\beta x_{t-1}) + \\gamma\\Delta x_t + \\epsilon_t",description:"Error correction model specification",variables:{"\\alpha":"Speed of adjustment coefficient","\\beta":"Long-run equilibrium coefficient","\\gamma":"Short-run dynamics coefficient"}}}},spatial:{section:"spatial-analysis",tooltips:{main:"Spatial analysis examines geographic patterns in market relationships",choropleth:"Color-coded map showing spatial distribution of values",flow_network:"Network diagram showing market relationships and flows",market_clustering:"Analysis of market groupings based on spatial relationships"},equations:{moran:{latex:"I = \\frac{n}{W} \\frac{\\sum_i \\sum_j w_{ij}(x_i - \\bar{x})(x_j - \\bar{x})}{\\sum_i (x_i - \\bar{x})^2}",description:"Moran's I spatial autocorrelation statistic",variables:{"w_{ij}":"Spatial weight between locations i and j",x_i:"Variable value at location i",W:"Sum of all spatial weights"}}}},tvmii:{section:"time-varying-market-integration",tooltips:{main:"Time-Varying Market Integration Index measures dynamic market relationships",chart:"Visualizes changes in market integration over time",interpretation:"Guidelines for interpreting TV-MII values",market_pairs:"Comparison of integration between market pairs"},equations:{main:{latex:"TV\\text{-}MII_{t} = \\frac{\\text{Cov}(P_{1t}, P_{2t})}{\\sqrt{\\text{Var}(P_{1t})\\text{Var}(P_{2t})}}",description:"Time-Varying Market Integration Index calculation",variables:{"P_{1t}":"Price in market 1 at time t","P_{2t}":"Price in market 2 at time t","TV\\text{-}MII_{t}":"Integration index at time t"}}}}},c=e=>s[e]&&l[e]||null,d=(e,t)=>{const r=l[e];return r?t?{tooltips:null===(i=r.tooltips)||void 0===i?void 0:i[t],equations:null===(a=r.equations)||void 0===a?void 0:a[t]}:r:null;var i,a}},42320:e=>{const t={SPATIAL:{DATA_LOAD:"spatial-data-load",PROCESSING:"spatial-processing",VALIDATION:"spatial-validation"},FLOW:{DATA_LOAD:"flow-data-load",PROCESSING:"flow-processing",VALIDATION:"flow-validation"},SYSTEM:{PERFORMANCE:"performance",ERROR:"error",INIT:"initialization"}};const r=new class{constructor(){this.metrics=[],this.errors=[],this.initialized=!1,this.observers=new Set,this.cleanupInterval=null,this.SPATIAL_METRIC_TYPES=t.SPATIAL}async init(){if(!this.initialized)try{return window.addEventListener("error",this.handleGlobalError.bind(this)),window.addEventListener("unhandledrejection",this.handleUnhandledRejection.bind(this)),await this.initializePerformanceMonitoring(),this.cleanupInterval=setInterval(this.cleanup.bind(this),6e4),this.initialized=!0,!0}catch(e){return this.logError("init-failed",{error:e.message,stack:e.stack}),!1}}handleGlobalError(e){try{var t;this.logError("uncaught-error",{message:e.message,filename:e.filename,lineno:e.lineno,colno:e.colno,stack:null===(t=e.error)||void 0===t?void 0:t.stack,timestamp:(new Date).toISOString()})}catch(e){}}handleUnhandledRejection(e){try{var t,r;this.logError("unhandled-rejection",{message:(null===(t=e.reason)||void 0===t?void 0:t.message)||"Unknown rejection reason",stack:null===(r=e.reason)||void 0===r?void 0:r.stack,timestamp:(new Date).toISOString()})}catch(e){}}async initializePerformanceMonitoring(){if("PerformanceObserver"in window)try{const e=new PerformanceObserver((e=>{e.getEntries().forEach((e=>{this.logMetric(t.SYSTEM.PERFORMANCE,{name:e.name,duration:e.duration,type:e.entryType,timestamp:(new Date).toISOString()})}))}));e.observe({entryTypes:["resource","navigation","longtask","paint","mark"]}),this.observers.add(e)}catch(e){throw e}}cleanup(){if(this.metrics.length>1e3){const e=this.metrics.length-1e3;this.metrics.splice(0,e)}if(this.errors.length>100){const e=this.errors.length-100;this.errors.splice(0,e)}}startMetric(e){var t=this;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e||"string"!=typeof e)return{finish:()=>{},cancel:()=>{}};const i=performance.now(),a=`${e}-${Date.now()}`;return{finish:function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{const o=performance.now()-i,s={id:a,...r,...n,duration:o,timestamp:(new Date).toISOString()};return t.metrics.push({name:e,data:s}),t.cleanup(),s}catch(e){return null}},cancel:()=>{0}}}logMetric(e,t){if(e&&"string"==typeof e)try{const r={...t,timestamp:(new Date).toISOString()};this.metrics.push({name:e,data:r}),this.cleanup()}catch(e){}}logError(e,t){if(e&&"string"==typeof e)try{const r={...t,timestamp:(new Date).toISOString()};this.errors.push({name:e,data:r}),this.cleanup()}catch(e){}}getMetrics(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return e?this.metrics.filter((t=>t.name.startsWith(e))):[...this.metrics]}getErrors(){return[...this.errors]}clearMetrics(){this.metrics=[],this.errors=[]}destroy(){try{window.removeEventListener("error",this.handleGlobalError.bind(this)),window.removeEventListener("unhandledrejection",this.handleUnhandledRejection.bind(this)),this.observers.forEach((e=>e.disconnect())),this.observers.clear(),this.cleanupInterval&&(clearInterval(this.cleanupInterval),this.cleanupInterval=null),this.metrics=[],this.errors=[],this.initialized=!1}catch(e){}}checkHealth(){return{initialized:this.initialized,metricsCount:this.metrics.length,errorsCount:this.errors.length,observersCount:this.observers.size,hasCleanupInterval:Boolean(this.cleanupInterval)}}};const i=t;e.exports={backgroundMonitor:r,MetricTypes:i,logError:e=>{}}},30428:e=>{const t=new Map;e.exports={getCache:e=>t.get(e),setCache:(e,r)=>{t.set(e,r)}}},73151:(e,t,r)=>{"use strict";r.d(t,{Ir:()=>d,ZB:()=>h,cv:()=>u,sH:()=>m});var i=r(47509);const a="/Yemen_Market_Analysis",n=parseInt({NODE_ENV:"production",PUBLIC_URL:"/Yemen_Market_Analysis",REACT_APP_DATA_PATH:"/data"}.REACT_APP_CACHE_DURATION,10)||36e5,o=3,s=1e3,l=5e3;new class{constructor(){this.cache=new Map}set(e,t){this.cache.set(e,{data:t,timestamp:Date.now()})}get(e){const t=this.cache.get(e);return t?Date.now()-t.timestamp>n?(this.cache.delete(e),null):t.data:null}clear(){this.cache.clear()}};const c=e=>e?e.replace(/\/+/g,"/").replace(/\/$/,"").replace(/^\/+/,"/").trim():"",d=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const t=`${a}/data`;if(e.includes("preprocessed_")){const t="preprocessed_by_commodity";return c(`${a}/data/${t}/${e}`)}return c(`${t}/${e}`)},u=e=>c(`${d("network_data")}/${e}`),m=e=>i.c.getCommodityFilePath(e),h=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{maxRetries:r=o,initialDelay:i=s,maxDelay:a=l,onRetry:n=null}=t;let c;for(let t=0;t<r;t++)try{return await e()}catch(e){if(c=e,t===r-1)throw e;const o=Math.min(i*Math.pow(2,t),a);n&&n(t,o,e),await new Promise((e=>setTimeout(e,o)))}throw c}},33890:e=>{e.exports={logValidation:e=>{}}},47509:(e,t,r)=>{"use strict";r.d(t,{c:()=>n});var i=r(44809),a=r.n(i);const n=new class{constructor(){this.basePaths=["/Yemen_Market_Analysis/data"],this.cache=new Map,this.successPathMap=new Map,this.retryAttempts=3,this.retryDelay=1e3}async resolveDataFile(e,t){var r;let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const a=`${e}/${t}`,n=this.cache.get(a);if(n&&Date.now()-n.timestamp<36e5)return n.response;const o=this.generatePaths(e,t);let s=null,l=null;for(let t=0;t<this.retryAttempts;t++){for(const t of o)try{if(s=await fetch(t,{...i,headers:{Accept:"application/json, text/csv","Cache-Control":"max-age=3600",...i.headers}}),s.ok)return this.successPathMap.set(e,t),this.cache.set(a,{response:s.clone(),timestamp:Date.now()}),s}catch(e){l=e;continue}t<this.retryAttempts-1&&await new Promise((e=>setTimeout(e,this.retryDelay*Math.pow(2,t))))}const c=await this.tryAlternativePath(e,t,i);if(c)return c;throw new Error(`Failed to load ${t} from all paths. Last error: ${null===(r=l)||void 0===r?void 0:r.message}`)}generatePaths(e,t){const r=this.basePaths.map((r=>`${r}/${e}/${t}`)),i=this.basePaths.map((e=>`${e}/${t}`)),a=this.successPathMap.get(e),n=[...r,...i];if(a){const r=a.split("/").slice(0,-2).join("/");n.unshift(`${r}/${e}/${t}`)}return n}async tryAlternativePath(e,t,r){const i=`/Yemen_Market_Analysis/results/${e}/${t}`;try{const e=await fetch(i,r);if(e.ok)return e}catch(e){}return null}async loadFile(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=await this.resolveDataFile(e,t,r);if("csv"===r.contentType){const e=await i.text();return new Promise(((t,r)=>{a().parse(e,{header:!0,dynamicTyping:!0,skipEmptyLines:!0,complete:e=>{e.data&&0!==e.data.length?t(e.data):r(new Error("CSV parsing resulted in empty data"))},error:e=>r(new Error(`CSV parsing failed: ${e.message}`))})}))}try{const e=await i.text();return JSON.parse(e)}catch(e){throw new Error(`Failed to parse JSON response: ${e.message}`)}}getCommodityPath(e){return{category:"preprocessed_by_commodity",filename:`preprocessed_yemen_market_data_${this.sanitizeCommodityName(e)}.json`}}getCommodityFilePath(e){const{category:t,filename:r}=this.getCommodityPath(e);return`/Yemen_Market_Analysis/data/${t}/${r}`}sanitizeCommodityName(e){return e?e.toLowerCase().trim().replace(/[()]/g,"").replace(/\s+/g,"_").replace(/[^a-z0-9_]/g,"").replace(/_+/g,"_").replace(/^_|_$/g,""):""}clearCache(){this.cache.clear(),this.successPathMap.clear()}}},80106:(e,t,r)=>{"use strict";r.d(t,{H:()=>f});var i=r(97857),a=(r(44809),r(2543)),n=r.n(a),o=r(34732),s=r(73151);r(47509);new class{constructor(){const e="/Yemen_Market_Analysis";this.pathMappings={development:{base:"/results",api:"http://localhost:5001/api",static:"/static",data:{preprocessed:"/results/preprocessed_by_commodity",raw:"/results"}},production:{base:e,static:`${e}/static`,data:{preprocessed:`${e}/data/preprocessed_by_commodity`,raw:`${e}/data`}}},this.cache=new Map,this.validPaths=new Set}normalizeCommodityName(e){return e?e.toLowerCase().trim().replace(/[()]/g,"").replace(/\s+/g,"_").replace(/[^a-z0-9_]/g,"").replace(/_+/g,"_").replace(/^_|_$/g,""):""}getCommodityFilePath(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"production";const r=this.normalizeCommodityName(e),i=this.detectEnvironment(t);return`${this.pathMappings[i].data.preprocessed}/preprocessed_yemen_market_data_${r}.json`}async validatePath(e){if(this.validPaths.has(e))return!0;try{const t=(await fetch(e,{method:"HEAD"})).ok;return t&&this.validPaths.add(e),t}catch(e){return!1}}detectEnvironment(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"production";return window.location.hostname.includes("github.io")||"production"===e?"production":"development"}async validatePaths(){const e=this.detectEnvironment(),t={environment:e,baseUrl:this.pathMappings[e].base,pathMappings:{},validPaths:[],invalidPaths:[],suggestions:[]},r=["beans (kidney red)","wheat_flour","rice_imported"];for(const i of r){const r=this.getCommodityFilePath(i,e),a=await this.validatePath(r);if(t.pathMappings[i]={normalized:this.normalizeCommodityName(i),filePath:r,valid:a},a)t.validPaths.push(r);else{t.invalidPaths.push(r);const a=this.generateAlternativePaths(i,e);for(const e of a)await this.validatePath(e)&&t.suggestions.push({original:r,alternative:e,commodity:i})}}return t}generateAlternativePaths(e,t){const r=this.normalizeCommodityName(e),i=[];if("development"===this.detectEnvironment(t))i.push(`/data/preprocessed_by_commodity/preprocessed_yemen_market_data_${r}.json`,`/results/preprocessed_by_commodity/preprocessed_yemen_market_data_${r}.json`);else{const e="/Yemen_Market_Analysis";i.push(`${e}/data/preprocessed_by_commodity/preprocessed_yemen_market_data_${r}.json`,`${e}/results/preprocessed_by_commodity/preprocessed_yemen_market_data_${r}.json`)}return i}async validateDataAccess(e){const t=await this.validatePaths();return t.invalidPaths.length>0&&t.suggestions.length>0&&this.applyPathSuggestions(e,t.suggestions),t}applyPathSuggestions(e,t){t.forEach((t=>{const{original:r,alternative:i}=t;e.get(r,((e,t)=>{t.redirect(i)}))}))}getStaticPath(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"production";const r=this.detectEnvironment(t);return`${this.pathMappings[r].static}/${e}`}clearCache(){this.cache.clear(),this.validPaths.clear()}};var l=r(23567),c=(r(27154),r(5307)),d=r(42320);class u{constructor(){this.normalizedNameCache=new Map,this._instance=null}static getInstance(){return this._instance||(this._instance=new u),this._instance}normalizePolygons(e){if(!Array.isArray(e))return[];const t=JSON.stringify(e.map((e=>{var t;return null==e||null===(t=e.properties)||void 0===t?void 0:t.shapeName})));if(this.normalizedNameCache.has(t))return this.normalizedNameCache.get(t);const r=e.map((e=>{var t;if(null==e||null===(t=e.properties)||void 0===t||!t.shapeName)return e;const r=this.getNormalizedName(e.properties.shapeName);return{...e,properties:{...e.properties,originalName:e.properties.shapeName,normalizedName:r,region_id:r}}}));return this.normalizedNameCache.set(t,r),r}getNormalizedName(e){if(!e)return null;if(this.normalizedNameCache.has(e.toLowerCase()))return this.normalizedNameCache.get(e.toLowerCase());let t=e.toLowerCase();const r=t+(t.endsWith(" governorate")?"":" governorate"),i=this.applyYemenRegionFixes(r);return i!==r?(this.normalizedNameCache.set(e.toLowerCase(),i),i):(t=t.replace(/\s+governorate$/i,"").replace(/[ʿʾ]/g,"'").replace(/['']/g,"'").trim(),t=this.applyYemenRegionFixes(t),this.normalizedNameCache.set(e.toLowerCase(),t),t)}applyYemenRegionFixes(e){return{"'amran governorate":"amran","abyan governorate":"abyan","'adan governorate":"aden","al bayda' governorate":"al bayda","ad dali' governorate":"al dhale'e","al hudaydah governorate":"al hudaydah","al jawf governorate":"al jawf","al mahrah governorate":"al maharah","al mahwit governorate":"al mahwit","san'a'":"amanat al asimah","dhamar governorate":"dhamar",hadhraumaut:"hadramaut","hajjah governorate":"hajjah","ibb governorate":"ibb","lahij governorate":"lahj","ma'rib governorate":"marib","raymah governorate":"raymah","san'a' governorate":"sana'a","shabwah governorate":"shabwah",socotra:"socotra","ta'izz governorate":"taizz"}[e]||e}matchPolygonsWithPoints(e,t){if(!Array.isArray(e)||!Array.isArray(t))return[];const r=new Map;return t.forEach((e=>{var t;const i=this.getNormalizedName(null===(t=e.properties)||void 0===t?void 0:t.admin1);i&&r.set(i,e)})),e.map((e=>{var t,i,a;const n=null===(t=e.properties)||void 0===t?void 0:t.normalizedName;if(!n)return e;const o=r.get(n);return o?{...e,properties:{...e.properties,coordinates:o.coordinates,population:null===(i=o.properties)||void 0===i?void 0:i.population,population_percentage:null===(a=o.properties)||void 0===a?void 0:a.population_percentage}}:e}))}clearCache(){this.normalizedNameCache.clear()}}const m=u.getInstance(),h="/Yemen_Market_Analysis",p=`${h}/data`,g={type:"FeatureCollection",features:[],crs:{type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}}};class y{static getInstance(){return y._instance||(y._instance=new y),y._instance}constructor(){if((0,i.A)(this,"cleanupCache",(()=>{const e=Date.now();for(const[t,r]of this.cache.entries())e-r.timestamp>this.cacheConfig.TTL&&this.cache.delete(t)})),(0,i.A)(this,"clearCache",(()=>{this.cache.clear(),this.geometryCache=null,this.regionMappingCache.clear(),this.coordinateCache.clear(),this.pointCache=null})),(0,i.A)(this,"convertUTMtoLatLng",((e,t)=>{const r=.9996,i=6378137,a=.081819191,n=.006739497,o=e-5e5,s=t/r/6367449.183292391,l=s+(3*n/2-27*Math.pow(n,3)/32)*Math.sin(2*s)+(21*Math.pow(n,2)/16-55*Math.pow(n,4)/32)*Math.sin(4*s)+151*Math.pow(n,3)/96*Math.sin(6*s),c=i/Math.sqrt(1-a*a*Math.sin(l)*Math.sin(l)),d=Math.tan(l)*Math.tan(l),u=a*a*Math.cos(l)*Math.cos(l)/(1-a*a),m=i*(1-a*a)/Math.pow(1-a*a*Math.sin(l)*Math.sin(l),1.5),h=o/(c*r),p=l-c*Math.tan(l)/m*(h*h/2-(5+3*d+10*u-4*Math.pow(u,2)-9*a*a)*Math.pow(h,4)/24+(61+90*d+298*u+45*Math.pow(d,2)-252*a*a-3*Math.pow(u,2))*Math.pow(h,6)/720),g=(h-(1+2*d+u)*Math.pow(h,3)/6+(5-2*u+28*d-3*Math.pow(u,2)+8*a*a+24*Math.pow(d,2))*Math.pow(h,5)/120+45)/Math.cos(l)*(180/Math.PI);return{lat:p*(180/Math.PI),lng:g}})),(0,i.A)(this,"normalizeRegionName",(e=>e?m.getNormalizedName(e):null)),(0,i.A)(this,"normalizeCommodityName",(e=>e?e.toLowerCase().replace(/[()]/g,"").replace(/\s+/g,"_").trim():"")),(0,i.A)(this,"validateGeoJSON",(e=>{if(!e||"object"!=typeof e)return!1;if("FeatureCollection"!==e.type)return!1;if(!Array.isArray(e.features))return!1;if(0===e.features.length)return!1;const t=e.features[0];return!!(t.type&&t.properties&&t.geometry)})),(0,i.A)(this,"validateFlowData",(e=>{if(!Array.isArray(e))return!1;const t=e.map((e=>{const t=this.validateMarket(e.source),r=this.validateMarket(e.target),i=this.validateFlowMetrics(e);return{valid:t&&r&&i,source:t,target:r,metrics:i,messages:[]}}));return{valid:t.every((e=>e.valid)),details:t}})),(0,i.A)(this,"validateMarket",(e=>{const t=this.normalizeRegionName(e);return t&&!this.excludedRegions.has(t)&&this.coordinateCache.has(t)})),(0,i.A)(this,"validateFlowMetrics",(e=>"number"==typeof e.flow_weight&&e.flow_weight>=0&&"number"==typeof e.flow_count&&e.flow_count>0)),(0,i.A)(this,"validatePreprocessedData",(e=>{if(!e||"object"!=typeof e)return!1;const t=["time_series_data","market_clusters","market_shocks","spatial_autocorrelation","market_integration"],r=t.filter((t=>!e[t])),i=t.filter((t=>{const r=e[t];switch(t){case"time_series_data":case"market_clusters":case"market_shocks":return!Array.isArray(r);case"spatial_autocorrelation":return!(null!=r&&r.global&&null!=r&&r.local);case"market_integration":return!(null!=r&&r.price_correlation);default:return!1}}));return!(r.length>0)&&!(i.length>0)})),(0,i.A)(this,"validateRegressionData",(e=>{if(null==e||!e.model||null==e||!e.spatial||null==e||!e.residuals)return!1;if(!("number"==typeof e.model.r_squared&&"number"==typeof e.model.adj_r_squared&&"number"==typeof e.model.mse&&"number"==typeof e.model.intercept&&"number"==typeof e.model.observations&&e.model.coefficients&&Object.keys(e.model.coefficients).length>0))return!1;if(!(e.spatial.moran_i&&"number"==typeof e.spatial.moran_i.I&&"number"==typeof e.spatial.moran_i["p-value"]&&Array.isArray(e.spatial.vif)))return!1;return!(!Array.isArray(e.residuals.raw)||"object"!=typeof e.residuals.byRegion||!e.residuals.stats||"number"!=typeof e.residuals.stats.mean||"number"!=typeof e.residuals.stats.variance||"number"!=typeof e.residuals.stats.maxAbsolute)})),(0,i.A)(this,"validateMarketClusters",(e=>e.every((e=>e.main_market&&Array.isArray(e.connected_markets)&&this.validateMarketConnections(e))))),(0,i.A)(this,"validateMarketConnections",(e=>!0)),(0,i.A)(this,"initializeGeometry",(async()=>{if(this.geometryCache&&this.geometryCache.size>0)return this.geometryCache;try{const e=`${h}/data/geoBoundaries-YEM-ADM1.geojson`,t=await fetch(e);if(!t.ok){const t=`${h}/results/geoBoundaries-YEM-ADM1.geojson`,r=await fetch(t);if(!r.ok)throw new Error(`Failed to load geometry from both paths: ${e} and ${t}`);return this.processGeometryResponse(r)}return this.processGeometryResponse(t)}catch(e){throw e}})),(0,i.A)(this,"processGeometryResponse",(async e=>{const t=await e.json();this.geometryCache||(this.geometryCache=new Map);const r=new Map;return t.features.forEach((e=>{var t;if(null==e||null===(t=e.properties)||void 0===t||!t.shapeName)return;const i=m.getNormalizedName(e.properties.shapeName);i&&(r.has(i)||r.set(i,{type:"polygon",geometry:e.geometry,properties:{originalName:e.properties.shapeName,normalizedName:i,shapeISO:e.properties.shapeISO,region_id:i}}))})),this.geometryCache=r,this.updateMappingCache(r),this.geometryCache})),(0,i.A)(this,"updateMappingCache",(e=>{e.forEach(((e,t)=>{this.regionMappingCache.set(e.properties.originalName.toLowerCase(),t),this.regionMappingCache.set(t,t)}))})),(0,i.A)(this,"initializePoints",(async()=>{if(this.pointCache)return this.pointCache;try{const e=`${h}/data/unified_data.geojson`,t=await fetch(e);if(!t.ok){const t=`${h}/results/unified_data.geojson`,r=await fetch(t);if(!r.ok)throw new Error(`Failed to load points from both paths: ${e} and ${t}`);return this.processPointsResponse(r)}return this.processPointsResponse(t)}catch(e){throw e}})),(0,i.A)(this,"processPointsResponse",(async e=>{const t=await e.json();this.pointCache=new Map;const r=e=>{var t;if(null==e||null===(t=e.properties)||void 0===t||!t.admin1)return null;const r=this.normalizeRegionName(e.properties.admin1);if(!r)return null;const i=e.geometry.coordinates,a=this.convertUTMtoLatLng(i[0],i[1]);return{type:"point",coordinates:[a.lng,a.lat],properties:{originalName:e.properties.admin1,normalizedName:r,population:e.properties.population,population_percentage:e.properties.population_percentage}}},i=t.features||[];for(let e=0;e<i.length;e+=1e3){i.slice(e,e+1e3).forEach((e=>{const t=r(e);t&&(this.pointCache.set(t.properties.normalizedName,t),this.coordinateCache.set(t.properties.normalizedName,t.coordinates))}))}return this.pointCache})),(0,i.A)(this,"initializeCoordinates",(async()=>{if(!(this.coordinateCache.size>0))try{(await this.initializeGeometry()).forEach((e=>{var t,r;const i=this.normalizeRegionName(null===(t=e.properties)||void 0===t?void 0:t.shapeName);if(i&&null!==(r=e.geometry)&&void 0!==r&&r.coordinates){const t=this.calculateCentroid(e.geometry.coordinates);this.coordinateCache.set(i,t)}}))}catch(e){throw e}})),(0,i.A)(this,"calculateCentroid",(e=>{try{if(!Array.isArray(e))return null;if(Array.isArray(e[0][0][0])){const t=e.flat(2),r=this.calculateCentroidFromPoints(t);return this.convertUTMtoLatLng(r.x,r.y)}if(Array.isArray(e[0][0])){const t=this.calculateCentroidFromPoints(e[0]);return this.convertUTMtoLatLng(t.x,t.y)}return null}catch(e){return null}})),(0,i.A)(this,"calculateCentroidFromPoints",(e=>{if(!Array.isArray(e)||0===e.length)return null;let t=0,r=0,i=0;for(const a of e)Array.isArray(a)&&a.length>=2&&(t+=a[0],r+=a[1],i++);return 0===i?null:{x:t/i,y:r/i}})),(0,i.A)(this,"loadPreprocessedData",(async e=>{try{const t=`preprocessed_yemen_market_data_${this.normalizeCommodityName(e)}.json`,r=`${h}/data/preprocessed_by_commodity/${t}`,i=await fetch(r);if(!i.ok){const e=`${h}/results/preprocessed_by_commodity/${t}`,i=await fetch(e);if(!i.ok)throw new Error(`Failed to load data from both paths: ${r} and ${e}`);return this.processPreprocessedResponse(i)}return this.processPreprocessedResponse(i)}catch(e){throw e}})),(0,i.A)(this,"processPreprocessedResponse",(async e=>{const t=await e.text(),r=this.sanitizeJsonText(t);try{const e=JSON.parse(r);if(!this.validatePreprocessedData(e))throw new Error("Invalid data structure");return this.enhanceWithRealtimeMetrics(e)}catch(e){throw new Error("Failed to parse data: "+e.message)}})),(0,i.A)(this,"loadFlowDataWithRecovery",(async e=>{try{return await this.loadFlowData(e)}catch(t){try{return await this.loadBackupFlowData(e)}catch(e){return[]}}})),(0,i.A)(this,"loadFlowData",(async e=>{try{const t=(0,s.sH)(e),r=`flow_${e}`,i=this.cache.get(r);if(i)return i.data;const a=await fetch(t);if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const n=await a.json();if(!n.flow_analysis)throw new Error("Flow analysis data not found in preprocessed file");const o=this.processFlowAnalysis(n.flow_analysis);return this.cache.set(r,{data:o,timestamp:Date.now()}),o}catch(e){throw e}})),(0,i.A)(this,"loadBackupFlowData",(async e=>{try{const t=this.normalizeCommodityName(e),r=`${p}/backup_flow_data/${`backup_flow_data_${t}.json`}`,i=await fetch(r);if(!i.ok)throw new Error(`Backup HTTP error! status: ${i.status}`);const a=await i.json();return this.processFlowAnalysis(a.flow_analysis)}catch(e){throw e}})),(0,i.A)(this,"processFlowDataSafely",(e=>e.map((e=>{try{return this.processFlowRow(e)}catch(e){return null}})).filter(Boolean))),(0,i.A)(this,"processFlowRow",(e=>{var t,r;if(!e||"object"!=typeof e)return null;const i=this.normalizeRegionName(e.source),a=this.normalizeRegionName(e.target);return this.excludedRegions.has(i)||this.excludedRegions.has(a)?null:{source:i,target:a,commodity:null===(t=e.commodity)||void 0===t||null===(r=t.trim)||void 0===r?void 0:r.call(t),price_differential:Number(e.price_differential)||0,source_price:Number(e.source_price)||0,target_price:Number(e.target_price)||0,flow_weight:Number(e.flow_weight)||0}})),(0,i.A)(this,"processFlowAnalysis",(e=>{if(!Array.isArray(e))return{flows:[],byDate:{},metadata:{}};try{const t=e.map((e=>{const t=this.normalizeRegionName(e.source),r=this.normalizeRegionName(e.target);if(!t||!r||this.excludedRegions.has(t)||this.excludedRegions.has(r))return null;const i=this.coordinateCache.get(t),a=this.coordinateCache.get(r);if(!i||!a)return null;let n="2020-10";return(e.date||e.month)&&(n=(e.date||e.month).substring(0,7),n.match(/^\d{4}-\d{2}$/)||(n="2020-10")),{source:t,target:r,date:n,total_flow:this.sanitizeNumericValue(e.total_flow||e.flow_weight),avg_flow:this.sanitizeNumericValue(e.avg_flow||e.total_flow||e.flow_weight),flow_count:e.flow_count||1,price_differential:this.sanitizeNumericValue(e.price_differential),source_price:this.sanitizeNumericValue(e.source_price),target_price:this.sanitizeNumericValue(e.target_price),coordinates:{source:i,target:a}}})).filter(Boolean),r=t.reduce(((e,t)=>(e[t.date]||(e[t.date]=[]),e[t.date].push(t),e)),{});Object.keys(r).forEach((e=>{const t=r[e],i=Math.max(...t.map((e=>e.total_flow||0))),a=Math.max(...t.map((e=>Math.abs(e.price_differential||0))));t.forEach((e=>{e.normalized={flow:i>0?(e.total_flow||0)/i:0,priceDiff:a>0?Math.abs(e.price_differential||0)/a:0}}))}));const i=Object.keys(r).sort();return{flows:t,byDate:r,metadata:{totalFlows:t.length,dateRange:{start:i[0],end:i[i.length-1]},uniqueDates:i.length,lastUpdated:(new Date).toISOString()}}}catch(e){return{flows:[],byDate:{},metadata:{}}}})),(0,i.A)(this,"processFlowData",((e,t)=>{if(!Array.isArray(e))throw new Error("Invalid flow data structure: expected array");return(t?e.filter((e=>{var r,i;return(null===(r=e.date)||void 0===r?void 0:r.startsWith(t))||(null===(i=e.month)||void 0===i?void 0:i.startsWith(t))})):e).map((e=>{const t=this.normalizeRegionName(e.source),r=this.normalizeRegionName(e.target),i=this.coordinateCache.get(t),a=this.coordinateCache.get(r);return i&&a?{source:t,target:r,date:e.date||e.month,source_lat:i[1],source_lng:i[0],target_lat:a[1],target_lng:a[0],flow_weight:Number(e.flow_weight)||0,price_differential:Number(e.price_differential)||0,source_price:Number(e.source_price)||0,target_price:Number(e.target_price)||0}:null})).filter((e=>e&&!this.excludedRegions.has(e.source)&&!this.excludedRegions.has(e.target)))})),(0,i.A)(this,"filterByDate",((e,t)=>{if(!t||!Array.isArray(e))return e;try{const r=t.substring(0,7);return e.filter((e=>(e.date||e.month||"").substring(0,7)===r))}catch(e){return[]}})),(0,i.A)(this,"validateFlow",(e=>Boolean(e&&e.source&&e.target&&"number"==typeof e.total_flow&&!isNaN(e.total_flow)&&(e.date||e.month)))),(0,i.A)(this,"processFlow",(e=>{const t=this.normalizeRegionName(e.source),r=this.normalizeRegionName(e.target);if(!this.validateFlow(e)||!t||!r)return null;const i=this.coordinateCache.get(t),a=this.coordinateCache.get(r);return i&&a?{source:t,target:r,date:(e.date||e.month).substring(0,7),total_flow:this.sanitizeNumericValue(e.total_flow||e.flow_weight),avg_flow:this.sanitizeNumericValue(e.avg_flow),price_differential:this.sanitizeNumericValue(e.price_differential),coordinates:{source:i,target:a}}:null})),y._instance)return y._instance;this.cache=new Map,this.geometryCache=null,this.pointCache=null,this.coordinateCache=new Map,this.regionMappingCache=new Map,this.excludedRegions=new Set(o.IN.map((e=>m.getNormalizedName(e)))),this.defaultGeoJSON=g,this.missingGeometryWarnings=new Set,this.debugMode=!1,this.cacheConfig={TTL:36e5,maxSize:100,cleanupInterval:3e5},"undefined"!=typeof window&&setInterval((()=>this.cleanupCache()),this.cacheConfig.cleanupInterval)}async deduplicateRequest(e,t){if(y._pendingRequests.has(e))return y._pendingRequests.get(e);const r=this.cache.get(e);if(r&&Date.now()-r.timestamp<this.cacheConfig.TTL)return r.data;const i=t().then((t=>(this.cache.set(e,{data:t,timestamp:Date.now()}),y._pendingRequests.delete(e),t))).catch((t=>{throw y._pendingRequests.delete(e),t}));return y._pendingRequests.set(e,i),i}async loadRegressionAnalysis(e){let t;try{var r;if(!e)return l.vS;t=d.backgroundMonitor.startMetric("regression-data-fetch",{commodity:e,timestamp:(new Date).toISOString()});const a=`regression_${e}`,n=this.cache.get(a);var i;if(null!=n&&n.data)return null===(i=t)||void 0===i||i.finish({status:"cache-hit"}),n.data;const o=`${h}/data/spatial_analysis_results.json`,s=await fetch(o);if(!s.ok)throw new Error(`Failed to load spatial analysis data: ${s.statusText}`);const c=await s.text();let u;try{if(u=JSON.parse(c),!Array.isArray(u))throw new Error("Invalid data format: expected array")}catch(t){throw d.backgroundMonitor.logError("regression-parse-error",{error:t.message,commodity:e,path:o}),t}const m=u.find((t=>this.normalizeCommodityName(t.commodity)===this.normalizeCommodityName(e)));if(!m)throw new Error(`No analysis found for commodity: ${e}`);const p={model:{coefficients:m.coefficients||{},intercept:this.sanitizeNumericValue(m.intercept),p_values:m.p_values||{},r_squared:this.sanitizeNumericValue(m.r_squared),adj_r_squared:this.sanitizeNumericValue(m.adj_r_squared),mse:this.sanitizeNumericValue(m.mse),observations:m.observations||0},spatial:{moran_i:m.moran_i||{I:0,"p-value":1},vif:Array.isArray(m.vif)?m.vif:[]},residuals:{raw:m.residual||[],byRegion:this.processResidualsByRegion(m.residual||[]),stats:this.calculateResidualStats(m.residual||[])},metadata:{commodity:e,regime:m.regime||"unified",timestamp:(new Date).toISOString(),version:"1.0"}};if(!this.validateRegressionData(p))throw new Error("Invalid regression data structure after processing");return this.cache.set(a,{data:p,timestamp:Date.now()}),null===(r=t)||void 0===r||r.finish({status:"success",dataPoints:p.model.observations,hasResiduals:p.residuals.raw.length>0}),p}catch(r){var a;return d.backgroundMonitor.logError("regression-load-error",{error:r.message,commodity:e,stack:r.stack}),null===(a=t)||void 0===a||a.finish({status:"error",error:r.message,commodity:e}),l.vS}}processResidualsByRegion(e){return e.reduce(((e,t)=>{const r=t.region_id;return e[r]||(e[r]=[]),e[r].push({date:t.date,residual:t.residual}),e}),{})}calculateResidualStats(e){if(!e.length)return{mean:0,variance:0,maxAbsolute:0};const t=e.map((e=>e.residual)),r=t.reduce(((e,t)=>e+t),0)/t.length,i=t.reduce(((e,t)=>e+Math.pow(t-r,2)),0)/t.length,a=Math.max(...t.map(Math.abs));return{mean:r,variance:i,maxAbsolute:a}}async processTimeSeriesData(e){try{if(null==e||!e.features||!Array.isArray(e.features))return[];const t=e.features.map((e=>{try{var t,r,i,a,n,o;if(null==e||null===(t=e.properties)||void 0===t||!t.date||!e.properties.region_id&&!e.properties.admin1)return null;const s=new Date(e.properties.date);if(isNaN(s.getTime()))return null;const l=`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}`,c=this.normalizeRegionName(e.properties.region_id||e.properties.admin1);return{region:c,month:l,usdPrice:null!==(r=e.properties.usdprice)&&void 0!==r?r:null,conflictIntensity:null!==(i=e.properties.conflict_intensity)&&void 0!==i?i:null,additionalProperties:{...e.properties,region:c,population:null!==(a=e.properties.population)&&void 0!==a?a:null,conflict_intensity:null!==(n=e.properties.conflict_intensity)&&void 0!==n?n:null,commodity:null!==(o=e.properties.commodity)&&void 0!==o?o:null,regime:e.properties.exchange_rate_regime||"unified"}}}catch(e){return null}})).filter(Boolean).filter((e=>{const t=Boolean(e.region&&null!==e.usdPrice&&!isNaN(e.usdPrice));return t}));return n().sortBy(t,["region","month"])}catch(e){throw e}}processMarketShocks(e){return Array.isArray(e)?e.map((e=>({region:this.normalizeRegionName(e.region),date:e.date,shock_type:e.shock_type,magnitude:this.sanitizeNumericValue(e.magnitude),previous_price:this.sanitizeNumericValue(e.previous_price),current_price:this.sanitizeNumericValue(e.current_price)}))).filter((e=>e.region&&e.magnitude)):[]}processClusterEfficiency(e){return Array.isArray(e)?e.map((e=>({cluster_id:e.cluster_id,internal_connectivity:this.sanitizeNumericValue(e.internal_connectivity),market_coverage:this.sanitizeNumericValue(e.market_coverage),price_convergence:this.sanitizeNumericValue(e.price_convergence),stability:this.sanitizeNumericValue(e.stability),efficiency_score:this.sanitizeNumericValue(e.efficiency_score)}))):[]}processSpatialAutocorrelation(e){if(null==e||!e.global||null==e||!e.local)return{global:null,local:null};const t={moran_i:this.sanitizeNumericValue(e.global.moran_i),p_value:e.global.p_value,z_score:e.global.z_score,significance:e.global.significance},r={};for(const[t,i]of Object.entries(e.local)){r[this.normalizeRegionName(t)]={local_i:this.sanitizeNumericValue(i.local_i),p_value:i.p_value,cluster_type:i.cluster_type}}return{global:t,local:r}}processSeasonalAnalysis(e){return null!=e&&e.seasonal_pattern?{seasonal_strength:this.sanitizeNumericValue(e.seasonal_strength),trend_strength:this.sanitizeNumericValue(e.trend_strength),peak_month:e.peak_month,trough_month:e.trough_month,seasonal_pattern:e.seasonal_pattern.map((e=>this.sanitizeNumericValue(e)))}:null}processConflictMetrics(e){return Array.isArray(e)?e.map((e=>({month:e.month,adjusted_price:this.sanitizeNumericValue(e.adjusted_price)}))):[]}processMarketIntegration(e){if(null==e||!e.price_correlation)return null;const t={};for(const[r,i]of Object.entries(e.price_correlation)){const e=this.normalizeRegionName(r);t[e]={};for(const[r,a]of Object.entries(i)){const i=this.normalizeRegionName(r);t[e][i]=this.sanitizeNumericValue(a)}}return{price_correlation:t,flow_density:this.sanitizeNumericValue(e.flow_density),accessibility:e.accessibility,integration_score:this.sanitizeNumericValue(e.integration_score)}}processRegressionAnalysis(e){if(!e)return l.vS;try{var t,r;return{model:{coefficients:e.coefficients||{},intercept:this.sanitizeNumericValue(e.intercept),p_values:e.p_values||{},r_squared:this.sanitizeNumericValue(e.r_squared),adj_r_squared:this.sanitizeNumericValue(e.adj_r_squared),mse:this.sanitizeNumericValue(e.mse),observations:e.observations||0},spatial:{moran_i:{I:this.sanitizeNumericValue(null===(t=e.moran_i)||void 0===t?void 0:t.I),"p-value":this.sanitizeNumericValue(null===(r=e.moran_i)||void 0===r?void 0:r["p-value"])},vif:Array.isArray(e.vif)?e.vif.map((e=>({Variable:e.Variable,VIF:this.sanitizeNumericValue(e.VIF)}))):[]},residuals:this.processResiduals(e.residual||[])}}catch(e){return l.vS}}processResiduals(e){if(!Array.isArray(e))return{raw:[],byRegion:{},stats:{}};const t=e.map((e=>({region_id:e.region_id,date:new Date(e.date).toISOString(),residual:Number(e.residual)}))),r=n().groupBy(t,"region_id"),i=t.map((e=>e.residual));return{raw:t,byRegion:r,stats:{mean:n().mean(i)||0,variance:this.calculateVariance(i),maxAbsolute:Math.max(...i.map(Math.abs))||0}}}calculateVariance(e){if(!e.length)return 0;const t=n().mean(e);return n().sum(e.map((e=>Math.pow(e-t,2))))/e.length}async processVisualizationData(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{return await c.o.calculateVisualization(e,{mode:t,filters:r})}catch(e){throw e}}async processPriceVisualization(e,t){const{timeSeriesData:r}=e;if(null==r||!r.length)return null;const i={timeSeries:this.processTimeSeriesForVisualization(r),metrics:calculateVisualizationMetrics.calculatePriceMetrics(r),trends:this.calculatePriceTrends(r),statistics:{volatility:this.calculateVolatilityMetrics(r),seasonality:this.detectSeasonalPatterns(r)}};return t.timeRange&&(i.timeSeries=this.filterTimeSeriesData(i.timeSeries,t.timeRange)),i}async processIntegrationVisualization(e,t){const{marketIntegration:r,flowAnalysis:i,spatialAutocorrelation:a}=e;return{correlationMatrix:this.processCorrelationMatrix(r.price_correlation,t),flowMetrics:this.processFlowMetrics(i,t),spatialMetrics:{moran:a.global.moran_i,clusters:this.processSpatialClusters(a.local,t)},integrationScores:this.calculateIntegrationScores(e)}}async processClusterVisualization(e,t){const{marketClusters:r,clusterEfficiency:i}=e;return{clusters:this.processMarketClusters(r,t),efficiency:this.processClusterEfficiency(i),metrics:{coverage:this.calculateMarketCoverage(r),stability:this.calculateClusterStability(r),connectivity:this.calculateClusterConnectivity(r)},spatialDistribution:this.analyzeClusterDistribution(r)}}async processShockVisualization(e,t){const{marketShocks:r,timeSeriesData:i}=e;return{shocks:this.processMarketShocks(r,t),patterns:this.analyzeShockPatterns(r),impact:this.calculateShockImpact(r,i),propagation:this.analyzeShockPropagation(r),riskMetrics:this.calculateMarketRiskMetrics(r)}}async createUnifiedGeoJSON(e){await Promise.all([this.initializeGeometry(),this.initializePoints()]);const t=[];for(const[r,i]of this.geometryCache.entries()){const a=this.pointCache.get(r),n=e.find((e=>this.normalizeRegionName(e.region||e.admin1)===r))||{};t.push({type:"Feature",geometry:i.geometry,properties:{region_id:r,originalName:i.properties.originalName,normalizedName:r,shapeISO:i.properties.shapeISO,center:a?a.coordinates:null,population:a?a.properties.population:null,data:n||{}}})}return{type:"FeatureCollection",features:t,crs:{type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}}}}async enhanceWithRealtimeMetrics(e){try{const a=n().cloneDeep(e);var t,r,i;if(this.shouldEnhanceData(a))null!==(t=a.time_series_data)&&void 0!==t&&null!==(t=t[0])&&void 0!==t&&t.garch_volatility||(a.time_series_data=this.addGarchVolatility(a.time_series_data)),null!==(r=a.time_series_data)&&void 0!==r&&null!==(r=r[0])&&void 0!==r&&r.price_stability||(a.time_series_data=this.addPriceStability(a.time_series_data)),null!==(i=a.market_integration)&&void 0!==i&&i.integration_score||(a.market_integration=await this.enhanceMarketIntegration(a.market_integration)),a.metadata={...a.metadata,enhanced:!0,enhancement_date:(new Date).toISOString(),enhancement_version:"1.0"};return a}catch(t){return e}}shouldEnhanceData(e){var t,r,i;return!(null!==(t=e.time_series_data)&&void 0!==t&&null!==(t=t[0])&&void 0!==t&&t.garch_volatility&&null!==(r=e.time_series_data)&&void 0!==r&&null!==(r=r[0])&&void 0!==r&&r.price_stability&&null!==(i=e.market_integration)&&void 0!==i&&i.integration_score)}addGarchVolatility(e){return Array.isArray(e)?e.map((e=>{var t;return{...e,garch_volatility:null!==(t=e.garch_volatility)&&void 0!==t?t:this.calculateGarchVolatility(e)}})):e}calculateGarchVolatility(e){var t;const r=e.avgUsdPrice;return r?Math.abs(r-(null!==(t=e.previous_price)&&void 0!==t?t:r))/r:0}addPriceStability(e){return Array.isArray(e)?e.map(((t,r)=>{var i;return{...t,price_stability:null!==(i=t.price_stability)&&void 0!==i?i:this.calculatePriceStability(e,r)}})):e}calculatePriceStability(e,t){const r=Math.max(0,t-3+1),i=e.slice(r,t+1).map((e=>e.avgUsdPrice)).filter((e=>null!=e));if(i.length<2)return 1;return 1/(1+Math.sqrt(i.reduce(((e,t)=>e+Math.pow(t-i[0],2)),0)/i.length))}async enhanceMarketIntegration(e){var t;return e?{...e,integration_score:null!==(t=e.integration_score)&&void 0!==t?t:this.calculateIntegrationScore(e)}:{}}calculateIntegrationScore(e){const t=.4,r=.3,i=.3;let a=0,n=0;return e.price_correlation&&(a+=t*this.calculateAverageCorrelation(e.price_correlation),n+=t),"number"==typeof e.flow_density&&(a+=r*e.flow_density,n+=r),e.accessibility&&(a+=i*this.calculateAverageAccessibility(e.accessibility),n+=i),n>0?a/n:0}calculateAverageCorrelation(e){if(!e||"object"!=typeof e)return 0;let t=0,r=0;return Object.values(e).forEach((e=>{"object"==typeof e&&Object.values(e).forEach((e=>{"number"!=typeof e||isNaN(e)||(t+=e,r++)}))})),r>0?t/r:0}calculateAverageAccessibility(e){if(!e||"object"!=typeof e)return 0;const t=Object.values(e).filter((e=>"number"==typeof e&&!isNaN(e)));return t.length>0?t.reduce(((e,t)=>e+t),0)/t.length:0}sanitizeNumericValues(e){if(e&&"object"==typeof e)for(const[t,r]of Object.entries(e))r&&"object"==typeof r?this.sanitizeNumericValues(r):"number"==typeof r&&(!Number.isNaN(r)&&Number.isFinite(r)||(e[t]=null))}sanitizeNumericValue(e){return null==e||Number.isNaN(e)?null:"number"==typeof e?e:Number(e)}sanitizeJsonText(e){return e?e.replace(/:\s*NaN/g,": null").replace(/:\s*Infinity/g,": null").replace(/:\s*-Infinity/g,": null").replace(/:\s*undefined/g,": null").replace(/:\s*"(NaN|Infinity|-Infinity)"/g,": null").replace(/:\s*""/g,": null").replace(/,(\s*[}\]])/g,"$1"):""}cleanShapeName(e){return e?e.replace(/_governorate$/i,"").replace(/\s+governorate$/i,"").replace(/^_+/,"").replace(/_+/g," ").trim():""}filterFlowsByCommodity(e,t){const r=t.toLowerCase().trim();return e.filter((e=>{var t,i,a;return(null===(t=e.commodity)||void 0===t||null===(i=t.toLowerCase)||void 0===i||null===(i=i.call(t))||void 0===i||null===(a=i.trim)||void 0===a?void 0:a.call(i))===r}))}processAllData(e,t,r,i){if(null==t||!t.time_series_data)throw new Error("Missing time series data");this.filterByDate(r,i);const a=this.processMarketClusters(t.market_clusters,t.time_series_data,i);return{timeSeriesData:t.time_series_data,marketClusters:t.market_clusters,marketShocks:t.market_shocks,clusterEfficiency:t.cluster_efficiency,flowAnalysis:t.flow_analysis,spatialAutocorrelation:t.spatial_autocorrelation,seasonalAnalysis:t.seasonal_analysis,marketIntegration:t.market_integration,metadata:t.metadata,geoJSON:this.createGeoJSON(a.features),flowMaps:r}}processMarketClusters(e,t,r){if(!Array.isArray(e)||!Array.isArray(t))throw new Error("Invalid clusters or time data");const i=[],a=[],n=this.filterByDate(t,r);for(const t of e)try{var o;const e=this.processClusterFeatures(t,n);i.push(...e);const r=e.find((e=>e.properties.isMainMarket&&e.properties.region_id===this.normalizeRegionName(t.main_market))),s=null==r||null===(o=r.geometry)||void 0===o?void 0:o.coordinates;a.push({...t,processed_markets:e.map((e=>e.properties.region_id)),main_market_coordinates:s?{lat:s[1],lng:s[0]}:null})}catch(e){}return{clusters:a,features:i,timeData:n}}processClusterFeatures(e,t){if(null==e||!e.main_market||!Array.isArray(e.connected_markets))throw new Error("Invalid cluster structure");const r=[],i=new Set,a=(a,n)=>{if(!a||i.has(a))return;const o=this.normalizeRegionName(a);if(!o)return;const s=this.geometryCache.get(o);if(!s)return;const l=t.find((e=>this.normalizeRegionName(e.region||e.admin1)===o))||{};r.push({type:"Feature",properties:{region_id:o,originalName:s.properties.originalName,isMainMarket:n,cluster_id:e.cluster_id,market_count:e.market_count,...l},geometry:s.geometry}),i.add(a)};return a(e.main_market,!0),e.connected_markets.forEach((e=>{a(e,!1)})),r}createGeoJSON(e){if(!Array.isArray(e))throw new Error("Invalid features array");return{type:"FeatureCollection",features:e.filter((e=>e&&e.geometry)).map((e=>{const t={...e.properties,region_id:this.normalizeRegionName(e.properties.region_id||e.properties.admin1||e.properties.region),date:e.properties.date||e.properties.month||null,commodity:e.properties.commodity||null};let r={...e.geometry};if("Point"===r.type){const[e,t]=r.coordinates;r.coordinates=[t,e]}return{type:"Feature",properties:t,geometry:r}}))}}processTimeSeriesForVisualization(e){return e.map((e=>({date:e.month,value:e.avgUsdPrice,volatility:e.volatility,conflictIntensity:e.conflict_intensity,sampleSize:e.sampleSize})))}processCorrelationMatrix(e,t){const r={...e},i=t.minCorrelation||0;return Object.keys(r).forEach((e=>{r[e]=Object.fromEntries(Object.entries(r[e]).filter((e=>{let[t,r]=e;return Math.abs(r)>=i})))})),r}processFlowMetrics(e,t){const r=t.minFlowWeight||0,i=e.filter((e=>e.total_flow>=r));return{flows:i,summary:this.calculateFlowSummaryStats(i),intensity:this.calculateFlowIntensityMatrix(i)}}calculateIntegrationScores(e){const{marketIntegration:t,flowAnalysis:r,spatialAutocorrelation:i}=e;return{overall:t.integration_score,byMarket:this.calculateMarketSpecificScores(e),temporal:this.analyzeTemporalIntegration(e),spatial:this.analyzeSpatialIntegration(i,r)}}getCoordinates(e){var t,r;const i=this.normalizeRegionName(e),a=(null===(t=this.geometryCache)||void 0===t?void 0:t.get(i))||(null===(r=this.pointCache)||void 0===r?void 0:r.get(i));return a||null}async getSpatialData(e,t){const r=(null==e?void 0:e.toLowerCase().trim())||"beans (kidney red)",i=`spatial_${r}_${t||"all"}`;return this.deduplicateRequest(i,(async()=>{try{const e=`${h}/data/enhanced_unified_data_with_residual.geojson`,i=await fetch(e,{headers:{Accept:"application/json","Content-Type":"application/json"},credentials:"same-origin"});if(!i.ok){const t=`${h}/results/enhanced_unified_data_with_residual.geojson`,r=await fetch(t);if(!r.ok)throw new Error(`Failed to load enhanced data from both paths: ${e} and ${t}`);i=r}const a=await i.json(),n={...a,features:a.features.filter((e=>{var t;return this.normalizeCommodityName((null===(t=e.properties)||void 0===t?void 0:t.commodity)||"")===this.normalizeCommodityName(r)}))};if(!n.features||0===n.features.length)return{flowMaps:[],timeSeriesData:[],marketClusters:[],marketShocks:[],spatialAutocorrelation:{},commodities:[],metadata:{commodity:r,date:t||"all",timestamp:(new Date).toISOString()}};const o=this.extractCommodities(a),s=await this.processTimeSeriesData(n),l=await this.loadPreprocessedData(r),c=l.flow_analysis?this.processFlowAnalysis(l.flow_analysis):{flows:[],byDate:{},metadata:{}},d=t&&c.byDate[t]?c.byDate[t]:c.flows;return{flowMaps:d,timeSeriesData:s,marketClusters:l.market_clusters||[],marketShocks:l.market_shocks||[],spatialAutocorrelation:l.spatial_autocorrelation||{},commodities:o,metadata:{commodity:r,date:t||"all",timestamp:(new Date).toISOString(),flows:{total:c.metadata.totalFlows,filtered:d.length,dateRange:c.metadata.dateRange}}}}catch(e){throw e}}))}extractCommodities(e){const t=new Set;return e.features&&Array.isArray(e.features)&&e.features.forEach((e=>{e.properties&&e.properties.commodity&&t.add(e.properties.commodity.toLowerCase())})),Array.from(t)}async getDefaultGeoJSON(){try{const e=await this.initializeGeometry();return e?this.createGeoJSON(Array.from(e.values())):this.defaultGeoJSON}catch(e){return this.defaultGeoJSON}}async retryRegressionLoad(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;for(let r=0;r<t;r++)try{const t=await this.loadRegressionAnalysis(e);if(t!==l.vS)return t}catch(e){}return l.vS}validateMarketConnections(e){return!0}}(0,i.A)(y,"_pendingRequests",new Map),(0,i.A)(y,"_instance",null);const f=y.getInstance()},5307:(e,t,r)=>{"use strict";r.d(t,{o:()=>i});const i=new class{constructor(){this.workers=new Map,this.taskQueue=new Map,this.activeWorkers=0,this.maxWorkers=navigator.hardwareConcurrency||4}async getWorker(){for(const[e,t]of this.workers.entries())if(!this.taskQueue.has(e))return{worker:t,id:e};if(this.workers.size<this.maxWorkers){const e=this.workers.size,t=new Worker(new URL(r.p+r.u(659),r.b),{type:void 0});return this.workers.set(e,t),{worker:t,id:e}}return new Promise((e=>{const t=setInterval((()=>{for(const[r,i]of this.workers.entries())if(!this.taskQueue.has(r))return clearInterval(t),void e({worker:i,id:r})}),100)}))}async processData(e,t,r){const{worker:i,id:a}=await this.getWorker();return new Promise(((n,o)=>{const s=e=>{"success"===e.data.type?n(e.data.result):o(new Error(e.data.error)),i.removeEventListener("message",s),this.taskQueue.delete(a)};i.addEventListener("message",s),this.taskQueue.set(a,{type:e,data:t,options:r}),i.postMessage({type:e,data:t,options:r})}))}terminateAll(){for(const e of this.workers.values())e.terminate();this.workers.clear(),this.taskQueue.clear()}}}},e=>{e.O(0,[982],(()=>{return t=33640,e(e.s=t);var t}));e.O()}]);