(()=>{"use strict";var e,t,r={29659:(e,t,r)=>{var a=r(2543),n=r.n(a);function i(e){var t,r;if(!e.length)return{garch:0,traditional:0,stability:0};const a=e[e.length-1],n=null!==(t=a.garch_volatility)&&void 0!==t?t:0,i=null!==(r=a.price_stability)&&void 0!==r?r:0,o=e.reduce(((e,t)=>(null!=t.avgUsdPrice&&e.push(t.avgUsdPrice),e)),[]),s=o.reduce(((e,t)=>e+t),0)/o.length;return{garch:n,traditional:Math.sqrt(o.reduce(((e,t)=>e+Math.pow(t-s,2)),0)/o.length)/s,stability:i}}function o(e){var t,r,a,n;if(!e.market_integration)return null;const{price_correlation:i,flow_density:o,integration_score:s,accessibility:l}=e.market_integration,c=null!==(t=null===(r=e.spatial_autocorrelation)||void 0===r?void 0:r.global)&&void 0!==t?t:{};return{correlationMatrix:null!=i?i:{},flowDensity:null!=o?o:0,integrationScore:null!=s?s:0,spatialDependence:null!==(a=c.moran_i)&&void 0!==a?a:0,accessibility:null!=l?l:{},significance:null!==(n=c.significance)&&void 0!==n&&n}}function s(e){if(!Array.isArray(e)||!e.length)return{efficiency:0,coverage:0,stability:0};const t=e.reduce(((e,t)=>{var r,a,n;return{efficiency:e.efficiency+(null!==(r=t.efficiency_score)&&void 0!==r?r:0),coverage:e.coverage+(null!==(a=t.market_coverage)&&void 0!==a?a:0),stability:e.stability+(null!==(n=t.stability)&&void 0!==n?n:0)}}),{efficiency:0,coverage:0,stability:0}),r=e.length;return{efficiency:t.efficiency/r,coverage:t.coverage/r,stability:t.stability/r}}function l(e){const t=e.map((e=>e.usdprice)).filter((e=>null!=e)),r=e.map((e=>new Date(e.date).getTime()));if(t.length!==r.length||0===t.length)return null;const a=t.length,n=r.reduce(((e,t)=>e+t),0),i=t.reduce(((e,t)=>e+t),0),o=(a*r.reduce(((e,r,a)=>e+r*t[a]),0)-n*i)/(a*r.reduce(((e,t)=>e+t*t),0)-n*n);return{slope:o,intercept:(i-o*n)/a}}function c(e){const t=n().groupBy(e,(e=>new Date(e.date).getMonth())),r=n().mapValues(t,(e=>n().meanBy(e,"usdprice"))),a=n().mean(Object.values(r)),i=Math.sqrt(n().mean(Object.values(r).map((e=>Math.pow(e-a,2)))));return{seasonal:i>.05*a,monthlyAverages:r,stdDev:i}}const u=e=>Array.isArray(e)?e.map((e=>({...e,trend:l([e]),seasonality:c([e]),volatility:i([e]),integration:o([e])}))):[],f=e=>{if(!Array.isArray(e))return{flows:[],byDate:{},metadata:{lastUpdated:(new Date).toISOString(),dateRange:{start:null,end:null}}};const t=e.reduce(((e,t)=>{try{if(!t||"object"!=typeof t)return e;if(!t.source||!t.target||!t.flow_weight)return e;const r=t.date||t.month;if(!r||"string"!=typeof r)return e;const a=r.substring(0,7);return e[a]||(e[a]=[]),e[a].push({source:String(t.source),target:String(t.target),flow_weight:Number(t.flow_weight)||0,price_differential:Number(t.price_differential)||0,source_price:Number(t.source_price)||0,target_price:Number(t.target_price)||0,total_flow:Number(t.total_flow||t.flow_weight)||0,avg_flow:Number(t.avg_flow||t.total_flow||t.flow_weight)||0,flow_count:Number(t.flow_count)||1,date:a}),e}catch(t){return e}}),{}),r=Object.keys(t).sort(),a={start:r[0]||null,end:r[r.length-1]||null},n=Object.values(t).flat();return{flows:n,byDate:t,metadata:{lastUpdated:(new Date).toISOString(),dateRange:a,totalFlows:n.length,uniqueDates:r.length}}},p=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!Array.isArray(e))return[];const{minMarketCount:r=0,minEfficiency:a=0}=t;return e.filter((e=>e.market_count>=r&&s(e)>=a)).map((e=>({...e,efficiency:s(e),processed:!0})))};self.onmessage=async e=>{const{type:t,data:r,options:a}=e.data;try{let e;switch(t){case"processSpatialData":e=(e=>{if(!e||"object"!=typeof e)return null;const{timeSeriesData:t,flowMaps:r,marketClusters:a,marketShocks:n,spatialAutocorrelation:i,regressionAnalysis:o}=e;return{timeSeriesData:u(t),flowData:f(r),marketClusters:p(a),marketShocks:n,spatialAutocorrelation:i,regressionAnalysis:o}})(r);break;case"processTimeSeries":e=u(r);break;case"processFlows":e=f(r);break;case"processClusters":e=p(r,a);break;default:throw new Error(`Unknown processing type: ${t}`)}self.postMessage({type:"success",result:e})}catch(e){self.postMessage({type:"error",error:e.message||"Unknown error in spatial worker"})}}}},a={};function n(e){var t=a[e];if(void 0!==t)return t.exports;var i=a[e]={id:e,loaded:!1,exports:{}};return r[e].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}n.m=r,n.x=()=>{var e=n.O(void 0,[543],(()=>n(29659)));return e=n.O(e)},e=[],n.O=(t,r,a,i)=>{if(!r){var o=1/0;for(u=0;u<e.length;u++){r=e[u][0],a=e[u][1],i=e[u][2];for(var s=!0,l=0;l<r.length;l++)(!1&i||o>=i)&&Object.keys(n.O).every((e=>n.O[e](r[l])))?r.splice(l--,1):(s=!1,i<o&&(o=i));if(s){e.splice(u--,1);var c=a();void 0!==c&&(t=c)}}return t}i=i||0;for(var u=e.length;u>0&&e[u-1][2]>i;u--)e[u]=e[u-1];e[u]=[r,a,i]},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce(((t,r)=>(n.f[r](e,t),t)),[])),n.u=e=>e+".549295ef219449b552fd.js",n.miniCssF=e=>{},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");if(r.length)for(var a=r.length-1;a>-1&&(!e||!/^http(s?):/.test(e));)e=r[a--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e})(),(()=>{var e={659:1};n.f.i=(t,r)=>{e[t]||importScripts(n.p+n.u(t))};var t=self.webpackChunkyemen_market_analysis=self.webpackChunkyemen_market_analysis||[],r=t.push.bind(t);t.push=t=>{var a=t[0],i=t[1],o=t[2];for(var s in i)n.o(i,s)&&(n.m[s]=i[s]);for(o&&o(n);a.length;)e[a.pop()]=1;r(t)}})(),t=n.x,n.x=()=>n.e(543).then(t);n.x()})();